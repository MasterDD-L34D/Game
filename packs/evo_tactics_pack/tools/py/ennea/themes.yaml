version: 0.3.0
metadata:
  dataset_ref: packs/evo_tactics_pack/tools/py/modules/personality/enneagram/enneagramma_dataset.json
  module_ref: packs/evo_tactics_pack/tools/py/modules/personality/enneagram/personality_module.v1.json
  compat_ref: packs/evo_tactics_pack/tools/py/modules/personality/enneagram/compat_map.json
  schema_ref: packs/evo_tactics_pack/tools/py/modules/personality/enneagram/enneagramma_schema.json
  notes: docs/evo-tactics-pack/ennea-themes.md
themes:
  - id: reformer_1
    name: "Riformatore (1) — Biome Coherence"
    summary: "Mantiene coerenza tra biomi, affissi e mutazioni riducendo l'entropia ambientale."
    requirements:
      telemetry:
        - metric: cohesion
          threshold: 0.62
          window: rolling_two_encounters
        - metric: setup
          threshold: 0.55
          window: rolling_two_encounters
      biome_tags:
        include:
          - vc_adapt
          - mutations_control
          - low_entropy
      mating_preferences:
        include:
          - cohesion
          - preparation
    triggers:
      - on_setback
    trigger_details:
      on_setback:
        telemetry_metrics:
          - cohesion
          - setup
        dataset_refs:
          - themes.reformer_1
          - triads."Centri (emozione di base)"[0]
    effects:
      - La prossima prova ottiene +1 (1/scene)
    effect_details:
      primary:
        description: "La prossima prova collegata ai biomi ottiene +1 (1/scene)."
        stats:
          - skill_success
        hooks:
          - theme.reformer_1
          - triad.core_emotion.rabbia
        compatibility:
          stats:
            skill_success: compat.stats.skill_success
          events:
            - on_setback
    synergies:
      triads:
        - triad.core_emotion.rabbia
      hornevian:
        - hornevian.obbediente
      harmonic:
        - harmonic.competenti
    notes:
      - "Baseline per generatori Ennea e audit coerenza dati ↔ biomi."
      - "Innesca sincronizzazione VC con adattamenti attivi nel cluster biome-coherence."
  - id: helper_2
    name: "Aiutante (2) — Coordinatore"
    summary: "Potenzia supporto continuo, gestione scudi e recupero risorse in squadre coese."
    requirements:
      telemetry:
        - metric: cohesion
          threshold: 0.70
          window: mission_average
        - metric: assist_density
          threshold: 0.40
          window: mission_average
      mating_preferences:
        include:
          - assist
          - shield_share
          - revive
    triggers:
      - on_ally_downed
      - on_coordinate_action
    trigger_details:
      on_ally_downed:
        telemetry_metrics:
          - cohesion
          - assist_density
        dataset_refs:
          - themes.helper_2
          - triads."Harmonic (gestione del conflitto)"[0]
      on_coordinate_action:
        telemetry_metrics:
          - cohesion
        dataset_refs:
          - themes.helper_2
    effects:
      - +1 potere di supporto al prossimo aiuto (1/incontro)
      - Rigenerazione scudi addizionale su azioni coordinate
    effect_details:
      support_spike:
        stats:
          - support_power
          - bond_aura
        hooks:
          - theme.helper_2
          - harmonic.ottimisti
        compatibility:
          stats:
            support_power: compat.stats.support_power
            bond_aura: compat.stats.bond_aura
          events:
            - on_ally_downed
            - on_coordinate_action
      shield_regen:
        description: "Restituisce scudi pari al 10% del valore mancante dopo un assist riuscito."
        stats:
          - hp_max
        hooks:
          - triad.core_emotion.vergogna
    synergies:
      triads:
        - triad.core_emotion.vergogna
      hornevian:
        - hornevian.obbediente
      harmonic:
        - harmonic.ottimisti
    notes:
      - "Consigliato per tutorial e stress test di adattamenti cohesion_high."
      - "Attiva carte reazione gratuite attraverso compatibilità alias `assist` nel compat_map."
  - id: achiever_3
    name: "Conquistatore (3) — Pressione Coordinata"
    summary: "Premia pressione aggressiva mantenuta con finisher sincronizzati e gestione dell'immagine."
    requirements:
      telemetry:
        - metric: aggro
          threshold: 0.65
          window: rolling_two_encounters
        - metric: risk
          threshold: 0.55
          window: rolling_two_encounters
      mating_preferences:
        include:
          - first_strike
          - finisher
          - image_management
    triggers:
      - on_finisher_hit
      - on_initiative_win
    trigger_details:
      on_finisher_hit:
        telemetry_metrics:
          - aggro
          - risk
        dataset_refs:
          - themes.achiever_3
      on_initiative_win:
        telemetry_metrics:
          - risk
        dataset_refs:
          - themes.achiever_3
    effects:
      - +1 PP immediato (1/incontro)
      - Recupero stamina dopo first_strike riuscito
    effect_details:
      pp_gain:
        stats:
          - pp
          - initiative_adv
        hooks:
          - theme.achiever_3
          - harmonic.competenti
        compatibility:
          stats:
            pp: compat.stats.pp
            initiative_adv: compat.stats.initiative_adv
          events:
            - on_finisher_hit
      stamina_recovery:
        description: "Recupera 1 segmento stamina quando `first_strike` rimane sopra la soglia di rischio."
        stats:
          - stamina_regen
        hooks:
          - triad.core_emotion.vergogna
    synergies:
      triads:
        - triad.core_emotion.vergogna
      hornevian:
        - hornevian.assertivo
      harmonic:
        - harmonic.competenti
    notes:
      - "Monitorare `overcap_guard` per evitare picchi di tilt durante i playtest."
      - "Integra preferenze di mating `image_management` per reazioni narrative."
  - id: individual_4
    name: "Individualista (4) — Sintonizzatore"
    summary: "Orchestra pattern estetici/tattici alternando rigore e improvvisazione controllata."
    requirements:
      telemetry:
        - metric: pattern_entropy
          threshold: 0.58
          window: mission_average
        - metric: cover_discipline
          threshold: 0.52
          window: mission_average
        - metric: time_to_commit
          threshold: 4.5
          window: seconds
      mating_preferences:
        include:
          - signature_pattern
          - style_variation
    triggers:
      - on_isolation
      - on_goal_blocked
    trigger_details:
      on_isolation:
        telemetry_metrics:
          - pattern_entropy
        dataset_refs:
          - themes.individual_4
      on_goal_blocked:
        telemetry_metrics:
          - cover_discipline
        dataset_refs:
          - themes.individual_4
    effects:
      - +1 danno al prossimo attacco (1/incontro)
      - Swap istantaneo di una carta abilità estetica
    effect_details:
      burst_bonus:
        stats:
          - burst_damage
        hooks:
          - theme.individual_4
          - harmonic.reattivi
        compatibility:
          stats:
            burst_damage: compat.stats.burst_damage
          events:
            - on_isolation
      style_swap:
        description: "Consente un cambio carta abilità senza costo quando l'entropia supera la soglia."
        stats:
          - charisma_checks
          - stealth
        hooks:
          - hornevian.ritirato
    synergies:
      triads:
        - triad.core_emotion.vergogna
      hornevian:
        - hornevian.ritirato
      harmonic:
        - harmonic.reattivi
    notes:
      - "Usato per seed signature e documentazione di varianti visive nei biomi sintetici."
      - "Richiede telemetria MBTI `S_N`/`J_P` per pattern estetici."
  - id: investigator_5
    name: "Investigatore (5) — Architetto"
    summary: "Valorizza pianificazione pre-battaglia, overwatch e controllo di trappole."
    requirements:
      telemetry:
        - metric: setup
          threshold: 0.70
          window: mission_average
        - metric: trap_conversion
          threshold: 0.45
          window: mission_average
      mating_preferences:
        include:
          - overwatch
          - trap_layer
          - resource_bank
    triggers:
      - on_stealth_start
      - on_skill_check_under_pressure
    trigger_details:
      on_stealth_start:
        telemetry_metrics:
          - setup
        dataset_refs:
          - themes.investigator_5
      on_skill_check_under_pressure:
        telemetry_metrics:
          - trap_conversion
        dataset_refs:
          - themes.investigator_5
    effects:
      - +1 Furtività fino a fine turno (1/incontro)
      - Recupero punti abilità dopo trappola riuscita
    effect_details:
      stealth_buff:
        stats:
          - stealth
        hooks:
          - theme.investigator_5
          - harmonic.competenti
        compatibility:
          stats:
            stealth: compat.stats.stealth
          events:
            - on_stealth_start
      trap_recovery:
        description: "Restituisce 1 punto abilità quando una trappola collegata converte sopra il 45%."
        stats:
          - skill_success
          - stamina_regen
        hooks:
          - triad.core_emotion.paura
    synergies:
      triads:
        - triad.core_emotion.paura
      hornevian:
        - hornevian.ritirato
      harmonic:
        - harmonic.competenti
    notes:
      - "Integra blueprint pre-missione e alimenta seed difensivi."
      - "Ottimizzare con dataset `compat_map` per alias trap-specifici."
  - id: loyalist_6
    name: "Lealista (6) — Telemetry Sync"
    summary: "Garantisce sincronizzazione infrastruttura telemetrica e resilienza alert VC."
    requirements:
      telemetry:
        - metric: ema_alpha
          threshold: 0.25
          window: config
        - metric: debounce_ms
          threshold: 180
          window: config
        - metric: idle_threshold_s
          threshold: 12
          window: config
      mating_preferences:
        include:
          - safety_net
          - logistics
          - diagnostics
    triggers:
      - on_adjacent_ally
      - on_setback
    trigger_details:
      on_adjacent_ally:
        telemetry_metrics:
          - ema_alpha
        dataset_refs:
          - themes.loyalist_6
      on_setback:
        telemetry_metrics:
          - idle_threshold_s
        dataset_refs:
          - themes.loyalist_6
    effects:
      - +1 AC finché resti adiacente (1/turno)
      - Smoothing EMA e report live su telemetria valida
    effect_details:
      adjacency_buff:
        stats:
          - ac
          - bond_aura
        hooks:
          - theme.loyalist_6
          - hornevian.obbediente
        compatibility:
          stats:
            ac: compat.stats.ac
            bond_aura: compat.stats.bond_aura
          events:
            - on_adjacent_ally
      telemetry_stream:
        description: "Stabilizza segnali EMA e attiva report live quando i parametri restano in range per 3 missioni."
        stats:
          - self_reliance
        hooks:
          - triad.core_emotion.paura
    synergies:
      triads:
        - triad.core_emotion.paura
      hornevian:
        - hornevian.obbediente
      harmonic:
        - harmonic.reattivi
    notes:
      - "Prerequisito per campagne pubbliche; richiede audit log `logs/playtests/*/session-metrics.yaml`."
      - "Valori baseline per smoothing fino a nuovo bilanciamento."
  - id: enthusiast_7
    name: "Esploratore (7) — Rotte Opzionali"
    summary: "Incentiva scoperte opzionali, movimento bonus e mutazioni esplorative."
    requirements:
      telemetry:
        - metric: explore
          threshold: 0.70
          window: mission_average
        - metric: optional_objectives
          threshold: 2
          window: per_mission
      mating_preferences:
        include:
          - optional_discovery
          - scouting
          - novelty_seek
    triggers:
      - on_new_area_discovered
      - on_initiative_win
    trigger_details:
      on_new_area_discovered:
        telemetry_metrics:
          - explore
        dataset_refs:
          - themes.enthusiast_7
      on_initiative_win:
        telemetry_metrics:
          - optional_objectives
        dataset_refs:
          - themes.enthusiast_7
    effects:
      - +1 PE (1/incontro)
      - Movimento gratuito su tile consecutivi scoperti
    effect_details:
      pe_bonus:
        stats:
          - pe
          - initiative
        hooks:
          - theme.enthusiast_7
          - harmonic.ottimisti
        compatibility:
          stats:
            pe: compat.stats.pe
            initiative: compat.stats.initiative
          events:
            - on_new_area_discovered
      free_move:
        description: "Concede un passo bonus quando vengono scoperti due tile consecutivi nello stesso turno."
        stats:
          - stamina_regen
        hooks:
          - triad.core_emotion.paura
    synergies:
      triads:
        - triad.core_emotion.paura
      hornevian:
        - hornevian.assertivo
      harmonic:
        - harmonic.ottimisti
    notes:
      - "Raccoglie log per bilanciare affissi esplorativi nei biomi adattivi."
      - "Abilita mutazioni T0 bonus attraverso dataset `themes[*].linked_stats`."
  - id: challenger_8
    name: "Dominatore (8) — Baluardo"
    summary: "Trasforma rischio controllato in dominanza difensiva e contrattacchi potenziati."
    requirements:
      telemetry:
        - metric: risk
          threshold: 0.68
          window: rolling_two_encounters
        - metric: damage_taken_window
          threshold: 0.35
          window: rolling_two_encounters
      biome_tags:
        include:
          - risk_high
          - impact_knockback
    triggers:
      - on_damage_taken_then_counter
      - on_first_blood_received
    trigger_details:
      on_damage_taken_then_counter:
        telemetry_metrics:
          - risk
        dataset_refs:
          - themes.challenger_8
      on_first_blood_received:
        telemetry_metrics:
          - damage_taken_window
        dataset_refs:
          - themes.challenger_8
    effects:
      - +1 danno al prossimo contrattacco (1/incontro)
      - Riduzione danni post overcap_guard
    effect_details:
      counter_bonus:
        stats:
          - counter_chance
          - melee_damage
        hooks:
          - theme.challenger_8
          - triad.core_emotion.rabbia
        compatibility:
          stats:
            counter_chance: compat.stats.counter_chance
            melee_damage: compat.stats.melee_damage
          events:
            - on_damage_taken_then_counter
      guard_reduction:
        description: "Riduce del 5% i danni successivi al trigger finché dura l'incontro."
        stats:
          - burst_damage
        hooks:
          - harmonic.reattivi
    synergies:
      triads:
        - triad.core_emotion.rabbia
      hornevian:
        - hornevian.assertivo
      harmonic:
        - harmonic.reattivi
    notes:
      - "Ideale per missioni difesa/ondata con affissi ad alta pressione."
      - "Interagisce con adattamenti `risk_high` e log `damage_taken_window`."
  - id: peacemaker_9
    name: "Pacificatore (9) — Stoico"
    summary: "Mitiga tilt e mantiene equilibrio mentale della squadra nelle campagne lunghe."
    requirements:
      telemetry:
        - metric: tilt
          threshold: 0.65
          window: rolling_three_checks
        - metric: recovery_time
          threshold: 18
          window: seconds
      mating_preferences:
        include:
          - calming_protocol
          - mediation
          - stability_anchor
    triggers:
      - on_coordinate_action
      - on_setback
    trigger_details:
      on_coordinate_action:
        telemetry_metrics:
          - tilt
        dataset_refs:
          - themes.peacemaker_9
      on_setback:
        telemetry_metrics:
          - recovery_time
        dataset_refs:
          - themes.peacemaker_9
    effects:
      - +1 potere di supporto al coordinamento (1/incontro)
      - Recupero morale a fine fase
    effect_details:
      support_coordination:
        stats:
          - support_power
          - bond_aura
        hooks:
          - theme.peacemaker_9
          - harmonic.ottimisti
        compatibility:
          stats:
            support_power: compat.stats.support_power
            bond_aura: compat.stats.bond_aura
          events:
            - on_coordinate_action
      morale_recovery:
        description: "Ripristina 1 punto morale se il tilt rientra sotto 0.35 entro due turni."
        stats:
          - stamina_regen
        hooks:
          - triad.core_emotion.rabbia
    synergies:
      triads:
        - triad.core_emotion.rabbia
      hornevian:
        - hornevian.ritirato
      harmonic:
        - harmonic.ottimisti
    notes:
      - "Suggerisce pause tattiche programmate e segnali calmanti nei playtest estesi."
      - "Compatibile con piani di resilienza mentale per campagne cooperative."
notes:
  - "Ogni tema allinea `requirements.telemetry` con i dataset `themes[*].requirements` del modulo Enneagramma."
  - "`effect_details.*.compatibility` punta agli alias definiti in compat_map.json per agganci rapidi negli script di generatori."
  - "`synergies` elenca i hook secondari attivati dai profili Enneagramma (triadi, Hornevian, Harmonic)."
