<!doctype html><html><head><meta charset="utf-8">
<title>Specie â€” Indice & Filtri</title>
<style>
body{font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;margin:24px;color:#222}
h1{margin:8px 0} .row{display:flex;gap:12px;flex-wrap:wrap;margin:8px 0}
select,input{padding:6px 8px;border:1px solid #e5e7eb;border-radius:8px}
.card{border:1px solid #e5e7eb;border-radius:12px;padding:14px;margin:10px 0}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:12px}
.badge{display:inline-block;padding:2px 8px;border-radius:10px;background:#eef2ff;color:#3730a3;margin-right:6px;font-size:12px}
.small{font-size:12px;color:#6b7280}
a{color:#2563eb;text-decoration:none} a:hover{text-decoration:underline}
</style></head><body>
<h1>Indice Specie</h1>
<div class="row">
  <label>Bioma <select id="biome"></select></label>
  <label>Ruolo trofico <select id="role"></select></label>
  <label>Tag funzionali <select id="tag"></select></label>
  <input id="q" placeholder="Cerca nome/specie..." />
  <button id="clear">Reset</button>
</div>
<div id="count" class="small"></div>
<div id="list" class="grid"></div>

<script>
let data={};
async function load(){
  const res=await fetch('catalog_data.json'); data=await res.json();
  const biomes=[...new Set(data.species.flatMap(s=>s.biomes))].sort();
  const roles=[...new Set(data.species.map(s=>s.role_trofico).filter(Boolean))].sort();
  const tags=[...new Set(data.species.flatMap(s=>s.functional_tags||[]))].sort();
  fill('biome',['(tutti)',...biomes]);
  fill('role',['(tutti)',...roles]);
  fill('tag',['(tutti)',...tags]);
  render();
}
function fill(id,opts){
  const sel=document.getElementById(id);
  sel.innerHTML='';
  for(const o of opts){
    const e=document.createElement('option'); e.value=o; e.textContent=o; sel.appendChild(e);
  }
}
function render(){
  const selB=document.getElementById('biome').value;
  const selR=document.getElementById('role').value;
  const selT=document.getElementById('tag').value;
  const q=(document.getElementById('q').value||'').toLowerCase();
  let items=data.species;
  if(selB && selB!=='(tutti)') items=items.filter(s=>s.biomes.includes(selB));
  if(selR && selR!=='(tutti)') items=items.filter(s=>s.role_trofico===selR);
  if(selT && selT!=='(tutti)') items=items.filter(s=>(s.functional_tags||[]).includes(selT));
  if(q) items=items.filter(s=> (s.display_name||'').toLowerCase().includes(q) || (s.id||'').toLowerCase().includes(q));
  document.getElementById('count').textContent = `${items.length} specie`;
  const list=document.getElementById('list'); list.innerHTML='';
  for(const s of items){
    const card=document.createElement('div'); card.className='card';
    const flags = Object.keys(s.flags||{}).filter(k=>s.flags[k]).join(', ');
    card.innerHTML = `<div><strong>${s.display_name}</strong> <span class="small">(${s.id})</span></div>
      <div class="small">Biomi: ${s.biomes.join(', ')}</div>
      <div class="small">Ruolo: ${s.role_trofico||'-'}</div>
      <div>${(s.functional_tags||[]).map(t=>`<span class='badge'>${t}</span>`).join('')}</div>
      <div class="small">${flags? 'Flags: '+flags : ''}</div>
      <div class="small"><a href="../..//${s.path}">Apri YAML</a></div>`;
    list.appendChild(card);
  }
}
['biome','role','tag','q'].forEach(id=>document.getElementById(id).addEventListener('input',render));
document.getElementById('clear').onclick=()=>{ ['biome','role','tag','q'].forEach(id=>{ const el=document.getElementById(id); if(el.tagName==='SELECT') el.selectedIndex=0; else el.value=''; }); render(); };
load();
</script>
</body></html>
