{
  "version": 3,
  "sources": ["../../services/api/generatorClient.ts", "pack-data.js", "ui/elements.ts", "views/anchor.js", "state/session.ts", "utils/ids.ts", "utils/normalizers.ts", "utils/serializers.ts", "services/storage.ts", "services/audio.ts", "../../services/export/dossier.ts", "views/parameters.js", "views/traits.js", "views/biomes.js", "views/seeds.js", "views/composer.js", "views/insights.js", "views/activity.js", "views/export.js", "generator.js"],
  "sourcesContent": ["type FetchImplementation = (input: RequestInfo | URL, init?: RequestInit) => Promise<Response>;\n\nexport interface GeneratorCatalogContext {\n  resolvedBase: string | null;\n  docsBase: string | null;\n  catalogUrl: string | null;\n  apiBase?: string | null;\n  resolveDocHref(relativePath: string): string;\n  resolvePackHref(relativePath: string): string;\n}\n\nexport interface FetchCatalogOptions {\n  candidates?: string[];\n  fetchImpl?: FetchImplementation;\n  signal?: AbortSignal;\n}\n\nexport interface CatalogFetchResult {\n  data: unknown;\n  context: GeneratorCatalogContext;\n}\n\nexport interface FetchResourceOptions {\n  context?: GeneratorCatalogContext | null;\n  candidates: string[];\n  fetchImpl?: FetchImplementation;\n  signal?: AbortSignal;\n}\n\nexport interface ResourceFetchResult<T> {\n  data: T | null;\n  url: string | null;\n  fromFallback: boolean;\n}\n\nexport interface FetchSpeciesOptions {\n  context?: GeneratorCatalogContext | null;\n  speciesId?: string | null;\n  fetchImpl?: FetchImplementation;\n  signal?: AbortSignal;\n}\n\nfunction ensureTrailingSlash(value: string | null | undefined): string | null {\n  if (!value) return value ?? null;\n  return value.endsWith('/') ? value : `${value}/`;\n}\n\nfunction resolveRelative(path: string, base: string | null | undefined): string {\n  if (!base) {\n    return path;\n  }\n  try {\n    return new URL(path, base).toString();\n  } catch (primaryError) {\n    try {\n      if (typeof window !== 'undefined' && typeof window.location?.href === 'string') {\n        const absoluteBase = new URL(base, window.location.href).toString();\n        return new URL(path, absoluteBase).toString();\n      }\n    } catch (secondaryError) {\n      console.warn('Impossibile normalizzare la base relativa', base, secondaryError);\n    }\n    console.warn('Impossibile risolvere il percorso relativo', path, base, primaryError);\n    const separator = base.endsWith('/') ? '' : '/';\n    return `${base}${separator}${path}`;\n  }\n}\n\nasync function fetchJson<T>(\n  url: string,\n  fetchImpl: FetchImplementation,\n  signal?: AbortSignal,\n): Promise<T> {\n  const response = await fetchImpl(url, { signal });\n  if (!response.ok) {\n    throw new Error(`HTTP ${response.status}`);\n  }\n  return (await response.json()) as T;\n}\n\nfunction createContext(base: string): GeneratorCatalogContext {\n  const resolvedBase = ensureTrailingSlash(base);\n  let docsBase: string | null = null;\n  try {\n    const resolvedDocs = resolveRelative('docs/catalog/', resolvedBase);\n    docsBase = ensureTrailingSlash(resolvedDocs);\n  } catch (error) {\n    console.warn('Impossibile determinare la base documenti del pack', error);\n    docsBase = null;\n  }\n\n  const resolveDocHref = (relativePath: string): string => {\n    if (docsBase) {\n      return resolveRelative(relativePath, docsBase);\n    }\n    return resolveRelative(relativePath, resolvedBase);\n  };\n\n  const resolvePackHref = (relativePath: string): string =>\n    resolveRelative(relativePath, resolvedBase);\n\n  return {\n    resolvedBase,\n    docsBase,\n    catalogUrl: resolveDocHref('catalog_data.json'),\n    resolveDocHref,\n    resolvePackHref,\n  };\n}\n\nasync function fetchFromCandidates<T>(\n  options: FetchResourceOptions,\n): Promise<ResourceFetchResult<T>> {\n  const { context, candidates, fetchImpl = globalThis.fetch, signal } = options;\n  if (typeof fetchImpl !== 'function') {\n    return { data: null, url: null, fromFallback: false };\n  }\n\n  const tried = new Set<string>();\n  let lastError: unknown = null;\n\n  const resolveCandidate = (candidate: string): string => {\n    if (context?.resolveDocHref) {\n      try {\n        return context.resolveDocHref(candidate);\n      } catch (error) {\n        console.warn('Impossibile risolvere la risorsa tramite resolveDocHref', candidate, error);\n      }\n    }\n    if (context?.resolvePackHref) {\n      try {\n        return context.resolvePackHref(candidate);\n      } catch (error) {\n        console.warn('Impossibile risolvere la risorsa tramite resolvePackHref', candidate, error);\n      }\n    }\n    if (context?.resolvedBase) {\n      return resolveRelative(candidate, context.resolvedBase);\n    }\n    return candidate;\n  };\n\n  for (const candidate of candidates) {\n    if (!candidate) continue;\n    const url = resolveCandidate(candidate);\n    if (!url || tried.has(url)) continue;\n    tried.add(url);\n    try {\n      const data = await fetchJson<T>(url, fetchImpl, signal);\n      return { data, url, fromFallback: candidate.startsWith('../') || candidate.startsWith('./') };\n    } catch (error) {\n      lastError = error;\n      console.warn('Tentativo di caricamento risorsa fallito', url, error);\n    }\n  }\n\n  if (lastError) {\n    throw lastError instanceof Error\n      ? lastError\n      : new Error(String(lastError ?? 'Errore sconosciuto'));\n  }\n  return { data: null, url: null, fromFallback: false };\n}\n\nfunction localAsset(relativePath: string): string | null {\n  try {\n    return new URL(relativePath, import.meta.url).toString();\n  } catch (error) {\n    console.warn('Impossibile calcolare il percorso locale', relativePath, error);\n    return null;\n  }\n}\n\nexport async function fetchCatalog(options: FetchCatalogOptions = {}): Promise<CatalogFetchResult> {\n  const { candidates = [], fetchImpl = globalThis.fetch, signal } = options;\n  if (typeof fetchImpl !== 'function') {\n    throw new Error(\"fetch non disponibile nell'ambiente corrente\");\n  }\n\n  let lastError: unknown = null;\n\n  for (const base of candidates) {\n    if (!base) continue;\n    try {\n      const context = createContext(base);\n      const catalogUrl = resolveRelative('docs/catalog/catalog_data.json', context.resolvedBase);\n      const data = await fetchJson<unknown>(catalogUrl, fetchImpl, signal);\n      context.catalogUrl = catalogUrl;\n      return { data, context };\n    } catch (error) {\n      lastError = error;\n      console.warn('Tentativo di caricamento del catalogo fallito', base, error);\n    }\n  }\n\n  const manualFallback = localAsset('../../docs/evo-tactics-pack/catalog_data.json');\n  if (manualFallback) {\n    try {\n      const data = await fetchJson<unknown>(manualFallback, fetchImpl, signal);\n      const context = createContext('../../docs/evo-tactics-pack/');\n      context.catalogUrl = manualFallback;\n      return { data, context };\n    } catch (error) {\n      lastError = error;\n      console.warn('Caricamento del catalogo dal fallback locale fallito', error);\n    }\n  }\n\n  const message =\n    \"Impossibile caricare il catalogo del pack da alcuna sorgente candidata. Controlla la connessione o l'URL di base.\";\n  if (lastError instanceof Error) {\n    const composed = new Error(message, { cause: lastError });\n    throw composed;\n  }\n  throw new Error(message);\n}\n\nexport async function fetchTraitRegistry(\n  options: FetchResourceOptions,\n): Promise<ResourceFetchResult<Record<string, unknown>>> {\n  const fallback = localAsset('../../docs/evo-tactics-pack/env-traits.json');\n  const candidates = [...options.candidates];\n  if (fallback) {\n    candidates.push(fallback);\n  }\n  const result = await fetchFromCandidates<Record<string, unknown>>({\n    ...options,\n    candidates,\n  });\n  if (fallback && result.url === fallback) {\n    return { ...result, fromFallback: true };\n  }\n  return result;\n}\n\nexport async function fetchTraitReference(\n  options: FetchResourceOptions,\n): Promise<ResourceFetchResult<Record<string, unknown>>> {\n  const fallback = localAsset('../../docs/evo-tactics-pack/trait-reference.json');\n  const candidates = [...options.candidates];\n  if (fallback) {\n    candidates.push(fallback);\n  }\n  const result = await fetchFromCandidates<Record<string, unknown>>({\n    ...options,\n    candidates,\n  });\n  if (fallback && result.url === fallback) {\n    return { ...result, fromFallback: true };\n  }\n  return result;\n}\n\nexport async function fetchTraitGlossary(\n  options: FetchResourceOptions,\n): Promise<ResourceFetchResult<Record<string, unknown>>> {\n  const fallback = localAsset('../../docs/evo-tactics-pack/trait-glossary.json');\n  const candidates = [...options.candidates];\n  if (fallback) {\n    candidates.push(fallback);\n  }\n  const result = await fetchFromCandidates<Record<string, unknown>>({\n    ...options,\n    candidates,\n  });\n  if (fallback && result.url === fallback) {\n    return { ...result, fromFallback: true };\n  }\n  return result;\n}\n\nexport async function fetchHazardRegistry(\n  options: FetchResourceOptions,\n): Promise<ResourceFetchResult<Record<string, unknown>>> {\n  const fallback = localAsset('../../docs/evo-tactics-pack/hazards.json');\n  const candidates = [...options.candidates];\n  if (fallback) {\n    candidates.push(fallback);\n  }\n  const result = await fetchFromCandidates<Record<string, unknown>>({\n    ...options,\n    candidates,\n  });\n  if (fallback && result.url === fallback) {\n    return { ...result, fromFallback: true };\n  }\n  return result;\n}\n\nexport async function fetchSpecies(\n  options: FetchSpeciesOptions,\n): Promise<ResourceFetchResult<unknown>> {\n  const { context, speciesId, fetchImpl = globalThis.fetch, signal } = options;\n  const baseCandidates: string[] = [];\n  if (speciesId) {\n    const normalized = speciesId.replace(/\\.json$/i, '');\n    baseCandidates.push(`docs/catalog/species/${normalized}.json`);\n    baseCandidates.push(`data/species/${normalized}.json`);\n  } else {\n    baseCandidates.push('docs/catalog/species/index.json');\n    baseCandidates.push('docs/catalog/species.json');\n  }\n  const fallback = localAsset('../../docs/evo-tactics-pack/species-index.json');\n  if (fallback) {\n    baseCandidates.push(fallback);\n  }\n\n  try {\n    const result = await fetchFromCandidates<unknown>({\n      context,\n      candidates: baseCandidates,\n      fetchImpl,\n      signal,\n    });\n    if (fallback && result.url === fallback) {\n      return { ...result, fromFallback: true };\n    }\n    return result;\n  } catch (error) {\n    console.warn('Impossibile caricare le informazioni sulle specie richieste', speciesId, error);\n    return { data: null, url: null, fromFallback: false };\n  }\n}\n", "import { fetchCatalog } from '../../services/api/generatorClient.ts';\n\nexport const PACK_PATH = 'packs/evo_tactics_pack/';\nexport const DEFAULT_BRANCH = 'main';\n\nexport function ensureTrailingSlash(value) {\n  if (!value) return value;\n  return value.endsWith('/') ? value : `${value}/`;\n}\n\nexport function normalizeBase(value) {\n  if (!value) return null;\n  try {\n    const absolute = new URL(value, window.location.href);\n    return ensureTrailingSlash(absolute.toString());\n  } catch (error) {\n    console.warn('Impossibile normalizzare la base dati', value, error);\n    return ensureTrailingSlash(value);\n  }\n}\n\nexport function detectRepoBase() {\n  try {\n    const origin = window.location.origin;\n    if (!origin || origin === 'null') {\n      return null;\n    }\n\n    const segments = window.location.pathname.split('/').filter(Boolean);\n    const withoutFile = segments.slice(0, Math.max(segments.length - 1, 0));\n    let baseSegments = [];\n\n    if (window.location.hostname.endsWith('github.io')) {\n      if (withoutFile.length > 0) {\n        baseSegments = [withoutFile[0]];\n      }\n    } else {\n      const docsIndex = withoutFile.indexOf('docs');\n      if (docsIndex > 0) {\n        baseSegments = withoutFile.slice(0, docsIndex);\n      } else if (docsIndex === 0) {\n        baseSegments = [];\n      } else if (withoutFile.length > 1) {\n        baseSegments = withoutFile.slice(0, withoutFile.length - 1);\n      }\n    }\n\n    const basePath = baseSegments.length ? `/${baseSegments.join('/')}/` : '/';\n    return ensureTrailingSlash(`${origin}${basePath}`);\n  } catch (error) {\n    console.warn('Impossibile determinare la base del repository', error);\n    return null;\n  }\n}\n\nexport function detectPackRootOverride() {\n  try {\n    const params = new URLSearchParams(window.location.search);\n    const override =\n      params.get('pack-root') ||\n      document.querySelector('meta[name=\"pack-root\"]')?.getAttribute('content');\n    return normalizeBase(override);\n  } catch (error) {\n    console.warn(\"Impossibile leggere l'override della base pack\", error);\n    return null;\n  }\n}\n\nexport function detectGitHubRawRoot() {\n  if (!window.location.hostname.endsWith('github.io')) {\n    return null;\n  }\n\n  const owner =\n    document.querySelector('meta[name=\"data-owner\"]')?.getAttribute('content') ||\n    window.location.hostname.split('.')[0];\n  const pathParts = window.location.pathname.split('/').filter(Boolean);\n  const repo =\n    document.querySelector('meta[name=\"data-repo\"]')?.getAttribute('content') || pathParts[0] || '';\n  const params = new URLSearchParams(window.location.search);\n  const branch =\n    params.get('ref') ||\n    document.querySelector('meta[name=\"data-branch\"]')?.getAttribute('content') ||\n    DEFAULT_BRANCH;\n\n  if (!owner || !repo) {\n    return null;\n  }\n\n  return ensureTrailingSlash(\n    `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${PACK_PATH}`,\n  );\n}\n\nexport function candidatePackRoots() {\n  const candidates = [];\n\n  const override = detectPackRootOverride();\n  if (override) {\n    candidates.push(override);\n  }\n\n  const githubRaw = detectGitHubRawRoot();\n  if (githubRaw) {\n    candidates.push(githubRaw);\n  }\n\n  const repoBase = detectRepoBase();\n  if (repoBase) {\n    try {\n      candidates.push(ensureTrailingSlash(new URL(PACK_PATH, repoBase).toString()));\n    } catch (error) {\n      console.warn('Impossibile costruire la base dati dal repository', error);\n    }\n  }\n\n  try {\n    candidates.push(\n      ensureTrailingSlash(new URL(`../${PACK_PATH}`, window.location.href).toString()),\n    );\n  } catch (error) {\n    console.warn('Impossibile calcolare la base dati relativa', error);\n  }\n\n  if (window.location.origin && window.location.origin !== 'null') {\n    const origin = window.location.origin.endsWith('/')\n      ? window.location.origin\n      : `${window.location.origin}/`;\n    candidates.push(ensureTrailingSlash(`${origin}${PACK_PATH}`));\n  }\n\n  candidates.push(ensureTrailingSlash(PACK_PATH));\n\n  return Array.from(new Set(candidates.filter(Boolean)));\n}\n\nconst PACK_ROOT_CANDIDATES = candidatePackRoots();\n\nexport function resolveRelative(relativePath, base) {\n  if (!relativePath) return relativePath;\n  if (!base) return relativePath;\n  try {\n    return new URL(relativePath, base).toString();\n  } catch (error) {\n    console.warn('Impossibile risolvere il percorso relativo', relativePath, base, error);\n    return relativePath;\n  }\n}\n\nexport function getPackRootCandidates() {\n  return [...PACK_ROOT_CANDIDATES];\n}\n\nexport async function loadCatalogFromCandidates(candidates = PACK_ROOT_CANDIDATES) {\n  return fetchCatalog({ candidates });\n}\n\nexport async function manualLoadCatalog(options = {}) {\n  const { candidates = PACK_ROOT_CANDIDATES } = options;\n  return loadCatalogFromCandidates(candidates);\n}\n\nexport async function loadPackCatalog(options = {}) {\n  const { candidates = PACK_ROOT_CANDIDATES } = options;\n  return loadCatalogFromCandidates(candidates);\n}\n\nif (typeof window !== 'undefined') {\n  window.EvoPack = window.EvoPack || {};\n  window.EvoPack.utils = window.EvoPack.utils || {};\n  window.EvoPack.PACK_PATH = PACK_PATH;\n  window.EvoPack.DEFAULT_BRANCH = DEFAULT_BRANCH;\n  window.EvoPack.packRootCandidates = [...PACK_ROOT_CANDIDATES];\n  window.EvoPack.utils.ensureTrailingSlash = ensureTrailingSlash;\n  window.EvoPack.utils.normalizeBase = normalizeBase;\n  window.EvoPack.utils.detectRepoBase = detectRepoBase;\n  window.EvoPack.utils.detectPackRootOverride = detectPackRootOverride;\n  window.EvoPack.utils.detectGitHubRawRoot = detectGitHubRawRoot;\n  window.EvoPack.utils.candidatePackRoots = candidatePackRoots;\n  window.EvoPack.utils.getPackRootCandidates = getPackRootCandidates;\n  window.EvoPack.utils.resolveRelative = resolveRelative;\n  window.EvoPack.utils.manualLoadCatalog = manualLoadCatalog;\n  window.EvoPack.utils.loadPackCatalog = loadPackCatalog;\n  window.EvoPack.utils.loadCatalogFromCandidates = loadCatalogFromCandidates;\n}\n", "/**\n * @template {Element} T\n * @param {Document | DocumentFragment | Element} root\n * @param {string} selector\n * @returns {T | null}\n */\nfunction query(root, selector) {\n  return root.querySelector(selector);\n}\n\n/**\n * @template {Element} T\n * @param {Document | DocumentFragment | Element} root\n * @param {string} selector\n * @returns {T[]}\n */\nfunction queryAll(root, selector) {\n  return Array.from(root.querySelectorAll(selector));\n}\n\n/**\n * @param {Document | DocumentFragment | Element} root\n * @param {string} id\n * @returns {HTMLElement | null}\n */\nfunction byId(root, id) {\n  if ('getElementById' in root && typeof root.getElementById === 'function') {\n    return root.getElementById(id);\n  }\n  if (typeof CSS !== 'undefined' && CSS.escape) {\n    return root.querySelector(`#${CSS.escape(id)}`);\n  }\n  return root.querySelector(`#${id.replace(/([\"'\\\\])/g, '\\\\$1')}`);\n}\n\n/**\n * @typedef {ReturnType<typeof resolveGeneratorElements>} GeneratorElements\n */\n\n/**\n * @typedef {ReturnType<typeof resolveAnchorUi>} AnchorUiElements\n */\n\nexport function resolveGeneratorElements(root = document) {\n  return {\n    form: byId(root, 'generator-form'),\n    flags: byId(root, 'flags'),\n    roles: byId(root, 'roles'),\n    tags: byId(root, 'tags'),\n    filtersHint: byId(root, 'generator-filters-hint'),\n    nBiomi: byId(root, 'nBiomi'),\n    biomeGrid: byId(root, 'biome-grid'),\n    traitGrid: byId(root, 'trait-grid'),\n    seedGrid: byId(root, 'seed-grid'),\n    status: byId(root, 'generator-status'),\n    summaryContainer: byId(root, 'generator-summary'),\n    summaryCounts: {\n      biomes: query(root, '[data-summary=\"biomes\"]'),\n      species: query(root, '[data-summary=\"species\"]'),\n      seeds: query(root, '[data-summary=\"seeds\"]'),\n    },\n    narrativePanel: byId(root, 'generator-narrative'),\n    narrativeBriefing: query(root, '[data-narrative=\"briefing\"]'),\n    narrativeHook: query(root, '[data-narrative=\"hook\"]'),\n    narrativeInsightPanel: byId(root, 'generator-insight-panel'),\n    narrativeInsightEmpty: byId(root, 'generator-insight-empty'),\n    narrativeInsightList: byId(root, 'generator-insight-list'),\n    briefingPanel: byId(root, 'generator-briefing-panel'),\n    hookPanel: byId(root, 'generator-hook-panel'),\n    audioControls: byId(root, 'generator-audio-controls'),\n    audioMute: byId(root, 'generator-audio-mute'),\n    audioVolume: byId(root, 'generator-audio-volume'),\n    profilePanel: byId(root, 'generator-profiles'),\n    profileSlots: byId(root, 'generator-profile-slots'),\n    profileEmpty: byId(root, 'generator-profile-empty'),\n    composerPanel: byId(root, 'generator-composer'),\n    composerPresetList: byId(root, 'generator-composer-presets'),\n    composerPresetEmpty: byId(root, 'generator-composer-presets-empty'),\n    composerSuggestions: byId(root, 'generator-composer-suggestions'),\n    composerSuggestionsEmpty: byId(root, 'generator-composer-suggestions-empty'),\n    composerRoleToggles: byId(root, 'generator-composer-role-toggles'),\n    composerSynergySlider: byId(root, 'generator-composer-synergy'),\n    composerSynergyValue: byId(root, 'generator-composer-synergy-value'),\n    composerRadarCanvas: byId(root, 'generator-synergy-radar'),\n    composerHeatmap: byId(root, 'generator-role-heatmap'),\n    comparePanel: byId(root, 'generator-compare-panel'),\n    compareList: byId(root, 'generator-compare-list'),\n    compareEmpty: byId(root, 'generator-compare-empty'),\n    compareChartContainer: byId(root, 'generator-compare-chart'),\n    compareCanvas: byId(root, 'generator-compare-canvas'),\n    compareFallback: byId(root, 'generator-compare-fallback'),\n    pinnedList: byId(root, 'generator-pinned-list'),\n    pinnedEmpty: byId(root, 'generator-pinned-empty'),\n    flowMapList: byId(root, 'generator-flow-map-list'),\n    flowNodes: queryAll(root, '[data-flow-node]'),\n    historyPanel: byId(root, 'generator-history'),\n    historyList: byId(root, 'generator-history-list'),\n    historyEmpty: byId(root, 'generator-history-empty'),\n    lastAction: byId(root, 'generator-last-action'),\n    logList: byId(root, 'generator-log'),\n    logEmpty: byId(root, 'generator-log-empty'),\n    activitySearch: byId(root, 'activity-search'),\n    activityTagFilter: byId(root, 'activity-tags'),\n    activityPinnedOnly: byId(root, 'activity-pinned-only'),\n    activityToneToggles: queryAll(root, '[data-activity-tone]'),\n    activityReset: query(root, '[data-action=\"reset-activity-filters\"]'),\n    exportMeta: byId(root, 'generator-export-meta'),\n    exportList: byId(root, 'generator-export-list'),\n    exportEmpty: byId(root, 'generator-export-empty'),\n    exportActions: byId(root, 'generator-export-actions'),\n    exportPreset: byId(root, 'generator-export-preset'),\n    exportPresetStatus: byId(root, 'generator-export-preset-status'),\n    exportPreview: byId(root, 'generator-export-preview'),\n    exportPreviewEmpty: byId(root, 'generator-preview-empty'),\n    exportPreviewJson: byId(root, 'generator-preview-json'),\n    exportPreviewYaml: byId(root, 'generator-preview-yaml'),\n    exportPreviewJsonDetails: byId(root, 'generator-preview-json-details'),\n    exportPreviewYamlDetails: byId(root, 'generator-preview-yaml-details'),\n    dossierPreview: byId(root, 'generator-dossier-preview'),\n    dossierEmpty: byId(root, 'generator-dossier-empty'),\n    insightsPanel: byId(root, 'generator-insights-panel'),\n    insightsEmpty: byId(root, 'generator-insights-empty'),\n    insightsList: byId(root, 'generator-insights-list'),\n    kpi: {\n      averageRoll: query(root, '[data-kpi=\"avg-roll\"]'),\n      rerollCount: query(root, '[data-kpi=\"reroll-count\"]'),\n      uniqueSpecies: query(root, '[data-kpi=\"unique-species\"]'),\n      profileReuses: query(root, '[data-kpi=\"profile-reuse\"]'),\n    },\n    nebula: {\n      title: byId(root, 'generator-nebula-title'),\n      panel: byId(root, 'generator-nebula'),\n      status: byId(root, 'generator-nebula-status'),\n      summary: byId(root, 'generator-nebula-summary'),\n      release: byId(root, 'generator-nebula-release'),\n      metrics: {\n        species: byId(root, 'generator-nebula-metric-species'),\n        biomes: byId(root, 'generator-nebula-metric-biomes'),\n        encounters: byId(root, 'generator-nebula-metric-encounters'),\n      },\n      highlights: byId(root, 'generator-nebula-highlights'),\n      coverage: byId(root, 'generator-nebula-coverage'),\n      events: byId(root, 'generator-nebula-events'),\n      updated: byId(root, 'generator-nebula-updated'),\n      refresh: query(root, '[data-action=\"nebula-refresh\"]'),\n    },\n  };\n}\n\nexport function resolveAnchorUi(root = document) {\n  return {\n    root: query(root, '[data-anchor-root]'),\n    anchors: queryAll(root, '[data-anchor-target]'),\n    panels: queryAll(root, '[data-panel]'),\n    breadcrumbTargets: queryAll(root, '[data-anchor-breadcrumb]'),\n    minimapContainers: queryAll(root, '[data-anchor-minimap]'),\n    overlay: query(root, '[data-codex-overlay]'),\n    codexToggles: queryAll(root, '[data-codex-toggle]'),\n    codexClosers: queryAll(root, '[data-codex-close]'),\n  };\n}\n", "const DEFAULT_LABEL = '';\n\nfunction filterElements(list) {\n  return Array.isArray(list) ? list.filter((node) => node instanceof HTMLElement) : [];\n}\n\nfunction toArray(value) {\n  if (!value) return [];\n  if (Array.isArray(value)) return value;\n  return [value];\n}\n\nexport function createAnchorNavigator(environment = {}) {\n  const doc = environment.document ?? (typeof document !== 'undefined' ? document : null);\n  const win = environment.window ?? (typeof window !== 'undefined' ? window : null);\n\n  const state = {\n    doc,\n    win,\n    ui: {\n      anchors: [],\n      panels: [],\n      breadcrumbTargets: [],\n      minimapContainers: [],\n      overlay: null,\n      codexToggles: [],\n      codexClosers: [],\n    },\n    descriptors: [],\n    descriptorsById: new Map(),\n    sectionsById: new Map(),\n    minimaps: new Map(),\n    observer: null,\n    scrollHandler: null,\n    activeId: null,\n    lastToggle: null,\n    anchorHandlers: new Map(),\n    toggleHandlers: new Map(),\n    closerHandlers: new Map(),\n    overlayClickHandler: null,\n    keydownHandler: null,\n    hashHandler: null,\n  };\n\n  function setUi(ui) {\n    state.ui.anchors = filterElements(toArray(ui?.anchors));\n    state.ui.panels = filterElements(toArray(ui?.panels));\n    state.ui.breadcrumbTargets = filterElements(toArray(ui?.breadcrumbTargets));\n    state.ui.minimapContainers = filterElements(toArray(ui?.minimapContainers));\n    state.ui.overlay = ui?.overlay instanceof HTMLElement ? ui.overlay : null;\n    state.ui.codexToggles = filterElements(toArray(ui?.codexToggles));\n    state.ui.codexClosers = filterElements(toArray(ui?.codexClosers));\n  }\n\n  function getPanelIdFromHash() {\n    if (!state.win) return null;\n    const hash = state.win.location?.hash ?? '';\n    if (!hash) return null;\n    const id = hash.replace(/^#/, '');\n    if (!id) return null;\n    const element = state.doc?.getElementById(id);\n    if (!element) return null;\n    return element.dataset?.panel ?? null;\n  }\n\n  function updateBreadcrumbs(sectionId) {\n    const descriptor = state.descriptorsById.get(sectionId);\n    const label = descriptor?.label ?? DEFAULT_LABEL;\n    state.ui.breadcrumbTargets.forEach((target) => {\n      target.textContent = label;\n      target.dataset.activeAnchor = sectionId ?? '';\n    });\n  }\n\n  function updateMinimapState() {\n    state.minimaps.forEach((registry) => {\n      registry.forEach(({ item, progress }, id) => {\n        const descriptor = state.descriptorsById.get(id);\n        if (!descriptor) return;\n        const ratio = Math.max(0, Math.min(1, descriptor.progress ?? 0));\n        progress.style.setProperty('--progress', `${Math.round(ratio * 100)}%`);\n        if (state.activeId === id) {\n          item.classList.add('is-active');\n        } else {\n          item.classList.remove('is-active');\n        }\n      });\n    });\n  }\n\n  function setActiveSection(sectionId, { updateHash = false, silent = false } = {}) {\n    if (!sectionId || !state.descriptorsById.has(sectionId)) {\n      return false;\n    }\n\n    const previous = state.activeId;\n    state.activeId = sectionId;\n\n    if (previous !== sectionId || !silent) {\n      state.descriptors.forEach((descriptor) => {\n        if (descriptor.id === sectionId) {\n          descriptor.anchor.classList.add('is-active');\n          descriptor.anchor.setAttribute('aria-current', 'location');\n        } else {\n          descriptor.anchor.classList.remove('is-active');\n          descriptor.anchor.removeAttribute('aria-current');\n        }\n      });\n      updateBreadcrumbs(sectionId);\n      updateMinimapState();\n    }\n\n    if (updateHash) {\n      const panel = state.sectionsById.get(sectionId)?.element;\n      if (panel?.id && state.win?.history?.replaceState) {\n        state.win.history.replaceState(null, '', `#${panel.id}`);\n      }\n    }\n\n    return true;\n  }\n\n  function focusPanel(panel) {\n    if (!panel || typeof panel.focus !== 'function') {\n      return;\n    }\n    try {\n      panel.focus({ preventScroll: true });\n    } catch (error) {\n      panel.focus();\n    }\n  }\n\n  function scrollToPanel(panelId, { smooth = true } = {}) {\n    if (!panelId) return false;\n    const entry = state.sectionsById.get(panelId);\n    const panel = entry?.element;\n    if (!panel) return false;\n    if (!panel.hasAttribute('tabindex')) {\n      panel.setAttribute('tabindex', '-1');\n    }\n    if (typeof panel.scrollIntoView === 'function') {\n      const behavior = smooth ? 'smooth' : 'auto';\n      panel.scrollIntoView({ behavior, block: 'start' });\n    }\n    if (typeof state.win?.requestAnimationFrame === 'function') {\n      state.win.requestAnimationFrame(() => focusPanel(panel));\n    } else {\n      focusPanel(panel);\n    }\n    return true;\n  }\n\n  function computeActiveSection() {\n    if (!state.descriptors.length) return null;\n    const visible = state.descriptors.filter((descriptor) => descriptor.isIntersecting);\n    if (visible.length) {\n      visible.sort((a, b) => (a.top ?? 0) - (b.top ?? 0));\n      return visible[0].id;\n    }\n\n    let candidate = null;\n    let minTop = Infinity;\n    state.descriptors.forEach((descriptor) => {\n      const section = state.sectionsById.get(descriptor.id);\n      const element = section?.element;\n      if (!element) return;\n      const rect = element.getBoundingClientRect();\n      if (rect.top >= 0 && rect.top < minTop) {\n        minTop = rect.top;\n        candidate = descriptor.id;\n      }\n    });\n\n    if (candidate) return candidate;\n    return state.descriptors[state.descriptors.length - 1]?.id ?? null;\n  }\n\n  function handleAnchorObserver(entries) {\n    entries.forEach((entry) => {\n      const id = entry.target?.dataset?.panel;\n      if (!id) return;\n      const descriptor = state.descriptorsById.get(id);\n      if (!descriptor) return;\n      descriptor.progress = entry.intersectionRatio ?? 0;\n      descriptor.isIntersecting = !!entry.isIntersecting;\n      descriptor.top = entry.boundingClientRect?.top ?? 0;\n      descriptor.bottom = entry.boundingClientRect?.bottom ?? 0;\n    });\n\n    const nextActive = computeActiveSection();\n    if (nextActive) {\n      setActiveSection(nextActive, { silent: true });\n    }\n    updateMinimapState();\n  }\n\n  function cleanupScrollFallback() {\n    if (!state.scrollHandler || !state.win) {\n      return;\n    }\n    state.win.removeEventListener('scroll', state.scrollHandler);\n    state.win.removeEventListener('resize', state.scrollHandler);\n    state.scrollHandler = null;\n  }\n\n  function createScrollFallback() {\n    if (!state.win) return;\n    state.scrollHandler = () => {\n      const viewportHeight = state.win.innerHeight || state.doc?.documentElement?.clientHeight || 1;\n\n      state.descriptors.forEach((descriptor) => {\n        const section = state.sectionsById.get(descriptor.id);\n        const element = section?.element;\n        if (!element) return;\n\n        const rect = element.getBoundingClientRect();\n        const height = rect.height || element.offsetHeight || 1;\n        const visible = Math.max(0, Math.min(rect.bottom, viewportHeight) - Math.max(rect.top, 0));\n        const ratio = Math.max(0, Math.min(1, visible / height));\n\n        descriptor.progress = Number.isFinite(ratio) ? ratio : 0;\n        descriptor.isIntersecting = rect.top < viewportHeight && rect.bottom > 0;\n        descriptor.top = rect.top;\n        descriptor.bottom = rect.bottom;\n      });\n\n      const nextActive = computeActiveSection();\n      if (nextActive) {\n        setActiveSection(nextActive, { silent: true });\n      }\n      updateMinimapState();\n    };\n\n    state.win.addEventListener('scroll', state.scrollHandler, { passive: true });\n    state.win.addEventListener('resize', state.scrollHandler);\n    state.scrollHandler();\n  }\n\n  function createAnchorObserver() {\n    if (state.observer) {\n      state.observer.disconnect();\n      state.observer = null;\n    }\n    cleanupScrollFallback();\n    if (!state.sectionsById.size) return;\n\n    const IntersectionObserverCtor =\n      (state.win && state.win.IntersectionObserver) || globalThis.IntersectionObserver;\n\n    if (typeof IntersectionObserverCtor === 'undefined') {\n      createScrollFallback();\n      return;\n    }\n\n    const thresholds = [];\n    for (let value = 0; value <= 1; value += 0.25) {\n      thresholds.push(Number(value.toFixed(2)));\n    }\n\n    state.observer = new IntersectionObserverCtor(handleAnchorObserver, {\n      rootMargin: '-40% 0px -40% 0px',\n      threshold: thresholds,\n    });\n\n    state.sectionsById.forEach(({ element }) => {\n      if (element) {\n        state.observer.observe(element);\n      }\n    });\n  }\n\n  function setupMinimaps() {\n    state.minimaps.clear();\n    if (!state.doc) return;\n\n    state.ui.minimapContainers.forEach((container) => {\n      const isOverlay = container.dataset.minimapMode === 'overlay';\n      const existingTitle = container.querySelector('.codex-minimap__title');\n      const label =\n        container.dataset.minimapLabel || existingTitle?.textContent?.trim() || 'Minimappa';\n\n      container.innerHTML = '';\n\n      if (!isOverlay) {\n        const title = state.doc.createElement('p');\n        title.className = 'codex-minimap__title';\n        title.textContent = label;\n        container.appendChild(title);\n      }\n\n      const list = state.doc.createElement('ol');\n      list.className = isOverlay ? 'codex-overlay__list' : 'codex-minimap__list';\n      const registry = new Map();\n\n      state.descriptors.forEach((descriptor) => {\n        const item = state.doc.createElement('li');\n        item.className = isOverlay ? 'codex-overlay__item' : 'codex-minimap__item';\n        item.dataset.minimapItem = descriptor.id;\n\n        const trigger = state.doc.createElement('button');\n        trigger.type = 'button';\n        trigger.className = isOverlay ? 'codex-overlay__link' : 'codex-minimap__link';\n        trigger.textContent = descriptor.label;\n        const handler = () => {\n          if (setActiveSection(descriptor.id, { updateHash: true })) {\n            scrollToPanel(descriptor.id);\n          }\n          if (isOverlay) {\n            closeOverlay();\n          }\n        };\n        trigger.addEventListener('click', handler);\n\n        const progress = state.doc.createElement('span');\n        progress.className = isOverlay ? 'codex-overlay__progress' : 'codex-minimap__progress';\n        progress.style.setProperty('--progress', '0%');\n\n        item.append(trigger, progress);\n        list.appendChild(item);\n        registry.set(descriptor.id, { item, progress });\n      });\n\n      container.appendChild(list);\n      state.minimaps.set(container, registry);\n    });\n\n    updateMinimapState();\n  }\n\n  function closeOverlay({ skipFocus = false } = {}) {\n    const overlay = state.ui.overlay;\n    if (!overlay || overlay.hidden) {\n      state.lastToggle = skipFocus ? state.lastToggle : null;\n      return;\n    }\n    overlay.hidden = true;\n    overlay.setAttribute('aria-hidden', 'true');\n    state.doc?.body?.classList.remove('codex-open');\n    if (!skipFocus && state.lastToggle && typeof state.lastToggle.focus === 'function') {\n      state.lastToggle.focus();\n    }\n    state.lastToggle = null;\n  }\n\n  function openOverlay() {\n    const overlay = state.ui.overlay;\n    if (!overlay) return;\n    if (!state.minimaps.size) {\n      setupMinimaps();\n    }\n    overlay.hidden = false;\n    overlay.setAttribute('aria-hidden', 'false');\n    state.doc?.body?.classList.add('codex-open');\n    updateMinimapState();\n    const closeButton = overlay.querySelector('[data-codex-close]');\n    if (closeButton instanceof HTMLElement) {\n      closeButton.focus({ preventScroll: true });\n    }\n  }\n\n  function setupOverlayControls() {\n    const overlay = state.ui.overlay;\n    if (!overlay) return;\n\n    closeOverlay({ skipFocus: true });\n\n    state.ui.codexToggles.forEach((button) => {\n      const handler = () => {\n        state.lastToggle = button;\n        openOverlay();\n      };\n      button.addEventListener('click', handler);\n      state.toggleHandlers.set(button, handler);\n    });\n\n    state.ui.codexClosers.forEach((button) => {\n      const handler = () => {\n        closeOverlay();\n      };\n      button.addEventListener('click', handler);\n      state.closerHandlers.set(button, handler);\n    });\n\n    state.overlayClickHandler = (event) => {\n      if (event.target === overlay) {\n        closeOverlay();\n      }\n    };\n    overlay.addEventListener('click', state.overlayClickHandler);\n\n    if (state.doc) {\n      state.keydownHandler = (event) => {\n        if (event.key === 'Escape' && state.doc.body?.classList.contains('codex-open')) {\n          closeOverlay();\n        }\n      };\n      state.doc.addEventListener('keydown', state.keydownHandler);\n    }\n  }\n\n  function attachAnchorHandlers() {\n    state.anchorHandlers.forEach((handler, anchor) => {\n      anchor.removeEventListener('click', handler);\n    });\n    state.anchorHandlers.clear();\n\n    state.descriptors.forEach((descriptor) => {\n      const handler = (event) => {\n        event.preventDefault();\n        if (setActiveSection(descriptor.id, { updateHash: true })) {\n          scrollToPanel(descriptor.id);\n        }\n        closeOverlay();\n      };\n      descriptor.anchor.addEventListener('click', handler);\n      state.anchorHandlers.set(descriptor.anchor, handler);\n    });\n  }\n\n  function attachHashHandler() {\n    if (!state.win) return;\n    if (state.hashHandler) {\n      state.win.removeEventListener('hashchange', state.hashHandler);\n    }\n    state.hashHandler = () => {\n      const fromHash = getPanelIdFromHash();\n      if (fromHash) {\n        setActiveSection(fromHash, { silent: true });\n      }\n    };\n    state.win.addEventListener('hashchange', state.hashHandler);\n  }\n\n  function detachOverlayControls() {\n    state.ui.codexToggles.forEach((button) => {\n      const handler = state.toggleHandlers.get(button);\n      if (handler) {\n        button.removeEventListener('click', handler);\n      }\n    });\n    state.toggleHandlers.clear();\n\n    state.ui.codexClosers.forEach((button) => {\n      const handler = state.closerHandlers.get(button);\n      if (handler) {\n        button.removeEventListener('click', handler);\n      }\n    });\n    state.closerHandlers.clear();\n\n    if (state.overlayClickHandler && state.ui.overlay) {\n      state.ui.overlay.removeEventListener('click', state.overlayClickHandler);\n      state.overlayClickHandler = null;\n    }\n\n    if (state.keydownHandler && state.doc) {\n      state.doc.removeEventListener('keydown', state.keydownHandler);\n      state.keydownHandler = null;\n    }\n  }\n\n  function detachHashHandler() {\n    if (state.hashHandler && state.win) {\n      state.win.removeEventListener('hashchange', state.hashHandler);\n      state.hashHandler = null;\n    }\n  }\n\n  function destroy() {\n    cleanupScrollFallback();\n    if (state.observer) {\n      state.observer.disconnect();\n      state.observer = null;\n    }\n    detachHashHandler();\n    detachOverlayControls();\n    state.anchorHandlers.forEach((handler, anchor) => {\n      anchor.removeEventListener('click', handler);\n    });\n    state.anchorHandlers.clear();\n    closeOverlay({ skipFocus: true });\n    state.descriptors = [];\n    state.descriptorsById.clear();\n    state.sectionsById.clear();\n    state.minimaps.clear();\n    state.activeId = null;\n    state.lastToggle = null;\n    setUi({});\n  }\n\n  function init(ui) {\n    destroy();\n    setUi(ui);\n\n    if (!state.ui.anchors.length || !state.ui.panels.length) {\n      return { activeId: null };\n    }\n\n    state.sectionsById = new Map();\n    state.ui.panels.forEach((panel) => {\n      const panelId = panel.dataset.panel;\n      if (!panelId) return;\n      state.sectionsById.set(panelId, { element: panel });\n      if (!panel.hasAttribute('tabindex')) {\n        panel.setAttribute('tabindex', '-1');\n      }\n    });\n\n    state.descriptors = state.ui.anchors\n      .map((anchor) => {\n        const id = anchor.dataset.anchorTarget;\n        if (!id || !state.sectionsById.has(id)) return null;\n        const label = anchor.textContent?.trim() || id;\n        return {\n          id,\n          label,\n          anchor,\n          progress: 0,\n          isIntersecting: false,\n          top: 0,\n          bottom: 0,\n        };\n      })\n      .filter(Boolean);\n\n    state.descriptorsById = new Map(\n      state.descriptors.map((descriptor) => [descriptor.id, descriptor]),\n    );\n\n    if (!state.descriptors.length) {\n      return { activeId: null };\n    }\n\n    attachAnchorHandlers();\n    setupMinimaps();\n    createAnchorObserver();\n    setupOverlayControls();\n    attachHashHandler();\n\n    const initialId = getPanelIdFromHash();\n    if (initialId && state.descriptorsById.has(initialId)) {\n      setActiveSection(initialId, { silent: true });\n    } else {\n      setActiveSection(state.descriptors[0].id, { silent: true });\n    }\n\n    return { activeId: state.activeId };\n  }\n\n  return {\n    init,\n    setActiveSection,\n    scrollToPanel,\n    destroy,\n    openOverlay,\n    closeOverlay,\n    hasSection: (sectionId) => state.descriptorsById.has(sectionId),\n    getActiveSection: () => state.activeId,\n  };\n}\n\nexport default createAnchorNavigator;\n", "/**\n * @typedef {object} ExportStateOptions\n * @property {Array<{id?: string | null}>} [manifestPresets]\n * @property {boolean} [initialPdfSupported]\n */\n\n/**\n * @typedef {object} SessionStateOptions\n * @property {string[]} [defaultActivityTones]\n * @property {Array<{id?: string | null}>} [manifestPresets]\n * @property {boolean} [initialPdfSupported]\n * @property {string} [defaultBriefingText]\n * @property {string} [defaultHookText]\n */\n\n/**\n * @typedef {ReturnType<typeof createExportState>} ExportState\n */\n\n/**\n * @typedef {ReturnType<typeof createComposerState>} ComposerState\n */\n\n/**\n * @typedef {ReturnType<typeof createHistoryState>} HistoryState\n */\n\n/**\n * @typedef {ReturnType<typeof createSessionState>} SessionState\n */\n\n/**\n * @param {ExportStateOptions} [options]\n * @returns {ExportState}\n */\nexport function createExportState(options = {}) {\n  const { manifestPresets = [], initialPdfSupported = false } = options;\n  return {\n    presetId: manifestPresets[0]?.id ?? null,\n    checklist: new Map(),\n    dossierTemplate: null,\n    pdfSupported: initialPdfSupported,\n    pdfSupportNotified: false,\n  };\n}\n\n/**\n * @returns {ComposerState}\n */\nexport function createComposerState() {\n  return {\n    constraints: {\n      minSynergy: 45,\n      preferredRoles: new Set(),\n    },\n    combinedPresets: [],\n    suggestions: [],\n    metrics: {\n      radar: [],\n      heatmap: [],\n    },\n    roleStats: new Map(),\n  };\n}\n\n/**\n * @returns {HistoryState}\n */\nexport function createHistoryState() {\n  return [];\n}\n\n/**\n * @param {SessionStateOptions} [options]\n * @returns {SessionState}\n */\nexport function createSessionState(options = {}) {\n  const {\n    defaultActivityTones = [],\n    manifestPresets = [],\n    initialPdfSupported = false,\n    defaultBriefingText = '',\n    defaultHookText = '',\n  } = options;\n\n  return {\n    data: null,\n    traitRegistry: null,\n    traitReference: null,\n    traitGlossary: null,\n    traitsIndex: new Map(),\n    traitDetailsIndex: new Map(),\n    traitGlossaryIndex: new Map(),\n    hazardRegistry: null,\n    hazardsIndex: new Map(),\n    activityLog: [],\n    activityFilters: {\n      query: '',\n      tones: new Set(defaultActivityTones),\n      tags: new Set(),\n      pinnedOnly: false,\n    },\n    activityTagCounts: new Map(),\n    metrics: {\n      averageRollIntervalMs: null,\n      rerollCount: 0,\n      uniqueSpecies: 0,\n      filterProfileReuses: 0,\n      roleUsage: new Map(),\n    },\n    lastFilters: { flags: [], roles: [], tags: [] },\n    pick: {\n      ecosystem: {},\n      biomes: [],\n      species: {},\n      seeds: [],\n      exportSlug: null,\n    },\n    cardState: {\n      pinned: new Map(),\n      squad: new Map(),\n      comparison: new Map(),\n      locks: {\n        biomes: new Set(),\n        species: new Set(),\n      },\n    },\n    exportState: createExportState({ manifestPresets, initialPdfSupported }),\n    filterProfiles: [],\n    history: createHistoryState(),\n    preferences: {\n      audioMuted: false,\n      volume: 0.75,\n    },\n    api: {\n      base: null,\n    },\n    lastGenerationMeta: null,\n    narrative: {\n      missionBriefing: defaultBriefingText,\n      narrativeHook: defaultHookText,\n      rare: false,\n      reason: null,\n      recommendations: [],\n    },\n    composer: createComposerState(),\n    nebula: {\n      dataset: null,\n      generator: null,\n      telemetry: null,\n      lastSyncedAt: null,\n      error: null,\n    },\n  };\n}\n", "export function randomId(prefix = 'synt'): string {\n  const suffix = Math.random().toString(36).slice(2, 8);\n  return `${prefix}-${suffix}`;\n}\n\nexport type RandomIdGenerator = (prefix?: string) => string;\n", "import { randomId, type RandomIdGenerator } from './ids.ts';\nimport type { FilterSet, GenerationConstraints, HazardLevel, TagEntry, TagLike } from './types.ts';\n\nconst ROLE_FLAGS_DEFAULT = ['apex', 'keystone', 'bridge', 'threat', 'event'] as const;\n\nconst CLIMATE_HINTS = [\n  { pattern: /frost|criogen|ghiacci|ice/i, value: 'frozen' },\n  { pattern: /desert|sabbia|arid|dust/i, value: 'arid' },\n  { pattern: /tempesta|storm|ion|vento/i, value: 'storm' },\n  { pattern: /fung|micel|caver/i, value: 'subterranean' },\n  { pattern: /abiss|idro|mare|ocean/i, value: 'aquatic' },\n] as const;\n\nfunction filtersInclude(values: unknown, pattern: RegExp): boolean {\n  if (!Array.isArray(values) || !values.length) return false;\n  return values.some((value) => pattern.test(String(value)));\n}\n\nexport function extractRequiredRoles(\n  filters: FilterSet = {},\n  roleFlags: readonly string[] = ROLE_FLAGS_DEFAULT,\n): string[] {\n  const roles = new Set<string>();\n  (Array.isArray(filters.flags) ? filters.flags : []).forEach((flag) => {\n    if (roleFlags.includes(String(flag))) {\n      roles.add(String(flag));\n    }\n  });\n  (Array.isArray(filters.roles) ? filters.roles : []).forEach((token) => {\n    const value = String(token).toLowerCase();\n    if (/apic|predator|apex/i.test(value)) roles.add('apex');\n    if (/chiav|custod|warden|keystone/i.test(value)) roles.add('keystone');\n    if (/ponte|bridge|logist|corridor/i.test(value)) roles.add('bridge');\n    if (/minacc|threat|assalt|predator/i.test(value)) roles.add('threat');\n    if (/evento|anomalia|event/i.test(value)) roles.add('event');\n  });\n  return Array.from(roles);\n}\n\nexport function collectPreferredTags(filters: FilterSet = {}): string[] {\n  const tags = new Set<string>();\n  (Array.isArray(filters.tags) ? filters.tags : []).forEach((tag) => {\n    if (tag) {\n      tags.add(String(tag));\n    }\n  });\n  (Array.isArray(filters.roles) ? filters.roles : []).forEach((token) => {\n    const value = String(token).toLowerCase();\n    if (/criogen|frost|ghiacci/i.test(value)) tags.add('criogenico');\n    if (/desert|sabbia|arid/i.test(value)) tags.add('desertico');\n    if (/idro|abiss|marino|ocean/i.test(value)) tags.add('abissale');\n    if (/fung|micel/i.test(value)) tags.add('micelico');\n  });\n  return Array.from(tags);\n}\n\nexport function inferHazardFromFilters(filters: FilterSet = {}): HazardLevel {\n  const flags = Array.isArray(filters.flags) ? filters.flags : [];\n  if (flags.some((flag) => String(flag) === 'threat' || String(flag) === 'apex')) {\n    return 'high';\n  }\n  if (filtersInclude(filters.tags, /tempest|storm|pericolo|hazard|ferro/i)) {\n    return 'high';\n  }\n  if (filtersInclude(filters.tags, /rifug|tranquill|shelter|safe/i)) {\n    return 'low';\n  }\n  return 'medium';\n}\n\nexport function inferClimateFromFilters(filters: FilterSet = {}): string | null {\n  const tags = Array.isArray(filters.tags) ? filters.tags : [];\n  for (const hint of CLIMATE_HINTS) {\n    if (filtersInclude(tags, hint.pattern)) {\n      return hint.value;\n    }\n  }\n  if (filtersInclude(filters.roles, /criogen|ghiacci|frost/i)) return 'frozen';\n  if (filtersInclude(filters.roles, /fung|micel/i)) return 'subterranean';\n  if (filtersInclude(filters.roles, /idro|abiss|mare|ocean/i)) return 'aquatic';\n  return null;\n}\n\nexport function inferMinSize(\n  filters: FilterSet = {},\n  roleFlags: readonly string[] = ROLE_FLAGS_DEFAULT,\n): number {\n  const roles = extractRequiredRoles(filters, roleFlags);\n  const tagCount = Array.isArray(filters.tags) ? filters.tags.length : 0;\n  const base = roles.length >= 3 ? 4 : 3;\n  const bonus = tagCount >= 4 ? 2 : tagCount >= 2 ? 1 : 0;\n  return Math.min(6, base + bonus);\n}\n\nexport interface BuildGenerationConstraintsOptions {\n  roleFlags?: readonly string[];\n}\n\nexport function buildGenerationConstraints(\n  filters: FilterSet = {},\n  options: BuildGenerationConstraintsOptions = {},\n): GenerationConstraints {\n  const roleFlags = options.roleFlags ?? ROLE_FLAGS_DEFAULT;\n  const requiredRoles = extractRequiredRoles(filters, roleFlags);\n  const preferredTags = collectPreferredTags(filters);\n  const hazard = inferHazardFromFilters(filters);\n  const climate = inferClimateFromFilters(filters);\n  const minSize = inferMinSize(filters, roleFlags);\n  const constraints: GenerationConstraints = {\n    requiredRoles,\n    preferredTags,\n    hazard,\n    climate,\n    minSize,\n  };\n  if (!constraints.requiredRoles?.length) delete constraints.requiredRoles;\n  if (!constraints.preferredTags?.length) delete constraints.preferredTags;\n  if (!constraints.hazard) delete constraints.hazard;\n  if (!constraints.climate) delete constraints.climate;\n  if (!Number.isFinite(constraints.minSize)) delete constraints.minSize;\n  return constraints;\n}\n\nexport function normaliseTagId(value: unknown): string {\n  return String(value ?? '')\n    .trim()\n    .toLowerCase()\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, '')\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-+|-+$/g, '');\n}\n\nexport function createTagEntry(\n  tag: TagLike,\n  generator: RandomIdGenerator = randomId,\n): TagEntry | null {\n  if (tag && typeof tag === 'object') {\n    const labelCandidate =\n      (tag as { label?: string | null }).label ??\n      (tag as { name?: string | null }).name ??\n      (tag as { title?: string | null }).title ??\n      (tag as { text?: string | null }).text ??\n      (tag as { value?: string | null }).value ??\n      (tag as { id?: string | null }).id ??\n      '';\n    const label = String(labelCandidate || '').trim();\n    if (!label) {\n      return null;\n    }\n    const idCandidate =\n      (tag as { id?: string | null }).id ??\n      (tag as { value?: string | null }).value ??\n      normaliseTagId(label);\n    const id = normaliseTagId(idCandidate || label) || normaliseTagId(label) || generator('tag');\n    return { id: id || generator('tag'), label };\n  }\n  const label = String(tag ?? '').trim();\n  if (!label) {\n    return null;\n  }\n  const id = normaliseTagId(label) || generator('tag');\n  return { id, label };\n}\n", "import { normaliseTagId } from './normalizers.ts';\nimport type { ActivityLogEntryInput, ActivityLogTag, SerialisedActivityLogEntry } from './types.ts';\n\nfunction toIsoTimestamp(value: ActivityLogEntryInput['timestamp']): string {\n  if (value instanceof Date) {\n    return value.toISOString();\n  }\n  if (value === null || value === undefined || value === '') {\n    return new Date().toISOString();\n  }\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) {\n    return new Date().toISOString();\n  }\n  return date.toISOString();\n}\n\nexport function serialiseActivityLogEntry(\n  entry: ActivityLogEntryInput,\n): SerialisedActivityLogEntry | null {\n  if (!entry) return null;\n  const tags: ActivityLogTag[] = Array.isArray(entry.tags)\n    ? entry.tags\n        .map((tag) => {\n          if (!tag) return null;\n          if (typeof tag === 'object') {\n            const id =\n              (tag as { id?: string | null; value?: string | null }).id ??\n              (tag as { value?: string | null }).value ??\n              null;\n            const label =\n              (tag as { label?: string | null }).label ??\n              (tag as { name?: string | null }).name ??\n              (tag as { value?: string | null }).value ??\n              (tag as { id?: string | null }).id ??\n              null;\n            if (!id && !label) return null;\n            return {\n              id: id ?? (label ? normaliseTagId(label) || null : null),\n              label: label ?? (id ? String(id) : ''),\n            } as ActivityLogTag;\n          }\n          const label = String(tag ?? '').trim();\n          if (!label) return null;\n          return { id: normaliseTagId(label) || null, label } as ActivityLogTag;\n        })\n        .filter((tag): tag is ActivityLogTag => Boolean(tag))\n    : [];\n\n  return {\n    id: entry.id ?? null,\n    message: entry.message ?? '',\n    tone: entry.tone ?? 'info',\n    timestamp: toIsoTimestamp(entry.timestamp ?? null),\n    tags,\n    action: entry.action ?? null,\n    pinned: Boolean(entry.pinned),\n    metadata: entry.metadata ?? null,\n  };\n}\n\nexport function activityLogToCsv(entries: SerialisedActivityLogEntry[]): string {\n  const columns: (keyof SerialisedActivityLogEntry)[] = [\n    'id',\n    'timestamp',\n    'tone',\n    'message',\n    'tags',\n    'action',\n    'pinned',\n    'metadata',\n  ];\n\n  const escape = (value: unknown): string => {\n    if (value === null || value === undefined) return '';\n    const stringValue = String(value);\n    if (/[\",\\n]/.test(stringValue)) {\n      return `\"${stringValue.replace(/\"/g, '\"\"')}\"`;\n    }\n    return stringValue;\n  };\n\n  const header = columns.join(',');\n  if (!entries.length) {\n    return `${header}\\n`;\n  }\n\n  const rows = entries.map((entry) => {\n    const tags = Array.isArray(entry.tags)\n      ? entry.tags\n          .map((tag) => {\n            if (!tag) return null;\n            const label = tag.label ?? tag.id ?? '';\n            return label ? String(label) : null;\n          })\n          .filter((value): value is string => Boolean(value))\n          .join('|')\n      : '';\n    const metadata =\n      entry.metadata === null || entry.metadata === undefined\n        ? ''\n        : typeof entry.metadata === 'string'\n          ? entry.metadata\n          : JSON.stringify(entry.metadata);\n    const record: Record<string, unknown> = {\n      id: entry.id ?? '',\n      timestamp: entry.timestamp ?? '',\n      tone: entry.tone ?? '',\n      message: entry.message ?? '',\n      tags,\n      action: entry.action ?? '',\n      pinned: entry.pinned ? 'true' : 'false',\n      metadata,\n    };\n    return columns.map((column) => escape(record[column])).join(',');\n  });\n\n  return [header, ...rows].join('\\n');\n}\n\nexport function toYAML(value: unknown, indent = 0): string {\n  const space = '  '.repeat(indent);\n  if (value === null || value === undefined) return 'null';\n  if (Array.isArray(value)) {\n    if (!value.length) return '[]';\n    return value\n      .map((item) => `${space}- ${toYAML(item, indent + 1).replace(/^\\s*/, '')}`)\n      .join('\\n');\n  }\n  if (typeof value === 'object') {\n    const entries = Object.entries(value as Record<string, unknown>);\n    if (!entries.length) return '{}';\n    return entries\n      .map(([key, val]) => {\n        const formatted = toYAML(val, indent + 1);\n        const needsBlock = typeof val === 'object' && val !== null;\n        return `${space}${key}: ${needsBlock ? `\\n${formatted}` : formatted}`;\n      })\n      .join('\\n');\n  }\n  if (typeof value === 'string') {\n    if (/[:#\\-\\[\\]\\{\\}\\n]/.test(value)) {\n      return JSON.stringify(value);\n    }\n    return value;\n  }\n  return String(value);\n}\n", "type StorageLike = {\n  getItem(key: string): string | null | undefined;\n  setItem(key: string, value: string): void;\n  removeItem?(key: string): void;\n};\n\ntype WindowLike = {\n  localStorage?: StorageLike | null;\n};\n\ntype StorageLogger = {\n  warn?: (...args: unknown[]) => void;\n};\n\nexport const STORAGE_KEYS = {\n  activityLog: 'evo-generator-activity-log',\n  filterProfiles: 'evo-generator-filter-profiles',\n  history: 'evo-generator-history',\n  pinned: 'evo-generator-pinned',\n  locks: 'evo-generator-locks',\n  preferences: 'evo-generator-preferences',\n} as const;\n\nexport type StoredPreferences = {\n  audioMuted?: boolean;\n  volume?: number;\n} | null;\n\nexport type StoredLocks = {\n  biomes: unknown[];\n  species: unknown[];\n};\n\nexport interface StorageService {\n  isPersistent(): boolean;\n  loadActivityLog(): unknown[];\n  saveActivityLog(entries: unknown[]): void;\n  loadFilterProfiles(): unknown[];\n  saveFilterProfiles(profiles: unknown[]): void;\n  loadPreferences(): StoredPreferences;\n  savePreferences(preferences: StoredPreferences): void;\n  loadPinnedState(): unknown[];\n  savePinnedState(payload: unknown[]): void;\n  loadLocks(): StoredLocks;\n  saveLocks(payload: StoredLocks): void;\n  loadHistory(): unknown[];\n  saveHistory(entries: unknown[]): void;\n}\n\nexport interface CreateStorageServiceOptions {\n  windowRef?: WindowLike | null;\n  storage?: StorageLike | null;\n  logger?: StorageLogger;\n}\n\nfunction createMemoryStorage(): StorageLike {\n  const store = new Map<string, string>();\n  return {\n    getItem(key: string) {\n      return store.has(key) ? store.get(key)! : null;\n    },\n    setItem(key: string, value: string) {\n      store.set(key, value);\n    },\n    removeItem(key: string) {\n      store.delete(key);\n    },\n  };\n}\n\nfunction detectLocalStorage(\n  windowRef?: WindowLike | null,\n  logger?: StorageLogger,\n): StorageLike | null {\n  const storage = windowRef?.localStorage ?? null;\n  if (!storage) {\n    return null;\n  }\n  try {\n    const testKey = '__storage_test__';\n    storage.setItem(testKey, '1');\n    storage.removeItem?.(testKey);\n    return storage;\n  } catch (error) {\n    logger?.warn?.('LocalStorage non disponibile, verr\u00E0 utilizzato il fallback in-memory', error);\n    return null;\n  }\n}\n\nexport function createStorageService(options: CreateStorageServiceOptions = {}): StorageService {\n  const { windowRef, storage: overrideStorage, logger } = options;\n  const memoryStorage = createMemoryStorage();\n  let activeStorage: StorageLike =\n    overrideStorage ?? detectLocalStorage(windowRef, logger) ?? memoryStorage;\n  let persistent = activeStorage !== memoryStorage;\n\n  function withStorage<T>(action: (driver: StorageLike) => T, fallbackValue: T): T {\n    try {\n      return action(activeStorage);\n    } catch (error) {\n      if (activeStorage !== memoryStorage) {\n        logger?.warn?.('Persistenza locale non disponibile, uso fallback in-memory', error);\n        activeStorage = memoryStorage;\n        persistent = false;\n        try {\n          return action(activeStorage);\n        } catch (fallbackError) {\n          logger?.warn?.(\n            'Operazione storage non riuscita con il fallback in-memory',\n            fallbackError,\n          );\n          return fallbackValue;\n        }\n      }\n      logger?.warn?.('Operazione storage non riuscita', error);\n      return fallbackValue;\n    }\n  }\n\n  function readRaw(key: string): string | null {\n    return withStorage<string | null>((driver) => driver.getItem(key) ?? null, null);\n  }\n\n  function writeRaw(key: string, value: string | null): void {\n    if (value === null) {\n      withStorage(\n        (driver) => {\n          driver.removeItem?.(key);\n        },\n        undefined as unknown as void,\n      );\n      return;\n    }\n    withStorage(\n      (driver) => {\n        driver.setItem(key, value);\n      },\n      undefined as unknown as void,\n    );\n  }\n\n  function loadJson<T>(key: string, defaultValue: T): T {\n    const raw = readRaw(key);\n    if (!raw) {\n      return defaultValue;\n    }\n    try {\n      return JSON.parse(raw) as T;\n    } catch (error) {\n      logger?.warn?.(`Impossibile decodificare i dati salvati per la chiave ${key}`, error);\n      return defaultValue;\n    }\n  }\n\n  function saveJson<T>(key: string, value: T): void {\n    let payload: string;\n    try {\n      payload = JSON.stringify(value);\n    } catch (error) {\n      logger?.warn?.(`Impossibile serializzare i dati per la chiave ${key}`, error);\n      return;\n    }\n    writeRaw(key, payload);\n  }\n\n  return {\n    isPersistent() {\n      return persistent;\n    },\n    loadActivityLog() {\n      const data = loadJson<unknown[]>(STORAGE_KEYS.activityLog, []);\n      return Array.isArray(data) ? data : [];\n    },\n    saveActivityLog(entries: unknown[]) {\n      saveJson(STORAGE_KEYS.activityLog, Array.isArray(entries) ? entries : []);\n    },\n    loadFilterProfiles() {\n      const data = loadJson<unknown[]>(STORAGE_KEYS.filterProfiles, []);\n      return Array.isArray(data) ? data : [];\n    },\n    saveFilterProfiles(profiles: unknown[]) {\n      saveJson(STORAGE_KEYS.filterProfiles, Array.isArray(profiles) ? profiles : []);\n    },\n    loadPreferences() {\n      const data = loadJson<StoredPreferences>(STORAGE_KEYS.preferences, null);\n      if (!data || typeof data !== 'object') {\n        return null;\n      }\n      const result: StoredPreferences = {\n        audioMuted: typeof data.audioMuted === 'boolean' ? data.audioMuted : undefined,\n        volume: typeof data.volume === 'number' ? data.volume : undefined,\n      };\n      if (result.audioMuted === undefined && result.volume === undefined) {\n        return null;\n      }\n      return result;\n    },\n    savePreferences(preferences: StoredPreferences) {\n      if (!preferences || typeof preferences !== 'object') {\n        writeRaw(STORAGE_KEYS.preferences, null);\n        return;\n      }\n      saveJson(STORAGE_KEYS.preferences, preferences);\n    },\n    loadPinnedState() {\n      const data = loadJson<unknown[]>(STORAGE_KEYS.pinned, []);\n      return Array.isArray(data) ? data : [];\n    },\n    savePinnedState(payload: unknown[]) {\n      saveJson(STORAGE_KEYS.pinned, Array.isArray(payload) ? payload : []);\n    },\n    loadLocks() {\n      const data = loadJson<StoredLocks>(STORAGE_KEYS.locks, { biomes: [], species: [] });\n      const biomes = Array.isArray(data?.biomes) ? data.biomes : [];\n      const species = Array.isArray(data?.species) ? data.species : [];\n      return { biomes, species };\n    },\n    saveLocks(payload: StoredLocks) {\n      const biomes = Array.isArray(payload?.biomes) ? payload.biomes : [];\n      const species = Array.isArray(payload?.species) ? payload.species : [];\n      saveJson(STORAGE_KEYS.locks, { biomes, species });\n    },\n    loadHistory() {\n      const data = loadJson<unknown[]>(STORAGE_KEYS.history, []);\n      return Array.isArray(data) ? data : [];\n    },\n    saveHistory(entries: unknown[]) {\n      saveJson(STORAGE_KEYS.history, Array.isArray(entries) ? entries : []);\n    },\n  };\n}\n", "import { StoredPreferences } from './storage.ts';\n\ntype AudioLogger = {\n  warn?: (...args: unknown[]) => void;\n};\n\ntype AudioElementLike = {\n  volume: number;\n  currentTime: number;\n  play?: () => void | Promise<void>;\n  pause?: () => void;\n  preload?: string;\n};\n\ntype AudioElementFactory = (src: string) => AudioElementLike | null;\n\ntype ClassListLike = {\n  toggle?: (className: string, force?: boolean) => void;\n};\n\ntype EventListenerLike = (event: unknown) => void;\n\ntype EventTargetLike = {\n  addEventListener?: (type: string, listener: EventListenerLike) => void;\n};\n\ntype ButtonElementLike = EventTargetLike & {\n  classList?: ClassListLike;\n  setAttribute?: (name: string, value: string) => void;\n  textContent?: string;\n};\n\ntype InputElementLike = EventTargetLike & {\n  value: string;\n};\n\ntype ControlsElementLike = {\n  hidden?: boolean;\n  setAttribute?: (name: string, value: string) => void;\n};\n\nexport interface AudioControlElements {\n  controls?: ControlsElementLike | null;\n  mute?: ButtonElementLike | null;\n  volume?: InputElementLike | null;\n}\n\nexport interface AudioPreferencesState {\n  audioMuted: boolean;\n  volume: number;\n}\n\nexport interface AudioCueFactoryOptions {\n  cues?: Record<string, string>;\n  createAudioElement?: AudioElementFactory;\n  logger?: AudioLogger;\n  initialVolume?: number;\n}\n\nexport interface AudioCueFactory {\n  ensure(key: string): AudioElementLike | null;\n  setVolume(volume: number): void;\n}\n\nexport interface AudioServiceOptions {\n  cues?: Record<string, string>;\n  preferences: AudioPreferencesState;\n  elements?: AudioControlElements;\n  loadPreferences?: () => StoredPreferences;\n  savePreferences?: (preferences: StoredPreferences) => void;\n  createAudioElement?: AudioElementFactory;\n  logger?: AudioLogger;\n  defaultVolume?: number;\n}\n\nexport interface AudioService {\n  applyPreferences(): void;\n  playCue(key: string): void;\n  setupControls(): void;\n  restorePreferences(): void;\n}\n\nexport const RARE_CUE_SOURCE =\n  'data:audio/wav;base64,UklGRiYfAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQIfAAAAALwL+hZBISMqQTFONhM5d' +\n  'DlsNxEzkSwzJFAaUg+wA+j3dezU4XfYw9AKy4rH' +\n  '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' +\n  'Wug=';\n\nexport const DEFAULT_AUDIO_CUES = {\n  rare: RARE_CUE_SOURCE,\n} as const;\n\nexport function clampVolume(value: unknown, fallback = 0.5): number {\n  const numeric = Number(value);\n  if (!Number.isFinite(numeric)) return fallback;\n  if (numeric < 0) return 0;\n  if (numeric > 1) return 1;\n  return numeric;\n}\n\nfunction defaultCreateAudioElement(\n  src: string,\n  initialVolume: number,\n  logger?: AudioLogger,\n): AudioElementLike | null {\n  if (typeof Audio === 'undefined') {\n    return null;\n  }\n  try {\n    const audio = new Audio(src);\n    audio.preload = 'auto';\n    audio.volume = clampVolume(initialVolume);\n    return audio as unknown as AudioElementLike;\n  } catch (error) {\n    logger?.warn?.('Impossibile inizializzare il cue audio', error);\n    return null;\n  }\n}\n\nexport function createAudioCueFactory(options: AudioCueFactoryOptions = {}): AudioCueFactory {\n  const { cues = {}, createAudioElement, logger, initialVolume = 0.5 } = options;\n  const cache = new Map<string, AudioElementLike>();\n  const factory: AudioElementFactory =\n    createAudioElement ?? ((src) => defaultCreateAudioElement(src, initialVolume, logger));\n\n  return {\n    ensure(key: string) {\n      if (!key) return null;\n      if (cache.has(key)) {\n        return cache.get(key) ?? null;\n      }\n      const src = cues[key];\n      if (!src) return null;\n      try {\n        const element = factory(src);\n        if (!element) {\n          return null;\n        }\n        if (typeof element.volume === 'number') {\n          element.volume = clampVolume(initialVolume);\n        }\n        cache.set(key, element);\n        return element;\n      } catch (error) {\n        logger?.warn?.('Impossibile inizializzare il cue audio', error);\n        return null;\n      }\n    },\n    setVolume(volume: number) {\n      const target = clampVolume(volume);\n      cache.forEach((audio) => {\n        try {\n          audio.volume = target;\n        } catch (error) {\n          logger?.warn?.('Impossibile aggiornare il volume del cue audio', error);\n        }\n      });\n    },\n  };\n}\n\nexport function createAudioService(options: AudioServiceOptions): AudioService {\n  const {\n    cues = DEFAULT_AUDIO_CUES,\n    preferences,\n    elements = {},\n    loadPreferences,\n    savePreferences,\n    createAudioElement,\n    logger,\n    defaultVolume = 0.5,\n  } = options;\n\n  const cueFactory = createAudioCueFactory({\n    cues,\n    createAudioElement,\n    logger,\n    initialVolume: defaultVolume,\n  });\n\n  const controlElements: AudioControlElements = {\n    controls: elements.controls ?? null,\n    mute: elements.mute ?? null,\n    volume: elements.volume ?? null,\n  };\n\n  function persist() {\n    savePreferences?.({\n      audioMuted: Boolean(preferences.audioMuted),\n      volume: clampVolume(preferences.volume, defaultVolume),\n    });\n  }\n\n  function applyPreferences() {\n    const muted = Boolean(preferences.audioMuted);\n    const volume = clampVolume(preferences.volume, defaultVolume);\n    preferences.volume = volume;\n\n    cueFactory.setVolume(muted ? 0 : volume);\n\n    const muteButton = controlElements.mute;\n    if (muteButton?.classList?.toggle) {\n      muteButton.classList.toggle('is-muted', muted);\n    }\n    muteButton?.setAttribute?.('aria-pressed', muted ? 'true' : 'false');\n    if (typeof muteButton?.textContent === 'string') {\n      muteButton.textContent = muted ? '\uD83D\uDD07 Audio disattivato' : '\uD83D\uDD08 Audio attivo';\n    }\n\n    const volumeInput = controlElements.volume;\n    if (volumeInput) {\n      const targetValue = String(Math.round(volume * 100));\n      if (volumeInput.value !== targetValue) {\n        volumeInput.value = targetValue;\n      }\n    }\n  }\n\n  function playCue(key: string) {\n    const audio = cueFactory.ensure(key);\n    if (!audio) return;\n    const volume = clampVolume(preferences.volume, defaultVolume);\n    if (preferences.audioMuted || volume <= 0) {\n      if (typeof audio.pause === 'function') {\n        try {\n          audio.pause();\n        } catch (error) {\n          logger?.warn?.('Impossibile mettere in pausa il cue audio', error);\n        }\n      }\n      return;\n    }\n    try {\n      audio.currentTime = 0;\n      audio.volume = volume;\n      const playback = audio.play?.();\n      if (playback && typeof (playback as Promise<void>).catch === 'function') {\n        (playback as Promise<void>).catch((error) => {\n          if (!error || (error as { name?: string }).name === 'NotAllowedError') {\n            return;\n          }\n          logger?.warn?.('Riproduzione audio non riuscita', error);\n        });\n      }\n    } catch (error) {\n      logger?.warn?.(`Impossibile riprodurre il cue audio ${key}`, error);\n    }\n  }\n\n  function setupControls() {\n    const supported = Boolean(cueFactory.ensure('rare'));\n    const controls = controlElements.controls;\n    if (!supported) {\n      if (controls) {\n        controls.hidden = true;\n        controls.setAttribute?.('aria-hidden', 'true');\n      }\n      return;\n    }\n    if (controls) {\n      controls.hidden = false;\n      controls.setAttribute?.('aria-hidden', 'false');\n    }\n\n    const muteButton = controlElements.mute;\n    if (muteButton?.addEventListener) {\n      muteButton.addEventListener('click', (event) => {\n        const evt = event as { preventDefault?: () => void };\n        evt?.preventDefault?.();\n        const nextMuted = !preferences.audioMuted;\n        preferences.audioMuted = nextMuted;\n        if (!nextMuted && clampVolume(preferences.volume, defaultVolume) <= 0) {\n          preferences.volume = defaultVolume;\n        }\n        applyPreferences();\n        persist();\n      });\n    }\n\n    const volumeInput = controlElements.volume;\n    if (volumeInput?.addEventListener) {\n      const handleVolume = (value: unknown) => {\n        const numeric = clampVolume(Number(value) / 100, defaultVolume);\n        preferences.volume = numeric;\n        if (numeric > 0 && preferences.audioMuted) {\n          preferences.audioMuted = false;\n        }\n        if (numeric === 0) {\n          preferences.audioMuted = true;\n        }\n        applyPreferences();\n      };\n\n      volumeInput.addEventListener('input', (event) => {\n        const target =\n          (event as { target?: { value?: string } }).target?.value ?? volumeInput.value;\n        handleVolume(target);\n      });\n\n      volumeInput.addEventListener('change', () => {\n        persist();\n      });\n    }\n\n    applyPreferences();\n  }\n\n  function restorePreferences() {\n    const stored = loadPreferences?.();\n    if (stored && typeof stored === 'object') {\n      if (typeof stored.audioMuted === 'boolean') {\n        preferences.audioMuted = stored.audioMuted;\n      }\n      if (typeof stored.volume === 'number') {\n        preferences.volume = clampVolume(stored.volume, defaultVolume);\n      }\n    }\n    applyPreferences();\n  }\n\n  return {\n    applyPreferences,\n    playCue,\n    setupControls,\n    restorePreferences,\n  };\n}\n", "export interface DossierMetrics {\n  biomeCount: number;\n  speciesCount: number;\n  seedCount: number;\n  uniqueSpeciesCount?: number;\n}\n\nexport interface ActivityEntry {\n  [key: string]: unknown;\n}\n\nexport interface DossierContext {\n  slug: string;\n  folder: string;\n  filters?: Record<string, unknown> | null;\n  filterSummary?: string | null;\n  ecosystemLabel: string;\n  metrics: DossierMetrics;\n  payload: unknown;\n  activityEntries: ActivityEntry[];\n  biomes: unknown[];\n  speciesBuckets: Record<string, unknown[]>;\n  seeds: unknown[];\n  pinnedEntries: unknown[];\n  narrative?: Record<string, unknown> | null;\n  insights?: unknown[];\n  generatedAt?: Date | string;\n  composer?: Record<string, unknown> | null;\n}\n\nexport interface TemplateCache {\n  get(): string | null | undefined;\n  set(value: string | null): void;\n}\n\nexport interface LoadTemplateOptions {\n  fetchImpl?: (input: RequestInfo | URL, init?: RequestInit) => Promise<Response>;\n  cache?: TemplateCache | null;\n  signal?: AbortSignal;\n}\n\nexport interface DossierHelpers {\n  presetLabel?: string | null;\n  roleLabels: Record<string, string>;\n  titleCase: (value: string) => string;\n  findBiomeLabelById?: (biomeId: string | null | undefined) => string | null;\n}\n\nexport interface GeneratedFileDescriptor {\n  id: string;\n  name: string;\n  mime: string;\n  data: string | Blob;\n  binary?: boolean;\n}\n\nexport interface PresetFileConfig {\n  id: string;\n  builder: string;\n  filename: ((slug: string) => string) | string;\n  description?: string | ((context: DossierContext) => string);\n}\n\nexport interface PresetDescriptor {\n  files: PresetFileConfig[];\n}\n\nexport interface DossierExportOptions extends DossierHelpers {\n  template: string;\n  slug: string;\n  html2pdf?: unknown;\n}\n\nexport interface PresetContentOptions extends DossierHelpers {\n  templateLoader: () => Promise<string | null>;\n  slug: string;\n  html2pdf?: unknown;\n  toYAML: (value: unknown) => string;\n  activityLogToCsv: (entries: ActivityEntry[]) => string;\n}\n\nfunction ensureFetcher(\n  fetchImpl?: (input: RequestInfo | URL, init?: RequestInit) => Promise<Response>,\n) {\n  if (typeof fetchImpl === 'function') {\n    return fetchImpl;\n  }\n  if (typeof globalThis.fetch === 'function') {\n    return globalThis.fetch.bind(globalThis);\n  }\n  throw new Error(\"fetch non disponibile nell'ambiente corrente\");\n}\n\nexport async function loadDossierTemplate(\n  path: string,\n  options: LoadTemplateOptions = {},\n): Promise<string | null> {\n  const { cache = null, fetchImpl, signal } = options;\n  const cached = cache?.get?.();\n  if (cached) {\n    return cached;\n  }\n  const fetcher = (() => {\n    try {\n      return ensureFetcher(fetchImpl);\n    } catch (error) {\n      console.warn('fetch non disponibile per il caricamento del template dossier', error);\n      return null;\n    }\n  })();\n  if (!fetcher) {\n    return null;\n  }\n  try {\n    const response = await fetcher(path, { cache: 'no-cache', signal });\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n    const text = await response.text();\n    cache?.set?.(text);\n    return text;\n  } catch (error) {\n    console.warn('Impossibile caricare il template del dossier', error);\n    cache?.set?.(null);\n    return null;\n  }\n}\n\nfunction flattenSpeciesBuckets(buckets: Record<string, unknown[]> = {}): unknown[] {\n  const seen = new Map<string, unknown>();\n  Object.values(buckets)\n    .filter((list): list is unknown[] => Array.isArray(list))\n    .forEach((list) => {\n      list.forEach((entry) => {\n        if (!entry || typeof entry !== 'object') return;\n        const key =\n          (entry as Record<string, unknown>).id ||\n          (entry as Record<string, unknown>).display_name ||\n          (entry as Record<string, unknown>).displayName ||\n          (entry as Record<string, unknown>).speciesId ||\n          null;\n        if (!key || seen.has(String(key))) return;\n        seen.set(String(key), entry);\n      });\n    });\n  return Array.from(seen.values());\n}\n\nfunction summariseSeedParty(seed: Record<string, unknown>): string {\n  const party = Array.isArray(seed.party) ? seed.party : [];\n  if (!party.length) {\n    return 'Nessuna specie associata al seed con i filtri correnti.';\n  }\n  return party\n    .map((entry) => {\n      if (!entry || typeof entry !== 'object') return null;\n      const value = entry as Record<string, unknown>;\n      const parts = [String(value.display_name ?? value.id ?? 'Specie')];\n      const meta: string[] = [];\n      if (typeof value.role === 'string' && value.role.length) meta.push(value.role);\n      if (typeof value.tier === 'number') meta.push(`T${value.tier}`);\n      if (typeof value.count === 'number' && value.count > 1) meta.push(`x${value.count}`);\n      if (meta.length) {\n        parts.push(`(${meta.join(' \u00B7 ')})`);\n      }\n      return parts.join(' ');\n    })\n    .filter(Boolean)\n    .join('; ');\n}\n\nfunction formatSpotlightLine(entry: Record<string, unknown>): string | null {\n  if (!entry) return null;\n  const name = String(\n    entry.displayName ?? entry.display_name ?? entry.speciesId ?? entry.id ?? '',\n  ).trim();\n  if (!name) return null;\n  const biomeLabel = entry.biomeLabel ?? entry.biome_id ?? entry.biome ?? null;\n  const tierLabel = typeof entry.tier === 'number' ? `T${entry.tier}` : null;\n  const synthLabel = entry.synthetic ? 'Synth' : null;\n  const tags = [biomeLabel, tierLabel, synthLabel].filter(Boolean).join(' \u00B7 ');\n  return tags ? `- ${name} (${tags})` : `- ${name}`;\n}\n\nfunction formatSpeciesFallbackLine(\n  species: Record<string, unknown>,\n  helpers: DossierHelpers,\n): string | null {\n  if (!species) return null;\n  const name = String(species.display_name ?? species.id ?? 'Specie');\n  const biomeCode = species.biome_id ?? species.biome ?? species.habitat_code ?? null;\n  const biomeLabel = helpers.findBiomeLabelById?.(biomeCode as string | null) ?? biomeCode;\n  const roleCode = species.role_trofico ?? species.role ?? null;\n  const resolvedRole =\n    typeof roleCode === 'string'\n      ? (helpers.roleLabels[roleCode] ?? helpers.titleCase(roleCode.replace(/_/g, ' ')))\n      : null;\n  const tags = [biomeLabel, resolvedRole].filter(Boolean).join(' \u00B7 ');\n  return tags ? `- ${name} (${tags})` : `- ${name}`;\n}\n\nfunction formatSeedSummary(seed: Record<string, unknown>, helpers: DossierHelpers): string | null {\n  if (!seed) return null;\n  const label = String(seed.label ?? seed.id ?? 'Seed');\n  const biomeCode = seed.biome_id ?? seed.biome ?? null;\n  const biomeLabel = helpers.findBiomeLabelById?.(biomeCode as string | null) ?? biomeCode;\n  const threat = typeof seed.threat_budget === 'number' ? `Budget T${seed.threat_budget}` : null;\n  const synth = seed.synthetic ? 'Synth' : null;\n  const segments = [label, biomeLabel, threat, synth].filter(Boolean).join(' \u00B7 ');\n  return segments ? `- ${segments}` : null;\n}\n\nexport function generateDossierDocument(\n  context: DossierContext,\n  helpers: DossierHelpers & { template: string },\n): Document {\n  const parser = new DOMParser();\n  const doc = parser.parseFromString(helpers.template, 'text/html');\n  const setSlotText = (slot: string, value: string | null | undefined) => {\n    const target = doc.querySelector(`[data-slot=\"${slot}\"]`);\n    if (target) {\n      target.textContent = value ?? '';\n    }\n  };\n\n  const generatedAt = context.generatedAt\n    ? context.generatedAt instanceof Date\n      ? context.generatedAt\n      : new Date(context.generatedAt)\n    : new Date();\n\n  const locale = 'it-IT';\n  const generatedLabel = generatedAt.toLocaleString(locale, { hour12: false });\n\n  setSlotText('title', `${context.ecosystemLabel} \u00B7 Dossier`);\n  setSlotText('heading', context.ecosystemLabel);\n  setSlotText(\n    'badge',\n    helpers.presetLabel ? `Preset \u00B7 ${helpers.presetLabel}` : 'Ecosystem dossier',\n  );\n  setSlotText('meta', `Generato il ${generatedLabel}`);\n\n  const summaryParts = [\n    `${context.metrics.biomeCount} biomi`,\n    `${context.metrics.speciesCount} specie`,\n    `${context.metrics.seedCount} seed`,\n  ];\n  if (context.metrics.uniqueSpeciesCount) {\n    summaryParts.push(`${context.metrics.uniqueSpeciesCount} specie uniche`);\n  }\n  if (context.filterSummary) {\n    summaryParts.push(`Filtri: ${context.filterSummary}`);\n  }\n  setSlotText('summary', summaryParts.join(' \u00B7 '));\n\n  const activityContainer = doc.querySelector('[data-slot=\"activity\"]');\n  if (activityContainer) {\n    activityContainer.innerHTML = '';\n    context.activityEntries.slice(0, 12).forEach((entry) => {\n      const item = doc.createElement('li');\n      item.className = 'dossier__list-item';\n      const text = String(entry.summary ?? entry.message ?? '').trim();\n      item.textContent = text || 'Evento attivit\u00E0';\n      activityContainer.appendChild(item);\n    });\n  }\n\n  const biomeContainer = doc.querySelector('[data-slot=\"biomes\"]');\n  if (biomeContainer) {\n    biomeContainer.innerHTML = '';\n    context.biomes.slice(0, 6).forEach((biome) => {\n      const record = biome as Record<string, unknown>;\n      const item = doc.createElement('li');\n      item.className = 'dossier__list-item';\n      const heading = doc.createElement('h3');\n      const headingParts = [record.label ?? record.id ?? 'Bioma'];\n      const hazard = record.hazard as Record<string, unknown> | undefined;\n      if (hazard?.severity) {\n        headingParts.push(`Pericolo ${helpers.titleCase(String(hazard.severity))}`);\n      }\n      heading.textContent = headingParts.filter(Boolean).join(' \u00B7 ');\n      const summary = doc.createElement('p');\n      const speciesCount = Array.isArray(record.species) ? record.species.length : 0;\n      summary.textContent = `Specie disponibili: ${speciesCount}.`;\n      item.append(heading, summary);\n      biomeContainer.appendChild(item);\n    });\n  }\n\n  const speciesContainer = doc.querySelector('[data-slot=\"species\"]');\n  if (speciesContainer) {\n    speciesContainer.innerHTML = '';\n    flattenSpeciesBuckets(context.speciesBuckets)\n      .slice(0, 12)\n      .forEach((entry) => {\n        const record = entry as Record<string, unknown>;\n        const item = doc.createElement('li');\n        item.className = 'dossier__list-item';\n        const heading = doc.createElement('h3');\n        heading.textContent = String(record.display_name ?? record.id ?? 'Specie');\n        const meta = doc.createElement('p');\n        const metaParts: string[] = [];\n        if (record.role_trofico) {\n          const role = String(record.role_trofico);\n          metaParts.push(helpers.roleLabels[role] ?? helpers.titleCase(role.replace(/_/g, ' ')));\n        }\n        if (record.balance?.threat_tier) {\n          metaParts.push(String(record.balance.threat_tier));\n        }\n        if (Array.isArray(record.biomes) && record.biomes.length) {\n          metaParts.push(`Biomi: ${record.biomes.join(', ')}`);\n        }\n        meta.textContent = metaParts.length ? metaParts.join(' \u00B7 ') : 'Dati sintetici';\n        item.append(heading, meta);\n\n        const tags = Array.isArray(record.functional_tags)\n          ? record.functional_tags.slice(0, 8)\n          : [];\n        if (tags.length) {\n          const chipList = doc.createElement('div');\n          chipList.className = 'dossier__chips';\n          tags.forEach((tag) => {\n            const chip = doc.createElement('span');\n            chip.className = 'dossier__chip';\n            chip.textContent = String(tag);\n            chipList.appendChild(chip);\n          });\n          item.appendChild(chipList);\n        }\n\n        speciesContainer.appendChild(item);\n      });\n  }\n\n  const seedsContainer = doc.querySelector('[data-slot=\"seeds\"]');\n  if (seedsContainer) {\n    seedsContainer.innerHTML = '';\n    context.seeds.slice(0, 10).forEach((seedEntry) => {\n      const record = seedEntry as Record<string, unknown>;\n      const item = doc.createElement('li');\n      item.className = 'dossier__list-item';\n      const heading = doc.createElement('h3');\n      const headingParts = [record.biome_id ?? record.biome ?? record.id ?? 'Seed'];\n      if (record.label) headingParts.push(String(record.label));\n      heading.textContent = headingParts.join(' \u00B7 ');\n      const meta = doc.createElement('p');\n      meta.textContent = `Budget minaccia: T${record.threat_budget ?? '?'}`;\n      const composition = doc.createElement('p');\n      composition.textContent = summariseSeedParty(record);\n      item.append(heading, meta, composition);\n      seedsContainer.appendChild(item);\n    });\n  }\n\n  return doc;\n}\n\nexport async function generateDossierHtml(\n  context: DossierContext,\n  helpers: DossierHelpers & { templateLoader: () => Promise<string | null> },\n): Promise<string | null> {\n  const template = await helpers.templateLoader();\n  if (!template) {\n    return null;\n  }\n  const doc = generateDossierDocument(context, { ...helpers, template });\n  return `<!DOCTYPE html>${doc.documentElement.outerHTML}`;\n}\n\nexport async function generateDossierPdfBlob(\n  context: DossierContext,\n  options: DossierExportOptions & { templateLoader: () => Promise<string | null> },\n): Promise<Blob> {\n  if (typeof window === 'undefined' || !options.html2pdf) {\n    throw new Error('html2pdf non disponibile');\n  }\n  const template = await options.templateLoader();\n  if (!template) {\n    throw new Error('Template dossier non disponibile');\n  }\n  const html = await generateDossierHtml(context, {\n    presetLabel: options.presetLabel,\n    roleLabels: options.roleLabels,\n    titleCase: options.titleCase,\n    findBiomeLabelById: options.findBiomeLabelById,\n    templateLoader: async () => template,\n  });\n  if (!html) {\n    throw new Error('Impossibile generare il dossier HTML');\n  }\n  const worker = (options.html2pdf as typeof window.html2pdf)().set({\n    margin: 10,\n    filename: `${options.slug}-dossier.pdf`,\n    html2canvas: { scale: 2 },\n    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },\n  });\n  const blob = await worker.from(html).outputPdf('blob');\n  return blob;\n}\n\nexport function buildPressKitMarkdown(context: DossierContext, helpers: DossierHelpers): string {\n  const metrics = context.metrics || {\n    biomeCount: 0,\n    speciesCount: 0,\n    uniqueSpeciesCount: 0,\n    seedCount: 0,\n  };\n  const generatedAt =\n    context.generatedAt instanceof Date\n      ? context.generatedAt\n      : new Date(context.generatedAt ?? Date.now());\n\n  const lines: string[] = [];\n  lines.push(`# ${context.ecosystemLabel} \u2014 Demo pubblico`);\n  lines.push('');\n  lines.push(\n    `Generato il ${generatedAt.toLocaleString('it-IT', {\n      dateStyle: 'medium',\n      timeStyle: 'short',\n    })} con ${metrics.biomeCount} biomi, ${metrics.speciesCount} specie (${metrics.uniqueSpeciesCount ?? 0} uniche) e ${metrics.seedCount} seed narrativi.`,\n  );\n  if (context.filterSummary) {\n    lines.push(`Filtri attivi: ${context.filterSummary}.`);\n  }\n  lines.push('');\n\n  lines.push('## Metriche chiave');\n  lines.push('');\n  lines.push(`- Biomi selezionati: ${metrics.biomeCount}`);\n  lines.push(\n    `- Specie totali: ${metrics.speciesCount} (${metrics.uniqueSpeciesCount ?? 0} uniche)`,\n  );\n  lines.push(`- Seed narrativi: ${metrics.seedCount}`);\n  const highlightBiome =\n    Array.isArray(context.biomes) && context.biomes.length ? context.biomes[0] : null;\n  if (highlightBiome) {\n    const label =\n      (highlightBiome as Record<string, unknown>).label ??\n      (highlightBiome as Record<string, unknown>).id ??\n      'Bioma';\n    lines.push(`- Bioma in evidenza: ${label}`);\n  }\n  lines.push('');\n\n  const pinnedLines = Array.isArray(context.pinnedEntries)\n    ? (context.pinnedEntries as Record<string, unknown>[])\n        .map((entry) => formatSpotlightLine(entry))\n        .filter(Boolean)\n        .slice(0, 3)\n    : [];\n  let spotlightLines = pinnedLines;\n  if (!spotlightLines.length) {\n    spotlightLines = flattenSpeciesBuckets(context.speciesBuckets)\n      .map((species) => formatSpeciesFallbackLine(species as Record<string, unknown>, helpers))\n      .filter(Boolean)\n      .slice(0, 3);\n  }\n  if (spotlightLines.length) {\n    lines.push('## Specie spotlight');\n    lines.push('');\n    spotlightLines.forEach((line) => lines.push(line as string));\n    lines.push('');\n  }\n\n  const seedLines = Array.isArray(context.seeds)\n    ? (context.seeds as Record<string, unknown>[])\n        .map((seed) => formatSeedSummary(seed, helpers))\n        .filter(Boolean)\n        .slice(0, 4)\n    : [];\n  if (seedLines.length) {\n    lines.push('## Seed narrativi in evidenza');\n    lines.push('');\n    seedLines.forEach((line) => lines.push(line as string));\n    lines.push('');\n  }\n\n  const recommendations = Array.isArray(context.insights) ? context.insights : [];\n  if (recommendations.length) {\n    lines.push('## Insight operativi');\n    lines.push('');\n    recommendations.slice(0, 4).forEach((rec) => {\n      if (!rec || typeof rec !== 'object') return;\n      const record = rec as Record<string, unknown>;\n      if (!record.message) return;\n      const tone = record.tone ? String(record.tone).toUpperCase() : null;\n      const prefix = tone ? `[${tone}] ` : '';\n      lines.push(`- ${prefix}${record.message}`);\n    });\n    lines.push('');\n  }\n\n  if (context.narrative && typeof context.narrative === 'object') {\n    const narrative = context.narrative as Record<string, unknown>;\n    if (narrative.narrativeHook) {\n      lines.push('## Hook narrativo');\n      lines.push('');\n      lines.push(String(narrative.narrativeHook));\n      lines.push('');\n    }\n  }\n\n  lines.push('## Call to action');\n  lines.push('');\n  lines.push('- Condividi il dossier HTML con Marketing/Comms per asset visivi aggiornati.');\n  lines.push('- Usa il manifesto YAML per predisporre il deploy statico o la CDN demo.');\n  lines.push('- Integra il press kit nelle note di rilascio e nella newsletter della demo.');\n  lines.push('');\n\n  return lines.join('\\n').replace(/\\n{3,}/g, '\\n\\n');\n}\n\nexport async function generatePresetFileContents(\n  preset: PresetDescriptor,\n  context: DossierContext,\n  options: PresetContentOptions,\n): Promise<{ files: GeneratedFileDescriptor[]; context: DossierContext }> {\n  const files: GeneratedFileDescriptor[] = [];\n  let cachedTemplate: string | null | undefined;\n  let cachedHtml: string | null | undefined;\n  let cachedPdf: Blob | null | undefined;\n\n  const ensureTemplate = async () => {\n    if (cachedTemplate !== undefined) return cachedTemplate;\n    cachedTemplate = await options.templateLoader();\n    return cachedTemplate;\n  };\n\n  const ensureHtml = async () => {\n    if (cachedHtml !== undefined) return cachedHtml;\n    const template = await ensureTemplate();\n    if (!template) {\n      cachedHtml = null;\n      return cachedHtml;\n    }\n    cachedHtml = await generateDossierHtml(context, {\n      presetLabel: options.presetLabel,\n      roleLabels: options.roleLabels,\n      titleCase: options.titleCase,\n      findBiomeLabelById: options.findBiomeLabelById,\n      templateLoader: async () => template,\n    });\n    return cachedHtml;\n  };\n\n  const ensurePdf = async () => {\n    if (cachedPdf !== undefined) return cachedPdf;\n    if (!options.html2pdf) {\n      cachedPdf = null;\n      return cachedPdf;\n    }\n    const template = await ensureTemplate();\n    if (!template) {\n      cachedPdf = null;\n      return cachedPdf;\n    }\n    cachedPdf = await generateDossierPdfBlob(context, {\n      presetLabel: options.presetLabel,\n      roleLabels: options.roleLabels,\n      titleCase: options.titleCase,\n      findBiomeLabelById: options.findBiomeLabelById,\n      template,\n      templateLoader: async () => template,\n      slug: options.slug,\n      html2pdf: options.html2pdf,\n    });\n    return cachedPdf;\n  };\n\n  for (const file of preset.files) {\n    const filename =\n      typeof file.filename === 'function' ? file.filename(context.slug) : file.filename;\n    try {\n      switch (file.builder) {\n        case 'ecosystem-json':\n          files.push({\n            id: file.id,\n            name: filename,\n            mime: 'application/json',\n            data: JSON.stringify(context.payload, null, 2),\n          });\n          break;\n        case 'ecosystem-yaml':\n          files.push({\n            id: file.id,\n            name: filename,\n            mime: 'text/yaml',\n            data: options.toYAML(context.payload),\n          });\n          break;\n        case 'activity-json':\n          files.push({\n            id: file.id,\n            name: filename,\n            mime: 'application/json',\n            data: JSON.stringify(context.activityEntries, null, 2),\n          });\n          break;\n        case 'activity-csv':\n          files.push({\n            id: file.id,\n            name: filename,\n            mime: 'text/csv',\n            data: options.activityLogToCsv(context.activityEntries),\n          });\n          break;\n        case 'dossier-html': {\n          const html = await ensureHtml();\n          if (html) {\n            files.push({\n              id: file.id,\n              name: filename,\n              mime: 'text/html',\n              data: html,\n            });\n          }\n          break;\n        }\n        case 'dossier-pdf': {\n          const blob = await ensurePdf();\n          if (blob) {\n            files.push({\n              id: file.id,\n              name: filename,\n              mime: 'application/pdf',\n              data: blob,\n              binary: true,\n            });\n          }\n          break;\n        }\n        case 'press-kit-md': {\n          const markdown = buildPressKitMarkdown(context, options);\n          files.push({\n            id: file.id,\n            name: filename,\n            mime: 'text/markdown',\n            data: markdown,\n          });\n          break;\n        }\n        default:\n          break;\n      }\n    } catch (error) {\n      console.warn(`Impossibile generare il file ${filename}`, error);\n    }\n  }\n\n  return { files, context };\n}\n", "export function setup(state, elements, deps = {}) {\n  deps.setupFilterChangeHandlers?.(state, elements);\n  deps.attachProfileHandlers?.(state, elements);\n  deps.setupExportControls?.(state, elements);\n}\n\nexport function render(state, elements, deps = {}) {\n  const {\n    context = {},\n    renderProfileSlots,\n    renderExportManifest,\n    renderKpiSidebar,\n    currentFilters,\n  } = deps;\n\n  const refreshTargets = Array.isArray(context.refresh)\n    ? new Set(context.refresh)\n    : new Set(['profiles', 'export', 'kpi']);\n\n  if (refreshTargets.has('profiles') && typeof renderProfileSlots === 'function') {\n    renderProfileSlots(state, elements);\n  }\n\n  if (refreshTargets.has('export') && typeof renderExportManifest === 'function') {\n    const filters =\n      context.filters ??\n      (typeof context.getFilters === 'function' ? context.getFilters() : undefined) ??\n      (typeof currentFilters === 'function' ? currentFilters() : undefined);\n    renderExportManifest(filters);\n  }\n\n  if (refreshTargets.has('kpi') && typeof renderKpiSidebar === 'function') {\n    renderKpiSidebar(state, elements);\n  }\n}\n", "export function setup() {}\n\nexport function render(state, elements, deps = {}) {\n  deps.renderTraitExpansions?.(state, elements);\n}\n", "export function setup(state, elements, deps = {}) {\n  deps.attachComparisonHandlers?.(state, elements);\n}\n\nexport function render(state, elements, deps = {}) {\n  const { context = {}, renderBiomes, currentFilters } = deps;\n  const filters =\n    context.filters ?? (typeof currentFilters === 'function' ? currentFilters() : undefined);\n  renderBiomes?.(filters);\n}\n", "export function setup() {}\n\nexport function render(state, elements, deps = {}) {\n  deps.renderSeeds?.(state, elements);\n}\n", "export function setup(state, elements, deps = {}) {\n  deps.attachComposerHandlers?.(state, elements);\n}\n\nexport function render(state, elements, deps = {}) {\n  deps.renderComposerPanel?.(state, elements);\n}\n", "export function setup(state, elements, deps = {}) {\n  deps.attachInsightHandlers?.(state, elements);\n}\n\nexport function render(state, elements, deps = {}) {\n  const { context = {}, renderContextualInsights, getRecommendations } = deps;\n  const recommendations =\n    context.recommendations ??\n    (typeof getRecommendations === 'function' ? getRecommendations() : []);\n  renderContextualInsights?.(recommendations);\n}\n", "export function setup(state, elements, deps = {}) {\n  const triggerRender = () => {\n    if (typeof deps.render === 'function') {\n      deps.render(state, elements, deps);\n    } else {\n      render(state, elements, deps);\n    }\n  };\n\n  if (elements.activitySearch) {\n    elements.activitySearch.addEventListener('input', (event) => {\n      state.activityFilters = state.activityFilters ?? {};\n      state.activityFilters.query = String(event.target.value ?? '');\n      triggerRender();\n    });\n  }\n\n  if (elements.activityTagFilter && typeof deps.getSelectedValues === 'function') {\n    elements.activityTagFilter.addEventListener('change', () => {\n      const values = new Set(deps.getSelectedValues(elements.activityTagFilter));\n      state.activityFilters = state.activityFilters ?? {};\n      state.activityFilters.tags = values;\n      triggerRender();\n    });\n  }\n\n  if (elements.activityPinnedOnly) {\n    elements.activityPinnedOnly.addEventListener('change', (event) => {\n      state.activityFilters = state.activityFilters ?? {};\n      state.activityFilters.pinnedOnly = Boolean(event.target.checked);\n      triggerRender();\n    });\n  }\n\n  if (Array.isArray(elements.activityToneToggles)) {\n    elements.activityToneToggles.forEach((toggle) => {\n      if (!(toggle instanceof HTMLInputElement)) return;\n      toggle.addEventListener('change', (event) => {\n        const tone = event.target.value || event.target.dataset.activityTone;\n        if (!tone) return;\n        state.activityFilters = state.activityFilters ?? {};\n        if (!(state.activityFilters.tones instanceof Set)) {\n          state.activityFilters.tones = new Set(deps.defaultTones ?? []);\n        }\n        if (event.target.checked) {\n          state.activityFilters.tones.add(tone);\n        } else {\n          state.activityFilters.tones.delete(tone);\n        }\n        triggerRender();\n      });\n    });\n  }\n\n  if (elements.activityReset && typeof deps.resetFilters === 'function') {\n    elements.activityReset.addEventListener('click', (event) => {\n      event.preventDefault();\n      deps.resetFilters();\n    });\n  }\n\n  if (elements.logList && typeof deps.togglePin === 'function') {\n    elements.logList.addEventListener('click', (event) => {\n      const target = event.target;\n      if (!(target instanceof HTMLElement)) return;\n      const button = target.closest('[data-action=\"toggle-activity-pin\"]');\n      if (!(button instanceof HTMLElement)) return;\n      event.preventDefault();\n      const { eventId } = button.dataset;\n      if (!eventId) return;\n      deps.togglePin(eventId);\n    });\n  }\n\n  syncControls(state, elements, deps);\n}\n\nexport function render(state, elements, deps = {}) {\n  const list = elements.logList;\n  const empty = elements.logEmpty;\n  if (!list) return;\n\n  list.innerHTML = '';\n  const entries = Array.isArray(state.activityLog) ? state.activityLog : [];\n  const filters = state.activityFilters ?? {};\n  const defaultTones = Array.isArray(deps.defaultTones) ? deps.defaultTones : [];\n  const toneFilterActive = filters.tones instanceof Set;\n  const toneSet = toneFilterActive ? filters.tones : new Set(defaultTones);\n  const tagSet = filters.tags instanceof Set ? filters.tags : new Set();\n  const query = String(filters.query ?? '')\n    .trim()\n    .toLowerCase();\n  const pinnedOnly = Boolean(filters.pinnedOnly);\n\n  const buildHaystack =\n    typeof deps.buildActivityHaystack === 'function' ? deps.buildActivityHaystack : () => '';\n  const toTitleCase = typeof deps.titleCase === 'function' ? deps.titleCase : (value) => value;\n  const toneLabels = deps.toneLabels && typeof deps.toneLabels === 'object' ? deps.toneLabels : {};\n\n  const filtered = entries.filter((entry) => {\n    const tone = entry.tone ?? 'info';\n    if (toneFilterActive) {\n      if (!toneSet.size) return false;\n      if (!toneSet.has(tone)) return false;\n    }\n    if (pinnedOnly && !entry.pinned) {\n      return false;\n    }\n    if (tagSet.size) {\n      const tagIds = (entry.tags ?? []).map((tag) => tag.id);\n      if (!tagIds.some((id) => tagSet.has(id))) {\n        return false;\n      }\n    }\n    if (query) {\n      const haystack = buildHaystack(entry);\n      if (!haystack.includes(query)) {\n        return false;\n      }\n    }\n    return true;\n  });\n\n  const hasEntries = filtered.length > 0;\n  list.hidden = !hasEntries;\n  if (empty) {\n    empty.hidden = hasEntries;\n    const filtersActive =\n      typeof deps.activityFiltersActive === 'function' ? deps.activityFiltersActive(state) : false;\n    empty.textContent =\n      hasEntries || !filtersActive\n        ? 'Nessuna attivit\u00E0 registrata.'\n        : 'Nessun evento corrisponde ai filtri.';\n  }\n\n  if (!hasEntries) {\n    return;\n  }\n\n  filtered.forEach((entry) => {\n    const item = document.createElement('li');\n    item.className = 'generator-timeline__item';\n    item.dataset.tone = entry.tone ?? 'info';\n    item.dataset.pinned = entry.pinned ? 'true' : 'false';\n\n    const marker = document.createElement('div');\n    marker.className = 'generator-timeline__marker';\n    marker.setAttribute('aria-hidden', 'true');\n    item.appendChild(marker);\n\n    const content = document.createElement('div');\n    content.className = 'generator-timeline__content';\n    item.appendChild(content);\n\n    const header = document.createElement('header');\n    header.className = 'generator-timeline__header';\n    content.appendChild(header);\n\n    const time = document.createElement('time');\n    time.className = 'generator-timeline__time';\n    const stamp = entry.timestamp instanceof Date ? entry.timestamp : new Date(entry.timestamp);\n    const safeStamp = Number.isNaN(stamp.getTime()) ? new Date() : stamp;\n    time.dateTime = safeStamp.toISOString();\n    time.textContent = safeStamp.toLocaleString('it-IT', {\n      hour: '2-digit',\n      minute: '2-digit',\n      day: '2-digit',\n      month: '2-digit',\n    });\n    time.title = safeStamp.toLocaleString('it-IT');\n    header.appendChild(time);\n\n    const controls = document.createElement('div');\n    controls.className = 'generator-timeline__controls';\n    header.appendChild(controls);\n\n    const toneBadge = document.createElement('span');\n    toneBadge.className = `generator-timeline__tone generator-timeline__tone--${entry.tone ?? 'info'}`;\n    toneBadge.textContent = toneLabels[entry.tone ?? 'info'] ?? toTitleCase(entry.tone ?? 'info');\n    controls.appendChild(toneBadge);\n\n    const pinButton = document.createElement('button');\n    pinButton.type = 'button';\n    pinButton.className = 'generator-timeline__pin';\n    pinButton.dataset.action = 'toggle-activity-pin';\n    pinButton.dataset.eventId = entry.id;\n    pinButton.setAttribute('aria-pressed', entry.pinned ? 'true' : 'false');\n    pinButton.title = entry.pinned ? 'Rimuovi pin evento' : 'Pin evento';\n    pinButton.textContent = entry.pinned ? '\uD83D\uDCCC' : '\uD83D\uDCCD';\n    controls.appendChild(pinButton);\n\n    if (entry.action) {\n      const meta = document.createElement('p');\n      meta.className = 'generator-timeline__meta';\n      meta.textContent = toTitleCase(entry.action.replace(/[-_]/g, ' '));\n      content.appendChild(meta);\n    }\n\n    const messageText = document.createElement('p');\n    messageText.className = 'generator-timeline__message';\n    messageText.textContent = entry.message;\n    content.appendChild(messageText);\n\n    if (entry.tags?.length) {\n      const tagsContainer = document.createElement('div');\n      tagsContainer.className = 'chip-list chip-list--compact generator-timeline__tags';\n      entry.tags.forEach((tag) => {\n        if (!tag?.label) return;\n        const chip = document.createElement('span');\n        chip.className = 'chip';\n        chip.dataset.tagId = tag.id;\n        chip.textContent = tag.label;\n        tagsContainer.appendChild(chip);\n      });\n      if (tagsContainer.childElementCount) {\n        content.appendChild(tagsContainer);\n      }\n    }\n\n    list.appendChild(item);\n  });\n}\n\nexport function syncControls(state, elements, deps = {}) {\n  state.activityFilters = state.activityFilters ?? {};\n  if (elements.activitySearch) {\n    elements.activitySearch.value = state.activityFilters.query ?? '';\n  }\n  if (elements.activityPinnedOnly) {\n    elements.activityPinnedOnly.checked = Boolean(state.activityFilters.pinnedOnly);\n  }\n  if (Array.isArray(elements.activityToneToggles)) {\n    const defaultTones = Array.isArray(deps.defaultTones) ? deps.defaultTones : [];\n    elements.activityToneToggles.forEach((toggle) => {\n      if (!(toggle instanceof HTMLInputElement)) return;\n      const tone = toggle.value || toggle.dataset.activityTone;\n      if (!tone) return;\n      if (!(state.activityFilters.tones instanceof Set)) {\n        state.activityFilters.tones = new Set(defaultTones);\n      }\n      toggle.checked = state.activityFilters.tones.has(tone);\n    });\n  }\n  if (elements.activityTagFilter) {\n    const selected = state.activityFilters.tags ?? new Set();\n    Array.from(elements.activityTagFilter.options).forEach((option) => {\n      option.selected = selected instanceof Set ? selected.has(option.value) : false;\n    });\n  }\n}\n", "export function setup() {}\n\nexport function render(state, elements, deps = {}) {\n  const container = elements.exportPreview;\n  const empty = elements.exportPreviewEmpty;\n  if (!container || !empty) return;\n\n  const payload = deps.payload ?? null;\n  const hasPayload = Boolean(payload);\n  container.hidden = !hasPayload;\n  empty.hidden = hasPayload;\n\n  if (!hasPayload) {\n    if (elements.exportPreviewJson) elements.exportPreviewJson.textContent = '';\n    if (elements.exportPreviewYaml) elements.exportPreviewYaml.textContent = '';\n    if (elements.exportPreviewJsonDetails) elements.exportPreviewJsonDetails.open = false;\n    if (elements.exportPreviewYamlDetails) elements.exportPreviewYamlDetails.open = false;\n    return;\n  }\n\n  const jsonDetails = elements.exportPreviewJsonDetails;\n  const yamlDetails = elements.exportPreviewYamlDetails;\n  const jsonWasOpen = Boolean(jsonDetails?.open);\n  const yamlWasOpen = Boolean(yamlDetails?.open);\n\n  if (elements.exportPreviewJson) {\n    elements.exportPreviewJson.textContent = JSON.stringify(payload, null, 2);\n  }\n  if (elements.exportPreviewYaml) {\n    if (typeof deps.toYAML === 'function') {\n      elements.exportPreviewYaml.textContent = deps.toYAML(payload);\n    } else {\n      elements.exportPreviewYaml.textContent = '';\n    }\n  }\n\n  if (jsonDetails) jsonDetails.open = jsonWasOpen;\n  if (yamlDetails) yamlDetails.open = yamlWasOpen;\n}\n", "import {\n  loadPackCatalog,\n  manualLoadCatalog,\n  getPackRootCandidates,\n  PACK_PATH,\n} from './pack-data.js';\nimport { resolveGeneratorElements, resolveAnchorUi } from './ui/elements.ts';\nimport { createAnchorNavigator } from './views/anchor.js';\nimport { createSessionState } from './state/session.ts';\nimport { randomId } from './utils/ids.ts';\nimport { buildGenerationConstraints, createTagEntry } from './utils/normalizers.ts';\nimport { activityLogToCsv, serialiseActivityLogEntry, toYAML } from './utils/serializers.ts';\nimport { createStorageService } from './services/storage.ts';\nimport { createAudioService, DEFAULT_AUDIO_CUES } from './services/audio.ts';\nimport {\n  fetchTraitRegistry,\n  fetchTraitReference,\n  fetchTraitGlossary,\n  fetchHazardRegistry,\n  fetchSpecies,\n} from '../../services/api/generatorClient.ts';\nimport {\n  loadDossierTemplate as loadDossierTemplateService,\n  generateDossierDocument as generateDossierDocumentService,\n  generateDossierHtml as generateDossierHtmlService,\n  generateDossierPdfBlob as generateDossierPdfBlobService,\n  buildPressKitMarkdown as buildPressKitMarkdownService,\n  generatePresetFileContents as generatePresetFileContentsService,\n} from '../../services/export/dossier.ts';\nimport * as parametersView from './views/parameters.js';\nimport * as traitsView from './views/traits.js';\nimport * as biomesView from './views/biomes.js';\nimport * as seedsView from './views/seeds.js';\nimport * as composerView from './views/composer.js';\nimport * as insightsView from './views/insights.js';\nimport * as activityView from './views/activity.js';\nimport * as exportView from './views/export.js';\n\nconst elements = resolveGeneratorElements(document);\nconst anchorUi = resolveAnchorUi(document);\nconst anchorNavigator = createAnchorNavigator();\n\nconst PACK_ROOT_CANDIDATES = getPackRootCandidates();\nconst EXPORT_BASE_FOLDER = `${PACK_PATH}out/generator/`;\n\nconst DEFAULT_ACTIVITY_TONES = ['info', 'success', 'warn', 'error'];\nconst MAX_ACTIVITY_EVENTS = 150;\nconst DOSSIER_TEMPLATE_PATH = '../templates/dossier.html';\nconst initialPdfSupport = typeof window !== 'undefined' && typeof window.html2pdf !== 'undefined';\nconst NEBULA_SNAPSHOT_PATH = '../mission-console/data/nebula/atlas.json';\nconst TONE_LABELS = {\n  info: 'Info',\n  success: 'Successo',\n  warn: 'Avviso',\n  error: 'Errore',\n};\n\nfunction getActivityViewDeps() {\n  return {\n    defaultTones: DEFAULT_ACTIVITY_TONES,\n    toneLabels: TONE_LABELS,\n    buildActivityHaystack,\n    activityFiltersActive: () => activityFiltersActive(),\n    titleCase,\n    getSelectedValues,\n    resetFilters: resetActivityFilters,\n    togglePin: toggleActivityPin,\n  };\n}\nconst REROLL_ACTIONS = new Set(['reroll-biomi', 'reroll-species', 'reroll-seeds']);\nconst ROLL_ACTIONS = new Set(['roll-ecos', 'reroll-biomi', 'reroll-species', 'reroll-seeds']);\n\nconst SPECIES_ROLE_LABELS = {\n  apex: 'Apex',\n  keystone: 'Specie chiave',\n  bridge: 'Specie ponte',\n  threat: 'Minaccia',\n  event: 'Evento dinamico',\n};\n\nconst CONNECTION_TYPE_LABELS = {\n  corridor: 'Corridoio stagionale',\n  trophic_spillover: 'Spillover trofico',\n  seasonal_bridge: 'Ponte stagionale',\n};\n\nconst PANEL_LABELS = {\n  parameters: 'Parametri',\n  traits: 'Pacchetti ambientali',\n  biomes: 'Biomi selezionati',\n  seeds: 'Encounter seed',\n  composer: 'Composizione avanzata',\n  insights: 'Insight contestuali',\n};\n\nconst FLOW_STATUS_LABELS = {\n  pending: 'In attesa',\n  active: 'In corso',\n  complete: 'Completato',\n};\n\nconst FLOW_STATUS_ICONS = {\n  pending: '\u25CB',\n  active: '\u25D4',\n  complete: '\u25CF',\n};\n\nconst USER_FLOWS = [\n  {\n    id: 'onboarding',\n    label: 'Onboarding form',\n    target: '#generator-parameters',\n    description:\n      'Configura vincoli, filtri e profili per ottenere un roll coerente prima della generazione.',\n  },\n  {\n    id: 'summary',\n    label: 'Riepilogo e narrativa',\n    target: '#generator-summary',\n    description:\n      'Monitora metriche, narrativa dinamica e pinnature per ottimizzare la sessione in corso.',\n  },\n  {\n    id: 'history',\n    label: 'Cronologia snapshot',\n    target: '#generator-history',\n    description:\n      'Raccogli snapshot e timeline per confrontare le estrazioni e condividere i risultati.',\n  },\n];\n\nconst PROFILE_SLOT_COUNT = 5;\nconst MAX_SPECIES_PER_BIOME = 3;\nconst MAX_HISTORY_ENTRIES = 12;\nconst HISTORY_ACTION_LABELS = {\n  'roll-ecos': 'Nuovo ecosistema',\n  'reroll-biomi': 'Biomi aggiornati',\n  'reroll-species': 'Specie aggiornate',\n  'reroll-seeds': 'Seed rigenerati',\n};\nconst MANIFEST_PRESETS = [\n  {\n    id: 'playtest-bundle',\n    label: 'Bundle playtest',\n    description:\n      'Pacchetto completo per sessioni di prova con dati serializzati e registro attivit\u00E0.',\n    zipSuffix: 'playtest',\n    files: [\n      {\n        id: 'ecosystem-json',\n        format: 'JSON',\n        filename: (slug) => `${slug}.json`,\n        description: (context) =>\n          `Dump completo dell'ecosistema \"${context.ecosystemLabel}\" con ${context.metrics.biomeCount} biomi, ${context.metrics.speciesCount} specie e ${context.metrics.seedCount} seed generati.`,\n        builder: 'ecosystem-json',\n      },\n      {\n        id: 'ecosystem-yaml',\n        format: 'YAML',\n        filename: (slug) => `${slug}.yaml`,\n        description: () =>\n          'Manifesto YAML utilizzabile per commit rapidi o pipeline di integrazione continua.',\n        builder: 'ecosystem-yaml',\n      },\n      {\n        id: 'activity-json',\n        format: 'JSON',\n        filename: (slug) => `${slug}-log.json`,\n        description: () =>\n          'Registro attivit\u00E0 in formato JSON con tutti gli eventi ordinati cronologicamente.',\n        builder: 'activity-json',\n        optional: true,\n      },\n      {\n        id: 'activity-csv',\n        format: 'CSV',\n        filename: (slug) => `${slug}-log.csv`,\n        description: () =>\n          'Registro attivit\u00E0 pronto per spreadsheet, pivot e annotazioni durante il playtest.',\n        builder: 'activity-csv',\n        optional: true,\n      },\n    ],\n  },\n  {\n    id: 'report-design',\n    label: 'Report design',\n    description:\n      'Materiale di documentazione per pitch, hand-off designer e revisioni art direction.',\n    zipSuffix: 'report',\n    files: [\n      {\n        id: 'ecosystem-yaml',\n        format: 'YAML',\n        filename: (slug) => `${slug}.yaml`,\n        description: () =>\n          'Manifesto YAML curato per alimentare design docs, report e versioning narrativo.',\n        builder: 'ecosystem-yaml',\n      },\n      {\n        id: 'dossier-html',\n        format: 'HTML',\n        filename: (slug) => `${slug}-dossier.html`,\n        description: () =>\n          'Dossier HTML con panoramica visiva dei biomi, specie chiave e seed generati.',\n        builder: 'dossier-html',\n      },\n      {\n        id: 'dossier-pdf',\n        format: 'PDF',\n        filename: (slug) => `${slug}-dossier.pdf`,\n        description: () =>\n          'Versione PDF del dossier, pronta per la condivisione con stakeholder esterni.',\n        builder: 'dossier-pdf',\n      },\n    ],\n  },\n  {\n    id: 'demo-bundle',\n    label: 'Bundle demo pubblico',\n    description:\n      'Kit leggero per distribuzioni pubbliche con manifesto, dossier e press kit narrativo.',\n    zipSuffix: 'demo',\n    files: [\n      {\n        id: 'ecosystem-yaml',\n        format: 'YAML',\n        filename: (slug) => `${slug}.yaml`,\n        description: () =>\n          'Manifesto YAML allineato al bundle demo, pronto per deploy statici o CDN.',\n        builder: 'ecosystem-yaml',\n      },\n      {\n        id: 'dossier-html',\n        format: 'HTML',\n        filename: (slug) => `${slug}-dossier.html`,\n        description: () =>\n          'Dossier HTML riassuntivo con biomi, specie in evidenza e seed narrativi per la demo.',\n        builder: 'dossier-html',\n      },\n      {\n        id: 'press-kit-md',\n        format: 'Markdown',\n        filename: (slug) => `${slug}-press-kit.md`,\n        description: () =>\n          'Press kit markdown con punti chiave, highlight e call-to-action per il lancio pubblico.',\n        builder: 'press-kit-md',\n      },\n    ],\n  },\n];\n\nconst DEFAULT_BRIEFING_TEXT = 'Genera un ecosistema per ottenere il briefing operativo.';\nconst DEFAULT_HOOK_TEXT = 'Gli hook narrativi compariranno dopo la prima generazione.';\n\nconst state = createSessionState({\n  defaultActivityTones: DEFAULT_ACTIVITY_TONES,\n  manifestPresets: MANIFEST_PRESETS,\n  initialPdfSupported: initialPdfSupport,\n  defaultBriefingText: DEFAULT_BRIEFING_TEXT,\n  defaultHookText: DEFAULT_HOOK_TEXT,\n});\n\nstate.nebula = state.nebula || {\n  dataset: null,\n  generator: null,\n  telemetry: null,\n  lastSyncedAt: null,\n  error: null,\n};\n\nconst storageService = createStorageService({\n  windowRef: typeof window !== 'undefined' ? window : null,\n  logger: typeof console !== 'undefined' ? console : undefined,\n});\n\nconst audioService = createAudioService({\n  cues: DEFAULT_AUDIO_CUES,\n  preferences: state.preferences,\n  elements: {\n    controls: elements.audioControls,\n    mute: elements.audioMute,\n    volume: elements.audioVolume,\n  },\n  loadPreferences: () => storageService.loadPreferences(),\n  savePreferences: (prefs) => storageService.savePreferences(prefs),\n  logger: typeof console !== 'undefined' ? console : undefined,\n  defaultVolume: typeof state.preferences?.volume === 'number' ? state.preferences.volume : 0.75,\n});\n\naudioService.restorePreferences();\n\nlet summaryFocusTimer = null;\n\nlet packContext = null;\nlet resolvedCatalogUrl = null;\nlet resolvedPackRoot = null;\nlet packDocsBase = null;\nlet comparisonChart = null;\nlet chartUnavailableNotified = false;\nlet composerRadarChart = null;\nlet composerChartUnavailable = false;\n\nconst panelRegistry = new Map();\n\nfunction registerPanel(id, viewModule, dependenciesFactory = () => ({})) {\n  const controller = {\n    setup() {\n      if (typeof viewModule?.setup === 'function') {\n        viewModule.setup(state, elements, dependenciesFactory());\n      }\n    },\n    render(context) {\n      if (typeof viewModule?.render === 'function') {\n        viewModule.render(state, elements, {\n          ...dependenciesFactory(),\n          context: context ?? {},\n        });\n      }\n    },\n  };\n  panelRegistry.set(id, controller);\n  return controller;\n}\n\nconst parametersPanel = registerPanel('parameters', parametersView, () => ({\n  setupFilterChangeHandlers,\n  setupExportControls,\n  attachProfileHandlers,\n  renderProfileSlots,\n  renderExportManifest,\n  renderKpiSidebar,\n  currentFilters,\n}));\n\nconst traitsPanel = registerPanel('traits', traitsView, () => ({\n  renderTraitExpansions,\n}));\n\nconst biomesPanel = registerPanel('biomes', biomesView, () => ({\n  renderBiomes,\n  currentFilters,\n  attachComparisonHandlers,\n}));\n\nconst seedsPanel = registerPanel('seeds', seedsView, () => ({\n  renderSeeds,\n}));\n\nconst composerPanel = registerPanel('composer', composerView, () => ({\n  renderComposerPanel,\n  attachComposerHandlers,\n}));\n\nconst insightsPanel = registerPanel('insights', insightsView, () => ({\n  renderContextualInsights,\n  attachInsightHandlers,\n  getRecommendations: () => state.narrative?.recommendations ?? [],\n}));\n\nfunction renderParametersPanel(context = {}) {\n  parametersPanel.render(context);\n}\n\nfunction renderTraitsPanel(context = {}) {\n  traitsPanel.render(context);\n}\n\nfunction renderBiomesPanel(filters = currentFilters()) {\n  biomesPanel.render({ filters });\n}\n\nfunction renderSeedsPanel(context = {}) {\n  seedsPanel.render(context);\n}\n\nfunction renderComposerPanelView(context = {}) {\n  composerPanel.render(context);\n}\n\nfunction renderInsightsPanel(recommendations = state.narrative?.recommendations ?? []) {\n  insightsPanel.render({ recommendations });\n}\n\nif (typeof window !== 'undefined' && typeof window.__EVO_TACTICS_API_BASE__ === 'string') {\n  state.api.base = window.__EVO_TACTICS_API_BASE__;\n}\n\nconst COMPARISON_LABELS = ['Tier medio', 'Densit\u00E0 hazard', 'Diversit\u00E0 ruoli'];\n\nconst ROLE_FLAGS = ['apex', 'keystone', 'bridge', 'threat', 'event'];\n\nconst ROLE_FLAG_LABELS = {\n  apex: 'Apex',\n  keystone: 'Specie chiave',\n  bridge: 'Specie ponte',\n  threat: 'Minaccia',\n  event: 'Evento dinamico',\n};\n\nconst ROLE_FLAG_TOKENS = {\n  apex: '--color-accent-400',\n  keystone: '--color-success-400',\n  bridge: '--color-info-400',\n  threat: '--color-error-400',\n  event: '--color-warn-400',\n};\n\nconst COMPOSER_RADAR_LABELS = ROLE_FLAGS.map((flag) => ROLE_FLAG_LABELS[flag] ?? titleCase(flag));\n\nconst TRAIT_CATEGORY_LABELS = {\n  biomi_estremi: 'Biomi estremi',\n  rete_connessa: 'Rete connessa',\n  avanzati_specializzati: 'Cluster avanzati',\n};\n\nconst API_ENDPOINTS = {\n  biomeGeneration: '/api/v1/generation/biomes',\n};\n\nconst HAZARD_LABELS = {\n  low: 'Basso',\n  medium: 'Medio',\n  high: 'Alto',\n};\n\nfunction resolveApiEndpoint(pathname) {\n  const bases = [state.api?.base, packContext?.apiBase];\n  if (typeof window !== 'undefined' && typeof window.__EVO_TACTICS_API_BASE__ === 'string') {\n    bases.push(window.__EVO_TACTICS_API_BASE__);\n  }\n  for (const base of bases) {\n    if (!base) continue;\n    try {\n      return new URL(pathname, base).toString();\n    } catch (error) {\n      console.warn(\"Impossibile risolvere l'endpoint API\", base, error);\n    }\n  }\n  return pathname;\n}\n\nfunction formatHazardSeverity(severity) {\n  if (!severity) return '';\n  return HAZARD_LABELS[severity] ?? titleCase(severity);\n}\n\nfunction applyCatalogContext(data, context) {\n  packContext = context ?? null;\n  resolvedCatalogUrl = context?.catalogUrl ?? null;\n  resolvedPackRoot = context?.resolvedBase ?? null;\n  packDocsBase = context?.docsBase ?? null;\n  if (context?.apiBase) {\n    state.api.base = context.apiBase;\n  }\n  state.data = data;\n  populateFilters(data);\n  renderFlowMap();\n}\n\nfunction calculatePickMetrics() {\n  const biomes = state.pick?.biomes ?? [];\n  const speciesBuckets = state.pick?.species ?? {};\n  const seeds = state.pick?.seeds ?? [];\n  const biomeCount = Array.isArray(biomes) ? biomes.length : 0;\n  const speciesCount = Object.values(speciesBuckets).reduce(\n    (sum, list) => sum + (Array.isArray(list) ? list.length : 0),\n    0,\n  );\n  const seedCount = Array.isArray(seeds) ? seeds.length : 0;\n  const uniqueSpecies = new Set();\n  Object.values(speciesBuckets).forEach((list) => {\n    if (!Array.isArray(list)) return;\n    list.forEach((sp) => {\n      if (sp?.id) {\n        uniqueSpecies.add(sp.id);\n      }\n    });\n  });\n  const uniqueSpeciesCount = uniqueSpecies.size;\n  return { biomeCount, speciesCount, seedCount, uniqueSpeciesCount };\n}\n\nfunction focusSummaryPanel() {\n  if (!elements.summaryContainer) return;\n  if (!elements.summaryContainer.hasAttribute('tabindex')) {\n    elements.summaryContainer.setAttribute('tabindex', '-1');\n  }\n  if (typeof elements.summaryContainer.focus === 'function') {\n    try {\n      elements.summaryContainer.focus({ preventScroll: true });\n    } catch (error) {\n      console.warn('Impossibile portare il focus sul riepilogo', error);\n    }\n  }\n  if (typeof elements.summaryContainer.scrollIntoView === 'function') {\n    try {\n      elements.summaryContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });\n    } catch (error) {\n      console.warn('Impossibile scorrere verso il riepilogo', error);\n    }\n  }\n  elements.summaryContainer.classList.add('is-focused');\n  if (typeof window !== 'undefined') {\n    if (summaryFocusTimer) {\n      window.clearTimeout(summaryFocusTimer);\n    }\n    summaryFocusTimer = window.setTimeout(() => {\n      elements.summaryContainer.classList.remove('is-focused');\n    }, 1400);\n  }\n}\n\nfunction setStatus(message, tone = 'info', options = {}) {\n  const now = new Date();\n  if (elements.status) {\n    elements.status.textContent = message;\n    elements.status.dataset.tone = tone;\n  }\n  if (elements.lastAction) {\n    const formatted = now.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });\n    elements.lastAction.textContent = `Ultimo aggiornamento: ${formatted}`;\n    elements.lastAction.dataset.tone = tone;\n    elements.lastAction.title = now.toLocaleString('it-IT');\n  }\n  recordActivity(message, tone, now, options);\n\n  if (options.rare) {\n    triggerRareEventFeedback({ target: options.rareTarget ?? state.narrative.reason ?? null });\n  }\n}\n\nfunction updateSummaryCounts() {\n  const { biomeCount, speciesCount, seedCount, uniqueSpeciesCount } = calculatePickMetrics();\n\n  if (elements.summaryCounts) {\n    if (elements.summaryCounts.biomes) {\n      elements.summaryCounts.biomes.textContent = String(biomeCount);\n    }\n    if (elements.summaryCounts.species) {\n      elements.summaryCounts.species.textContent = String(speciesCount);\n    }\n    if (elements.summaryCounts.seeds) {\n      elements.summaryCounts.seeds.textContent = String(seedCount);\n    }\n  }\n\n  if (elements.summaryContainer) {\n    const hasResults = biomeCount + speciesCount + seedCount > 0;\n    elements.summaryContainer.dataset.hasResults = hasResults ? 'true' : 'false';\n  }\n\n  state.metrics.uniqueSpecies = uniqueSpeciesCount;\n  renderParametersPanel({ refresh: ['kpi'] });\n\n  renderParametersPanel({ refresh: ['export'] });\n  renderPinnedSummary();\n}\n\nfunction formatAverageRollMetric(ms) {\n  if (!Number.isFinite(ms) || ms <= 0) {\n    return '\u2014';\n  }\n  if (ms < 1000) {\n    return `${Math.round(ms)} ms`;\n  }\n  const seconds = ms / 1000;\n  if (seconds < 60) {\n    return `${seconds.toFixed(1)} s`;\n  }\n  const minutes = seconds / 60;\n  return `${minutes.toFixed(1)} min`;\n}\n\nfunction deriveFlowSnapshot() {\n  const metrics = calculatePickMetrics();\n  const hasCatalog = Boolean(state.data);\n  const hasResults = metrics.biomeCount > 0 || metrics.speciesCount > 0 || metrics.seedCount > 0;\n  const hasSeeds = metrics.seedCount > 0;\n  const hasHistory = Array.isArray(state.history) && state.history.length > 0;\n  const filtersSummary = summariseFilters(state.lastFilters ?? {});\n  const rerollCount = Number.isFinite(state.metrics?.rerollCount)\n    ? Math.max(0, state.metrics.rerollCount)\n    : 0;\n  const averageRoll = state.metrics?.averageRollIntervalMs ?? null;\n\n  return {\n    onboarding: {\n      status: hasResults ? 'complete' : hasCatalog ? 'active' : 'pending',\n      details: [\n        `Biomi selezionati: ${metrics.biomeCount}`,\n        filtersSummary ? `Filtri attivi: ${filtersSummary}` : 'Filtri attivi: nessuno',\n      ],\n    },\n    summary: {\n      status: hasResults ? (hasSeeds ? 'complete' : 'active') : hasCatalog ? 'pending' : 'pending',\n      details: [\n        `Specie totali: ${metrics.speciesCount}`,\n        `Seed generati: ${metrics.seedCount}`,\n        `Tempo medio roll: ${formatAverageRollMetric(averageRoll)}`,\n        `Riusi profili: ${state.metrics.filterProfileReuses ?? 0}`,\n      ],\n    },\n    history: {\n      status: hasHistory ? 'complete' : hasResults ? 'active' : hasCatalog ? 'pending' : 'pending',\n      details: [\n        `Snapshot salvati: ${state.history?.length ?? 0}`,\n        `Click per roll: ${Math.max(1, rerollCount + 1)}`,\n      ],\n    },\n  };\n}\n\nfunction renderFlowMap() {\n  const list = elements.flowMapList;\n  if (!list) return;\n\n  const snapshot = deriveFlowSnapshot();\n  list.innerHTML = '';\n\n  USER_FLOWS.forEach((flow) => {\n    const entry = snapshot[flow.id] ?? { status: 'pending', details: [] };\n    const status = entry.status;\n    const icon = FLOW_STATUS_ICONS[status] ?? FLOW_STATUS_ICONS.pending;\n    const label = FLOW_STATUS_LABELS[status] ?? FLOW_STATUS_LABELS.pending;\n\n    const item = document.createElement('li');\n    item.className = 'generator-flow-map__item';\n    item.dataset.flowId = flow.id;\n    item.dataset.flowStatus = status;\n\n    const article = document.createElement('article');\n    article.className = 'card generator-flow-map__card';\n\n    const header = document.createElement('div');\n    header.className = 'generator-flow-map__header';\n\n    const statusLabel = document.createElement('p');\n    statusLabel.className = 'generator-flow-map__status';\n    statusLabel.textContent = `${icon} ${label}`;\n    header.appendChild(statusLabel);\n\n    const title = document.createElement('h3');\n    title.className = 'generator-flow-map__title';\n    title.textContent = flow.label;\n    header.appendChild(title);\n\n    article.appendChild(header);\n\n    const description = document.createElement('p');\n    description.className = 'generator-flow-map__description';\n    description.textContent = flow.description;\n    article.appendChild(description);\n\n    if (Array.isArray(entry.details) && entry.details.length) {\n      const details = document.createElement('ul');\n      details.className = 'generator-flow-map__details';\n      entry.details.forEach((detail) => {\n        const li = document.createElement('li');\n        li.textContent = detail;\n        details.appendChild(li);\n      });\n      article.appendChild(details);\n    }\n\n    const actions = document.createElement('div');\n    actions.className = 'generator-flow-map__actions';\n    const button = document.createElement('button');\n    button.type = 'button';\n    button.className = 'button button--ghost generator-flow-map__action';\n    button.dataset.flowTarget = flow.target;\n    button.dataset.flowId = flow.id;\n    button.textContent = 'Apri sezione';\n    button.setAttribute('aria-label', `Apri sezione ${flow.label}`);\n    actions.appendChild(button);\n    article.appendChild(actions);\n\n    item.appendChild(article);\n    list.appendChild(item);\n  });\n\n  if (Array.isArray(elements.flowNodes)) {\n    elements.flowNodes.forEach((node) => {\n      if (!(node instanceof HTMLElement)) return;\n      const flowId = node.dataset.flowNode;\n      if (!flowId) return;\n      const entry = snapshot[flowId];\n      node.dataset.flowStatus = entry?.status ?? 'pending';\n    });\n  }\n}\n\nfunction setupFlowMapControls() {\n  const list = elements.flowMapList;\n  if (!list) return;\n  list.addEventListener('click', (event) => {\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) return;\n    const button = target.closest('[data-flow-target]');\n    if (!(button instanceof HTMLElement)) return;\n    const selector = button.dataset.flowTarget;\n    if (!selector) return;\n    const destination = document.querySelector(selector);\n    if (destination instanceof HTMLElement) {\n      destination.scrollIntoView({ behavior: 'smooth', block: 'start' });\n    }\n  });\n}\n\nconst RARE_TARGET_MAP = {\n  seed: 'hook',\n  species: 'briefing',\n  both: 'both',\n};\n\nlet rareFeedbackTimer = null;\n\nfunction pulseElement(element, className = 'is-animated', duration = 900) {\n  if (!element) return;\n  const timerKey = `__${className}Timer`;\n  if (element[timerKey]) {\n    clearTimeout(element[timerKey]);\n  }\n  element.classList.remove(className);\n  void element.offsetWidth;\n  element.classList.add(className);\n  if (typeof window !== 'undefined') {\n    element[timerKey] = window.setTimeout(() => {\n      element.classList.remove(className);\n      element[timerKey] = null;\n    }, duration);\n  }\n}\n\nfunction triggerRareEventFeedback(context = {}) {\n  if (elements.summaryContainer) {\n    elements.summaryContainer.classList.remove('is-rare-event');\n    void elements.summaryContainer.offsetWidth;\n    elements.summaryContainer.classList.add('is-rare-event');\n    if (rareFeedbackTimer && typeof window !== 'undefined') {\n      clearTimeout(rareFeedbackTimer);\n    }\n    if (typeof window !== 'undefined') {\n      rareFeedbackTimer = window.setTimeout(() => {\n        elements.summaryContainer?.classList.remove('is-rare-event');\n      }, 1000);\n    }\n  }\n\n  const target = context.target ? (RARE_TARGET_MAP[context.target] ?? context.target) : null;\n  if (target === 'hook' || target === 'both') {\n    pulseElement(elements.hookPanel, 'narrative-panel--rare', 900);\n  }\n  if (target === 'briefing' || target === 'both') {\n    pulseElement(elements.briefingPanel, 'narrative-panel--rare', 900);\n  }\n\n  audioService.playCue('rare');\n}\n\nfunction updateNarrativePrompts(filters = state.lastFilters) {\n  const context = buildNarrativePrompts(\n    state.pick,\n    filters ?? state.lastFilters ?? { flags: [], roles: [], tags: [] },\n  );\n  state.narrative.missionBriefing = context.missionBriefing;\n  state.narrative.narrativeHook = context.narrativeHook;\n  state.narrative.rare = context.isHighThreat;\n  state.narrative.reason = context.rareReason;\n  state.narrative.recommendations = context.recommendations ?? [];\n\n  if (elements.narrativePanel) {\n    elements.narrativePanel.dataset.hasNarrative = context.hasNarrative ? 'true' : 'false';\n  }\n  if (elements.narrativeBriefing) {\n    elements.narrativeBriefing.textContent = context.missionBriefing;\n  }\n  if (elements.narrativeHook) {\n    elements.narrativeHook.textContent = context.narrativeHook;\n  }\n\n  renderInsightsPanel(state.narrative.recommendations);\n\n  pulseElement(elements.briefingPanel);\n  pulseElement(elements.hookPanel);\n\n  return context;\n}\n\nfunction buildNarrativePrompts(pick, filters = { flags: [], roles: [], tags: [] }) {\n  const normalisedFilters = {\n    flags: Array.isArray(filters.flags) ? filters.flags : [],\n    roles: Array.isArray(filters.roles) ? filters.roles : [],\n    tags: Array.isArray(filters.tags) ? filters.tags : [],\n  };\n\n  const metrics = calculatePickMetrics();\n  const hasBiomes = metrics.biomeCount > 0;\n  const filterSummary = summariseFilters(normalisedFilters);\n  if (!hasBiomes) {\n    return {\n      missionBriefing: DEFAULT_BRIEFING_TEXT,\n      narrativeHook: DEFAULT_HOOK_TEXT,\n      hasNarrative: false,\n      isHighThreat: false,\n      rareReason: null,\n      metrics,\n    };\n  }\n\n  const biomes = Array.isArray(pick?.biomes) ? pick.biomes : [];\n  const speciesBuckets = pick?.species ?? {};\n  const seeds = Array.isArray(pick?.seeds) ? pick.seeds : [];\n\n  const highlightBiome =\n    [...biomes].sort((a, b) => {\n      const syntheticDelta = (b.synthetic ? 1 : 0) - (a.synthetic ? 1 : 0);\n      if (syntheticDelta !== 0) return syntheticDelta;\n      const speciesA = Array.isArray(speciesBuckets[a.id]) ? speciesBuckets[a.id].length : 0;\n      const speciesB = Array.isArray(speciesBuckets[b.id]) ? speciesBuckets[b.id].length : 0;\n      if (speciesA !== speciesB) return speciesB - speciesA;\n      const labelA = a.label ?? a.id ?? '';\n      const labelB = b.label ?? b.id ?? '';\n      return labelA.localeCompare(labelB);\n    })[0] ?? null;\n\n  const speciesEntries = [];\n  biomes.forEach((biome) => {\n    const list = Array.isArray(speciesBuckets[biome.id]) ? speciesBuckets[biome.id] : [];\n    list.forEach((sp) => {\n      const tier = tierOf(sp);\n      speciesEntries.push({\n        name: sp.display_name ?? sp.id ?? 'Specie',\n        tier,\n        biomeLabel: biome.label ?? titleCase(biome.id ?? 'bioma'),\n        synthetic: Boolean(sp.synthetic || biome.synthetic),\n      });\n    });\n  });\n\n  speciesEntries.sort((a, b) => {\n    if (b.tier !== a.tier) return b.tier - a.tier;\n    return a.name.localeCompare(b.name);\n  });\n\n  const topSpecies = speciesEntries.slice(0, 3);\n  const apex = topSpecies[0] ?? null;\n  const speciesSummary = topSpecies.length\n    ? topSpecies\n        .map((entry) => {\n          const parts = [`${entry.name}`, `T${entry.tier}`];\n          parts.push(entry.biomeLabel);\n          if (entry.synthetic) {\n            parts.push('Synth');\n          }\n          return parts.join(' \u00B7 ');\n        })\n        .join(' | ')\n    : 'Nessuna specie prioritaria identificata';\n\n  const highlightLabel = highlightBiome\n    ? (highlightBiome.label ?? titleCase(highlightBiome.id ?? 'bioma'))\n    : 'rete';\n  const highlightDescriptor = highlightBiome?.synthetic\n    ? `${highlightLabel} \u00B7 Synth`\n    : highlightLabel;\n\n  const hasFilters = Boolean(filterSummary && filterSummary.length);\n\n  const missionBriefingParts = [\n    `Deploy su ${metrics.biomeCount} biomi con ${metrics.speciesCount} specie (${metrics.uniqueSpeciesCount} uniche).`,\n    highlightBiome ? `Priorit\u00E0 operativa: ${highlightDescriptor}.` : null,\n    topSpecies.length\n      ? `Asset chiave: ${speciesSummary}.`\n      : 'Asset chiave: in attesa di estrazioni mirate.',\n    hasFilters ? `Filtri attivi: ${filterSummary}.` : 'Filtri attivi: nessuno.',\n  ].filter(Boolean);\n\n  const missionBriefing = missionBriefingParts.join(' ');\n\n  const sortedSeeds = [...seeds].sort((a, b) => (b.threat_budget ?? 0) - (a.threat_budget ?? 0));\n  const dangerousSeed = sortedSeeds[0] ?? null;\n\n  const hookParts = [];\n  if (dangerousSeed) {\n    const seedLabel = dangerousSeed.label ?? 'Encounter';\n    const origin = dangerousSeed.synthetic ? 'sintetico' : 'catalogo';\n    const biomeForSeed = biomes.find((biome) => biome.id === dangerousSeed.biome_id);\n    const location = biomeForSeed\n      ? (biomeForSeed.label ?? titleCase(biomeForSeed.id ?? 'bioma'))\n      : (dangerousSeed.biome_id ?? 'bioma bersaglio');\n    hookParts.push(`${seedLabel} attivo su ${location} (${origin}).`);\n    if (dangerousSeed.threat_budget) {\n      hookParts.push(`Budget minaccia T${dangerousSeed.threat_budget}.`);\n    }\n    if (apex) {\n      hookParts.push(`Risposta consigliata: ${apex.name} (T${apex.tier}).`);\n    } else {\n      hookParts.push('Preparare asset di contenimento dedicati.');\n    }\n  } else if (apex) {\n    hookParts.push(`${apex.name} domina ${apex.biomeLabel}.`);\n    hookParts.push(`Minaccia stimata T${apex.tier}.`);\n  } else {\n    hookParts.push('Genera encounter seed per dettagli narrativi contestuali.');\n  }\n\n  const narrativeHook = hookParts.join(' ');\n\n  const highThreatFromSpecies = (apex?.tier ?? 0) >= 4;\n  const highThreatFromSeed = (dangerousSeed?.threat_budget ?? 0) >= 12;\n  let rareReason = null;\n  if (highThreatFromSpecies && highThreatFromSeed) {\n    rareReason = 'both';\n  } else if (highThreatFromSeed) {\n    rareReason = 'seed';\n  } else if (highThreatFromSpecies) {\n    rareReason = 'species';\n  }\n\n  const recommendations = buildNarrativeRecommendations({\n    highlightBiome,\n    highlightLabel,\n    apex,\n    dangerousSeed,\n    filterSummary,\n  });\n\n  return {\n    missionBriefing: missionBriefing || DEFAULT_BRIEFING_TEXT,\n    narrativeHook: narrativeHook || DEFAULT_HOOK_TEXT,\n    hasNarrative: true,\n    isHighThreat: Boolean(rareReason),\n    rareReason,\n    metrics,\n    recommendations,\n  };\n}\n\nfunction buildNarrativeRecommendations({\n  highlightBiome,\n  highlightLabel,\n  apex,\n  dangerousSeed,\n  filterSummary,\n}) {\n  const recommendations = [];\n  const biomeId = highlightBiome?.id ?? null;\n\n  if (biomeId) {\n    const catalogBiome = findCatalogBiome(biomeId);\n    const manifestCounts = catalogBiome?.manifest?.species_counts ?? null;\n    if (manifestCounts && typeof manifestCounts === 'object') {\n      const entries = Object.entries(manifestCounts)\n        .map(([role, value]) => ({ role, value: Number(value) }))\n        .filter((entry) => Number.isFinite(entry.value) && entry.value > 0);\n      const total = entries.reduce((sum, entry) => sum + entry.value, 0);\n      if (entries.length && total > 0) {\n        entries.sort((a, b) => b.value - a.value);\n        const dominant = entries[0];\n        const roleLabel =\n          SPECIES_ROLE_LABELS[dominant.role] ?? titleCase(dominant.role.replace(/_/g, ' '));\n        const messageParts = [\n          `${highlightLabel} mette in risalto ${roleLabel.toLowerCase()}`,\n          `(${dominant.value}/${total} specie monitorate).`,\n          'Allinea i filtri ruoli per sfruttare il vantaggio.',\n        ];\n        recommendations.push({\n          id: `role-${biomeId}`,\n          tone: 'info',\n          message: messageParts.join(' '),\n          targetPanel: 'parameters',\n          targetLabel: getPanelLabel('parameters'),\n          tooltip: `Distribuzione ruoli dal catalogo per ${highlightLabel}.`,\n        });\n      }\n    }\n\n    const strongestConnection = pickStrongestConnection(biomeId);\n    if (strongestConnection) {\n      const typeLabel =\n        CONNECTION_TYPE_LABELS[strongestConnection.type] ??\n        titleCase(strongestConnection.type ?? 'connessione');\n      const connectedLabel =\n        findBiomeLabelByCode(strongestConnection.to) ??\n        titleCase((strongestConnection.to ?? 'bioma').toLowerCase());\n      const resistanceLabel =\n        typeof strongestConnection.resistance === 'number'\n          ? strongestConnection.resistance.toFixed(1)\n          : '\u2014';\n      recommendations.push({\n        id: `connection-${biomeId}`,\n        tone: 'info',\n        message: `${typeLabel} verso ${connectedLabel} (resistenza ${resistanceLabel}). Valuta sinergie cross-bioma.`,\n        targetPanel: 'biomes',\n        targetLabel: getPanelLabel('biomes'),\n        tooltip: `Connessioni note per ${highlightLabel}.`,\n      });\n    }\n  }\n\n  if (dangerousSeed) {\n    const locationLabel =\n      findBiomeLabelById(dangerousSeed.biome_id) ?? highlightLabel ?? 'bioma bersaglio';\n    const threatLabel =\n      typeof dangerousSeed.threat_budget === 'number' ? `T${dangerousSeed.threat_budget}` : null;\n    const parts = [`Seed ${dangerousSeed.label ?? 'Encounter'} attivo su ${locationLabel}.`];\n    if (threatLabel) {\n      parts.push(`Budget minaccia ${threatLabel}.`);\n    }\n    if (apex?.name) {\n      parts.push(`Sincronizza la risposta con ${apex.name}.`);\n    } else {\n      parts.push('Prepara squadre di contenimento dedicate.');\n    }\n    recommendations.push({\n      id: `seed-${dangerousSeed.id ?? dangerousSeed.label ?? 'primario'}`,\n      tone: (dangerousSeed.threat_budget ?? 0) >= 12 ? 'warn' : 'info',\n      message: parts.join(' '),\n      targetPanel: 'seeds',\n      targetLabel: getPanelLabel('seeds'),\n      tooltip: 'Consulta il pannello encounter seed per pianificare la risposta.',\n    });\n  }\n\n  const profileRecommendation = deriveProfileRecommendation({ filterSummary });\n  if (profileRecommendation) {\n    recommendations.push(profileRecommendation);\n  }\n\n  return recommendations;\n}\n\nfunction deriveProfileRecommendation({ filterSummary }) {\n  const entries = Array.isArray(state.activityLog) ? state.activityLog : [];\n  const lastLoad = entries.find((entry) => entry?.action === 'profile-load');\n  if (lastLoad) {\n    const metadata = lastLoad.metadata ?? {};\n    const profileIndex = Number.isInteger(metadata.profileIndex) ? metadata.profileIndex : null;\n    const profileName =\n      metadata.profileName ?? (profileIndex !== null ? `Slot ${profileIndex + 1}` : 'Profilo');\n    const summary = metadata.filtersSummary ?? summariseFilters(metadata.filters ?? {});\n    const reuseCount = state.metrics.filterProfileReuses ?? 0;\n    const reuseLabel = reuseCount === 1 ? '1 riuso registrato' : `${reuseCount} riusi registrati`;\n    const detail = summary ? `Filtri applicati: ${summary}. ` : '';\n    return {\n      id: `profile-reuse-${profileIndex ?? 'latest'}`,\n      tone: 'success',\n      message: `Profilo ${profileName} richiamato (${reuseLabel}). ${detail}Verifica i Parametri per salvare nuovi preset.`,\n      targetPanel: 'parameters',\n      targetLabel: getPanelLabel('parameters'),\n      tooltip: 'Apri Parametri per gestire i profili filtro.',\n    };\n  }\n\n  const profiles = Array.isArray(state.filterProfiles) ? state.filterProfiles : [];\n  const enriched = profiles\n    .map((profile, index) => {\n      if (!profile) return null;\n      return { profile, index };\n    })\n    .filter(Boolean);\n  if (!enriched.length) {\n    if (filterSummary) {\n      return {\n        id: 'profile-suggestion',\n        tone: 'info',\n        message: `Salva i filtri correnti (${filterSummary}) in un profilo per riutilizzarli rapidamente.`,\n        targetPanel: 'parameters',\n        targetLabel: getPanelLabel('parameters'),\n        tooltip: 'Usa il pannello Profili filtro per salvare la configurazione.',\n      };\n    }\n    return null;\n  }\n\n  enriched.sort((a, b) => {\n    const dateA = new Date(a.profile.updatedAt ?? 0).getTime();\n    const dateB = new Date(b.profile.updatedAt ?? 0).getTime();\n    return dateB - dateA;\n  });\n  const latest = enriched[0];\n  const updatedAt = formatIsoToLocale(latest.profile.updatedAt);\n  const updatedSuffix = updatedAt ? ` il ${updatedAt}` : '';\n  return {\n    id: `profile-reminder-${latest.index}`,\n    tone: 'info',\n    message: `Profilo ${latest.profile.name ?? `Slot ${latest.index + 1}`} aggiornato${updatedSuffix}. Applicalo dai Parametri per accelerare il setup.`,\n    targetPanel: 'parameters',\n    targetLabel: getPanelLabel('parameters'),\n    tooltip: 'Apri il pannello Parametri per gestire il profilo salvato.',\n  };\n}\n\nfunction renderContextualInsights(recommendations = []) {\n  const entries = Array.isArray(recommendations)\n    ? recommendations.filter((entry) => entry && entry.message)\n    : [];\n  renderInsightList(elements.narrativeInsightList, elements.narrativeInsightEmpty, entries, {\n    compact: true,\n  });\n  renderInsightList(elements.insightsList, elements.insightsEmpty, entries, { compact: false });\n}\n\nfunction renderInsightList(listElement, emptyElement, entries, { compact = false } = {}) {\n  if (!listElement || !emptyElement) return;\n  listElement.innerHTML = '';\n  if (!entries.length) {\n    listElement.hidden = true;\n    emptyElement.hidden = false;\n    return;\n  }\n  listElement.hidden = false;\n  emptyElement.hidden = true;\n\n  entries.forEach((entry) => {\n    const item = document.createElement('li');\n    item.className = compact\n      ? 'generator-insight__item generator-insight__item--compact'\n      : 'generator-insight__item';\n    if (entry.tone) {\n      item.dataset.tone = entry.tone;\n    }\n\n    const text = document.createElement('p');\n    text.className = 'generator-insight__copy';\n    text.textContent = entry.message;\n    if (entry.tooltip) {\n      text.title = entry.tooltip;\n    }\n    item.appendChild(text);\n\n    if (entry.targetPanel) {\n      const action = document.createElement('button');\n      action.type = 'button';\n      action.className = 'chip generator-insight__action';\n      action.dataset.action = 'focus-panel';\n      action.dataset.panelId = entry.targetPanel;\n      if (entry.id) {\n        action.dataset.insightId = entry.id;\n      }\n      if (entry.targetLabel) {\n        action.dataset.panelLabel = entry.targetLabel;\n      }\n      action.textContent = entry.targetLabel ?? getPanelLabel(entry.targetPanel) ?? 'Apri';\n      action.title = entry.tooltip || `Vai alla sezione ${entry.targetLabel ?? entry.targetPanel}`;\n      item.appendChild(action);\n    }\n\n    listElement.appendChild(item);\n  });\n}\n\nfunction normaliseBiomeId(value) {\n  return String(value ?? '')\n    .trim()\n    .toLowerCase();\n}\n\nfunction canonicalBiomeCode(value) {\n  const normalised = normaliseBiomeId(value).replace(/[^a-z0-9]+/g, '_');\n  return normalised ? normalised.toUpperCase() : '';\n}\n\nfunction findCatalogBiome(biomeId) {\n  const target = normaliseBiomeId(biomeId);\n  if (!target) return null;\n  const list = Array.isArray(state.data?.biomi) ? state.data.biomi : [];\n  return list.find((entry) => normaliseBiomeId(entry.id) === target) ?? null;\n}\n\nfunction findBiomeLabelById(biomeId) {\n  if (!biomeId) return null;\n  const fromPick = (state.pick?.biomes ?? []).find(\n    (biome) => normaliseBiomeId(biome?.id) === normaliseBiomeId(biomeId),\n  );\n  if (fromPick) {\n    return fromPick.label ?? titleCase(fromPick.id ?? 'bioma');\n  }\n  const catalog = findCatalogBiome(biomeId);\n  if (catalog) {\n    return catalog.label ?? titleCase(catalog.id ?? 'bioma');\n  }\n  return null;\n}\n\nfunction findBiomeLabelByCode(code) {\n  const canonical = canonicalBiomeCode(code);\n  if (!canonical) return null;\n  const list = Array.isArray(state.data?.biomi) ? state.data.biomi : [];\n  const match = list.find((entry) => canonicalBiomeCode(entry.id) === canonical);\n  if (match) {\n    return match.label ?? titleCase(match.id ?? 'bioma');\n  }\n  return null;\n}\n\nfunction findCatalogConnections(biomeId) {\n  const canonical = canonicalBiomeCode(biomeId);\n  if (!canonical) return [];\n  const connections = Array.isArray(state.data?.ecosistema?.connessioni)\n    ? state.data.ecosistema.connessioni\n    : [];\n  return connections.filter((connection) => canonicalBiomeCode(connection?.from) === canonical);\n}\n\nfunction pickStrongestConnection(biomeId) {\n  const connections = findCatalogConnections(biomeId);\n  if (!connections.length) return null;\n  const sorted = connections.slice().sort((a, b) => {\n    const resA = typeof a.resistance === 'number' ? a.resistance : Number.POSITIVE_INFINITY;\n    const resB = typeof b.resistance === 'number' ? b.resistance : Number.POSITIVE_INFINITY;\n    return resA - resB;\n  });\n  return sorted[0] ?? null;\n}\n\nfunction getPanelLabel(panelId) {\n  if (!panelId) return null;\n  const key = String(panelId);\n  return PANEL_LABELS[key] ?? PANEL_LABELS[key.toLowerCase()] ?? null;\n}\n\nfunction formatIsoToLocale(value) {\n  if (!value) return null;\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) {\n    return null;\n  }\n  return date.toLocaleDateString('it-IT', { day: '2-digit', month: '2-digit' });\n}\n\nfunction persistPinnedState() {\n  try {\n    const serialisable = Array.from(state.cardState.pinned.values()).map((entry) => ({\n      key: entry.key,\n      speciesId: entry.speciesId,\n      biomeId: entry.biomeId,\n      displayName: entry.displayName,\n      biomeLabel: entry.biomeLabel,\n      tier: entry.tier,\n      rarity: entry.rarity,\n      slug: entry.slug,\n      synthetic: Boolean(entry.synthetic),\n    }));\n    storageService.savePinnedState(serialisable);\n  } catch (error) {\n    console.warn('Impossibile salvare lo stato dei pin', error);\n  }\n}\n\nfunction restorePinnedState() {\n  try {\n    const parsed = storageService.loadPinnedState();\n    if (!Array.isArray(parsed)) return;\n    const store = state.cardState.pinned;\n    store.clear();\n    parsed.forEach((entry) => {\n      if (!entry) return;\n      const key = entry.key || createPinKey({ id: entry.biomeId }, { id: entry.speciesId });\n      if (!key) return;\n      store.set(key, {\n        key,\n        speciesId: entry.speciesId,\n        biomeId: entry.biomeId,\n        displayName: entry.displayName ?? entry.speciesId ?? 'Specie',\n        biomeLabel: entry.biomeLabel ?? entry.biomeId ?? 'Bioma',\n        tier: entry.tier ?? 1,\n        rarity: entry.rarity ?? 'Comune',\n        slug: entry.slug ?? 'common',\n        synthetic: Boolean(entry.synthetic),\n      });\n    });\n  } catch (error) {\n    console.warn('Impossibile ripristinare lo stato dei pin', error);\n  }\n}\n\nfunction persistLockState() {\n  try {\n    const payload = {\n      biomes: Array.from(state.cardState.locks.biomes.values()),\n      species: Array.from(state.cardState.locks.species.values()),\n    };\n    storageService.saveLocks(payload);\n  } catch (error) {\n    console.warn('Impossibile salvare lo stato dei lock', error);\n  }\n}\n\nfunction restoreLockState() {\n  try {\n    const parsed = storageService.loadLocks();\n    const biomeLocks = Array.isArray(parsed.biomes) ? parsed.biomes : [];\n    const speciesLocks = Array.isArray(parsed.species) ? parsed.species : [];\n    state.cardState.locks.biomes = new Set(biomeLocks);\n    state.cardState.locks.species = new Set(speciesLocks);\n  } catch (error) {\n    console.warn('Impossibile ripristinare lo stato dei lock', error);\n  }\n}\n\nfunction pruneLockState() {\n  const availableBiomes = new Set(\n    (state.pick.biomes ?? []).map((biome) => biome?.id).filter(Boolean),\n  );\n  state.cardState.locks.biomes = new Set(\n    Array.from(state.cardState.locks.biomes ?? []).filter((id) => availableBiomes.has(id)),\n  );\n  const availableSpecies = new Set();\n  Object.entries(state.pick.species ?? {}).forEach(([biomeId, speciesList]) => {\n    if (!biomeId || !Array.isArray(speciesList)) return;\n    speciesList.forEach((sp) => {\n      const key = createPinKey({ id: biomeId }, sp);\n      availableSpecies.add(key);\n    });\n  });\n  state.cardState.locks.species = new Set(\n    Array.from(state.cardState.locks.species ?? []).filter((key) => availableSpecies.has(key)),\n  );\n  persistLockState();\n}\n\nfunction ensureProfileState() {\n  if (!Array.isArray(state.filterProfiles)) {\n    state.filterProfiles = [];\n  }\n  if (state.filterProfiles.length > PROFILE_SLOT_COUNT) {\n    state.filterProfiles = state.filterProfiles.slice(0, PROFILE_SLOT_COUNT);\n  }\n  while (state.filterProfiles.length < PROFILE_SLOT_COUNT) {\n    state.filterProfiles.push(null);\n  }\n}\n\nfunction persistFilterProfiles() {\n  ensureProfileState();\n  try {\n    const payload = state.filterProfiles.map((profile) => {\n      if (!profile) return null;\n      return {\n        name: profile.name ?? null,\n        filters: {\n          flags: Array.isArray(profile.filters?.flags) ? profile.filters.flags : [],\n          roles: Array.isArray(profile.filters?.roles) ? profile.filters.roles : [],\n          tags: Array.isArray(profile.filters?.tags) ? profile.filters.tags : [],\n        },\n        updatedAt: profile.updatedAt ?? null,\n      };\n    });\n    storageService.saveFilterProfiles(payload);\n  } catch (error) {\n    console.warn('Impossibile salvare i profili filtro', error);\n  }\n}\n\nfunction restoreFilterProfiles() {\n  ensureProfileState();\n  try {\n    const parsed = storageService.loadFilterProfiles();\n    if (!Array.isArray(parsed)) return;\n    state.filterProfiles = parsed.slice(0, PROFILE_SLOT_COUNT).map((profile, index) => {\n      if (!profile) return null;\n      const filters = profile.filters ?? {};\n      return {\n        name: profile.name ?? `Slot ${index + 1}`,\n        filters: {\n          flags: Array.isArray(filters.flags) ? filters.flags : [],\n          roles: Array.isArray(filters.roles) ? filters.roles : [],\n          tags: Array.isArray(filters.tags) ? filters.tags : [],\n        },\n        updatedAt: profile.updatedAt ?? null,\n      };\n    });\n    ensureProfileState();\n  } catch (error) {\n    console.warn('Impossibile ripristinare i profili filtro', error);\n  }\n}\n\nfunction saveProfileSlot(index, filters) {\n  ensureProfileState();\n  if (index < 0 || index >= PROFILE_SLOT_COUNT) return;\n  const existing = state.filterProfiles[index] ?? {};\n  state.filterProfiles[index] = {\n    name: existing.name ?? `Slot ${index + 1}`,\n    filters: {\n      flags: Array.isArray(filters.flags) ? [...filters.flags] : [],\n      roles: Array.isArray(filters.roles) ? [...filters.roles] : [],\n      tags: Array.isArray(filters.tags) ? [...filters.tags] : [],\n    },\n    updatedAt: new Date().toISOString(),\n  };\n  persistFilterProfiles();\n}\n\nfunction renameProfileSlot(index, name) {\n  ensureProfileState();\n  if (index < 0 || index >= PROFILE_SLOT_COUNT) return;\n  const profile = state.filterProfiles[index];\n  if (!profile) {\n    state.filterProfiles[index] = {\n      name: name && name.trim() ? name.trim() : `Slot ${index + 1}`,\n      filters: { flags: [], roles: [], tags: [] },\n      updatedAt: null,\n    };\n  } else {\n    profile.name = name && name.trim() ? name.trim() : `Slot ${index + 1}`;\n  }\n  persistFilterProfiles();\n}\n\nfunction clearProfileSlot(index) {\n  ensureProfileState();\n  if (index < 0 || index >= PROFILE_SLOT_COUNT) return;\n  state.filterProfiles[index] = null;\n  persistFilterProfiles();\n}\n\nfunction persistHistoryEntries() {\n  try {\n    const serialisable = state.history.map((entry) => ({\n      id: entry.id,\n      action: entry.action,\n      label: entry.label,\n      timestamp: entry.timestamp instanceof Date ? entry.timestamp.toISOString() : entry.timestamp,\n      counts: entry.counts,\n      filters: entry.filters,\n      preview: entry.preview,\n    }));\n    storageService.saveHistory(serialisable);\n  } catch (error) {\n    console.warn('Impossibile salvare la cronologia del generatore', error);\n  }\n}\n\nfunction restoreHistoryEntries() {\n  try {\n    const parsed = storageService.loadHistory();\n    if (!Array.isArray(parsed)) return;\n    state.history = parsed\n      .slice(0, MAX_HISTORY_ENTRIES)\n      .map((entry) => {\n        if (!entry) return null;\n        let timestamp = entry.timestamp ? new Date(entry.timestamp) : new Date();\n        if (Number.isNaN(timestamp.getTime())) {\n          timestamp = new Date();\n        }\n        return {\n          id: entry.id ?? randomId('hist'),\n          action: entry.action ?? 'roll-ecos',\n          label: entry.label ?? HISTORY_ACTION_LABELS[entry.action] ?? 'Snapshot',\n          timestamp,\n          counts: entry.counts ?? { biomes: 0, species: 0, seeds: 0 },\n          filters: {\n            flags: Array.isArray(entry.filters?.flags) ? entry.filters.flags : [],\n            roles: Array.isArray(entry.filters?.roles) ? entry.filters.roles : [],\n            tags: Array.isArray(entry.filters?.tags) ? entry.filters.tags : [],\n          },\n          preview: {\n            biomes: Array.isArray(entry.preview?.biomes) ? entry.preview.biomes : [],\n            species: Array.isArray(entry.preview?.species) ? entry.preview.species : [],\n          },\n        };\n      })\n      .filter(Boolean);\n  } catch (error) {\n    console.warn('Impossibile ripristinare la cronologia del generatore', error);\n  }\n}\n\nfunction summariseProfile(profile) {\n  if (!profile?.filters) {\n    return 'Nessun filtro salvato';\n  }\n  return summariseFilters(profile.filters);\n}\n\nfunction renderProfileSlots() {\n  const list = elements.profileSlots;\n  if (!list) return;\n  ensureProfileState();\n  list.innerHTML = '';\n  const hasProfiles = state.filterProfiles.some((profile) => Boolean(profile));\n  if (elements.profileEmpty) {\n    elements.profileEmpty.hidden = hasProfiles;\n  }\n  list.hidden = !state.filterProfiles.length;\n  if (elements.profilePanel) {\n    elements.profilePanel.dataset.hasProfiles = hasProfiles ? 'true' : 'false';\n  }\n\n  state.filterProfiles.forEach((profile, index) => {\n    const item = document.createElement('li');\n    item.className = 'generator-profiles__slot';\n    item.dataset.slotIndex = String(index);\n\n    const header = document.createElement('div');\n    header.className = 'generator-profiles__slot-header';\n    const name = document.createElement('h4');\n    name.className = 'generator-profiles__slot-name';\n    name.textContent = profile?.name ?? `Slot ${index + 1}`;\n    header.appendChild(name);\n\n    const actions = document.createElement('div');\n    actions.className = 'generator-profiles__slot-actions';\n\n    const load = document.createElement('button');\n    load.type = 'button';\n    load.className = 'generator-profiles__action';\n    load.dataset.action = 'profile-load';\n    load.dataset.slotIndex = String(index);\n    load.textContent = 'Applica';\n    actions.appendChild(load);\n\n    const save = document.createElement('button');\n    save.type = 'button';\n    save.className = 'generator-profiles__action';\n    save.dataset.action = 'profile-save';\n    save.dataset.slotIndex = String(index);\n    save.textContent = 'Salva';\n    actions.appendChild(save);\n\n    const rename = document.createElement('button');\n    rename.type = 'button';\n    rename.className = 'generator-profiles__action';\n    rename.dataset.action = 'profile-rename';\n    rename.dataset.slotIndex = String(index);\n    rename.textContent = 'Rinomina';\n    actions.appendChild(rename);\n\n    const clear = document.createElement('button');\n    clear.type = 'button';\n    clear.className = 'generator-profiles__action';\n    clear.dataset.action = 'profile-clear';\n    clear.dataset.slotIndex = String(index);\n    clear.textContent = 'Svuota';\n    actions.appendChild(clear);\n\n    header.appendChild(actions);\n    item.appendChild(header);\n\n    const summary = document.createElement('p');\n    summary.className = 'generator-profiles__summary';\n    summary.textContent = summariseProfile(profile);\n    item.appendChild(summary);\n\n    if (profile?.updatedAt) {\n      const time = document.createElement('time');\n      time.className = 'generator-profiles__timestamp';\n      const ts = new Date(profile.updatedAt);\n      if (!Number.isNaN(ts.getTime())) {\n        time.dateTime = ts.toISOString();\n        time.textContent = ts.toLocaleString('it-IT', {\n          hour: '2-digit',\n          minute: '2-digit',\n          day: '2-digit',\n          month: '2-digit',\n        });\n      } else {\n        time.textContent = 'Ultimo aggiornamento sconosciuto';\n      }\n      item.appendChild(time);\n    }\n\n    list.appendChild(item);\n  });\n}\n\nfunction attachProfileHandlers() {\n  const panel = elements.profilePanel;\n  if (!panel) return;\n  panel.addEventListener('click', (event) => {\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) return;\n    const button = target.closest('[data-action]');\n    if (!(button instanceof HTMLElement)) return;\n    const { action, slotIndex } = button.dataset;\n    if (!action) return;\n    if (action === 'profile-clear-all') {\n      state.filterProfiles = new Array(PROFILE_SLOT_COUNT).fill(null);\n      persistFilterProfiles();\n      renderParametersPanel({ refresh: ['profiles'] });\n      setStatus('Profili filtro azzerati.', 'info', {\n        tags: ['profili', 'reset'],\n        action: 'profiles-reset',\n      });\n      return;\n    }\n    const index = Number.parseInt(slotIndex ?? '', 10);\n    if (!Number.isInteger(index) || index < 0 || index >= PROFILE_SLOT_COUNT) {\n      return;\n    }\n    switch (action) {\n      case 'profile-save': {\n        const filters = currentFilters();\n        saveProfileSlot(index, filters);\n        renderParametersPanel({ refresh: ['profiles'] });\n        const savedProfile = state.filterProfiles[index];\n        const summary = summariseFilters(savedProfile?.filters ?? filters ?? {});\n        setStatus(`Filtri salvati nel profilo ${index + 1}.`, 'success', {\n          tags: ['profili', 'salvataggio'],\n          action: 'profile-save',\n          metadata: {\n            profileIndex: index,\n            profileName: savedProfile?.name ?? `Slot ${index + 1}`,\n            filtersSummary: summary,\n            filters: savedProfile?.filters ?? filters,\n          },\n        });\n        break;\n      }\n      case 'profile-load': {\n        const profile = state.filterProfiles[index];\n        if (!profile) {\n          setStatus('Nessun profilo salvato in questo slot.', 'warn', {\n            tags: ['profili', 'vuoto'],\n            action: 'profile-empty',\n          });\n          break;\n        }\n        applyFiltersToForm(profile.filters);\n        const summary = summariseFilters(profile.filters ?? {});\n        setStatus(`Filtri applicati dal profilo ${profile.name ?? index + 1}.`, 'info', {\n          tags: ['profili', 'applica'],\n          action: 'profile-load',\n          metadata: {\n            profileIndex: index,\n            profileName: profile.name ?? `Slot ${index + 1}`,\n            filtersSummary: summary,\n            filters: profile.filters,\n          },\n        });\n        break;\n      }\n      case 'profile-rename': {\n        const currentName = state.filterProfiles[index]?.name ?? `Slot ${index + 1}`;\n        const name =\n          typeof window !== 'undefined'\n            ? window.prompt('Nuovo nome profilo', currentName)\n            : currentName;\n        if (name === null) {\n          break;\n        }\n        renameProfileSlot(index, name);\n        renderParametersPanel({ refresh: ['profiles'] });\n        setStatus('Nome profilo aggiornato.', 'success', {\n          tags: ['profili', 'rinomina'],\n          action: 'profile-rename',\n          metadata: {\n            profileIndex: index,\n            profileName: name,\n          },\n        });\n        break;\n      }\n      case 'profile-clear': {\n        clearProfileSlot(index);\n        renderParametersPanel({ refresh: ['profiles'] });\n        setStatus('Profilo liberato.', 'info', {\n          tags: ['profili', 'clear'],\n          action: 'profile-clear',\n        });\n        break;\n      }\n      default:\n        break;\n    }\n  });\n}\n\nfunction attachInsightHandlers() {\n  const panels = [elements.insightsPanel, elements.narrativeInsightPanel];\n  panels.forEach((panel) => {\n    if (!panel) return;\n    panel.addEventListener('click', (event) => {\n      const target = event.target;\n      if (!(target instanceof HTMLElement)) return;\n      const button = target.closest('[data-action=\"focus-panel\"]');\n      if (!(button instanceof HTMLElement)) return;\n      event.preventDefault();\n      const panelId = button.dataset.panelId;\n      if (!panelId) return;\n      if (anchorNavigator.setActiveSection(panelId, { updateHash: true })) {\n        anchorNavigator.scrollToPanel(panelId);\n      }\n      const label = button.dataset.panelLabel ?? getPanelLabel(panelId) ?? panelId;\n      setStatus(`Navigazione rapida: ${label}.`, 'info', {\n        tags: ['insight', 'navigazione'],\n        action: 'insight-navigate',\n        metadata: {\n          panelId,\n          insightId: button.dataset.insightId ?? null,\n        },\n      });\n    });\n  });\n}\n\nfunction formatHistoryTimestamp(date) {\n  const ts = date instanceof Date ? date : new Date(date);\n  if (Number.isNaN(ts.getTime())) {\n    return 'Data sconosciuta';\n  }\n  return ts.toLocaleString('it-IT', {\n    hour: '2-digit',\n    minute: '2-digit',\n    day: '2-digit',\n    month: '2-digit',\n  });\n}\n\nfunction renderHistoryPanel() {\n  const list = elements.historyList;\n  if (!list) return;\n  const entries = state.history ?? [];\n  list.innerHTML = '';\n  const hasEntries = entries.length > 0;\n  list.hidden = !hasEntries;\n  if (elements.historyEmpty) {\n    elements.historyEmpty.hidden = hasEntries;\n  }\n  if (elements.historyPanel) {\n    elements.historyPanel.dataset.hasEntries = hasEntries ? 'true' : 'false';\n  }\n  if (elements.summaryContainer) {\n    elements.summaryContainer.dataset.hasHistory = hasEntries ? 'true' : 'false';\n  }\n  if (!hasEntries) {\n    renderFlowMap();\n    return;\n  }\n\n  const appendChips = (container, values, limit) => {\n    const entries = Array.isArray(values) ? values : [];\n    if (!entries.length) {\n      const placeholder = document.createElement('span');\n      placeholder.className = 'chip chip--compact';\n      placeholder.textContent = '\u2014';\n      container.appendChild(placeholder);\n      return;\n    }\n    entries.slice(0, limit).forEach((label) => {\n      const chip = document.createElement('span');\n      chip.className = 'chip chip--compact';\n      chip.textContent = label;\n      container.appendChild(chip);\n    });\n    if (entries.length > limit) {\n      const remainder = document.createElement('span');\n      remainder.className = 'chip chip--compact';\n      remainder.textContent = `+${entries.length - limit}`;\n      container.appendChild(remainder);\n    }\n  };\n\n  entries.forEach((entry) => {\n    const item = document.createElement('li');\n    item.className = 'generator-history__entry';\n    item.dataset.historyId = entry.id;\n\n    const header = document.createElement('div');\n    header.className = 'generator-history__entry-header';\n    const title = document.createElement('h4');\n    title.className = 'generator-history__entry-title';\n    title.textContent = entry.label ?? HISTORY_ACTION_LABELS[entry.action] ?? 'Snapshot';\n    header.appendChild(title);\n\n    if (entry.timestamp) {\n      const time = document.createElement('time');\n      time.className = 'generator-history__entry-time';\n      const ts = entry.timestamp instanceof Date ? entry.timestamp : new Date(entry.timestamp);\n      if (!Number.isNaN(ts.getTime())) {\n        time.dateTime = ts.toISOString();\n        time.textContent = formatHistoryTimestamp(ts);\n      }\n      header.appendChild(time);\n    }\n\n    item.appendChild(header);\n\n    const metrics = document.createElement('dl');\n    metrics.className = 'generator-history__metrics';\n    const metricEntries = [\n      { label: 'Biomi', value: entry.counts?.biomes ?? 0 },\n      { label: 'Specie', value: entry.counts?.species ?? 0 },\n      { label: 'Seed', value: entry.counts?.seeds ?? 0 },\n    ];\n    metricEntries.forEach((metric) => {\n      const block = document.createElement('div');\n      block.className = 'generator-history__metric';\n      const dt = document.createElement('dt');\n      dt.textContent = metric.label;\n      const dd = document.createElement('dd');\n      dd.textContent = String(metric.value ?? 0);\n      block.appendChild(dt);\n      block.appendChild(dd);\n      metrics.appendChild(block);\n    });\n    item.appendChild(metrics);\n\n    const preview = document.createElement('div');\n    preview.className = 'generator-history__preview';\n    const biomePreview = document.createElement('div');\n    biomePreview.className = 'generator-history__preview-group';\n    const biomeLabel = document.createElement('p');\n    biomeLabel.className = 'generator-history__preview-label';\n    biomeLabel.textContent = 'Biomi';\n    biomePreview.appendChild(biomeLabel);\n    const biomeChips = document.createElement('div');\n    biomeChips.className = 'generator-history__chips';\n    appendChips(biomeChips, entry.preview?.biomes ?? [], 4);\n    biomePreview.appendChild(biomeChips);\n    preview.appendChild(biomePreview);\n\n    const speciesPreview = document.createElement('div');\n    speciesPreview.className = 'generator-history__preview-group';\n    const speciesLabel = document.createElement('p');\n    speciesLabel.className = 'generator-history__preview-label';\n    speciesLabel.textContent = 'Specie';\n    speciesPreview.appendChild(speciesLabel);\n    const speciesChips = document.createElement('div');\n    speciesChips.className = 'generator-history__chips';\n    appendChips(speciesChips, entry.preview?.species ?? [], 5);\n    speciesPreview.appendChild(speciesChips);\n    preview.appendChild(speciesPreview);\n\n    item.appendChild(preview);\n\n    const entryActions = document.createElement('div');\n    entryActions.className = 'generator-history__entry-actions';\n    const applyButton = document.createElement('button');\n    applyButton.type = 'button';\n    applyButton.className = 'generator-history__action';\n    applyButton.dataset.action = 'history-apply';\n    applyButton.dataset.historyId = entry.id;\n    applyButton.textContent = 'Applica filtri';\n    entryActions.appendChild(applyButton);\n\n    const removeButton = document.createElement('button');\n    removeButton.type = 'button';\n    removeButton.className = 'generator-history__action';\n    removeButton.dataset.action = 'history-remove';\n    removeButton.dataset.historyId = entry.id;\n    removeButton.textContent = 'Rimuovi';\n    entryActions.appendChild(removeButton);\n\n    item.appendChild(entryActions);\n    list.appendChild(item);\n  });\n\n  renderFlowMap();\n}\n\nfunction getHistoryEntry(historyId) {\n  return (state.history ?? []).find((entry) => entry.id === historyId) ?? null;\n}\n\nfunction applyHistoryEntry(historyId) {\n  const entry = getHistoryEntry(historyId);\n  if (!entry) {\n    setStatus('Nessuna voce di cronologia trovata.', 'warn', {\n      tags: ['history', 'missing'],\n      action: 'history-missing',\n    });\n    return;\n  }\n  applyFiltersToForm(entry.filters);\n  setStatus(`Filtri applicati dalla cronologia (${entry.label}).`, 'info', {\n    tags: ['history', 'apply'],\n    action: 'history-apply',\n  });\n}\n\nfunction removeHistoryEntry(historyId) {\n  const next = (state.history ?? []).filter((entry) => entry.id !== historyId);\n  if (next.length === state.history.length) {\n    return;\n  }\n  state.history = next;\n  persistHistoryEntries();\n  renderHistoryPanel();\n}\n\nfunction clearHistoryEntries() {\n  state.history = [];\n  persistHistoryEntries();\n  renderHistoryPanel();\n}\n\nfunction attachHistoryHandlers() {\n  const panel = elements.historyPanel;\n  if (!panel) return;\n  panel.addEventListener('click', (event) => {\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) return;\n    const button = target.closest('[data-action]');\n    if (!(button instanceof HTMLElement)) return;\n    const { action, historyId } = button.dataset;\n    if (!action) return;\n    switch (action) {\n      case 'history-apply':\n        if (historyId) {\n          applyHistoryEntry(historyId);\n        }\n        break;\n      case 'history-remove':\n        if (historyId) {\n          removeHistoryEntry(historyId);\n          setStatus('Voce di cronologia rimossa.', 'info', {\n            tags: ['history', 'remove'],\n            action: 'history-remove',\n          });\n        }\n        break;\n      case 'history-clear':\n        clearHistoryEntries();\n        setStatus('Cronologia del generatore svuotata.', 'info', {\n          tags: ['history', 'clear'],\n          action: 'history-clear',\n        });\n        break;\n      default:\n        break;\n    }\n  });\n}\n\nfunction recordHistoryEntry(action, filters) {\n  if (!ROLL_ACTIONS.has(action)) {\n    return;\n  }\n  const counts = calculatePickMetrics();\n  if (\n    (counts.biomeCount ?? 0) === 0 &&\n    (counts.speciesCount ?? 0) === 0 &&\n    (counts.seedCount ?? 0) === 0\n  ) {\n    return;\n  }\n  const timestamp = new Date();\n  const biomePreview = state.pick.biomes\n    .slice(0, 4)\n    .map((biome) => biome?.label ?? titleCase(biome?.id ?? ''));\n  const speciesPreview = [];\n  state.pick.biomes.forEach((biome) => {\n    const speciesList = state.pick.species?.[biome.id] ?? [];\n    speciesList.forEach((sp) => {\n      if (speciesPreview.length >= 8) return;\n      speciesPreview.push(sp?.display_name ?? sp?.id ?? biome.id ?? 'Specie');\n    });\n  });\n  const entry = {\n    id: randomId('hist'),\n    action,\n    label: HISTORY_ACTION_LABELS[action] ?? 'Snapshot',\n    timestamp,\n    counts: {\n      biomes: counts.biomeCount ?? 0,\n      species: counts.speciesCount ?? 0,\n      seeds: counts.seedCount ?? 0,\n    },\n    filters: {\n      flags: Array.isArray(filters?.flags) ? [...filters.flags] : [],\n      roles: Array.isArray(filters?.roles) ? [...filters.roles] : [],\n      tags: Array.isArray(filters?.tags) ? [...filters.tags] : [],\n    },\n    preview: {\n      biomes: biomePreview,\n      species: speciesPreview,\n    },\n  };\n  state.history = [entry, ...state.history.filter((existing) => existing.id !== entry.id)].slice(\n    0,\n    MAX_HISTORY_ENTRIES,\n  );\n  persistHistoryEntries();\n  renderHistoryPanel();\n}\n\nfunction trimActivityLog() {\n  if (!Array.isArray(state.activityLog)) {\n    state.activityLog = [];\n    return;\n  }\n  state.activityLog.sort((a, b) => {\n    const aTime =\n      a.timestamp instanceof Date ? a.timestamp.getTime() : new Date(a.timestamp).getTime();\n    const bTime =\n      b.timestamp instanceof Date ? b.timestamp.getTime() : new Date(b.timestamp).getTime();\n    return bTime - aTime;\n  });\n  if (state.activityLog.length <= MAX_ACTIVITY_EVENTS) {\n    return;\n  }\n  for (\n    let i = state.activityLog.length - 1;\n    i >= 0 && state.activityLog.length > MAX_ACTIVITY_EVENTS;\n    i -= 1\n  ) {\n    const entry = state.activityLog[i];\n    if (!entry?.pinned) {\n      state.activityLog.splice(i, 1);\n    }\n  }\n  if (state.activityLog.length > MAX_ACTIVITY_EVENTS) {\n    state.activityLog = state.activityLog.slice(0, MAX_ACTIVITY_EVENTS);\n  }\n}\n\nfunction persistActivityLog() {\n  try {\n    const serialisable = state.activityLog\n      .map(serialiseActivityLogEntry)\n      .filter(Boolean)\n      .map((entry) => ({\n        ...entry,\n        timestamp: entry.timestamp,\n      }));\n    storageService.saveActivityLog(serialisable);\n  } catch (error) {\n    console.warn('Impossibile salvare il registro attivit\u00E0', error);\n  }\n}\n\nfunction restoreActivityLog() {\n  try {\n    const parsed = storageService.loadActivityLog();\n    if (!Array.isArray(parsed)) return;\n    const restored = parsed\n      .map((entry) => {\n        if (!entry?.message) return null;\n        const timestamp = entry.timestamp ? new Date(entry.timestamp) : new Date();\n        if (Number.isNaN(timestamp.getTime())) {\n          return null;\n        }\n        const tagEntries = Array.isArray(entry.tags)\n          ? entry.tags\n              .map((tag) => {\n                if (!tag) return null;\n                if (typeof tag === 'object') {\n                  const label = tag.label ?? tag.name ?? tag.id ?? tag.value ?? '';\n                  return createTagEntry({ id: tag.id ?? tag.value, label });\n                }\n                return createTagEntry(tag);\n              })\n              .filter(Boolean)\n          : [];\n        const dedupedTags = [];\n        const seen = new Set();\n        tagEntries.forEach((tag) => {\n          if (!tag?.id || seen.has(tag.id)) return;\n          seen.add(tag.id);\n          dedupedTags.push(tag);\n        });\n        return {\n          id: entry.id ?? randomId('event'),\n          message: entry.message,\n          tone: entry.tone ?? 'info',\n          timestamp,\n          tags: dedupedTags,\n          action: entry.action ?? null,\n          pinned: Boolean(entry.pinned),\n          metadata: entry.metadata ?? null,\n        };\n      })\n      .filter(Boolean);\n    state.activityLog = restored.sort((a, b) => b.timestamp - a.timestamp);\n    trimActivityLog();\n    updateActivityTagRegistry();\n    recalculateActivityMetrics();\n  } catch (error) {\n    console.warn('Impossibile ripristinare il registro attivit\u00E0', error);\n  }\n}\n\nfunction activityFiltersActive() {\n  const filters = state.activityFilters ?? {};\n  if (filters.query?.trim()) return true;\n  if (filters.pinnedOnly) return true;\n  if (filters.tags instanceof Set && filters.tags.size) return true;\n  if (filters.tones instanceof Set && filters.tones.size !== DEFAULT_ACTIVITY_TONES.length)\n    return true;\n  return false;\n}\n\nfunction renderActivityTagFilters() {\n  const select = elements.activityTagFilter;\n  if (!select) return;\n  const entries = Array.from(state.activityTagCounts.entries()).sort((a, b) =>\n    a[1].label.localeCompare(b[1].label, 'it', { sensitivity: 'base' }),\n  );\n  const selected = state.activityFilters.tags ?? new Set();\n  select.innerHTML = '';\n  if (!entries.length) {\n    const placeholder = document.createElement('option');\n    placeholder.value = '';\n    placeholder.textContent = 'Nessun tag registrato';\n    placeholder.disabled = true;\n    select.appendChild(placeholder);\n    select.disabled = true;\n    return;\n  }\n  select.disabled = false;\n  entries.forEach(([id, info]) => {\n    const option = document.createElement('option');\n    option.value = id;\n    option.textContent = info.count > 1 ? `${info.label} (${info.count})` : info.label;\n    option.selected = selected instanceof Set ? selected.has(id) : false;\n    select.appendChild(option);\n  });\n}\n\nfunction buildActivityHaystack(entry) {\n  const parts = [entry.message, entry.action];\n\n  (entry.tags ?? []).forEach((tag) => {\n    if (tag?.label) {\n      parts.push(tag.label);\n    }\n  });\n\n  const metadata = entry.metadata;\n  if (metadata !== null && metadata !== undefined) {\n    collectMetadataText(metadata, parts);\n  }\n\n  return parts\n    .filter((value) => value !== null && value !== undefined && value !== '')\n    .join(' ')\n    .toLowerCase();\n}\n\nfunction collectMetadataText(source, parts) {\n  if (source === null || source === undefined) {\n    return;\n  }\n  if (typeof source === 'string' || typeof source === 'number' || typeof source === 'boolean') {\n    parts.push(String(source));\n    return;\n  }\n  if (Array.isArray(source)) {\n    source.forEach((item) => collectMetadataText(item, parts));\n    return;\n  }\n  if (typeof source === 'object') {\n    Object.values(source).forEach((value) => collectMetadataText(value, parts));\n  }\n}\n\nfunction updateActivityTagRegistry() {\n  const registry = new Map();\n  (state.activityLog ?? []).forEach((entry) => {\n    (entry.tags ?? []).forEach((tag) => {\n      if (!tag?.id) return;\n      const existing = registry.get(tag.id) ?? { label: tag.label ?? tag.id, count: 0 };\n      existing.label = tag.label ?? existing.label;\n      existing.count += 1;\n      registry.set(tag.id, existing);\n    });\n  });\n  state.activityTagCounts = registry;\n  renderActivityTagFilters();\n  syncActivityControls();\n}\n\nfunction recordActivity(message, tone = 'info', timestamp = new Date(), options = {}) {\n  if (!message) return;\n  const ts = timestamp instanceof Date ? timestamp : new Date(timestamp);\n  const safeTimestamp = Number.isNaN(ts.getTime()) ? new Date() : ts;\n  const providedTags = Array.isArray(options.tags) ? options.tags : [];\n  const processedTags = [];\n  const seen = new Set();\n  providedTags.forEach((tag) => {\n    const entry = createTagEntry(tag);\n    if (!entry || !entry.id || seen.has(entry.id)) return;\n    seen.add(entry.id);\n    processedTags.push(entry);\n  });\n  const activityEntry = {\n    id: options.id ?? randomId('event'),\n    message,\n    tone,\n    timestamp: safeTimestamp,\n    tags: processedTags,\n    action: options.action ?? null,\n    pinned: Boolean(options.pinned),\n    metadata: options.metadata ?? null,\n  };\n  state.activityLog.unshift(activityEntry);\n  trimActivityLog();\n  updateActivityTagRegistry();\n  recalculateActivityMetrics();\n  persistActivityLog();\n  renderActivityLog();\n}\n\nfunction recalculateActivityMetrics() {\n  const entries = Array.isArray(state.activityLog) ? state.activityLog : [];\n  const rollTimestamps = entries\n    .filter((entry) => (entry?.action ? ROLL_ACTIONS.has(entry.action) : false))\n    .map((entry) => {\n      const stamp = entry.timestamp instanceof Date ? entry.timestamp : new Date(entry.timestamp);\n      const value = stamp instanceof Date ? stamp.getTime() : Number.NaN;\n      return Number.isNaN(value) ? null : value;\n    })\n    .filter((value) => Number.isFinite(value))\n    .sort((a, b) => a - b);\n  if (rollTimestamps.length >= 2) {\n    let total = 0;\n    for (let i = 1; i < rollTimestamps.length; i += 1) {\n      total += rollTimestamps[i] - rollTimestamps[i - 1];\n    }\n    state.metrics.averageRollIntervalMs = total / (rollTimestamps.length - 1);\n  } else {\n    state.metrics.averageRollIntervalMs = null;\n  }\n\n  let rerollCount = 0;\n  let profileReuses = 0;\n  entries.forEach((entry) => {\n    if (entry?.action && REROLL_ACTIONS.has(entry.action)) {\n      rerollCount += 1;\n    }\n    if (entry?.action === 'profile-load') {\n      profileReuses += 1;\n    }\n  });\n  state.metrics.rerollCount = rerollCount;\n  state.metrics.filterProfileReuses = profileReuses;\n  renderParametersPanel({ refresh: ['kpi'] });\n}\n\nfunction formatDateTime(value) {\n  if (!value) return '\u2014';\n  const date = value instanceof Date ? value : new Date(value);\n  if (Number.isNaN(date.getTime())) {\n    return '\u2014';\n  }\n  try {\n    const formatter = new Intl.DateTimeFormat(undefined, {\n      dateStyle: 'medium',\n      timeStyle: 'short',\n    });\n    return formatter.format(date);\n  } catch (error) {\n    console.warn('Impossibile formattare la data Nebula', error);\n    return date.toISOString();\n  }\n}\n\nfunction formatAverageRollInterval(ms) {\n  if (!Number.isFinite(ms) || ms <= 0) {\n    return '\u2014';\n  }\n  const totalSeconds = Math.round(ms / 1000);\n  if (totalSeconds < 60) {\n    return `${totalSeconds}s`;\n  }\n  const seconds = totalSeconds % 60;\n  const totalMinutes = Math.floor(totalSeconds / 60);\n  const minutes = totalMinutes % 60;\n  const hours = Math.floor(totalMinutes / 60);\n  const parts = [];\n  if (hours) {\n    parts.push(`${hours}h`);\n  }\n  if (minutes) {\n    parts.push(`${minutes}m`);\n  }\n  if (!hours && seconds) {\n    parts.push(`${seconds}s`);\n  }\n  if (!parts.length) {\n    return `${totalMinutes}m`;\n  }\n  return parts.join(' ');\n}\n\nfunction renderKpiSidebar() {\n  if (elements.kpi?.averageRoll) {\n    elements.kpi.averageRoll.textContent = formatAverageRollInterval(\n      state.metrics.averageRollIntervalMs,\n    );\n  }\n  if (elements.kpi?.rerollCount) {\n    elements.kpi.rerollCount.textContent = String(state.metrics.rerollCount ?? 0);\n  }\n  if (elements.kpi?.uniqueSpecies) {\n    elements.kpi.uniqueSpecies.textContent = String(state.metrics.uniqueSpecies ?? 0);\n  }\n  if (elements.kpi?.profileReuses) {\n    elements.kpi.profileReuses.textContent = String(state.metrics.filterProfileReuses ?? 0);\n  }\n}\n\nfunction setNebulaStatus(message, tone = 'muted') {\n  const status = elements.nebula?.status;\n  if (!status) return;\n  status.textContent = message;\n  if (tone) {\n    status.dataset.tone = tone;\n  } else {\n    delete status.dataset.tone;\n  }\n}\n\nfunction renderNebulaHighlights(highlights = []) {\n  const list = elements.nebula?.highlights;\n  if (!list) return;\n  list.innerHTML = '';\n  const items = Array.isArray(highlights)\n    ? highlights.filter((item) => typeof item === 'string' && item.trim()).slice(0, 3)\n    : [];\n  if (!items.length) {\n    return;\n  }\n  items.forEach((item) => {\n    const entry = document.createElement('li');\n    entry.textContent = item;\n    list.appendChild(entry);\n  });\n}\n\nfunction renderNebulaPanel() {\n  const nebulaElements = elements.nebula;\n  if (!nebulaElements?.panel) {\n    return;\n  }\n\n  const nebulaState = state.nebula ?? {};\n  const dataset = nebulaState.dataset;\n  const generatorMeta = nebulaState.generator;\n  const telemetry = nebulaState.telemetry;\n  const hasSnapshot = Boolean(dataset || generatorMeta || telemetry);\n\n  if (!hasSnapshot) {\n    if (nebulaState.error) {\n      setNebulaStatus('Snapshot Nebula non disponibile', 'warn');\n      if (nebulaElements.summary) {\n        nebulaElements.summary.textContent =\n          'Impossibile raggiungere il Mission Console. Riprova pi\u00F9 tardi o verifica la pubblicazione.';\n      }\n      if (nebulaElements.release) {\n        nebulaElements.release.textContent = 'Finestra release: \u2014';\n      }\n      if (nebulaElements.metrics) {\n        if (nebulaElements.metrics.species) nebulaElements.metrics.species.textContent = '\u2014';\n        if (nebulaElements.metrics.biomes) nebulaElements.metrics.biomes.textContent = '\u2014';\n        if (nebulaElements.metrics.encounters) nebulaElements.metrics.encounters.textContent = '\u2014';\n      }\n      renderNebulaHighlights([]);\n      if (nebulaElements.coverage) nebulaElements.coverage.textContent = 'Copertura media: \u2014';\n      if (nebulaElements.events) nebulaElements.events.textContent = 'Eventi aperti: \u2014';\n      if (nebulaElements.updated) {\n        nebulaElements.updated.textContent = `Ultimo aggiornamento: ${formatDateTime(nebulaState.lastSyncedAt)}`;\n      }\n    } else {\n      setNebulaStatus('Sincronizzazione in attesa', 'muted');\n    }\n    return;\n  }\n\n  if (nebulaElements.title && dataset?.title) {\n    nebulaElements.title.textContent = dataset.title;\n  }\n\n  if (nebulaElements.summary) {\n    nebulaElements.summary.textContent =\n      dataset?.summary ||\n      generatorMeta?.summary ||\n      'Snapshot Nebula sincronizzato dal Mission Console.';\n  }\n\n  if (nebulaElements.release) {\n    nebulaElements.release.textContent = dataset?.releaseWindow\n      ? `Finestra release: ${dataset.releaseWindow}`\n      : 'Finestra release: \u2014';\n  }\n\n  if (nebulaElements.metrics) {\n    const metrics = dataset?.metrics || {};\n    if (nebulaElements.metrics.species) {\n      nebulaElements.metrics.species.textContent =\n        metrics.species != null ? String(metrics.species) : '\u2014';\n    }\n    if (nebulaElements.metrics.biomes) {\n      nebulaElements.metrics.biomes.textContent =\n        metrics.biomes != null ? String(metrics.biomes) : '\u2014';\n    }\n    if (nebulaElements.metrics.encounters) {\n      nebulaElements.metrics.encounters.textContent =\n        metrics.encounters != null ? String(metrics.encounters) : '\u2014';\n    }\n  }\n\n  renderNebulaHighlights(dataset?.highlights);\n\n  const coverageAverage = telemetry?.coverage?.average;\n  const coverageHistory = Array.isArray(telemetry?.coverage?.history)\n    ? telemetry.coverage.history\n    : [];\n  let coverageTrend = null;\n  if (coverageHistory.length >= 2) {\n    coverageTrend = coverageHistory[coverageHistory.length - 1] - coverageHistory[0];\n  }\n  if (nebulaElements.coverage) {\n    const trendSuffix =\n      typeof coverageTrend === 'number' && coverageTrend !== 0\n        ? coverageTrend > 0\n          ? ` (\u2191 ${coverageTrend}%)`\n          : ` (\u2193 ${Math.abs(coverageTrend)}%)`\n        : '';\n    nebulaElements.coverage.textContent =\n      coverageAverage != null\n        ? `Copertura media: ${coverageAverage}%${trendSuffix}`\n        : 'Copertura media: \u2014';\n  }\n\n  const summary = telemetry?.summary || {};\n  const openEvents = summary.openEvents;\n  const highPriority = summary.highPriorityEvents;\n  if (nebulaElements.events) {\n    if (openEvents != null) {\n      const highPriorityText = highPriority ? ` (${highPriority} alta priorit\u00E0)` : '';\n      nebulaElements.events.textContent = `Eventi aperti: ${openEvents}${highPriorityText}`;\n    } else {\n      nebulaElements.events.textContent = 'Eventi aperti: \u2014';\n    }\n  }\n\n  if (nebulaElements.updated) {\n    const updatedAt =\n      nebulaState.lastSyncedAt ||\n      generatorMeta?.updatedAt ||\n      dataset?.updatedAt ||\n      summary.lastEventAt;\n    nebulaElements.updated.textContent = `Ultimo aggiornamento: ${formatDateTime(updatedAt)}`;\n  }\n\n  const statusLabel = generatorMeta?.label || 'Snapshot Nebula sincronizzato';\n  const statusTone = (() => {\n    const baseStatus = (generatorMeta?.status || '').toLowerCase();\n    if (nebulaState.error) {\n      return 'warn';\n    }\n    if (baseStatus === 'success') return 'success';\n    if (baseStatus === 'warning' || baseStatus === 'warn') return 'warn';\n    if (baseStatus === 'error' || baseStatus === 'failed' || baseStatus === 'failure')\n      return 'error';\n    return 'muted';\n  })();\n\n  const statusMessage = nebulaState.error\n    ? `${statusLabel} \u00B7 ultimo tentativo con avviso`\n    : statusLabel;\n  setNebulaStatus(statusMessage, statusTone);\n}\n\nasync function loadNebulaSnapshot(options = {}) {\n  const { silent = false } = options;\n  if (!elements.nebula?.panel) {\n    return;\n  }\n  if (!silent) {\n    setNebulaStatus('Sincronizzazione in corso\u2026', 'muted');\n  }\n\n  try {\n    const response = await fetch(NEBULA_SNAPSHOT_PATH, { cache: 'no-store' });\n    if (!response.ok) {\n      throw new Error(`Snapshot Nebula non disponibile (${response.status})`);\n    }\n    const payload = await response.json();\n    state.nebula.dataset = payload.dataset ?? null;\n    state.nebula.generator = payload.generator ?? null;\n    state.nebula.telemetry = payload.telemetry ?? payload;\n    state.nebula.lastSyncedAt =\n      payload.updatedAt || payload.generator?.updatedAt || new Date().toISOString();\n    state.nebula.error = null;\n    renderNebulaPanel();\n    if (!silent) {\n      const coverageAvg = state.nebula.telemetry?.coverage?.average ?? null;\n      recordActivity('Snapshot Nebula sincronizzato dal Mission Console.', 'info', new Date(), {\n        tags: ['nebula', 'telemetria'],\n        action: 'nebula-sync-success',\n        metadata: coverageAvg != null ? { coverage: coverageAvg } : undefined,\n      });\n    }\n  } catch (error) {\n    state.nebula.error = error;\n    console.warn('Impossibile sincronizzare il dataset Nebula', error);\n    renderNebulaPanel();\n    if (!silent) {\n      recordActivity('Impossibile sincronizzare il dataset Nebula.', 'warn', new Date(), {\n        tags: ['nebula', 'errore'],\n        action: 'nebula-sync-error',\n        metadata: {\n          reason: error instanceof Error ? error.message : String(error ?? ''),\n        },\n      });\n    }\n  }\n}\n\nfunction attachNebulaHandlers() {\n  const refresh = elements.nebula?.refresh;\n  if (refresh) {\n    refresh.addEventListener('click', (event) => {\n      event.preventDefault();\n      loadNebulaSnapshot({ silent: false });\n    });\n  }\n}\n\nfunction renderActivityLog() {\n  activityView.render(state, elements, getActivityViewDeps());\n}\n\nfunction toggleActivityPin(eventId) {\n  if (!eventId) return;\n  const entry = state.activityLog.find((item) => item.id === eventId);\n  if (!entry) return;\n  entry.pinned = !entry.pinned;\n  trimActivityLog();\n  persistActivityLog();\n  renderActivityLog();\n}\n\nfunction resetActivityFilters() {\n  state.activityFilters.query = '';\n  state.activityFilters.pinnedOnly = false;\n  state.activityFilters.tags = new Set();\n  state.activityFilters.tones = new Set(DEFAULT_ACTIVITY_TONES);\n  syncActivityControls();\n  renderActivityLog();\n}\n\nfunction syncActivityControls() {\n  activityView.syncControls(state, elements, getActivityViewDeps());\n}\n\nfunction setupActivityControls() {\n  activityView.setup(state, elements, getActivityViewDeps());\n}\n\nfunction refreshExportSupportTelemetry() {\n  const hasPdfSupport = typeof window !== 'undefined' && typeof window.html2pdf !== 'undefined';\n  const wasNotified = state.exportState.pdfSupportNotified;\n  state.exportState.pdfSupported = hasPdfSupport;\n\n  if (!hasPdfSupport) {\n    if (!wasNotified) {\n      console.warn('html2pdf non \u00E8 disponibile: esportazione PDF disabilitata.');\n      recordActivity(\n        'Libreria html2pdf non caricata: esportazione PDF disabilitata.',\n        'warn',\n        new Date(),\n        {\n          tags: ['export', 'dossier', 'pdf', 'missing'],\n          action: 'export-pdf-missing',\n        },\n      );\n      state.exportState.pdfSupportNotified = true;\n    }\n  } else if (wasNotified) {\n    state.exportState.pdfSupportNotified = false;\n  }\n\n  return hasPdfSupport;\n}\n\nfunction ensureExportSlug() {\n  if (state.pick.exportSlug) {\n    return state.pick.exportSlug;\n  }\n  const base = state.pick.ecosystem?.id || randomId('ecos');\n  const stamp = new Date().toISOString().slice(0, 10).replace(/-/g, '');\n  const slug = slugify(`${base}-${stamp}`);\n  state.pick.exportSlug = slug || randomId('ecos');\n  return state.pick.exportSlug;\n}\n\nfunction renderExportPreview(payload) {\n  exportView.render(state, elements, { payload, toYAML });\n}\n\nfunction updateExportPresetStatus(message = '', tone = 'info') {\n  const hint = elements.exportPresetStatus;\n  if (!hint) return;\n  if (message) {\n    hint.textContent = message;\n    hint.dataset.tone = tone;\n    hint.hidden = false;\n  } else {\n    hint.textContent = '';\n    hint.hidden = true;\n    delete hint.dataset.tone;\n  }\n}\n\nfunction populateExportPresetOptions() {\n  const select = elements.exportPreset;\n  if (!select) return;\n  const wasFocused = document.activeElement === select;\n  select.innerHTML = '';\n  MANIFEST_PRESETS.forEach((preset) => {\n    const option = document.createElement('option');\n    option.value = preset.id;\n    option.textContent = preset.label;\n    select.appendChild(option);\n  });\n  if (!MANIFEST_PRESETS.length) {\n    const placeholder = document.createElement('option');\n    placeholder.value = '';\n    placeholder.textContent = 'Nessun preset disponibile';\n    placeholder.disabled = true;\n    placeholder.selected = true;\n    select.appendChild(placeholder);\n    select.disabled = true;\n    select.setAttribute('aria-disabled', 'true');\n    updateExportPresetStatus(\n      'Nessun preset manifest configurato. Verifica il pacchetto o carica manualmente i preset.',\n      'warn',\n    );\n    return;\n  }\n  const current = getCurrentPreset();\n  select.disabled = false;\n  select.removeAttribute('aria-disabled');\n  if (current) {\n    select.value = current.id;\n  }\n  updateExportPresetStatus();\n  if (wasFocused) {\n    select.focus();\n  }\n}\n\nfunction getCurrentPreset() {\n  const desiredId = state.exportState.presetId;\n  if (desiredId) {\n    const match = MANIFEST_PRESETS.find((preset) => preset.id === desiredId);\n    if (match) {\n      return match;\n    }\n  }\n  const fallback = MANIFEST_PRESETS[0] ?? null;\n  if (fallback) {\n    state.exportState.presetId = fallback.id;\n  }\n  return fallback;\n}\n\nfunction getPresetChecklist(presetId) {\n  if (!presetId) return new Map();\n  if (!state.exportState.checklist.has(presetId)) {\n    state.exportState.checklist.set(presetId, new Map());\n  }\n  return state.exportState.checklist.get(presetId);\n}\n\nfunction markPresetItemsComplete(presetId, itemIds, checked = true) {\n  if (!presetId || !Array.isArray(itemIds)) return;\n  const checklist = getPresetChecklist(presetId);\n  itemIds.forEach((itemId) => {\n    if (!itemId) return;\n    checklist.set(itemId, checked);\n  });\n}\n\nfunction markCurrentPresetByBuilder(builderId) {\n  if (!builderId) return;\n  const preset = getCurrentPreset();\n  if (!preset) return;\n  const matches = preset.files.filter((file) => file.builder === builderId).map((file) => file.id);\n  if (matches.length) {\n    markPresetItemsComplete(preset.id, matches, true);\n  }\n}\n\nfunction buildComposerExportSnapshot() {\n  const constraints = state.composer?.constraints ?? {};\n  const preferred = ensurePreferredRoleSet();\n  const presets = Array.isArray(state.composer?.combinedPresets)\n    ? state.composer.combinedPresets\n    : [];\n  const metrics = state.composer?.metrics ?? { radar: [], heatmap: [] };\n  const radar = ROLE_FLAGS.map((flag, index) => {\n    const value = Array.isArray(metrics.radar) ? metrics.radar[index] : 0;\n    return {\n      flag,\n      label: ROLE_FLAG_LABELS[flag] ?? titleCase(flag),\n      average_synergy: Number.isFinite(value) ? Number(value) : 0,\n    };\n  });\n  const heatmap = Array.isArray(metrics.heatmap)\n    ? metrics.heatmap.map((row) => ({\n        biome_id: row.biomeId,\n        biome_label: row.label,\n        roles: Array.isArray(row.values)\n          ? row.values.map((cell) => ({\n              flag: cell.role,\n              label: ROLE_FLAG_LABELS[cell.role] ?? titleCase(cell.role),\n              count: cell.count ?? 0,\n              average_synergy: cell.average ?? 0,\n            }))\n          : [],\n      }))\n    : [];\n  return {\n    constraints: {\n      min_synergy: Number.isFinite(constraints.minSynergy) ? constraints.minSynergy : 0,\n      preferred_roles: Array.from(preferred),\n    },\n    presets: presets.map((preset) => ({\n      id: preset.id,\n      label: preset.label,\n      synergy: preset.synergy,\n      usage: preset.usage,\n      roles: Array.isArray(preset.filters?.roles) ? preset.filters.roles : [],\n      flags: Array.isArray(preset.filters?.flags) ? preset.filters.flags : [],\n      tags: Array.isArray(preset.highlightTags) ? preset.highlightTags : [],\n    })),\n    metrics: { radar, heatmap },\n  };\n}\n\nfunction buildPresetContext(filters = state.lastFilters) {\n  const slug = ensureExportSlug();\n  const folder = EXPORT_BASE_FOLDER;\n  const metrics = calculatePickMetrics();\n  const filterSummary = summariseFilters(filters ?? {});\n  const ecosystemLabel = state.pick.ecosystem?.label ?? 'Ecosistema sintetico';\n  const payload = exportPayload(filters);\n  const activityEntries = exportActivityLogEntries();\n  const biomes = Array.isArray(state.pick.biomes) ? state.pick.biomes : [];\n  const speciesBuckets = state.pick.species ?? {};\n  const seeds = Array.isArray(state.pick.seeds) ? state.pick.seeds : [];\n  const pinnedEntries =\n    state.cardState?.pinned instanceof Map ? Array.from(state.cardState.pinned.values()) : [];\n  const narrative = { ...(state.narrative ?? {}) };\n  const insights = Array.isArray(narrative.recommendations) ? narrative.recommendations : [];\n  return {\n    slug,\n    folder,\n    filters,\n    filterSummary,\n    ecosystemLabel,\n    metrics,\n    payload,\n    activityEntries,\n    biomes,\n    speciesBuckets,\n    seeds,\n    pinnedEntries,\n    narrative,\n    insights,\n    generatedAt: new Date(),\n    composer: buildComposerExportSnapshot(),\n  };\n}\n\nfunction describePresetFile(file, context) {\n  const name = typeof file.filename === 'function' ? file.filename(context.slug) : file.filename;\n  const description =\n    typeof file.description === 'function' ? file.description(context) : (file.description ?? '');\n  let available = true;\n  let reason = '';\n  if (file.builder === 'activity-json' || file.builder === 'activity-csv') {\n    if (!context.activityEntries.length) {\n      available = false;\n      reason = 'Il registro attivit\u00E0 \u00E8 vuoto.';\n    }\n  }\n  if (\n    file.builder === 'dossier-html' ||\n    file.builder === 'dossier-pdf' ||\n    file.builder === 'press-kit-md'\n  ) {\n    const hasPayload =\n      context.metrics.biomeCount + context.metrics.speciesCount + context.metrics.seedCount > 0;\n    if (!hasPayload) {\n      available = false;\n      reason = 'Genera prima un ecosistema completo.';\n    }\n  }\n  return {\n    id: file.id,\n    format: file.format,\n    name,\n    description,\n    path: `${context.folder}${name}`,\n    available,\n    reason,\n    optional: Boolean(file.optional),\n    builder: file.builder,\n  };\n}\n\nfunction renderExportManifest(filters = state.lastFilters) {\n  const list = elements.exportList;\n  const empty = elements.exportEmpty;\n  const meta = elements.exportMeta;\n  const actions = elements.exportActions;\n  const presetSelect = elements.exportPreset;\n  if (!list || !empty || !meta) return;\n\n  populateExportPresetOptions();\n\n  const pdfSupported = refreshExportSupportTelemetry();\n\n  if (!MANIFEST_PRESETS.length) {\n    list.innerHTML = '';\n    list.hidden = true;\n    empty.hidden = false;\n    empty.textContent = 'Nessun manifest di esportazione disponibile.';\n    meta.textContent = 'Carica un preset per abilitare il manifest dei file.';\n    if (actions) actions.hidden = true;\n    renderExportPreview(null);\n    refreshDossierPreview(null);\n    return;\n  }\n\n  const { biomeCount, speciesCount, seedCount } = calculatePickMetrics();\n  const hasContent = biomeCount + speciesCount + seedCount > 0;\n  const preset = getCurrentPreset();\n\n  if (presetSelect && preset) {\n    presetSelect.value = preset.id;\n  }\n\n  if (!hasContent || !preset) {\n    list.innerHTML = '';\n    list.hidden = true;\n    empty.hidden = false;\n    empty.textContent =\n      'Nessun contenuto disponibile. Genera un ecosistema per sbloccare i preset.';\n    meta.textContent = 'Genera un ecosistema per preparare il manifest dei file.';\n    if (actions) actions.hidden = true;\n    renderExportPreview(null);\n    refreshDossierPreview(null);\n    return;\n  }\n\n  const context = buildPresetContext(filters);\n  const descriptors = preset.files.map((file) => describePresetFile(file, context));\n  const checklist = getPresetChecklist(preset.id);\n\n  list.innerHTML = '';\n\n  descriptors.forEach((descriptor) => {\n    const item = document.createElement('li');\n    item.className = 'generator-export__item';\n    if (!descriptor.available) {\n      item.classList.add('generator-export__item--disabled');\n    }\n\n    const label = document.createElement('label');\n    label.className = 'generator-export__item-label';\n\n    const checkbox = document.createElement('input');\n    checkbox.type = 'checkbox';\n    checkbox.value = descriptor.id;\n    checkbox.dataset.manifestItem = descriptor.id;\n    checkbox.disabled = !descriptor.available;\n    checkbox.checked = descriptor.available && checklist.get(descriptor.id) === true;\n\n    const content = document.createElement('div');\n    content.className = 'generator-export__item-content';\n\n    const header = document.createElement('div');\n    header.className = 'generator-export__item-header';\n\n    const title = document.createElement('span');\n    title.className = 'generator-export__item-title';\n    title.textContent = descriptor.name;\n\n    const format = document.createElement('span');\n    format.className = 'generator-export__item-format';\n    format.textContent = descriptor.format;\n\n    header.append(title, format);\n\n    const description = document.createElement('p');\n    description.className = 'generator-export__item-description';\n    description.textContent = descriptor.description;\n\n    const path = document.createElement('p');\n    path.className = 'generator-export__item-path';\n    path.textContent = descriptor.path;\n\n    content.append(header, description, path);\n\n    if (descriptor.optional) {\n      const badge = document.createElement('span');\n      badge.className = 'generator-export__item-badge';\n      badge.textContent = 'Opzionale';\n      header.appendChild(badge);\n    }\n\n    if (!descriptor.available && descriptor.reason) {\n      const hint = document.createElement('p');\n      hint.className = 'generator-export__item-hint';\n      hint.textContent = descriptor.reason;\n      content.appendChild(hint);\n    }\n\n    label.append(checkbox, content);\n    item.appendChild(label);\n    list.appendChild(item);\n  });\n\n  list.hidden = !descriptors.length;\n  if (!descriptors.length) {\n    empty.hidden = false;\n    empty.textContent = 'Il preset selezionato non ha elementi configurati.';\n  } else if (descriptors.some((descriptor) => descriptor.available)) {\n    empty.hidden = true;\n  } else {\n    empty.hidden = false;\n    empty.textContent = 'Tutti gli elementi del preset sono temporaneamente non disponibili.';\n  }\n\n  const pdfNotice = pdfSupported\n    ? ''\n    : ' \u00B7 <strong>Avviso:</strong> esportazione PDF disabilitata (html2pdf non caricato).';\n  meta.dataset.pdfSupported = pdfSupported ? 'true' : 'false';\n  meta.innerHTML = `Preset <strong>${preset.label}</strong>: ${preset.description} \u00B7 Cartella consigliata: <code>${context.folder}</code> \u00B7 ${\n    context.filterSummary ? `Filtri attivi: ${context.filterSummary}.` : 'Nessun filtro attivo.'\n  }${pdfNotice}`;\n\n  if (actions) {\n    actions.hidden = false;\n    const zipButton = actions.querySelector('[data-action=\"download-preset-zip\"]');\n    if (zipButton) {\n      const hasZipSupport = typeof window !== 'undefined' && window.JSZip;\n      const anyAvailable = descriptors.some((descriptor) => descriptor.available);\n      zipButton.disabled = !hasZipSupport || !anyAvailable;\n      zipButton.title = !hasZipSupport\n        ? 'JSZip non disponibile. Verifica il caricamento della libreria.'\n        : '';\n    }\n    const htmlButton = actions.querySelector('[data-action=\"download-dossier-html\"]');\n    if (htmlButton) {\n      const htmlAvailable = descriptors.some(\n        (descriptor) => descriptor.builder === 'dossier-html' && descriptor.available,\n      );\n      htmlButton.disabled = !htmlAvailable;\n    }\n    const pdfButton = actions.querySelector('[data-action=\"download-dossier-pdf\"]');\n    if (pdfButton) {\n      const pdfDescriptor = descriptors.find(\n        (descriptor) => descriptor.builder === 'dossier-pdf' && descriptor.available,\n      );\n      pdfButton.disabled = !pdfDescriptor || !pdfSupported;\n      pdfButton.title = !pdfSupported\n        ? 'html2pdf non disponibile. Controlla la connessione o ricarica la pagina.'\n        : '';\n    }\n  }\n\n  renderExportPreview(context.payload);\n  refreshDossierPreview(context).catch((error) => {\n    console.warn(\"Impossibile aggiornare l'anteprima del dossier\", error);\n  });\n}\n\nasync function loadDossierTemplate() {\n  const template = await loadDossierTemplateService(DOSSIER_TEMPLATE_PATH, {\n    cache: {\n      get: () => state.exportState.dossierTemplate,\n      set: (value) => {\n        state.exportState.dossierTemplate = value;\n      },\n    },\n  });\n  return template;\n}\n\nasync function generateDossierDocument(context) {\n  const template = await loadDossierTemplate();\n  if (!template) return null;\n  return generateDossierDocumentService(context, {\n    template,\n    presetLabel: getCurrentPreset()?.label ?? null,\n    roleLabels: SPECIES_ROLE_LABELS,\n    titleCase,\n    findBiomeLabelById,\n  });\n}\n\nasync function refreshDossierPreview(context) {\n  const preview = elements.dossierPreview;\n  const hint = elements.dossierEmpty;\n  if (!preview || !hint) return;\n  if (!context) {\n    preview.innerHTML = '';\n    hint.hidden = false;\n    return;\n  }\n  const doc = await generateDossierDocument(context);\n  if (!doc) {\n    preview.innerHTML = '';\n    hint.hidden = false;\n    hint.textContent = 'Impossibile caricare il template del dossier.';\n    return;\n  }\n  hint.hidden = true;\n  const body = doc.body ?? doc.querySelector('body');\n  preview.innerHTML = body ? body.innerHTML : '';\n}\n\nasync function generateDossierHtml(context = buildPresetContext(state.lastFilters)) {\n  return generateDossierHtmlService(context, {\n    presetLabel: getCurrentPreset()?.label ?? null,\n    roleLabels: SPECIES_ROLE_LABELS,\n    titleCase,\n    findBiomeLabelById,\n    templateLoader: () => loadDossierTemplate(),\n  });\n}\n\nasync function generateDossierPdfBlob(context) {\n  const template = await loadDossierTemplate();\n  if (!template) {\n    throw new Error('Template dossier non disponibile');\n  }\n  return generateDossierPdfBlobService(context, {\n    presetLabel: getCurrentPreset()?.label ?? null,\n    roleLabels: SPECIES_ROLE_LABELS,\n    titleCase,\n    findBiomeLabelById,\n    template,\n    templateLoader: () => Promise.resolve(template),\n    slug: context.slug ?? ensureExportSlug(),\n    html2pdf: typeof window !== 'undefined' ? window.html2pdf : undefined,\n  });\n}\n\nfunction buildPressKitMarkdown(context) {\n  return buildPressKitMarkdownService(context, {\n    presetLabel: getCurrentPreset()?.label ?? null,\n    roleLabels: SPECIES_ROLE_LABELS,\n    titleCase,\n    findBiomeLabelById,\n  });\n}\n\nasync function generatePresetFileContents(preset, filters) {\n  const context = buildPresetContext(filters);\n  const { files } = await generatePresetFileContentsService({ files: preset.files }, context, {\n    presetLabel: preset?.label ?? null,\n    roleLabels: SPECIES_ROLE_LABELS,\n    titleCase,\n    findBiomeLabelById,\n    templateLoader: () => loadDossierTemplate(),\n    slug: context.slug,\n    html2pdf: typeof window !== 'undefined' ? window.html2pdf : undefined,\n    toYAML,\n    activityLogToCsv,\n  });\n  return { files, context };\n}\n\nasync function downloadPresetZip(preset, filters) {\n  if (typeof window === 'undefined' || typeof window.JSZip === 'undefined') {\n    throw new Error('JSZip non disponibile');\n  }\n  const { files, context } = await generatePresetFileContents(preset, filters);\n  if (!files.length) {\n    throw new Error('Nessun file disponibile per il preset selezionato');\n  }\n  const zip = new window.JSZip();\n  files.forEach((file) => {\n    if (!file) return;\n    if (file.data instanceof Blob) {\n      zip.file(file.name, file.data);\n    } else {\n      zip.file(file.name, file.data, { binary: false });\n    }\n  });\n  const blob = await zip.generateAsync({ type: 'blob' });\n  const zipName = `${context.slug}-${preset.zipSuffix ?? preset.id}.zip`;\n  downloadFile(zipName, blob, 'application/zip');\n  markPresetItemsComplete(\n    preset.id,\n    files.map((file) => file.id),\n    true,\n  );\n  return { zipName, fileCount: files.length };\n}\n\nfunction setupExportControls() {\n  populateExportPresetOptions();\n  if (elements.exportPreset) {\n    elements.exportPreset.addEventListener('change', (event) => {\n      const { value } = event.target;\n      const fallbackPresetId = MANIFEST_PRESETS[0]?.id ?? null;\n      state.exportState.presetId = value || fallbackPresetId;\n      renderParametersPanel({ refresh: ['export'] });\n    });\n  }\n  if (elements.exportList) {\n    elements.exportList.addEventListener('change', (event) => {\n      const target = event.target;\n      if (!(target instanceof HTMLInputElement)) return;\n      if (target.type !== 'checkbox') return;\n      const { manifestItem } = target.dataset;\n      const preset = getCurrentPreset();\n      if (!preset || !manifestItem) return;\n      const checklist = getPresetChecklist(preset.id);\n      checklist.set(manifestItem, target.checked);\n    });\n  }\n  renderParametersPanel({ refresh: ['export'] });\n}\n\nfunction getSelectedValues(select) {\n  if (!select) return [];\n  if (isSelectElement(select)) {\n    return Array.from(select?.selectedOptions ?? []).map((opt) => opt.value);\n  }\n  return Array.from(select.querySelectorAll(`${MULTISELECT_OPTION_SELECTOR}[aria-pressed=\"true\"]`))\n    .map((button) => button.dataset.value)\n    .filter((value) => typeof value === 'string' && value.length);\n}\n\nfunction setSelectValues(select, values) {\n  if (!select) return;\n  const target = new Set(Array.isArray(values) ? values.map((value) => String(value)) : []);\n  if (isSelectElement(select)) {\n    Array.from(select.options ?? []).forEach((option) => {\n      option.selected = target.has(option.value);\n    });\n    return;\n  }\n\n  let hasOptions = false;\n  Array.from(select.querySelectorAll(MULTISELECT_OPTION_SELECTOR)).forEach((button) => {\n    hasOptions = true;\n    const pressed = target.has(button.dataset.value);\n    toggleMultiselectOption(button, pressed);\n  });\n  if (!hasOptions) {\n    renderMultiselectPlaceholder(select);\n  }\n  notifyMultiselectChange(select);\n}\n\nfunction applyFiltersToForm(filters = {}) {\n  setSelectValues(elements.flags, filters.flags ?? []);\n  setSelectValues(elements.roles, filters.roles ?? []);\n  setSelectValues(elements.tags, filters.tags ?? []);\n  state.lastFilters = {\n    flags: Array.isArray(filters.flags) ? [...filters.flags] : [],\n    roles: Array.isArray(filters.roles) ? [...filters.roles] : [],\n    tags: Array.isArray(filters.tags) ? [...filters.tags] : [],\n  };\n  updateFilterSummaryHint(state.lastFilters);\n}\n\nfunction getCssVariableValue(name) {\n  if (typeof window === 'undefined') return '';\n  try {\n    const root = document.documentElement;\n    const styles = window.getComputedStyle(root);\n    return styles.getPropertyValue(name)?.trim() ?? '';\n  } catch (error) {\n    console.warn('Impossibile leggere la variabile CSS', name, error);\n    return '';\n  }\n}\n\nfunction hexToRgba(hex, alpha = 1) {\n  if (typeof hex !== 'string') return '';\n  const normalized = hex.replace(/^#/, '').trim();\n  if (!normalized) return '';\n  const expand = (value) =>\n    value\n      .split('')\n      .map((char) => `${char}${char}`)\n      .join('');\n  let r;\n  let g;\n  let b;\n  if (normalized.length === 3) {\n    const expanded = expand(normalized);\n    r = parseInt(expanded.slice(0, 2), 16);\n    g = parseInt(expanded.slice(2, 4), 16);\n    b = parseInt(expanded.slice(4, 6), 16);\n  } else if (normalized.length === 6) {\n    r = parseInt(normalized.slice(0, 2), 16);\n    g = parseInt(normalized.slice(2, 4), 16);\n    b = parseInt(normalized.slice(4, 6), 16);\n  } else {\n    return '';\n  }\n  if ([r, g, b].some((component) => Number.isNaN(component))) {\n    return '';\n  }\n  const clampedAlpha = Math.min(1, Math.max(0, alpha));\n  return `rgba(${r}, ${g}, ${b}, ${clampedAlpha.toFixed(3)})`;\n}\n\nfunction parseRgbColor(value) {\n  if (typeof value !== 'string') return null;\n  const match = value.match(/rgba?\\(([^)]+)\\)/i);\n  if (!match) return null;\n  const parts = match[1]\n    .split(',')\n    .map((segment) => Number.parseFloat(segment.trim()))\n    .filter((segment) => !Number.isNaN(segment));\n  if (parts.length < 3) return null;\n  return { r: Math.round(parts[0]), g: Math.round(parts[1]), b: Math.round(parts[2]) };\n}\n\nfunction resolveHeatmapColor(tokenName, intensity) {\n  const baseAlpha = 0.12 + Math.max(0, Math.min(1, intensity)) * 0.45;\n  const clampedAlpha = Math.max(0.08, Math.min(0.85, baseAlpha));\n  const raw = tokenName ? getCssVariableValue(tokenName) : '';\n  if (raw.startsWith('#')) {\n    const converted = hexToRgba(raw, clampedAlpha);\n    if (converted) return converted;\n  }\n  if (/^rgb/i.test(raw)) {\n    const rgb = parseRgbColor(raw);\n    if (rgb) {\n      return `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${clampedAlpha.toFixed(3)})`;\n    }\n  }\n  return `rgba(88, 166, 255, ${clampedAlpha.toFixed(3)})`;\n}\n\nfunction ensurePreferredRoleSet() {\n  if (!state.composer) {\n    state.composer = {\n      constraints: { minSynergy: 45, preferredRoles: new Set() },\n      combinedPresets: [],\n      suggestions: [],\n      metrics: { radar: [], heatmap: [] },\n      roleStats: new Map(),\n    };\n  }\n  const constraints = state.composer.constraints ?? {};\n  if (!(constraints.preferredRoles instanceof Set)) {\n    const values = Array.isArray(constraints.preferredRoles) ? constraints.preferredRoles : [];\n    constraints.preferredRoles = new Set(values);\n  }\n  return constraints.preferredRoles;\n}\n\nfunction syncPreferredRolesWithAvailability() {\n  const preferred = ensurePreferredRoleSet();\n  if (!preferred.size) return [];\n\n  const availableRoles = new Set();\n  const collectRoles = (list) => {\n    if (!Array.isArray(list)) return;\n    list.forEach((entry) => {\n      const roleKey = entry?.role_trofico;\n      if (roleKey) {\n        availableRoles.add(roleKey);\n      }\n    });\n  };\n\n  const biomes = Array.isArray(state.pick?.biomes) ? state.pick.biomes : [];\n  biomes.forEach((biome) => {\n    if (!biome) return;\n    collectRoles(biome.species);\n    collectRoles(biome.generatedSpecies);\n  });\n\n  const selectedSpecies = state.pick?.species ?? {};\n  Object.values(selectedSpecies).forEach((list) => collectRoles(list));\n\n  const removed = [];\n  preferred.forEach((roleKey) => {\n    if (!availableRoles.has(roleKey)) {\n      preferred.delete(roleKey);\n      removed.push(roleKey);\n    }\n  });\n\n  return removed;\n}\n\nfunction applyHeatmapColor(element, role, percent) {\n  if (!(element instanceof HTMLElement)) return;\n  const token = ROLE_FLAG_TOKENS[role] ?? '--color-accent-400';\n  const numericPercent = Number.isFinite(percent) ? percent : Number(percent) || 0;\n  const intensity = Math.max(0, Math.min(1, numericPercent / 100));\n  element.style.setProperty('--heat-intensity', intensity.toFixed(2));\n  element.style.setProperty('--heat-color-token', `var(${token})`);\n  const background = resolveHeatmapColor(token, intensity);\n  if (background) {\n    element.style.background = background;\n  }\n}\n\nfunction passesComposerConstraints(species, biome) {\n  if (!state.composer?.constraints) return true;\n  const constraints = state.composer.constraints;\n  const preferred = ensurePreferredRoleSet();\n  if (preferred.size) {\n    const roleKey = species?.role_trofico ?? '';\n    if (!preferred.has(roleKey)) {\n      return false;\n    }\n  }\n  const minSynergy = Number.isFinite(constraints.minSynergy) ? constraints.minSynergy : 0;\n  if (minSynergy > 0) {\n    const synergy = calculateSynergy(species, biome);\n    if ((synergy?.percent ?? 0) < minSynergy) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction shuffle(array) {\n  const copy = [...array];\n  for (let i = copy.length - 1; i > 0; i -= 1) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [copy[i], copy[j]] = [copy[j], copy[i]];\n  }\n  return copy;\n}\n\nfunction sample(array) {\n  if (!array.length) return null;\n  const index = Math.floor(Math.random() * array.length);\n  return array[index];\n}\n\nfunction pickMany(array, n) {\n  if (!array?.length || n <= 0) return [];\n  if (n >= array.length) return [...array];\n  const pool = shuffle(array);\n  return pool.slice(0, n);\n}\n\nfunction titleCase(value) {\n  return value\n    .split(/[-_\\s]+/)\n    .filter(Boolean)\n    .map((part) => part.charAt(0).toUpperCase() + part.slice(1))\n    .join(' ');\n}\n\nfunction slugify(value) {\n  return String(value)\n    .toLowerCase()\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, '')\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-+|-+$/g, '')\n    .slice(0, 60);\n}\n\nfunction uniqueById(items) {\n  const seen = new Map();\n  items.forEach((item) => {\n    if (!item?.id) return;\n    if (!seen.has(item.id)) {\n      seen.set(item.id, item);\n    }\n  });\n  return Array.from(seen.values());\n}\n\nfunction combineNames(primaryName, secondaryName) {\n  const firstTokens = String(primaryName || 'Alpha')\n    .split(/\\s+/)\n    .filter(Boolean);\n  const secondTokens = String(secondaryName || 'Beta')\n    .split(/\\s+/)\n    .filter(Boolean);\n  const first = firstTokens[0] || 'Neo';\n  const last = secondTokens.length ? secondTokens[secondTokens.length - 1] : 'Synth';\n  return `${first} ${last}`;\n}\n\nfunction mixFlags(primary = {}, secondary = {}) {\n  const result = { ...primary };\n  Object.entries(secondary).forEach(([key, value]) => {\n    if (typeof value === 'boolean') {\n      result[key] = Boolean(value || result[key]);\n    } else if (value && !result[key]) {\n      result[key] = value;\n    }\n  });\n  return result;\n}\n\nfunction combineTags(primary = [], secondary = []) {\n  const merged = new Set();\n  primary.forEach((tag) => merged.add(tag));\n  secondary.forEach((tag) => merged.add(tag));\n  if (!merged.size) {\n    merged.add('ibrido');\n  }\n  return Array.from(merged);\n}\n\nfunction getTraitDetails(traitId) {\n  if (!(state.traitDetailsIndex instanceof Map)) {\n    return null;\n  }\n  return state.traitDetailsIndex.get(traitId) ?? null;\n}\n\nfunction traitLabel(traitId) {\n  const info = getTraitDetails(traitId);\n  if (info?.label) {\n    return info.label;\n  }\n  if (state.traitGlossaryIndex instanceof Map) {\n    const glossaryEntry = state.traitGlossaryIndex.get(traitId);\n    if (glossaryEntry) {\n      if (glossaryEntry.label_it) {\n        return glossaryEntry.label_it;\n      }\n      if (glossaryEntry.label_en) {\n        return glossaryEntry.label_en;\n      }\n    }\n  }\n  if (typeof traitId === 'string') {\n    return titleCase(traitId);\n  }\n  return traitId;\n}\n\nfunction createChipElement(value) {\n  const chip = document.createElement('span');\n  chip.className = 'chip';\n  const info = getTraitDetails(value);\n  chip.textContent = info?.label ?? value;\n  chip.dataset.traitId = value;\n  const tooltip = [];\n  const glossaryEntry =\n    state.traitGlossaryIndex instanceof Map ? state.traitGlossaryIndex.get(value) : null;\n  const glossaryDescription =\n    glossaryEntry?.description_it || glossaryEntry?.description_en || null;\n  if (info?.usage) tooltip.push(`Uso: ${info.usage}`);\n  if (info?.family) tooltip.push(`Famiglia: ${info.family}`);\n  if (info?.mutation) tooltip.push(`Mutazione: ${info.mutation}`);\n  if (info?.selectiveDrive) tooltip.push(`Spinta: ${info.selectiveDrive}`);\n  if (info?.fme) tooltip.push(`FME: ${info.fme}`);\n  if (info?.weakness) tooltip.push(`Debolezza: ${info.weakness}`);\n  if (info?.synergy?.length) {\n    tooltip.push(`Sinergie: ${info.synergy.map((id) => traitLabel(id)).join(', ')}`);\n  }\n  if (info?.conflict?.length) {\n    tooltip.push(`Conflitti: ${info.conflict.map((id) => traitLabel(id)).join(', ')}`);\n  }\n  if (info?.tier) {\n    tooltip.push(`Tier: ${info.tier}`);\n  }\n  if (info?.slots?.length) {\n    tooltip.push(`Slot PI: ${info.slots.join(', ')}`);\n  }\n  if (info?.piSynergy?.combo_totale) {\n    const formList = Array.isArray(info.piSynergy.forme) ? info.piSynergy.forme : [];\n    const formsNote = formList.length ? ` \u00B7 Forme: ${formList.join(', ')}` : '';\n    tooltip.push(`Combo PI: ${info.piSynergy.combo_totale}${formsNote}`);\n  }\n  if (info?.environmentRequirements?.length) {\n    tooltip.push(`Requisiti ambientali: ${info.environmentRequirements.length}`);\n  }\n  if (glossaryDescription) {\n    tooltip.push(`Sintesi: ${glossaryDescription}`);\n  }\n  if (tooltip.length) {\n    chip.title = tooltip.join('\\n');\n  }\n  return chip;\n}\n\nfunction inferThreatTierFromRole(role = '', flags = {}) {\n  if (flags.apex) return 4;\n  if (flags.threat) return 3;\n  if (flags.keystone) return 3;\n  if (/predatore_terziario/.test(role)) return 4;\n  if (/predatore/.test(role)) return 3;\n  if (/evento/.test(role)) return 2;\n  if (/minaccia/.test(role)) return 3;\n  if (/detritivoro|erbivoro|prede/.test(role)) return 1;\n  return 2;\n}\n\nfunction tierOf(species) {\n  if (species?.syntheticTier) {\n    return Math.max(1, Math.min(species.syntheticTier, 5));\n  }\n  const raw = species?.balance?.threat_tier ?? 'T1';\n  const parsed = parseInt(String(raw).replace(/\\D/g, ''), 10);\n  if (Number.isNaN(parsed)) return 1;\n  return Math.max(1, Math.min(parsed, 5));\n}\n\nconst MULTISELECT_OPTION_SELECTOR = '[data-multiselect-option]';\n\nfunction isSelectElement(element) {\n  return typeof HTMLSelectElement !== 'undefined' && element instanceof HTMLSelectElement;\n}\n\nfunction renderMultiselectPlaceholder(container, message) {\n  if (!container || isSelectElement(container)) return;\n  Array.from(container.querySelectorAll('.chip-multiselect__empty')).forEach((node) =>\n    node.remove(),\n  );\n  const empty = document.createElement('p');\n  empty.className = 'chip-multiselect__empty';\n  empty.textContent = message || container.dataset.emptyLabel || 'Nessuna opzione disponibile';\n  container.appendChild(empty);\n}\n\nfunction toggleMultiselectOption(button, pressed) {\n  if (!button) return;\n  const next =\n    typeof pressed === 'boolean' ? pressed : button.getAttribute('aria-pressed') !== 'true';\n  button.setAttribute('aria-pressed', next ? 'true' : 'false');\n  button.classList.toggle('chip--active', next);\n}\n\nfunction notifyMultiselectChange(container) {\n  if (!container || isSelectElement(container)) return;\n  const event = new CustomEvent('multiselect-change', {\n    bubbles: false,\n    detail: { values: getSelectedValues(container) },\n  });\n  container.dispatchEvent(event);\n}\n\nfunction ensureOption(select, value, label = value, options = {}) {\n  if (!select) return;\n  if (isSelectElement(select)) {\n    const option = document.createElement('option');\n    option.value = value;\n    option.textContent = label;\n    select.appendChild(option);\n    return;\n  }\n\n  const button = document.createElement('button');\n  button.type = 'button';\n  button.className = 'chip chip-multiselect__option';\n  button.dataset.multiselectOption = 'true';\n  button.dataset.value = String(value);\n  button.setAttribute('aria-pressed', 'false');\n  button.textContent = label;\n  const tooltip = options?.description\n    ? `${label} \u00B7 ${options.description}`\n    : label === value\n      ? label\n      : `${label} \u00B7 ${value}`;\n  button.title = tooltip;\n  button.addEventListener('click', () => {\n    toggleMultiselectOption(button);\n    notifyMultiselectChange(select);\n  });\n  select.appendChild(button);\n}\n\nfunction collectFlags(data) {\n  const flagSet = new Set();\n  data.species.forEach((sp) => {\n    Object.entries(sp.flags ?? {}).forEach(([flag]) => {\n      flagSet.add(flag);\n    });\n  });\n  return Array.from(flagSet).sort((a, b) => a.localeCompare(b));\n}\n\nfunction collectRoles(data) {\n  const roleSet = new Set();\n  data.species.forEach((sp) => {\n    if (sp.role_trofico) {\n      roleSet.add(sp.role_trofico);\n    }\n  });\n  return Array.from(roleSet).sort((a, b) => a.localeCompare(b));\n}\n\nfunction collectTags(data) {\n  const tagSet = new Set();\n  data.species.forEach((sp) => {\n    (sp.functional_tags ?? []).forEach((tag) => tagSet.add(tag));\n  });\n  return Array.from(tagSet).sort((a, b) => a.localeCompare(b));\n}\n\nfunction populateFilters(data) {\n  elements.flags.innerHTML = '';\n  elements.roles.innerHTML = '';\n  elements.tags.innerHTML = '';\n\n  const flags = collectFlags(data);\n  if (flags.length) {\n    flags.forEach((flag) =>\n      ensureOption(elements.flags, flag, formatFlagLabel(flag), {\n        description: SPECIES_ROLE_LABELS[flag] ?? undefined,\n      }),\n    );\n  } else {\n    renderMultiselectPlaceholder(elements.flags);\n  }\n\n  const roles = collectRoles(data);\n  if (roles.length) {\n    roles.forEach((role) => ensureOption(elements.roles, role, formatRoleTokenLabel(role)));\n  } else {\n    renderMultiselectPlaceholder(elements.roles);\n  }\n\n  const tags = collectTags(data);\n  if (tags.length) {\n    tags.forEach((tag) => ensureOption(elements.tags, tag, formatTagLabel(tag)));\n  } else {\n    renderMultiselectPlaceholder(elements.tags);\n  }\n\n  updateFilterSummaryHint(state.lastFilters ?? { flags: [], roles: [], tags: [] });\n}\n\nfunction setupFilterChangeHandlers() {\n  const groups = [elements.flags, elements.roles, elements.tags];\n  groups.forEach((group) => {\n    if (!group || group.dataset.multiselectListener === 'true') return;\n    group.dataset.multiselectListener = 'true';\n    group.addEventListener('multiselect-change', () => {\n      currentFilters();\n    });\n  });\n}\n\nfunction indexTraitRegistry(registry) {\n  const map = new Map();\n  if (!registry?.rules?.length) {\n    return map;\n  }\n\n  registry.rules.forEach((rule) => {\n    const classId = rule.when?.biome_class;\n    if (!classId) return;\n    const entry = map.get(classId) || {\n      traits: new Set(),\n      effects: {},\n      jobs: new Set(),\n      meta: null,\n      rules: [],\n    };\n    (rule.suggest?.traits ?? []).forEach((trait) => entry.traits.add(trait));\n    Object.entries(rule.suggest?.effects ?? {}).forEach(([key, value]) => {\n      entry.effects[key] = value;\n    });\n    (rule.suggest?.jobs_bias ?? []).forEach((job) => entry.jobs.add(job));\n    entry.rules.push(rule);\n    if (rule.meta) {\n      entry.meta = { ...(entry.meta ?? {}), ...rule.meta };\n    }\n    map.set(classId, entry);\n  });\n\n  return map;\n}\n\nfunction indexTraitGlossary(glossary) {\n  const map = new Map();\n  const entries = glossary?.traits;\n  if (!entries || typeof entries !== 'object') {\n    return map;\n  }\n\n  Object.entries(entries).forEach(([traitId, info]) => {\n    if (!traitId) return;\n    if (!info || typeof info !== 'object') {\n      map.set(traitId, {});\n      return;\n    }\n    const descriptionIt = info?.description_it ?? null;\n    const descriptionEn = info?.description_en ?? null;\n    map.set(traitId, {\n      ...info,\n      description: descriptionIt || descriptionEn || null,\n      description_it: descriptionIt,\n      description_en: descriptionEn,\n    });\n  });\n\n  return map;\n}\n\nfunction normalizeTraitList(value) {\n  if (!value) return [];\n  if (Array.isArray(value)) {\n    return value.filter((item) => typeof item === 'string' && item.length);\n  }\n  return [];\n}\n\nfunction indexTraitDetails(catalog) {\n  const map = new Map();\n  if (!catalog?.traits) {\n    return map;\n  }\n\n  Object.entries(catalog.traits).forEach(([traitId, raw]) => {\n    if (!traitId) return;\n    const usage = raw?.uso_funzione ?? raw?.usage ?? null;\n    const family = raw?.famiglia_tipologia ?? raw?.family ?? null;\n    const mutation = raw?.mutazione_indotta ?? raw?.mutation ?? null;\n    const selectiveDrive = raw?.spinta_selettiva ?? raw?.selective_drive ?? null;\n    const fme = raw?.fattore_mantenimento_energetico ?? raw?.fme ?? null;\n    const weakness = raw?.debolezza ?? raw?.weakness ?? null;\n    const synergy = normalizeTraitList(raw?.sinergie ?? raw?.synergy);\n    const conflict = normalizeTraitList(raw?.conflitti ?? raw?.conflict);\n    const tier = raw?.tier ?? null;\n    const slotList = Array.isArray(raw?.slot ?? raw?.slots)\n      ? (raw?.slot ?? raw?.slots).filter((item) => typeof item === 'string' && item.length)\n      : [];\n    const piSynergy = raw?.sinergie_pi ?? raw?.pi_synergy ?? null;\n    const environmentRequirements = Array.isArray(raw?.requisiti_ambientali)\n      ? raw.requisiti_ambientali\n      : Array.isArray(raw?.environment_requirements)\n        ? raw.environment_requirements\n        : [];\n    const entry = {\n      id: traitId,\n      label: raw?.label ?? titleCase(traitId),\n      usage,\n      family,\n      mutation,\n      selectiveDrive,\n      fme,\n      weakness,\n      synergy,\n      conflict,\n      tier,\n      slots: slotList,\n      piSynergy,\n      environmentRequirements,\n    };\n    map.set(traitId, entry);\n  });\n\n  return map;\n}\n\nfunction formatEffects(effects = {}) {\n  const entries = Object.entries(effects);\n  if (!entries.length) return null;\n  return entries.map(([key, value]) => `${key}: ${value}`).join(', ');\n}\n\nfunction setTraitRegistry(registry) {\n  state.traitRegistry = registry ?? null;\n  state.traitsIndex = indexTraitRegistry(registry);\n  renderTraitsPanel();\n}\n\nfunction setTraitReference(catalog) {\n  state.traitReference = catalog ?? null;\n  state.traitDetailsIndex = indexTraitDetails(catalog);\n  renderTraitsPanel();\n}\n\nfunction setTraitGlossary(glossary) {\n  state.traitGlossary = glossary ?? null;\n  state.traitGlossaryIndex = indexTraitGlossary(glossary);\n  renderTraitsPanel();\n}\n\nfunction indexHazardRegistry(registry) {\n  const map = new Map();\n  if (!registry?.hazards) return map;\n\n  Object.entries(registry.hazards).forEach(([hazardId, info]) => {\n    map.set(hazardId, {\n      id: hazardId,\n      requires_any_of: Array.from(info?.requires_any_of ?? []),\n      effect: info?.effect ?? null,\n      label: info?.label ?? null,\n    });\n  });\n\n  return map;\n}\n\nfunction setHazardRegistry(registry) {\n  state.hazardRegistry = registry ?? null;\n  state.hazardsIndex = indexHazardRegistry(registry);\n  renderTraitsPanel();\n}\n\nfunction describeHazards(hazardIds = []) {\n  if (!hazardIds?.length) return null;\n\n  const summaryParts = [];\n  const detailParts = [];\n\n  hazardIds.forEach((hazardId) => {\n    const name = titleCase(hazardId);\n    const entry = state.hazardsIndex.get(hazardId);\n    if (!entry) {\n      summaryParts.push(`${name} (?)`);\n      detailParts.push(`${name}: definizione mancante nel registro hazard.`);\n      return;\n    }\n\n    summaryParts.push(name);\n    const notes = [];\n    if (entry.requires_any_of?.length) {\n      notes.push(`cap: ${entry.requires_any_of.join(' / ')}`);\n    }\n    if (entry.effect) {\n      notes.push(entry.effect);\n    }\n    if (notes.length) {\n      detailParts.push(`${name}: ${notes.join(' \u2014 ')}`);\n    }\n  });\n\n  return {\n    summary: summaryParts.join(', '),\n    details: detailParts.join(' \u00B7 '),\n  };\n}\n\nfunction gatherTraitInfoForBiome(biome) {\n  if (!biome || !(state.traitsIndex instanceof Map)) {\n    return null;\n  }\n\n  const aggregate = (entry) => ({\n    traits: Array.from(entry?.traits ?? []).sort((a, b) => a.localeCompare(b)),\n    jobs: Array.from(entry?.jobs ?? []).sort((a, b) => a.localeCompare(b)),\n    effects: { ...(entry?.effects ?? {}) },\n    description: entry?.meta?.description ?? null,\n    meta: entry?.meta ?? null,\n  });\n\n  if (!biome.synthetic) {\n    const entry = state.traitsIndex.get(biome.id);\n    if (!entry) return null;\n    return aggregate(entry);\n  }\n\n  const traitSet = new Set();\n  const jobSet = new Set();\n  const effects = {};\n  const descriptions = [];\n\n  (biome.parents ?? []).forEach((parent) => {\n    const entry = state.traitsIndex.get(parent.id);\n    if (!entry) return;\n    entry.traits.forEach((trait) => traitSet.add(trait));\n    entry.jobs.forEach((job) => jobSet.add(job));\n    Object.assign(effects, entry.effects);\n    if (entry.meta?.description) {\n      descriptions.push(`${titleCase(parent.id)}: ${entry.meta.description}`);\n    }\n  });\n\n  if (!traitSet.size) return null;\n\n  return {\n    traits: Array.from(traitSet).sort((a, b) => a.localeCompare(b)),\n    jobs: Array.from(jobSet).sort((a, b) => a.localeCompare(b)),\n    effects,\n    description: descriptions.join(' \u00B7 ') || null,\n    meta: null,\n  };\n}\n\nfunction buildTraitBlock(info, { synthetic = false } = {}) {\n  if (!info?.traits?.length) return null;\n  const details = document.createElement('details');\n  details.className = 'trait-block';\n  details.open = false;\n\n  const summary = document.createElement('summary');\n  summary.textContent = synthetic\n    ? `Tratti ambientali ereditati (${info.traits.length})`\n    : `Tratti ambientali suggeriti (${info.traits.length})`;\n  details.appendChild(summary);\n\n  const chipList = document.createElement('div');\n  chipList.className = 'chip-list chip-list--compact';\n  const sortedTraitsForChips = [...info.traits].sort((a, b) =>\n    traitLabel(a).localeCompare(traitLabel(b)),\n  );\n  sortedTraitsForChips.forEach((trait) => {\n    chipList.appendChild(createChipElement(trait));\n  });\n  details.appendChild(chipList);\n\n  if (info.meta?.expansion) {\n    const expansion = document.createElement('p');\n    expansion.className = 'form__hint';\n    expansion.textContent = `Espansione: ${titleCase(info.meta.expansion)}`;\n    details.appendChild(expansion);\n  }\n\n  if (info.meta?.notes) {\n    const notes = document.createElement('p');\n    notes.className = 'form__hint';\n    notes.textContent = info.meta.notes;\n    details.appendChild(notes);\n  }\n\n  if (info.description) {\n    const desc = document.createElement('p');\n    desc.className = 'form__hint';\n    desc.textContent = info.description;\n    details.appendChild(desc);\n  }\n\n  const detailList = document.createElement('dl');\n  detailList.className = 'trait-details';\n  const orderedTraits = [...info.traits].sort((a, b) => traitLabel(a).localeCompare(traitLabel(b)));\n  orderedTraits.forEach((trait) => {\n    const traitInfo = getTraitDetails(trait);\n    if (!traitInfo) return;\n    const pieces = [];\n    if (traitInfo.usage) pieces.push(`Uso: ${traitInfo.usage}`);\n    if (traitInfo.fme) pieces.push(`FME: ${traitInfo.fme}`);\n    if (traitInfo.family) pieces.push(`Famiglia: ${traitInfo.family}`);\n    if (traitInfo.selectiveDrive) pieces.push(`Spinta: ${traitInfo.selectiveDrive}`);\n    if (traitInfo.mutation) pieces.push(`Mutazione: ${traitInfo.mutation}`);\n    if (traitInfo.synergy?.length) {\n      pieces.push(`Sinergie: ${traitInfo.synergy.map((id) => traitLabel(id)).join(', ')}`);\n    }\n    if (traitInfo.conflict?.length) {\n      pieces.push(`Conflitti: ${traitInfo.conflict.map((id) => traitLabel(id)).join(', ')}`);\n    }\n    if (traitInfo.weakness) pieces.push(`Debolezza: ${traitInfo.weakness}`);\n    if (!pieces.length) return;\n    const term = document.createElement('dt');\n    term.className = 'trait-details__term';\n    term.textContent = traitInfo.label ?? traitLabel(trait);\n    detailList.appendChild(term);\n    const desc = document.createElement('dd');\n    desc.className = 'trait-details__desc';\n    desc.textContent = pieces.join(' \u00B7 ');\n    detailList.appendChild(desc);\n  });\n  if (detailList.children.length) {\n    details.appendChild(detailList);\n  }\n\n  if (info.jobs?.length) {\n    const jobs = document.createElement('p');\n    jobs.className = 'form__hint';\n    jobs.textContent = `Bias ruoli: ${info.jobs.join(', ')}`;\n    details.appendChild(jobs);\n  }\n\n  const effectsSummary = formatEffects(info.effects);\n  if (effectsSummary) {\n    const eff = document.createElement('p');\n    eff.className = 'form__hint';\n    eff.textContent = `Effetti suggeriti: ${effectsSummary}`;\n    details.appendChild(eff);\n  }\n\n  return details;\n}\n\nfunction renderTraitExpansions() {\n  const container = elements.traitGrid;\n  if (!container) return;\n  container.innerHTML = '';\n\n  if (!(state.traitsIndex instanceof Map) || !state.traitsIndex.size) {\n    const placeholder = document.createElement('p');\n    placeholder.className = 'placeholder';\n    placeholder.textContent = 'Carica il catalogo per vedere i set di tratti ambientali.';\n    container.appendChild(placeholder);\n    return;\n  }\n\n  const orderedEntries = [];\n  const seen = new Set();\n  (state.traitRegistry?.rules ?? []).forEach((rule) => {\n    if (!rule.meta?.category) return;\n    const classId = rule.when?.biome_class;\n    if (!classId || seen.has(classId)) return;\n    const entry = state.traitsIndex.get(classId);\n    if (!entry) return;\n    orderedEntries.push({ classId, entry });\n    seen.add(classId);\n  });\n\n  if (!orderedEntries.length) {\n    const placeholder = document.createElement('p');\n    placeholder.className = 'placeholder';\n    placeholder.textContent = 'Nessun set di tratti ambientali avanzati registrato.';\n    container.appendChild(placeholder);\n    return;\n  }\n\n  orderedEntries.forEach(({ classId, entry }) => {\n    const card = document.createElement('article');\n    card.className = 'card';\n\n    const title = document.createElement('h3');\n    title.textContent = titleCase(classId ?? 'Bioma sconosciuto');\n    card.appendChild(title);\n\n    const metaParts = [];\n    const category = TRAIT_CATEGORY_LABELS[entry.meta?.category] ?? entry.meta?.category;\n    if (category) metaParts.push(category);\n    if (entry.meta?.network) metaParts.push(`Ecosistema: ${entry.meta.network}`);\n    if (entry.meta?.cohort) metaParts.push(`Cluster: ${entry.meta.cohort}`);\n    if (entry.meta?.expansion) metaParts.push(`Espansione: ${titleCase(entry.meta.expansion)}`);\n    let hazardDetails = null;\n    const hazardInfo = describeHazards(entry.meta?.hazard_profile ?? []);\n    if (hazardInfo) {\n      metaParts.push(`Hazard: ${hazardInfo.summary}`);\n      hazardDetails = hazardInfo.details;\n    }\n    const meta = document.createElement('p');\n    meta.className = 'form__hint';\n    meta.textContent = metaParts.join(' \u00B7 ') || 'Set di tratti ambientali';\n    card.appendChild(meta);\n\n    if (hazardDetails) {\n      const hazardNote = document.createElement('p');\n      hazardNote.className = 'form__hint';\n      hazardNote.textContent = hazardDetails;\n      card.appendChild(hazardNote);\n    }\n\n    if (entry.meta?.notes) {\n      const note = document.createElement('p');\n      note.className = 'form__hint';\n      note.textContent = entry.meta.notes;\n      card.appendChild(note);\n    }\n\n    if (entry.meta?.description) {\n      const desc = document.createElement('p');\n      desc.textContent = entry.meta.description;\n      card.appendChild(desc);\n    }\n\n    const traitList = document.createElement('div');\n    traitList.className = 'chip-list chip-list--compact';\n    Array.from(entry.traits)\n      .sort((a, b) => traitLabel(a).localeCompare(traitLabel(b)))\n      .forEach((trait) => {\n        traitList.appendChild(createChipElement(trait));\n      });\n    card.appendChild(traitList);\n\n    const effectsSummary = formatEffects(entry.effects ?? {});\n    if (effectsSummary) {\n      const eff = document.createElement('p');\n      eff.className = 'form__hint';\n      eff.textContent = `Effetti: ${effectsSummary}`;\n      card.appendChild(eff);\n    }\n\n    const jobBias = Array.from(entry.jobs ?? [])\n      .filter((job) => typeof job === 'string')\n      .sort((a, b) => a.localeCompare(b));\n    if (jobBias.length) {\n      const jobsEl = document.createElement('p');\n      jobsEl.className = 'form__hint';\n      jobsEl.textContent = `Bias ruoli: ${jobBias.join(', ')}`;\n      card.appendChild(jobsEl);\n    }\n\n    container.appendChild(card);\n  });\n}\n\nconst CONNECTION_TYPES = ['corridor', 'trophic_spillover', 'seasonal_bridge'];\nconst SEASONALITY = ['primavera', 'estate', 'autunno', 'inverno', 'episodico', 'multistagionale'];\n\nconst ENCOUNTER_BLUEPRINTS = [\n  {\n    id: 'scout',\n    label: 'Pattuglia rapida',\n    summary: \"Piccolo gruppo mobile per ingaggi d'avanscoperta.\",\n    minSize: 2,\n    targetSize: 3,\n    priorities: ['threat', 'bridge'],\n  },\n  {\n    id: 'strike',\n    label: 'Assalto mirato',\n    summary: \"Forza d'attacco centrata su predatori e specie chiave.\",\n    minSize: 3,\n    targetSize: 4,\n    priorities: ['apex', 'keystone', 'threat'],\n  },\n  {\n    id: 'gauntlet',\n    label: 'Crisi apex',\n    summary: 'Scenario culminante con il massimo della pressione ecologica.',\n    minSize: 4,\n    targetSize: 5,\n    priorities: ['apex', 'keystone', 'threat', 'bridge'],\n  },\n];\n\nfunction synthesiseBiome(parents) {\n  const parentIds = parents.map((parent) => parent.id);\n  const displayName = parents.map((parent) => titleCase(parent.id)).join(' / ');\n  const idBase = slugify(`${parentIds.join('-')}-${randomId('bio')}`);\n  const sourceSpecies = uniqueById(\n    parents.flatMap((parent) =>\n      (parent.species ?? []).map((sp) => ({ ...sp, source_biome: parent.id })),\n    ),\n  );\n\n  const counts = sourceSpecies.reduce(\n    (acc, sp) => {\n      if (sp.flags?.apex) acc.apex += 1;\n      if (sp.flags?.keystone) acc.keystone += 1;\n      if (sp.flags?.bridge) acc.bridge += 1;\n      if (sp.flags?.threat) acc.threat += 1;\n      if (sp.flags?.event) acc.event += 1;\n      return acc;\n    },\n    { apex: 0, keystone: 0, bridge: 0, threat: 0, event: 0 },\n  );\n\n  const functionalGroups = new Set();\n  sourceSpecies.forEach((sp) => {\n    (sp.functional_tags ?? []).forEach((tag) => functionalGroups.add(tag));\n  });\n\n  return {\n    id: idBase || randomId('biome'),\n    label: `Bioma sintetico ${displayName}`,\n    synthetic: true,\n    parents: parents.map((parent) => ({\n      id: parent.id,\n      label: titleCase(parent.id),\n      path: parent.path ?? null,\n    })),\n    species: sourceSpecies,\n    manifest: {\n      species_counts: counts,\n      functional_groups_present: Array.from(functionalGroups),\n      sources: parentIds,\n    },\n  };\n}\n\n// Pipeline legacy: seleziona biomi preesistenti e li combina per ottenere varianti sintetiche.\n// Rimane come fallback locale quando il worker di generazione non \u00E8 disponibile.\nfunction fallbackGenerateBiomes(baseBiomes, count) {\n  if (!baseBiomes?.length) return [];\n  const result = [];\n  for (let i = 0; i < count; i += 1) {\n    const parentCount = Math.min(3, Math.max(2, Math.floor(Math.random() * 3) + 2));\n    const parents = pickMany(baseBiomes, Math.min(parentCount, baseBiomes.length));\n    result.push(synthesiseBiome(parents));\n  }\n  return result;\n}\n\nasync function requestBiomeSynthesis(count, filters) {\n  if (!count) {\n    return { biomes: [], meta: null };\n  }\n  const constraints = buildGenerationConstraints(filters, { roleFlags: ROLE_FLAGS });\n  const endpoint = resolveApiEndpoint(API_ENDPOINTS.biomeGeneration);\n  const response = await fetch(endpoint, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ count, constraints }),\n  });\n  if (!response.ok) {\n    throw new Error(`Richiesta generazione biomi fallita (${response.status})`);\n  }\n  const payload = await response.json();\n  return {\n    biomes: Array.isArray(payload.biomes) ? payload.biomes : [],\n    meta: payload.meta ?? null,\n  };\n}\n\nfunction normaliseGeneratedSpecies(species, biomeId) {\n  if (!species) return null;\n  const id =\n    species.id ||\n    `${slugify(species.display_name || species.role_trofico || 'specie')}-${Math.random()\n      .toString(36)\n      .slice(2, 6)}`;\n  const flags = { ...species.flags };\n  ROLE_FLAGS.forEach((flag) => {\n    flags[flag] = Boolean(flags?.[flag]);\n  });\n  const tier = Number.isFinite(species.syntheticTier)\n    ? species.syntheticTier\n    : inferThreatTierFromRole(species.role_trofico ?? '', flags);\n  return {\n    ...species,\n    id,\n    display_name: species.display_name || titleCase(id),\n    role_trofico: species.role_trofico || 'ruolo_sintetico',\n    functional_tags: Array.isArray(species.functional_tags) ? species.functional_tags : [],\n    flags,\n    biomes: Array.isArray(species.biomes) && species.biomes.length ? species.biomes : [biomeId],\n    synthetic: true,\n    syntheticTier: tier,\n    balance: species.balance ?? { threat_tier: `T${tier}` },\n  };\n}\n\nfunction normaliseGeneratedBiome(entry) {\n  if (!entry) return null;\n  if (entry.synthetic === false) {\n    return entry;\n  }\n  const id = entry.id || randomId('biome');\n  const species = Array.isArray(entry.species)\n    ? entry.species.map((sp) => normaliseGeneratedSpecies(sp, id)).filter(Boolean)\n    : [];\n  const manifest = { ...(entry.manifest ?? {}) };\n  if (!manifest.species_counts) {\n    const counts = { apex: 0, keystone: 0, bridge: 0, threat: 0, event: 0 };\n    species.forEach((sp) => {\n      ROLE_FLAGS.forEach((flag) => {\n        if (sp.flags?.[flag]) {\n          counts[flag] += 1;\n        }\n      });\n    });\n    manifest.species_counts = counts;\n  }\n  const metrics = { ...(entry.metrics ?? {}) };\n  if (!Number.isFinite(metrics.zoneCount)) {\n    metrics.zoneCount = Math.max(2, species.length || 3);\n  }\n  if (!metrics.hazardSeverity && entry.hazard?.severity) {\n    metrics.hazardSeverity = entry.hazard.severity;\n  }\n  return {\n    ...entry,\n    id,\n    label: entry.label || `Bioma sintetico ${titleCase(id)}`,\n    synthetic: true,\n    parents: Array.isArray(entry.parents) ? entry.parents : [],\n    hazard: entry.hazard ?? null,\n    traits: entry.traits ?? { ids: [] },\n    manifest,\n    metrics,\n    species,\n  };\n}\n\nfunction normaliseBiomeCollection(biomes) {\n  if (!Array.isArray(biomes)) return [];\n  return biomes.map((biome) => normaliseGeneratedBiome(biome)).filter(Boolean);\n}\n\nfunction synthesiseConnections(biomes) {\n  if (!biomes.length) return [];\n  if (biomes.length === 1) {\n    return [\n      {\n        from: biomes[0].id.toUpperCase(),\n        to: biomes[0].id.toUpperCase(),\n        type: 'nested_loop',\n        resistance: 0.5,\n        seasonality: 'continuo',\n        notes: 'Bioma autosufficiente generato proceduralmente.',\n      },\n    ];\n  }\n  const connections = [];\n  const shuffled = shuffle(biomes);\n  for (let i = 0; i < shuffled.length; i += 1) {\n    const current = shuffled[i];\n    const next = shuffled[(i + 1) % shuffled.length];\n    if (!next) continue;\n    const type = sample(CONNECTION_TYPES) ?? 'corridor';\n    const seasonality = sample(SEASONALITY) ?? 'episodico';\n    connections.push({\n      from: current.id.toUpperCase(),\n      to: next.id.toUpperCase(),\n      type,\n      resistance: Math.round((0.3 + Math.random() * 0.5) * 100) / 100,\n      seasonality,\n      notes: `Connessione sintetica derivata da ${\n        current.parents?.map((p) => p.id).join('+') ?? 'sorgenti ignote'\n      } verso ${next.parents?.map((p) => p.id).join('+') ?? 'target ignoto'}.`,\n    });\n  }\n  return connections;\n}\n\nfunction resolvePackHref(relativePath) {\n  if (!relativePath) return relativePath;\n  if (packContext?.resolveDocHref) {\n    try {\n      return packContext.resolveDocHref(relativePath);\n    } catch (error) {\n      console.warn('Impossibile risolvere il percorso tramite resolveDocHref', relativePath, error);\n    }\n  }\n  if (packDocsBase) {\n    try {\n      return new URL(relativePath, packDocsBase).toString();\n    } catch (error) {\n      console.warn('Impossibile risolvere il percorso tramite packDocsBase', relativePath, error);\n    }\n  }\n  if (packContext?.resolvePackHref) {\n    try {\n      return packContext.resolvePackHref(relativePath);\n    } catch (error) {\n      console.warn(\n        'Impossibile risolvere il percorso tramite resolvePackHref',\n        relativePath,\n        error,\n      );\n    }\n  }\n  if (resolvedPackRoot) {\n    try {\n      return new URL(relativePath, resolvedPackRoot).toString();\n    } catch (error) {\n      console.warn(\n        'Impossibile risolvere il percorso tramite resolvedPackRoot',\n        relativePath,\n        error,\n      );\n    }\n  }\n  return relativePath;\n}\n\nfunction currentFilters() {\n  const filters = {\n    flags: getSelectedValues(elements.flags),\n    roles: getSelectedValues(elements.roles),\n    tags: getSelectedValues(elements.tags),\n  };\n  state.lastFilters = filters;\n  updateFilterSummaryHint(filters);\n  return filters;\n}\n\nfunction formatFlagLabel(flag) {\n  if (!flag) return '';\n  return ROLE_FLAG_LABELS[flag] ?? titleCase(String(flag).replace(/[_-]+/g, ' '));\n}\n\nfunction formatTagLabel(tag) {\n  if (!tag) return '';\n  return titleCase(String(tag).replace(/[_-]+/g, ' '));\n}\n\nfunction summariseFilters(filters = {}) {\n  const segments = [];\n  if (filters.flags?.length) {\n    segments.push(`Flag: ${filters.flags.map(formatFlagLabel).join(', ')}`);\n  }\n  if (filters.roles?.length) {\n    segments.push(`Ruoli: ${filters.roles.map((role) => formatRoleTokenLabel(role)).join(', ')}`);\n  }\n  if (filters.tags?.length) {\n    segments.push(`Tag: ${filters.tags.map(formatTagLabel).join(', ')}`);\n  }\n  return segments.join(' \u00B7 ');\n}\n\nfunction updateFilterSummaryHint(filters = {}) {\n  if (!elements.filtersHint) return;\n  const summary = summariseFilters(filters);\n  if (summary) {\n    elements.filtersHint.textContent = `Filtri attivi \u2192 ${summary}.`;\n  } else {\n    elements.filtersHint.textContent =\n      'Nessun filtro attivo. Tocca le capsule per attivare vincoli specifici.';\n  }\n}\n\nfunction matchesFlags(species, requiredFlags) {\n  if (!requiredFlags.length) return true;\n  const flags = species.flags ?? {};\n  return requiredFlags.every((flag) => Boolean(flags[flag]));\n}\n\nfunction matchesRoles(species, requiredRoles) {\n  if (!requiredRoles.length) return true;\n  return requiredRoles.includes(species.role_trofico ?? '');\n}\n\nfunction matchesTags(species, requiredTags) {\n  if (!requiredTags.length) return true;\n  const tags = species.functional_tags ?? [];\n  return requiredTags.every((tag) => tags.includes(tag));\n}\n\nconst HYBRID_FAMILY_KEYWORDS = [\n  [/locomotorio/i, 'locomotor'],\n  [/prensile/i, 'prehensile'],\n  [/strutturale/i, 'structural'],\n  [/difensivo/i, 'defensive'],\n  [/sensoriale/i, 'sensorial'],\n  [/nervoso/i, 'neural'],\n  [/metabolico/i, 'metabolic'],\n  [/supporto/i, 'support'],\n  [/empatico/i, 'social'],\n  [/cognitivo/i, 'cognitive'],\n  [/offensivo/i, 'offensive'],\n  [/biotico/i, 'biotic'],\n];\n\nconst HYBRID_BEHAVIOUR_KEYWORDS = [\n  [/coordin/i, 'coordinated'],\n  [/pred/i, 'predatory'],\n  [/difes/i, 'defensive'],\n  [/support/i, 'supportive'],\n  [/simbi/i, 'symbiotic'],\n  [/migraz/i, 'migratory'],\n  [/arramp/i, 'climber'],\n  [/vol/i, 'aerial'],\n  [/echo/i, 'echolocator'],\n  [/dispers/i, 'disperser'],\n  [/scav/i, 'scavenger'],\n];\n\nfunction normaliseTraitIds(value) {\n  if (!value) return [];\n  if (Array.isArray(value)) {\n    return value.filter((item) => typeof item === 'string' && item.length);\n  }\n  if (typeof value === 'string') {\n    return value.length ? [value] : [];\n  }\n  return [];\n}\n\nfunction deriveFamiliesFromDetail(detail) {\n  const results = new Set();\n  const family = detail?.family ?? detail?.famiglia ?? null;\n  if (!family) return results;\n  String(family)\n    .split(/[\\\\/]/g)\n    .map((part) => part.trim())\n    .filter(Boolean)\n    .forEach((part) => {\n      const lowered = part.toLowerCase();\n      const mapped = HYBRID_FAMILY_KEYWORDS.find(([pattern]) => pattern.test(lowered));\n      results.add(mapped ? mapped[1] : lowered);\n    });\n  return results;\n}\n\nfunction deriveBehaviourTagsFromTexts(texts) {\n  const tags = new Set();\n  texts.forEach((text) => {\n    if (!text) return;\n    const lowered = text.toLowerCase();\n    HYBRID_BEHAVIOUR_KEYWORDS.forEach(([pattern, label]) => {\n      if (pattern.test(lowered)) {\n        tags.add(label);\n      }\n    });\n  });\n  return Array.from(tags);\n}\n\nfunction scoreTraitTier(traitId) {\n  const detail = state.traitDetailsIndex?.get(traitId);\n  if (!detail?.tier) return null;\n  const match = /^(?:T)?(\\d+)/i.exec(String(detail.tier));\n  if (!match) return null;\n  return Number.parseInt(match[1], 10);\n}\n\nfunction rarityFromTraitSet(traitIds) {\n  const tierValues = traitIds\n    .map((traitId) => scoreTraitTier(traitId))\n    .filter((value) => Number.isFinite(value));\n  const highTiers = tierValues.filter((value) => value >= 3).length;\n  if (highTiers >= 3) return 'R4';\n  if (highTiers === 2) return 'R3';\n  if (highTiers === 1) return 'R2';\n  return 'R1';\n}\n\nfunction threatFromTraitSet(traitIds, fallbackTier) {\n  const values = traitIds\n    .map((traitId) => scoreTraitTier(traitId))\n    .filter((value) => Number.isFinite(value));\n  if (!values.length) return fallbackTier || 1;\n  const avg = values.reduce((sum, value) => sum + value, 0) / values.length;\n  return Math.max(1, Math.min(5, Math.round(avg)));\n}\n\nfunction summariseTraitDrivenProfile(traitIds) {\n  const glossaryIndex = state.traitGlossaryIndex || new Map();\n  const detailIndex = state.traitDetailsIndex || new Map();\n  const labels = [];\n  const families = new Set();\n  const environments = new Set();\n  const derived = new Set();\n  const conflicts = new Set();\n  const adaptations = [];\n  const behaviourTexts = [];\n  const descriptions = [];\n\n  traitIds.forEach((traitId) => {\n    const glossary = glossaryIndex.get(traitId) || {};\n    const detail = detailIndex.get(traitId) || {};\n    const label = glossary.label_it || glossary.label_en || detail.label || titleCase(traitId);\n    labels.push(label);\n    const glossaryDescription = glossary.description_it || glossary.description_en;\n    if (glossaryDescription) {\n      descriptions.push(glossaryDescription);\n    }\n    deriveFamiliesFromDetail(detail).forEach((family) => families.add(family));\n    const requirements = detail.environmentRequirements || [];\n    requirements.forEach((entry) => {\n      const cond = entry?.condizioni || entry?.conditions || {};\n      const biome = cond?.biome_class || entry?.biome;\n      if (biome) environments.add(biome);\n    });\n    normaliseTraitIds(detail.synergy || detail.sinergie).forEach((id) => derived.add(id));\n    normaliseTraitIds(detail.conflict || detail.conflitti).forEach((id) => conflicts.add(id));\n    if (detail.mutation) adaptations.push(detail.mutation);\n    if (detail.weakness) adaptations.push(`Precauzione: ${detail.weakness}`);\n    if (detail.usage) behaviourTexts.push(detail.usage);\n    if (detail.selectiveDrive) behaviourTexts.push(detail.selectiveDrive);\n  });\n\n  const summary = labels.slice(0, 3).join(' \u00B7 ');\n  const behaviourTags = deriveBehaviourTagsFromTexts(behaviourTexts);\n  const descriptionParts = [];\n  if (labels.length) {\n    const focus = labels.length > 1 ? `${labels[0]} / ${labels[1]}` : labels[0];\n    descriptionParts.push(`Sintesi rapida su ${focus}`);\n  }\n  if (descriptions.length) {\n    descriptionParts.push(descriptions[0]);\n  }\n  if (families.size) {\n    descriptionParts.push(`impronta ${Array.from(families).join(', ')}`);\n  }\n  if (behaviourTags.length) {\n    descriptionParts.push(`comportamento ${behaviourTags.join(', ')}`);\n  }\n  if (environments.size) {\n    descriptionParts.push(`biomi: ${Array.from(environments).join(', ')}`);\n  }\n\n  return {\n    labels,\n    summary,\n    description: `${descriptionParts.join(' \u00B7 ')}.`,\n    families: Array.from(families),\n    environments: Array.from(environments),\n    derived: Array.from(derived),\n    conflicts: Array.from(conflicts),\n    adaptations,\n    behaviourTags,\n  };\n}\n\nfunction filteredPool(biome, filters) {\n  const { flags, roles, tags } = filters;\n  return biome.species.filter(\n    (sp) =>\n      matchesFlags(sp, flags) &&\n      matchesRoles(sp, roles) &&\n      matchesTags(sp, tags) &&\n      passesComposerConstraints(sp, biome),\n  );\n}\n\nfunction generateHybridSpecies(biome, filters, desiredCount = 3) {\n  const pool = filteredPool(biome, filters);\n  const basePool = pool.length ? pool : (biome.species ?? []);\n  if (!basePool.length) return [];\n\n  const hybrids = [];\n  const maxAttempts = Math.max(desiredCount * 6, 12);\n  let attempts = 0;\n\n  while (hybrids.length < desiredCount && attempts < maxAttempts) {\n    attempts += 1;\n    const primary = sample(basePool);\n    if (!primary) break;\n    const secondaryCandidates = basePool.filter((sp) => sp.id !== primary.id);\n    const secondary = secondaryCandidates.length ? sample(secondaryCandidates) : null;\n\n    const combinedFlags = mixFlags(primary.flags, secondary?.flags);\n    const combinedTags = combineTags(primary.functional_tags, secondary?.functional_tags);\n    const roleOptions = [primary.role_trofico, secondary?.role_trofico].filter(Boolean);\n    const role = roleOptions.length ? sample(roleOptions) : (primary.role_trofico ?? null);\n    const displayName = combineNames(primary.display_name, secondary?.display_name);\n    const baseId = slugify(displayName) || slugify(`${primary.id}-${secondary?.id ?? 'solo'}`);\n    const tier = inferThreatTierFromRole(role ?? '', combinedFlags);\n\n    const hybrid = {\n      id: `${baseId}-${Math.random().toString(36).slice(2, 6)}`,\n      display_name: displayName,\n      role_trofico: role,\n      functional_tags: combinedTags,\n      flags: combinedFlags,\n      biomes: [biome.id],\n      synthetic: true,\n      syntheticTier: tier,\n      balance: { threat_tier: `T${tier}` },\n      sources: {\n        primary: {\n          id: primary.id,\n          biome: primary.source_biome ?? primary.biomes?.[0] ?? null,\n        },\n        secondary: secondary\n          ? {\n              id: secondary.id,\n              biome: secondary.source_biome ?? secondary.biomes?.[0] ?? null,\n            }\n          : null,\n      },\n    };\n\n    if (\n      matchesFlags(hybrid, filters.flags) &&\n      matchesRoles(hybrid, filters.roles) &&\n      matchesTags(hybrid, filters.tags) &&\n      passesComposerConstraints(hybrid, biome)\n    ) {\n      hybrids.push(hybrid);\n    }\n  }\n\n  if (!hybrids.length) {\n    const fallbackPool = basePool.filter((sp) => passesComposerConstraints(sp, biome));\n    return fallbackPool.slice(0, Math.min(desiredCount, fallbackPool.length)).map((sp) => {\n      const traitIds = [\n        ...normaliseTraitIds(sp.source_traits),\n        ...normaliseTraitIds(sp.traits?.ids),\n      ];\n      const profile = summariseTraitDrivenProfile(traitIds);\n      const baseTier = inferThreatTierFromRole(sp.role_trofico ?? '', sp.flags ?? {});\n      const computedTier = threatFromTraitSet(traitIds, baseTier);\n      const rarity = rarityFromTraitSet(traitIds);\n      const summary = profile.summary || sp.summary || sp.display_name || sp.id;\n      const description = profile.description || sp.description || summary;\n      const displayName =\n        profile.labels.length >= 2\n          ? `${profile.labels[0]} / ${profile.labels[1]}`\n          : `${sp.display_name ?? sp.id} Synth`;\n      const syntheticTier = Math.max(baseTier, computedTier);\n      const synergyScore = profile.derived.length\n        ? Math.min(1, profile.derived.length / Math.max(traitIds.length || 1, 1))\n        : 0;\n\n      return {\n        ...sp,\n        id: `${slugify(sp.id || sp.display_name)}-${Math.random().toString(36).slice(2, 5)}`,\n        display_name: displayName,\n        summary,\n        description,\n        biomes: [biome.id],\n        synthetic: true,\n        syntheticTier,\n        balance: { threat_tier: `T${syntheticTier}` },\n        derived_traits: profile.derived,\n        conflicting_traits: profile.conflicts,\n        morphology: {\n          families: profile.families,\n          adaptations: profile.adaptations,\n          environments: profile.environments,\n        },\n        behavior_profile: {\n          tags: profile.behaviourTags,\n          drives: profile.behaviourTags,\n        },\n        statistics: {\n          threat_tier: `T${syntheticTier}`,\n          rarity,\n          energy_profile: null,\n          synergy_score: Number.isFinite(synergyScore) ? Math.round(synergyScore * 1000) / 1000 : 0,\n        },\n        sources: {\n          primary: {\n            id: sp.id,\n            biome: sp.source_biome ?? sp.biomes?.[0] ?? null,\n          },\n          secondary: null,\n        },\n      };\n    });\n  }\n\n  return hybrids;\n}\n\nconst ROLE_MATCHERS = {\n  apex: (sp) => sp.flags?.apex || tierOf(sp) >= 4,\n  keystone: (sp) => sp.flags?.keystone,\n  threat: (sp) =>\n    sp.flags?.threat ||\n    /predatore|incursore|menace|minaccia/i.test(sp.role_trofico ?? '') ||\n    tierOf(sp) >= 3,\n  bridge: (sp) =>\n    sp.flags?.bridge ||\n    sp.flags?.event ||\n    /supporto|ponte|trasferimento/i.test(sp.role_trofico ?? ''),\n};\n\nfunction buildCandidatePools(biome, filters) {\n  const generated = state.pick.species[biome.id] ?? [];\n  const filtered = filteredPool(biome, filters);\n  const nativePool = biome.species ?? [];\n  const preferGenerated = biome.synthetic && generated.length > 0;\n\n  const prioritized = preferGenerated\n    ? uniqueById([...generated, ...filtered])\n    : uniqueById([...filtered]);\n  const fallback = uniqueById([...filtered, ...nativePool]);\n  const full = preferGenerated\n    ? uniqueById([...generated, ...filtered, ...nativePool])\n    : uniqueById([...filtered, ...nativePool]);\n\n  const sorted = [...full].sort((a, b) => tierOf(b) - tierOf(a));\n\n  return {\n    preferGenerated,\n    prioritized,\n    fallback,\n    full,\n    sorted,\n  };\n}\n\nfunction selectFromPools(pools, used, predicate) {\n  if (!predicate) return null;\n  const sequences = [];\n  if (pools.prioritized.length) {\n    sequences.push(pools.prioritized);\n  }\n  if (pools.fallback.length) {\n    sequences.push(pools.fallback);\n  }\n  sequences.push(pools.full);\n\n  for (const seq of sequences) {\n    const candidate = seq.find((sp) => !used.has(sp.id) && predicate(sp));\n    if (candidate) {\n      return candidate;\n    }\n  }\n  return null;\n}\n\nfunction normalisePartyEntry(sp) {\n  return {\n    id: sp.id,\n    display_name: sp.display_name ?? sp.id,\n    role: sp.role_trofico ?? null,\n    tier: tierOf(sp),\n    count: 1,\n    sources: sp.sources ?? null,\n    synthetic: Boolean(sp.synthetic),\n  };\n}\n\nfunction ensureMinimumIndividuals(party, blueprint, fallback) {\n  if (!party.length && fallback) {\n    party.push(normalisePartyEntry(fallback));\n  }\n\n  if (!party.length) {\n    return;\n  }\n\n  const target = Math.max(blueprint.minSize ?? 1, 1);\n  let individuals = party.reduce((sum, entry) => sum + (entry.count ?? 1), 0);\n  while (individuals < target) {\n    const last = party[party.length - 1];\n    last.count = (last.count ?? 1) + 1;\n    individuals = party.reduce((sum, entry) => sum + (entry.count ?? 1), 0);\n  }\n}\n\nfunction describeSeedNotes(biome, blueprint, filters, preferGenerated) {\n  const filterSummary = summariseFilters(filters);\n  if (biome.synthetic) {\n    const sources =\n      (biome.parents ?? [])\n        .map((parent) => parent.label ?? titleCase(parent.id ?? ''))\n        .filter(Boolean)\n        .join(' + ') || 'fonti miste';\n    const origin = preferGenerated ? 'specie ibride' : 'catalogo originale';\n    return `${blueprint.label} sintetico (${filterSummary}). Origine: ${sources}. Sorgente: ${origin}.`;\n  }\n  return `${blueprint.label} dal catalogo (${filterSummary}).`;\n}\n\nfunction createSeedFromBlueprint(biome, filters, blueprint) {\n  const pools = buildCandidatePools(biome, filters);\n  const used = new Set();\n  const party = [];\n\n  const addToParty = (sp) => {\n    if (!sp || used.has(sp.id)) return;\n    used.add(sp.id);\n    party.push(normalisePartyEntry(sp));\n  };\n\n  blueprint.priorities.forEach((key) => {\n    const matcher = ROLE_MATCHERS[key];\n    const candidate = matcher ? selectFromPools(pools, used, matcher) : null;\n    if (candidate) {\n      addToParty(candidate);\n    }\n  });\n\n  for (const sp of pools.sorted) {\n    if (party.length >= (blueprint.targetSize ?? party.length + 1)) {\n      break;\n    }\n    if (used.has(sp.id)) continue;\n    addToParty(sp);\n  }\n\n  ensureMinimumIndividuals(party, blueprint, pools.sorted[0] ?? null);\n\n  if (!party.length) {\n    return null;\n  }\n\n  const budget = party.reduce((sum, entry) => sum + entry.tier * (entry.count ?? 1), 0);\n\n  return {\n    encounter_id: `auto_${blueprint.id}_${biome.id}_${Math.random().toString(36).slice(2, 8)}`,\n    biome_id: biome.id,\n    template: blueprint.id,\n    label: blueprint.label,\n    description: blueprint.summary,\n    party,\n    threat_budget: budget,\n    synthetic: biome.synthetic || undefined,\n    notes: describeSeedNotes(biome, blueprint, filters, pools.preferGenerated),\n  };\n}\n\nfunction rerollSpecies(filters) {\n  const removedPreferredRoles = syncPreferredRolesWithAvailability();\n  const hasActiveBiomes = Array.isArray(state.pick?.biomes) && state.pick.biomes.length > 0;\n  if (removedPreferredRoles.length && hasActiveBiomes) {\n    const labels = removedPreferredRoles\n      .map((role) => titleCase(String(role).replace(/[_-]+/g, ' ')))\n      .join(', ');\n    const plural = removedPreferredRoles.length > 1;\n    setStatus(\n      plural\n        ? `Ruoli preferiti rimossi perch\u00E9 non pi\u00F9 disponibili: ${labels}.`\n        : `Ruolo preferito rimosso perch\u00E9 non pi\u00F9 disponibile: ${labels}.`,\n      'info',\n      {\n        tags: ['composer', 'ruoli'],\n        action: 'composer-preferred-pruned',\n        metadata: { roles: removedPreferredRoles },\n      },\n    );\n  }\n\n  const previous = state.pick.species ?? {};\n  const lockedBiomes = state.cardState.locks.biomes;\n  const lockedSpecies = state.cardState.locks.species;\n  const next = {};\n\n  state.pick.biomes.forEach((biome) => {\n    const biomeId = biome.id;\n    const wasLocked = lockedBiomes.has(biomeId);\n    const priorList = Array.isArray(previous[biomeId]) ? previous[biomeId] : [];\n    if (wasLocked) {\n      next[biomeId] = [...priorList];\n      if (biome.synthetic) {\n        biome.generatedSpecies = next[biomeId];\n      } else if (biome.generatedSpecies) {\n        delete biome.generatedSpecies;\n      }\n      return;\n    }\n\n    const preserved = priorList.filter((sp) => lockedSpecies.has(createPinKey(biome, sp)));\n    const preservedIds = new Set(preserved.map((sp) => sp?.id).filter(Boolean));\n    const picks = [...preserved];\n    const limit = Math.max(MAX_SPECIES_PER_BIOME, preserved.length);\n\n    if (biome.synthetic) {\n      const hybrids = generateHybridSpecies(biome, filters, limit);\n      hybrids.forEach((sp) => {\n        const key = createPinKey(biome, sp);\n        if (lockedSpecies.has(key)) {\n          if (!preservedIds.has(sp?.id)) {\n            picks.push(sp);\n            preservedIds.add(sp?.id);\n          }\n          return;\n        }\n        if (picks.length >= limit) return;\n        if (preservedIds.has(sp?.id)) return;\n        picks.push(sp);\n        preservedIds.add(sp?.id);\n      });\n      const uniquePicks = uniqueById(picks);\n      next[biomeId] = uniquePicks.slice(0, limit);\n      biome.generatedSpecies = next[biomeId];\n      return;\n    }\n\n    const pool = filteredPool(biome, filters);\n    const nativePool = biome.species ?? [];\n    const working = pool.length ? pool : nativePool;\n    const shuffled = shuffle(working).filter((sp) => {\n      const key = createPinKey(biome, sp);\n      return !lockedSpecies.has(key) && !preservedIds.has(sp?.id);\n    });\n    for (const sp of shuffled) {\n      if (picks.length >= limit) break;\n      picks.push(sp);\n    }\n    const uniquePicks = uniqueById(picks);\n    next[biomeId] = uniquePicks.slice(0, limit);\n    if (biome.generatedSpecies) {\n      delete biome.generatedSpecies;\n    }\n  });\n\n  state.pick.species = next;\n  pruneLockState();\n}\n\nfunction rerollSeeds(filters) {\n  const previous = state.pick.seeds ?? [];\n  const lockedBiomes = state.cardState.locks.biomes;\n  const next = [];\n  state.pick.biomes.forEach((biome) => {\n    if (lockedBiomes.has(biome.id)) {\n      previous.filter((seed) => seed?.biome_id === biome.id).forEach((seed) => next.push(seed));\n      return;\n    }\n    ENCOUNTER_BLUEPRINTS.forEach((blueprint) => {\n      const seed = createSeedFromBlueprint(biome, filters, blueprint);\n      if (seed) {\n        next.push(seed);\n      }\n    });\n  });\n  state.pick.seeds = next;\n}\n\nfunction createPinKey(biome, species) {\n  const biomeId = biome?.id ?? 'biome';\n  const speciesId = species?.id ?? 'species';\n  return `${biomeId}::${speciesId}`;\n}\n\nfunction queryPinButton(key) {\n  if (typeof document === 'undefined') return null;\n  const safeKey =\n    typeof CSS !== 'undefined' && typeof CSS.escape === 'function'\n      ? CSS.escape(key)\n      : key.replace(/\"/g, '\\\"');\n  return document.querySelector(`button[data-pin-key=\"${safeKey}\"]`);\n}\n\nfunction queryCompareButton(key) {\n  if (typeof document === 'undefined') return null;\n  const safeKey =\n    typeof CSS !== 'undefined' && typeof CSS.escape === 'function'\n      ? CSS.escape(key)\n      : key.replace(/\"/g, '\\\"');\n  return document.querySelector(`button[data-compare-key=\"${safeKey}\"]`);\n}\n\nfunction applyQuickButtonState(button, isActive) {\n  if (!button) return;\n  button.classList.toggle('is-active', Boolean(isActive));\n  button.setAttribute('aria-pressed', isActive ? 'true' : 'false');\n}\n\nfunction updatePinButtonState(key, active) {\n  const button = queryPinButton(key);\n  if (!button) return;\n  applyQuickButtonState(button, active);\n  const card = button.closest('.species-card');\n  if (card) {\n    card.dataset.pinned = active ? 'true' : 'false';\n  }\n}\n\nfunction updateCompareButtonState(key, active) {\n  const button = queryCompareButton(key);\n  if (!button) return;\n  applyQuickButtonState(button, active);\n  const card = button.closest('.species-card');\n  if (card) {\n    card.dataset.compare = active ? 'true' : 'false';\n  }\n}\n\nfunction stringHash(value = '') {\n  let hash = 0;\n  for (let i = 0; i < value.length; i += 1) {\n    hash = value.charCodeAt(i) + ((hash << 5) - hash);\n    hash &= hash;\n  }\n  return Math.abs(hash);\n}\n\nfunction gradientFromString(value = '') {\n  const hash = stringHash(value);\n  const hue = hash % 360;\n  const hueOffset = (hue + 36) % 360;\n  return `linear-gradient(135deg, hsl(${hue}, 68%, 26%), hsl(${hueOffset}, 70%, 38%))`;\n}\n\nfunction colorPairFromString(value = '') {\n  const hash = stringHash(value);\n  const hue = hash % 360;\n  const saturation = 70;\n  const lightness = 58;\n  return {\n    border: `hsl(${hue}, ${saturation}%, ${lightness}%)`,\n    fill: `hsla(${hue}, ${saturation}%, ${lightness}%, 0.2)`,\n  };\n}\n\nfunction initialsFromLabel(label) {\n  if (!label) return '??';\n  return label\n    .split(/[^a-zA-Z0-9]+/)\n    .filter(Boolean)\n    .map((segment) => segment[0])\n    .join('')\n    .slice(0, 2)\n    .toUpperCase();\n}\n\nfunction createPlaceholderImage(label, { variant = 'card', seed } = {}) {\n  const baseSeed = `${variant}:${seed ?? label ?? ''}`;\n  const width = variant === 'species' ? 200 : 320;\n  const height = variant === 'species' ? 200 : 180;\n  const hash = stringHash(baseSeed);\n  const hue = hash % 360;\n  const accent = (hue + 34) % 360;\n  const secondary = (hue + 210) % 360;\n  const initials = initialsFromLabel(label);\n  const gradientId = `grad-${hash.toString(16)}`;\n  const svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\" role=\"img\" aria-label=\"Placeholder\">\n    <defs>\n      <linearGradient id=\"${gradientId}\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n        <stop offset=\"0%\" stop-color=\"hsl(${hue}, 65%, 48%)\" stop-opacity=\"0.88\" />\n        <stop offset=\"100%\" stop-color=\"hsl(${accent}, 70%, 38%)\" stop-opacity=\"0.85\" />\n      </linearGradient>\n    </defs>\n    <rect width=\"${width}\" height=\"${height}\" fill=\"hsl(${secondary}, 68%, 14%)\" />\n    <rect width=\"${width}\" height=\"${height}\" fill=\"url(#${gradientId})\" opacity=\"0.82\" />\n    <g fill=\"rgba(17,24,39,0.45)\" transform=\"translate(${width / 2}, ${height / 2})\">\n      <circle r=\"${Math.min(width, height) / 2.1}\" />\n    </g>\n    <text x=\"50%\" y=\"50%\" text-anchor=\"middle\" dominant-baseline=\"middle\" font-family=\"'Segoe UI', 'Inter', sans-serif\" font-weight=\"700\" font-size=\"${Math.min(width, height) / 3}\" fill=\"rgba(241,245,255,0.9)\">${initials}</text>\n  </svg>`;\n  return `data:image/svg+xml;charset=UTF-8,${encodeURIComponent(svg)}`;\n}\n\nfunction createCardMedia({ label, variant = 'card', icon, backgroundKey, alt }) {\n  const className = variant === 'species' ? 'species-card__media' : 'generator-card__media';\n  const wrapper = document.createElement('div');\n  wrapper.className = className;\n  const seed = backgroundKey ?? label ?? '';\n  if (seed) {\n    wrapper.style.background = gradientFromString(seed);\n  }\n  const image = document.createElement('img');\n  image.loading = 'lazy';\n  image.decoding = 'async';\n  image.alt = alt ?? `Illustrazione segnaposto per ${label ?? 'la carta'}`;\n  image.src = createPlaceholderImage(label, { variant, seed });\n  wrapper.appendChild(image);\n  if (icon) {\n    const glyphClass =\n      variant === 'species' ? 'species-card__glyph' : 'generator-card__media-glyph';\n    const glyph = document.createElement('span');\n    glyph.className = glyphClass;\n    glyph.textContent = icon;\n    wrapper.appendChild(glyph);\n  }\n  return wrapper;\n}\n\nfunction clampScale(value, max = 5) {\n  if (!Number.isFinite(value)) return 0;\n  if (value < 0) return 0;\n  return Math.min(value, max);\n}\n\nfunction biomePlaceholderLabel(biome) {\n  if (biome?.emoji) return biome.emoji;\n  if (biome?.icon) return biome.icon;\n  const id = (biome?.id ?? '').toLowerCase();\n  if (/ghiaccio|cryosteppe|neve|tundra/.test(id)) return '\u2744\uFE0F';\n  if (/foresta|bosco|giungla/.test(id)) return '\uD83C\uDF32';\n  if (/deserto|sabbia|duna/.test(id)) return '\uD83C\uDFDC\uFE0F';\n  if (/palude|swamp|marsh|laguna/.test(id)) return '\uD83E\uDD8E';\n  if (/mont|rupe|alp/.test(id)) return '\u26F0\uFE0F';\n  if (/costa|reef|mare|oceano|litor/.test(id)) return '\uD83C\uDF0A';\n  if (/vulc|lava|fuoco/.test(id)) return '\uD83C\uDF0B';\n  const initials = (biome?.label ?? biome?.id ?? '??')\n    .split(/[^a-zA-Z0-9]+/)\n    .filter(Boolean)\n    .map((segment) => segment[0])\n    .join('')\n    .slice(0, 2)\n    .toUpperCase();\n  return initials || '\uD83D\uDF28';\n}\n\nfunction speciesPlaceholderIcon(species) {\n  if (species?.emoji) return species.emoji;\n  if (species?.icon) return species.icon;\n  const role = (species?.role_trofico ?? '').toLowerCase();\n  if (/predatore_terziario|apex/.test(role)) return '\uD83E\uDD88';\n  if (/predatore/.test(role)) return '\uD83E\uDD96';\n  if (/erbivoro|prede|pastoral/.test(role)) return '\uD83E\uDD8C';\n  if (/impollin/.test(role)) return '\uD83E\uDEB2';\n  if (/detrit|saprof/.test(role)) return '\uD83E\uDEB1';\n  if (/evento|anomalia|hazard/.test(role)) return '\u26A1';\n  return '\uD83E\uDDEC';\n}\n\nfunction createBadgeElement(label, modifier) {\n  const badge = document.createElement('span');\n  badge.className = 'badge';\n  if (modifier) {\n    badge.classList.add(`badge--${modifier}`);\n  }\n  badge.textContent = label;\n  return badge;\n}\n\nfunction rarityFromTier(tier) {\n  if (tier <= 1) return { label: 'Comune', slug: 'common' };\n  if (tier === 2) return { label: 'Non comune', slug: 'uncommon' };\n  if (tier === 3) return { label: 'Raro', slug: 'rare' };\n  if (tier === 4) return { label: 'Epico', slug: 'epic' };\n  return { label: 'Leggendario', slug: 'legendary' };\n}\n\nfunction extractFunctionalGroups(biome) {\n  const groups = new Set();\n  const manifestGroups = biome?.manifest?.functional_groups_present ?? [];\n  manifestGroups.forEach((group) => {\n    if (group) groups.add(group);\n  });\n  const functional = biome?.functional_groups ?? biome?.functionalGroups ?? [];\n  functional.forEach((group) => {\n    if (group) groups.add(group);\n  });\n  const tags = biome?.functional_tags ?? [];\n  tags.forEach((tag) => {\n    if (tag) groups.add(tag);\n  });\n  return groups;\n}\n\nfunction calculateSynergy(species, biome) {\n  const groups = extractFunctionalGroups(biome);\n  const tags = Array.isArray(species?.functional_tags) ? species.functional_tags : [];\n  const matches = tags.filter((tag) => groups.has(tag));\n  let percent;\n  if (groups.size && tags.length) {\n    percent = Math.round((matches.length / groups.size) * 100);\n  } else if (tags.length) {\n    percent = 55;\n  } else {\n    percent = 30;\n  }\n  const flags = species?.flags ?? {};\n  if (flags.keystone) percent += 12;\n  if (flags.apex) percent += 14;\n  if (flags.threat) percent += 8;\n  if (flags.bridge) percent += 6;\n  if (flags.event) percent -= 4;\n  if (species?.synthetic) percent += 4;\n  percent += Math.max(0, tierOf(species) - 2) * 4;\n  percent = Math.max(10, Math.min(100, percent));\n  const summary = matches.length\n    ? `Sinergie attive: ${matches.join(', ')}`\n    : tags.length\n      ? `Tag funzionali da connettere: ${tags.join(', ')}`\n      : 'Nessun tag funzionale dichiarato.';\n  return {\n    percent,\n    matches,\n    tags,\n    groups: Array.from(groups),\n    summary,\n  };\n}\n\nfunction createSynergyMeter(info) {\n  const meter = document.createElement('div');\n  meter.className = 'synergy-meter';\n  const labelRow = document.createElement('div');\n  labelRow.className = 'synergy-meter__label';\n  const label = document.createElement('span');\n  label.textContent = 'Sinergia ecosistema';\n  const value = document.createElement('span');\n  value.className = 'synergy-meter__value';\n  value.textContent = `${info.percent}%`;\n  labelRow.append(label, value);\n  meter.appendChild(labelRow);\n  const track = document.createElement('div');\n  track.className = 'synergy-meter__track';\n  const progress = document.createElement('div');\n  progress.className = 'synergy-meter__progress';\n  progress.style.setProperty('--progress', `${info.percent}%`);\n  track.appendChild(progress);\n  meter.appendChild(track);\n  return meter;\n}\n\nfunction findBiomeById(biomeId) {\n  if (!biomeId) return null;\n  const fromPick = state.pick?.biomes?.find((biome) => biome.id === biomeId);\n  if (fromPick) return fromPick;\n  const fromCatalog = state.data?.biomi?.find((biome) => biome.id === biomeId);\n  if (fromCatalog) return fromCatalog;\n  return null;\n}\n\nfunction findSpeciesInPick(biomeId, speciesId) {\n  if (!biomeId || !speciesId) return null;\n  const bucket = state.pick?.species?.[biomeId];\n  if (!Array.isArray(bucket)) return null;\n  return bucket.find((sp) => sp.id === speciesId) ?? null;\n}\n\nfunction splitRoleTokens(value) {\n  if (typeof value !== 'string') return [];\n  return value\n    .split(/[^a-z0-9]+/i)\n    .map((token) => token.trim())\n    .filter(Boolean);\n}\n\nfunction collectRoleTokenDetails(species) {\n  const tokens = [];\n  const seen = new Set();\n  const consider = (value) => {\n    splitRoleTokens(value).forEach((token) => {\n      if (!token) return;\n      const normalized = token.toLowerCase();\n      if (seen.has(normalized)) return;\n      seen.add(normalized);\n      tokens.push(token);\n    });\n  };\n  if (Array.isArray(species?.roles)) {\n    species.roles.forEach((role) => consider(role));\n  }\n  consider(species?.role_trofico ?? '');\n  return tokens;\n}\n\nfunction roleTokenCount(species) {\n  return collectRoleTokenDetails(species).length;\n}\n\nfunction formatRoleTokenLabel(token) {\n  if (!token) return '';\n  return titleCase(token.replace(/[_-]+/g, ' '));\n}\n\nfunction collectHazardIds(species) {\n  const hazardIds = new Set();\n  const add = (value) => {\n    if (!value) return;\n    if (Array.isArray(value)) {\n      value.forEach((item) => add(item));\n      return;\n    }\n    if (typeof value === 'string') {\n      value\n        .split(/[\\s,;]+/)\n        .map((item) => item.trim())\n        .filter(Boolean)\n        .forEach((item) => hazardIds.add(item));\n      return;\n    }\n    if (typeof value === 'object') {\n      Object.keys(value).forEach((key) => hazardIds.add(key));\n    }\n  };\n\n  add(species?.meta?.hazard_profile);\n  add(species?.hazard_profile);\n  add(species?.hazards_expected);\n  add(species?.hazardsExpected);\n\n  return Array.from(hazardIds);\n}\n\nfunction formatHazardLabel(hazardId) {\n  if (!hazardId) return '';\n  const entry = state.hazardsIndex.get(hazardId);\n  if (entry?.label) return entry.label;\n  return titleCase(String(hazardId));\n}\n\nfunction hazardSignalInfo(species) {\n  const hazardIds = collectHazardIds(species);\n  let hazardSignals = hazardIds.length;\n  const roleHint = species?.role_trofico ?? '';\n  if (species?.flags?.threat || /minaccia|hazard|evento/i.test(roleHint)) {\n    hazardSignals = Math.max(hazardSignals + 1, 2);\n  }\n  return { hazardSignals, hazardIds };\n}\n\nfunction hazardSignalCount(species) {\n  return hazardSignalInfo(species).hazardSignals;\n}\n\nfunction calculateSpeciesMetrics(species) {\n  const tier = Number.parseFloat(tierOf(species) ?? 0);\n  const { hazardSignals, hazardIds } = hazardSignalInfo(species);\n  const hazardNames = hazardIds.map((hazardId) => formatHazardLabel(hazardId));\n  const rawRoleTokens = collectRoleTokenDetails(species);\n  const roleTokenLabels = rawRoleTokens.map((token) => formatRoleTokenLabel(token));\n  const roleTokens = rawRoleTokens.length;\n  return {\n    tierAverage: clampScale(Number.isFinite(tier) ? tier : 0),\n    hazardDensity: clampScale(hazardSignals),\n    roleDiversity: clampScale(roleTokens),\n    detail: {\n      tier: Number.isFinite(tier) ? tier : 0,\n      hazardSignals,\n      hazardIds,\n      hazardNames,\n      roleTokens,\n      roleTokenList: roleTokenLabels,\n    },\n  };\n}\n\nfunction roleDisplayName(species) {\n  if (!species?.role_trofico) {\n    return 'Ruolo sconosciuto';\n  }\n  return titleCase(species.role_trofico.replace(/_/g, ' '));\n}\n\nfunction formatTierValue(value) {\n  const parsed = Number.parseFloat(value ?? 0);\n  const safe = Number.isFinite(parsed) ? parsed : 0;\n  return `T${safe.toFixed(1)}`;\n}\n\nfunction createComparisonEntry(biome, species) {\n  const key = createPinKey(biome, species);\n  return {\n    key,\n    biomeId: biome?.id ?? 'biome',\n    biomeLabel: biome?.label ?? titleCase(biome?.id ?? ''),\n    speciesId: species?.id ?? key,\n    displayName: species?.display_name ?? species?.id ?? 'Specie',\n    roleName: roleDisplayName(species),\n    metrics: calculateSpeciesMetrics(species),\n    synthetic: Boolean(species?.synthetic || biome?.synthetic),\n  };\n}\n\nfunction createQuickButton({ icon, label, className }) {\n  const button = document.createElement('button');\n  button.type = 'button';\n  button.className = ['quick-button', className].filter(Boolean).join(' ');\n  button.innerHTML = `<span aria-hidden=\"true\">${icon}</span><span class=\"visually-hidden\">${label}</span>`;\n  button.setAttribute('aria-pressed', 'false');\n  return button;\n}\n\nfunction isBiomeLocked(biomeId) {\n  if (!biomeId) return false;\n  return state.cardState.locks.biomes.has(biomeId);\n}\n\nfunction toggleBiomeLock(biome, { announce = true } = {}) {\n  const id = biome?.id;\n  if (!id) return false;\n  const locks = state.cardState.locks.biomes;\n  const label = biome?.label ?? titleCase(id ?? '');\n  let locked;\n  if (locks.has(id)) {\n    locks.delete(id);\n    locked = false;\n    if (announce) {\n      setStatus(`${label} sbloccato.`, 'info', {\n        tags: ['lock', 'bioma'],\n        action: 'biome-unlock',\n      });\n    }\n  } else {\n    locks.add(id);\n    locked = true;\n    if (announce) {\n      setStatus(`${label} bloccato per i prossimi re-roll.`, 'success', {\n        tags: ['lock', 'bioma'],\n        action: 'biome-lock',\n      });\n    }\n  }\n  persistLockState();\n  return locked;\n}\n\nfunction isSpeciesLocked(biome, species) {\n  const key = createPinKey(biome, species);\n  return state.cardState.locks.species.has(key);\n}\n\nfunction toggleSpeciesLock(biome, species, { announce = true } = {}) {\n  const key = createPinKey(biome, species);\n  const locks = state.cardState.locks.species;\n  const displayName = species?.display_name ?? species?.id ?? 'Specie';\n  let locked;\n  if (locks.has(key)) {\n    locks.delete(key);\n    locked = false;\n    if (announce) {\n      setStatus(`${displayName} sbloccata.`, 'info', {\n        tags: ['lock', 'specie'],\n        action: 'species-unlock',\n      });\n    }\n  } else {\n    locks.add(key);\n    locked = true;\n    if (announce) {\n      setStatus(`${displayName} bloccata nei prossimi re-roll.`, 'success', {\n        tags: ['lock', 'specie'],\n        action: 'species-lock',\n      });\n    }\n  }\n  persistLockState();\n  return locked;\n}\n\nfunction togglePinned(biome, species, { announce = true } = {}) {\n  const key = createPinKey(biome, species);\n  const store = state.cardState.pinned;\n  const displayName = species?.display_name ?? species?.id ?? 'Specie';\n  if (store.has(key)) {\n    store.delete(key);\n    if (announce) {\n      setStatus(`${displayName} rimosso dalle specie pinnate.`, 'info', {\n        tags: ['specie', 'pin'],\n        action: 'species-unpin',\n      });\n    }\n    updatePinButtonState(key, false);\n    renderPinnedSummary();\n    persistPinnedState();\n    return false;\n  }\n  const tier = tierOf(species);\n  const rarity = rarityFromTier(tier);\n  store.set(key, {\n    key,\n    speciesId: species?.id ?? key,\n    biomeId: biome?.id ?? 'biome',\n    displayName,\n    biomeLabel: biome?.label ?? titleCase(biome?.id ?? ''),\n    tier,\n    rarity: rarity.label,\n    slug: rarity.slug,\n    synthetic: Boolean(species?.synthetic || biome?.synthetic),\n  });\n  if (announce) {\n    setStatus(`${displayName} aggiunto alle specie pinnate.`, 'success', {\n      tags: ['specie', 'pin'],\n      action: 'species-pin',\n    });\n  }\n  updatePinButtonState(key, true);\n  renderPinnedSummary();\n  persistPinnedState();\n  return true;\n}\n\nfunction removeComparisonEntry(key, { announce = false, reRender = true } = {}) {\n  const store = state.cardState.comparison;\n  if (!store?.has(key)) return;\n  const entry = store.get(key);\n  store.delete(key);\n  updateCompareButtonState(key, false);\n  if (announce) {\n    const label = entry?.displayName ?? 'Specie';\n    setStatus(`${label} rimossa dal confronto.`, 'info', {\n      tags: ['confronto'],\n      action: 'compare-remove',\n    });\n  }\n  if (reRender) {\n    renderComparisonPanel();\n  }\n}\n\nfunction toggleComparison(biome, species, { announce = true } = {}) {\n  const key = createPinKey(biome, species);\n  const store = state.cardState.comparison;\n  if (store.has(key)) {\n    removeComparisonEntry(key, { announce, reRender: true });\n    return false;\n  }\n  if (store.size >= 3) {\n    if (announce) {\n      setStatus('Puoi confrontare al massimo tre specie alla volta.', 'warn', {\n        tags: ['confronto', 'limite'],\n        action: 'compare-limit',\n      });\n    }\n    return false;\n  }\n  const entry = createComparisonEntry(biome, species);\n  store.set(key, entry);\n  updateCompareButtonState(key, true);\n  renderComparisonPanel();\n  if (announce) {\n    setStatus(`${entry.displayName} aggiunta al confronto.`, 'success', {\n      tags: ['confronto'],\n      action: 'compare-add',\n    });\n  }\n  return true;\n}\n\nfunction syncComparisonStore() {\n  const store = state.cardState.comparison;\n  if (!store?.size) return 0;\n  const stale = [];\n  store.forEach((entry, key) => {\n    const species = findSpeciesInPick(entry.biomeId, entry.speciesId);\n    if (!species) {\n      stale.push(key);\n      return;\n    }\n    entry.displayName = species.display_name ?? species.id ?? entry.displayName;\n    entry.roleName = roleDisplayName(species);\n    entry.metrics = calculateSpeciesMetrics(species);\n    const biome = findBiomeById(entry.biomeId);\n    entry.biomeLabel = biome?.label ?? titleCase(biome?.id ?? entry.biomeId ?? '');\n    entry.synthetic = Boolean(species.synthetic || biome?.synthetic);\n  });\n  stale.forEach((key) => {\n    store.delete(key);\n    updateCompareButtonState(key, false);\n  });\n  return stale.length;\n}\n\nfunction ensureComparisonChart() {\n  if (!elements.compareCanvas) return null;\n  if (comparisonChart) return comparisonChart;\n  if (typeof Chart === 'undefined') {\n    if (!chartUnavailableNotified) {\n      console.warn('Chart.js non disponibile: il confronto radar verr\u00E0 mostrato solo come elenco.');\n      chartUnavailableNotified = true;\n    }\n    if (elements.compareFallback) {\n      elements.compareFallback.hidden = false;\n    }\n    elements.compareCanvas.hidden = true;\n    return null;\n  }\n\n  elements.compareCanvas.hidden = false;\n  if (elements.compareFallback) {\n    elements.compareFallback.hidden = true;\n  }\n\n  const context = elements.compareCanvas.getContext('2d');\n  if (!context) return null;\n\n  comparisonChart = new Chart(context, {\n    type: 'radar',\n    data: {\n      labels: COMPARISON_LABELS,\n      datasets: [],\n    },\n    options: {\n      responsive: true,\n      maintainAspectRatio: false,\n      scales: {\n        r: {\n          beginAtZero: true,\n          suggestedMax: 5,\n          angleLines: { color: 'rgba(148, 196, 255, 0.18)' },\n          grid: { color: 'rgba(148, 196, 255, 0.12)' },\n          ticks: {\n            stepSize: 1,\n            showLabelBackdrop: false,\n            color: 'rgba(148, 196, 255, 0.65)',\n          },\n          pointLabels: {\n            color: 'rgba(226, 240, 255, 0.82)',\n            font: { size: 12 },\n          },\n        },\n      },\n      plugins: {\n        legend: {\n          labels: {\n            color: '#e2f0ff',\n            font: { size: 12 },\n          },\n        },\n        tooltip: {\n          backgroundColor: 'rgba(15, 23, 42, 0.92)',\n          titleColor: '#f8fafc',\n          bodyColor: '#f8fafc',\n          borderColor: 'rgba(148, 196, 255, 0.35)',\n          borderWidth: 1,\n          callbacks: {\n            label(context) {\n              const detail = context.dataset?.metaDetails ?? {};\n              switch (context.dataIndex) {\n                case 0: {\n                  const tier = Number.isFinite(detail.tier) ? detail.tier : context.parsed.r;\n                  return `Tier medio: ${formatTierValue(tier)}`;\n                }\n                case 1: {\n                  const hazard = Number.isFinite(detail.hazardSignals)\n                    ? detail.hazardSignals\n                    : context.parsed.r;\n                  const label = hazard === 1 ? 'segnale' : 'segnali';\n                  const hazardNames = Array.isArray(detail.hazardNames)\n                    ? detail.hazardNames.filter(Boolean)\n                    : [];\n                  const maxDisplay = 3;\n                  const display = hazardNames.slice(0, maxDisplay);\n                  const more = hazardNames.length > display.length ? '\u2026' : '';\n                  const hint = display.length ? ` (${display.join(', ')}${more})` : '';\n                  return `Densit\u00E0 hazard: ${hazard} ${label}${hint}`;\n                }\n                case 2: {\n                  const roles = Number.isFinite(detail.roleTokens)\n                    ? detail.roleTokens\n                    : context.parsed.r;\n                  const label = roles === 1 ? 'archetipo' : 'archetipi';\n                  const roleTokens = Array.isArray(detail.roleTokenList)\n                    ? detail.roleTokenList.filter(Boolean)\n                    : [];\n                  const maxDisplay = 4;\n                  const display = roleTokens.slice(0, maxDisplay);\n                  const more = roleTokens.length > display.length ? '\u2026' : '';\n                  const hint = display.length ? ` (${display.join(', ')}${more})` : '';\n                  return `Diversit\u00E0 ruoli: ${roles} ${label}${hint}`;\n                }\n                default:\n                  return `${context.label}: ${context.formattedValue}`;\n              }\n            },\n          },\n        },\n      },\n    },\n  });\n\n  return comparisonChart;\n}\n\nfunction updateComparisonChart(entries) {\n  if (!entries?.length) {\n    if (comparisonChart) {\n      comparisonChart.data.datasets = [];\n      comparisonChart.update();\n    }\n    return;\n  }\n\n  const chart = ensureComparisonChart();\n  if (!chart) {\n    if (elements.compareFallback) {\n      elements.compareFallback.hidden = false;\n    }\n    return;\n  }\n\n  chart.data.labels = COMPARISON_LABELS;\n  chart.data.datasets = entries.map((entry) => {\n    const colors = colorPairFromString(entry.key);\n    return {\n      label: entry.displayName,\n      data: [entry.metrics.tierAverage, entry.metrics.hazardDensity, entry.metrics.roleDiversity],\n      fill: true,\n      backgroundColor: colors.fill,\n      borderColor: colors.border,\n      pointBackgroundColor: colors.border,\n      pointBorderColor: '#0f172a',\n      pointHoverBackgroundColor: '#f8fafc',\n      pointHoverBorderColor: colors.border,\n      metaDetails: entry.metrics.detail,\n    };\n  });\n  const maxValue = entries.reduce((acc, entry) => {\n    return Math.max(\n      acc,\n      entry.metrics.tierAverage,\n      entry.metrics.hazardDensity,\n      entry.metrics.roleDiversity,\n    );\n  }, 0);\n  if (chart.options?.scales?.r) {\n    const buffer = maxValue >= 4 ? 1 : 0.5;\n    chart.options.scales.r.suggestedMax = Math.max(5, Math.ceil(maxValue + buffer));\n  }\n  chart.update();\n}\n\nfunction renderComparisonPanel() {\n  const list = elements.compareList;\n  if (!list) return;\n  const entries = Array.from(state.cardState.comparison.values());\n  list.innerHTML = '';\n  const hasEntries = entries.length > 0;\n  list.hidden = !hasEntries;\n  if (elements.compareEmpty) {\n    elements.compareEmpty.hidden = hasEntries;\n  }\n  if (elements.comparePanel) {\n    elements.comparePanel.dataset.state = hasEntries ? 'filled' : 'empty';\n  }\n  if (elements.summaryContainer) {\n    elements.summaryContainer.dataset.hasComparison = hasEntries ? 'true' : 'false';\n  }\n  if (elements.compareChartContainer) {\n    elements.compareChartContainer.hidden = !hasEntries;\n  }\n\n  entries.forEach((entry) => {\n    const item = document.createElement('li');\n    item.className = 'generator-compare__item';\n    item.dataset.compareKey = entry.key;\n\n    const info = document.createElement('div');\n    info.className = 'generator-compare__info';\n    item.appendChild(info);\n\n    const name = document.createElement('p');\n    name.className = 'generator-compare__name';\n    name.textContent = entry.displayName;\n    info.appendChild(name);\n\n    const meta = document.createElement('p');\n    meta.className = 'generator-compare__meta';\n    const metaParts = [entry.biomeLabel];\n    if (entry.roleName) {\n      metaParts.push(entry.roleName);\n    }\n    if (entry.synthetic) {\n      metaParts.push('Synth');\n    }\n    meta.textContent = metaParts.filter(Boolean).join(' \u00B7 ');\n    info.appendChild(meta);\n\n    const metrics = document.createElement('div');\n    metrics.className = 'generator-compare__metrics';\n\n    const tierMetric = document.createElement('span');\n    tierMetric.className = 'generator-compare__metric';\n    tierMetric.innerHTML = `<span class=\"generator-compare__metric-label\">Tier medio</span> ${formatTierValue(\n      entry.metrics.detail.tier,\n    )}`;\n    tierMetric.title = `Tier stimato: ${formatTierValue(entry.metrics.detail.tier)}`;\n    metrics.appendChild(tierMetric);\n\n    const hazardMetric = document.createElement('span');\n    hazardMetric.className = 'generator-compare__metric';\n    const hazardSignals = Number.isFinite(entry.metrics.detail.hazardSignals)\n      ? entry.metrics.detail.hazardSignals\n      : 0;\n    const hazardLabel = hazardSignals === 1 ? 'segnale' : 'segnali';\n    hazardMetric.innerHTML = `<span class=\"generator-compare__metric-label\">Densit\u00E0 hazard</span> ${hazardSignals} ${hazardLabel}`;\n    if (\n      Array.isArray(entry.metrics.detail.hazardNames) &&\n      entry.metrics.detail.hazardNames.length\n    ) {\n      hazardMetric.title = entry.metrics.detail.hazardNames.join(', ');\n    }\n    metrics.appendChild(hazardMetric);\n\n    const roleMetric = document.createElement('span');\n    roleMetric.className = 'generator-compare__metric';\n    const roleTokens = Number.isFinite(entry.metrics.detail.roleTokens)\n      ? entry.metrics.detail.roleTokens\n      : 0;\n    const roleLabel = roleTokens === 1 ? 'archetipo' : 'archetipi';\n    roleMetric.innerHTML = `<span class=\"generator-compare__metric-label\">Diversit\u00E0 ruoli</span> ${roleTokens} ${roleLabel}`;\n    if (\n      Array.isArray(entry.metrics.detail.roleTokenList) &&\n      entry.metrics.detail.roleTokenList.length\n    ) {\n      roleMetric.title = entry.metrics.detail.roleTokenList.join(', ');\n    }\n    metrics.appendChild(roleMetric);\n\n    info.appendChild(metrics);\n\n    const remove = document.createElement('button');\n    remove.type = 'button';\n    remove.className = 'generator-compare__remove';\n    remove.dataset.action = 'remove-compare';\n    remove.dataset.compareKey = entry.key;\n    remove.innerHTML = '&times;';\n    item.appendChild(remove);\n\n    list.appendChild(item);\n  });\n\n  if (hasEntries) {\n    updateComparisonChart(entries);\n  } else if (elements.compareFallback) {\n    elements.compareFallback.hidden = true;\n    if (elements.compareCanvas) {\n      elements.compareCanvas.hidden = false;\n    }\n    updateComparisonChart([]);\n  }\n}\n\nfunction attachComparisonHandlers() {\n  const list = elements.compareList;\n  if (!list) return;\n  list.addEventListener('click', (event) => {\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) return;\n    const button = target.closest('[data-action=\"remove-compare\"]');\n    if (!button) return;\n    event.preventDefault();\n    const { compareKey } = button.dataset;\n    if (!compareKey) return;\n    removeComparisonEntry(compareKey, { announce: true });\n  });\n}\n\nfunction toggleSquad(biome, species) {\n  const key = createPinKey(biome, species);\n  const store = state.cardState.squad;\n  const displayName = species?.display_name ?? species?.id ?? 'Specie';\n  if (store.has(key)) {\n    store.delete(key);\n    setStatus(`${displayName} rimosso dalla squadra rapida.`, 'info', {\n      tags: ['squadra'],\n      action: 'squad-remove',\n    });\n    return false;\n  }\n  store.set(key, {\n    key,\n    speciesId: species?.id ?? key,\n    biomeId: biome?.id ?? 'biome',\n    displayName,\n    tier: tierOf(species),\n  });\n  setStatus(`${displayName} aggiunto alla squadra rapida.`, 'success', {\n    tags: ['squadra'],\n    action: 'squad-add',\n  });\n  return true;\n}\n\nfunction createSpeciesCard(biome, species) {\n  const displayName = species?.display_name ?? species?.id ?? 'Specie sconosciuta';\n  const card = document.createElement('article');\n  card.className = 'species-card';\n  card.dataset.cardType = 'species';\n  const pinKey = createPinKey(biome, species);\n  if (state.cardState.pinned.has(pinKey)) {\n    card.dataset.pinned = 'true';\n  }\n  if (state.cardState.comparison.has(pinKey)) {\n    card.dataset.compare = 'true';\n  }\n  if (isSpeciesLocked(biome, species)) {\n    card.dataset.locked = 'true';\n  }\n\n  const tier = tierOf(species);\n  const rarity = rarityFromTier(tier);\n  card.dataset.rarity = rarity.slug;\n  card.dataset.tier = `T${tier}`;\n  if (species?.synthetic || biome?.synthetic) {\n    card.dataset.synthetic = 'true';\n  }\n\n  const media = createCardMedia({\n    label: displayName,\n    variant: 'species',\n    icon: speciesPlaceholderIcon(species),\n    backgroundKey: species?.id ?? displayName,\n    alt: `Segnaposto per ${displayName}`,\n  });\n  card.appendChild(media);\n\n  const info = document.createElement('div');\n  info.className = 'species-card__info';\n  card.appendChild(info);\n\n  const header = document.createElement('div');\n  header.className = 'species-card__header';\n  info.appendChild(header);\n\n  const title = document.createElement('div');\n  title.className = 'species-card__title';\n  header.appendChild(title);\n\n  const name = document.createElement('h4');\n  name.className = 'species-card__name';\n  name.textContent = displayName;\n  title.appendChild(name);\n\n  const id = document.createElement('p');\n  id.className = 'species-card__id';\n  id.textContent = species?.id ?? '\u2014';\n  title.appendChild(id);\n\n  const controls = document.createElement('div');\n  controls.className = 'species-card__controls';\n  header.appendChild(controls);\n\n  const badges = document.createElement('div');\n  badges.className = 'species-card__badges';\n  badges.appendChild(createBadgeElement(rarity.label, `rarity-${rarity.slug}`));\n  if (species?.synthetic || biome?.synthetic) {\n    badges.appendChild(createBadgeElement('Synth', 'synth'));\n  }\n  controls.appendChild(badges);\n\n  const actions = document.createElement('div');\n  actions.className = 'species-card__actions';\n  controls.appendChild(actions);\n\n  const squadButton = createQuickButton({\n    icon: '\u2694\uFE0F',\n    label: `Aggiungi ${displayName} alla squadra rapida`,\n    className: 'quick-button--squad',\n  });\n  applyQuickButtonState(squadButton, state.cardState.squad.has(pinKey));\n  squadButton.addEventListener('click', (event) => {\n    event.preventDefault();\n    const active = toggleSquad(biome, species);\n    applyQuickButtonState(squadButton, active);\n  });\n  actions.appendChild(squadButton);\n\n  const lockActive = isSpeciesLocked(biome, species);\n  const lockButton = createQuickButton({\n    icon: lockActive ? '\uD83D\uDD12' : '\uD83D\uDD13',\n    label: `Blocca ${displayName} nei re-roll`,\n    className: 'quick-button--lock',\n  });\n  applyQuickButtonState(lockButton, lockActive);\n  lockButton.dataset.lockKey = pinKey;\n  lockButton.addEventListener('click', (event) => {\n    event.preventDefault();\n    const locked = toggleSpeciesLock(biome, species);\n    applyQuickButtonState(lockButton, locked);\n    const icon = lockButton.querySelector('span');\n    if (icon) {\n      icon.textContent = locked ? '\uD83D\uDD12' : '\uD83D\uDD13';\n    }\n    card.dataset.locked = locked ? 'true' : 'false';\n  });\n  actions.appendChild(lockButton);\n\n  const pinButton = createQuickButton({\n    icon: '\uD83D\uDCCC',\n    label: `Pin ${displayName} nel riepilogo`,\n    className: 'quick-button--pin',\n  });\n  pinButton.dataset.pinKey = pinKey;\n  applyQuickButtonState(pinButton, state.cardState.pinned.has(pinKey));\n  pinButton.addEventListener('click', (event) => {\n    event.preventDefault();\n    const active = togglePinned(biome, species);\n    applyQuickButtonState(pinButton, active);\n    card.dataset.pinned = active ? 'true' : 'false';\n  });\n  actions.appendChild(pinButton);\n\n  const compareButton = createQuickButton({\n    icon: '\uD83D\uDCCA',\n    label: `Confronta ${displayName} nel radar`,\n    className: 'quick-button--compare',\n  });\n  compareButton.dataset.compareKey = pinKey;\n  applyQuickButtonState(compareButton, state.cardState.comparison.has(pinKey));\n  compareButton.addEventListener('click', (event) => {\n    event.preventDefault();\n    const active = toggleComparison(biome, species);\n    applyQuickButtonState(compareButton, active);\n    card.dataset.compare = active ? 'true' : 'false';\n  });\n  actions.appendChild(compareButton);\n\n  const meta = document.createElement('div');\n  meta.className = 'species-card__meta';\n  const role = species?.role_trofico ? titleCase(species.role_trofico) : 'Ruolo sconosciuto';\n  const roleSpan = document.createElement('span');\n  roleSpan.textContent = role;\n  meta.appendChild(roleSpan);\n  const tierSpan = document.createElement('span');\n  tierSpan.textContent = `Tier T${tier}`;\n  meta.appendChild(tierSpan);\n  const notableFlags = ['keystone', 'apex', 'bridge', 'threat', 'event'].filter(\n    (flag) => species.flags?.[flag],\n  );\n  if (notableFlags.length) {\n    const flagSpan = document.createElement('span');\n    flagSpan.textContent = `Flag: ${notableFlags.map((flag) => titleCase(flag.replace(/_/g, ' '))).join(', ')}`;\n    meta.appendChild(flagSpan);\n  }\n  info.appendChild(meta);\n\n  const tags = Array.isArray(species.functional_tags) ? species.functional_tags : [];\n  if (tags.length) {\n    const tagContainer = document.createElement('div');\n    tagContainer.className = 'species-card__tags';\n    const maxVisible = 5;\n    tags.slice(0, maxVisible).forEach((tag) => {\n      const chip = document.createElement('span');\n      chip.className = 'chip';\n      chip.textContent = tag;\n      tagContainer.appendChild(chip);\n    });\n    if (tags.length > maxVisible) {\n      const remainder = document.createElement('span');\n      remainder.className = 'chip';\n      remainder.textContent = `+${tags.length - maxVisible}`;\n      tagContainer.appendChild(remainder);\n    }\n    info.appendChild(tagContainer);\n  }\n\n  const synergy = calculateSynergy(species, biome);\n  const meter = createSynergyMeter(synergy);\n  info.appendChild(meter);\n\n  if (synergy.summary) {\n    const summary = document.createElement('p');\n    summary.className = 'species-card__summary';\n    summary.textContent = synergy.summary;\n    info.appendChild(summary);\n  }\n\n  return card;\n}\n\nfunction buildBiomeCard(biome, filters) {\n  const card = document.createElement('article');\n  card.className = 'generator-card';\n  card.dataset.biomeId = biome.id;\n  card.dataset.cardType = 'biome';\n  if (biome?.synthetic) {\n    card.dataset.synthetic = 'true';\n  }\n  if (isBiomeLocked(biome.id)) {\n    card.dataset.locked = 'true';\n  }\n  card.setAttribute('role', 'listitem');\n\n  const titleText = biome.synthetic\n    ? (biome.label ?? titleCase(biome.id ?? ''))\n    : titleCase(biome.id ?? '');\n  const media = createCardMedia({\n    label: titleText,\n    variant: 'biome',\n    icon: biomePlaceholderLabel(biome),\n    backgroundKey: biome.id ?? biome.label ?? titleText,\n    alt: `Segnaposto per il bioma ${titleText}`,\n  });\n  card.appendChild(media);\n\n  const body = document.createElement('div');\n  body.className = 'generator-card__body';\n  card.appendChild(body);\n\n  const header = document.createElement('div');\n  header.className = 'generator-card__header';\n  body.appendChild(header);\n\n  const titleGroup = document.createElement('div');\n  titleGroup.className = 'generator-card__title-group';\n  header.appendChild(titleGroup);\n\n  const title = document.createElement('h3');\n  title.className = 'generator-card__title';\n  title.textContent = titleText;\n  titleGroup.appendChild(title);\n\n  const subtitle = document.createElement('p');\n  subtitle.className = 'generator-card__subtitle';\n  subtitle.textContent = `ID: ${biome.id}`;\n  titleGroup.appendChild(subtitle);\n\n  const badges = document.createElement('div');\n  badges.className = 'generator-card__badges';\n  const speciesCount = (state.pick.species?.[biome.id] ?? []).length;\n  badges.appendChild(createBadgeElement(`${speciesCount} specie`, ''));\n  if (biome.synthetic) {\n    badges.appendChild(createBadgeElement('Synth', 'synth'));\n  }\n  const headerTools = document.createElement('div');\n  headerTools.className = 'generator-card__header-tools';\n  headerTools.appendChild(badges);\n\n  const biomeLocked = isBiomeLocked(biome.id);\n  const lockButton = document.createElement('button');\n  lockButton.type = 'button';\n  lockButton.className = 'generator-card__lock';\n  lockButton.dataset.biomeId = biome.id;\n  const lockIcon = document.createElement('span');\n  lockIcon.className = 'generator-card__lock-icon';\n  lockIcon.textContent = biomeLocked ? '\uD83D\uDD12' : '\uD83D\uDD13';\n  lockButton.appendChild(lockIcon);\n  const lockLabel = document.createElement('span');\n  lockLabel.className = 'visually-hidden';\n  lockLabel.textContent = biomeLocked ? `Sblocca ${titleText}` : `Blocca ${titleText}`;\n  lockButton.appendChild(lockLabel);\n  lockButton.addEventListener('click', (event) => {\n    event.preventDefault();\n    const locked = toggleBiomeLock(biome);\n    lockIcon.textContent = locked ? '\uD83D\uDD12' : '\uD83D\uDD13';\n    lockLabel.textContent = locked ? `Sblocca ${titleText}` : `Blocca ${titleText}`;\n    card.dataset.locked = locked ? 'true' : 'false';\n  });\n  headerTools.appendChild(lockButton);\n\n  header.appendChild(headerTools);\n\n  const meta = document.createElement('p');\n  meta.className = 'generator-card__meta';\n  if (biome.synthetic) {\n    const parents = (biome.parents ?? [])\n      .map((parent) => parent.label ?? titleCase(parent.id ?? ''))\n      .filter(Boolean);\n    meta.textContent = parents.length\n      ? `Origine sintetica da ${parents.join(' + ')}`\n      : 'Origine sintetica procedurale.';\n  } else {\n    meta.textContent = biome.description ?? 'Bioma del catalogo originale.';\n  }\n  body.appendChild(meta);\n\n  if (biome.synthetic) {\n    const detailParts = [];\n    const zoneCount = Number.isFinite(biome.metrics?.zoneCount) ? biome.metrics.zoneCount : null;\n    if (zoneCount) {\n      detailParts.push(`${zoneCount} zone`);\n    }\n    if (biome.hazard?.severity) {\n      detailParts.push(`hazard ${formatHazardSeverity(biome.hazard.severity)}`);\n    }\n    if (Number.isFinite(biome.metrics?.resourceRichness) && biome.metrics.resourceRichness > 0) {\n      detailParts.push(`${biome.metrics.resourceRichness} risorse chiave`);\n    }\n    if (detailParts.length) {\n      const stats = document.createElement('p');\n      stats.className = 'generator-card__meta generator-card__meta--emphasis';\n      stats.textContent = detailParts.join(' \u00B7 ');\n      body.appendChild(stats);\n    }\n\n    const traitDetails = Array.isArray(biome.traits?.details) ? biome.traits.details : [];\n    if (traitDetails.length) {\n      const traitContainer = document.createElement('div');\n      traitContainer.className = 'generator-card__traits';\n      traitDetails.slice(0, 6).forEach((trait) => {\n        const chip = document.createElement('span');\n        chip.className = 'chip';\n        chip.textContent = trait.label ?? titleCase(trait.id ?? 'trait');\n        traitContainer.appendChild(chip);\n      });\n      if (traitDetails.length > 6) {\n        const remainder = document.createElement('span');\n        remainder.className = 'chip';\n        remainder.textContent = `+${traitDetails.length - 6}`;\n        traitContainer.appendChild(remainder);\n      }\n      body.appendChild(traitContainer);\n    }\n  }\n\n  if (!biome.synthetic) {\n    const links = document.createElement('div');\n    links.className = 'generator-card__links';\n    const biomeHref = resolvePackHref(biome.path);\n    if (biomeHref) {\n      const link = document.createElement('a');\n      link.href = biomeHref;\n      link.target = '_blank';\n      link.rel = 'noreferrer';\n      link.textContent = 'Bioma YAML';\n      links.appendChild(link);\n    }\n    const foodwebHref = biome.foodweb?.path ? resolvePackHref(biome.foodweb.path) : null;\n    if (foodwebHref) {\n      const link = document.createElement('a');\n      link.href = foodwebHref;\n      link.target = '_blank';\n      link.rel = 'noreferrer';\n      link.textContent = 'Foodweb';\n      links.appendChild(link);\n    }\n    try {\n      const reportHref = new URL(`catalog.html#bioma-${biome.id}`, window.location.href).toString();\n      const link = document.createElement('a');\n      link.href = reportHref;\n      link.textContent = 'Report';\n      links.appendChild(link);\n    } catch (error) {\n      console.warn('Impossibile calcolare il link al report del bioma', biome.id, error);\n    }\n    if (links.childElementCount) {\n      body.appendChild(links);\n    }\n  }\n\n  const speciesContainer = document.createElement('ul');\n  speciesContainer.className = 'generator-card__species';\n  speciesContainer.setAttribute('role', 'list');\n  const picked = state.pick.species?.[biome.id] ?? [];\n  if (!picked.length) {\n    const empty = document.createElement('li');\n    empty.className = 'generator-card__empty';\n    const filtersText = [];\n    if (filters.flags.length) filtersText.push(`flag: ${filters.flags.join(', ')}`);\n    if (filters.roles.length) filtersText.push(`ruoli: ${filters.roles.join(', ')}`);\n    if (filters.tags.length) filtersText.push(`tag: ${filters.tags.join(', ')}`);\n    empty.textContent = filtersText.length\n      ? `Nessuna specie soddisfa i filtri correnti (${filtersText.join(' \u00B7 ')}).`\n      : 'Nessuna specie estratta, effettua un nuovo re-roll.';\n    speciesContainer.appendChild(empty);\n  } else {\n    picked.forEach((sp) => {\n      const item = document.createElement('li');\n      item.className = 'generator-card__species-item';\n      item.appendChild(createSpeciesCard(biome, sp));\n      speciesContainer.appendChild(item);\n    });\n  }\n  body.appendChild(speciesContainer);\n\n  const traitInfo = gatherTraitInfoForBiome(biome);\n  const traitBlock = traitInfo\n    ? buildTraitBlock(traitInfo, { synthetic: Boolean(biome.synthetic) })\n    : null;\n  if (traitBlock) {\n    body.appendChild(traitBlock);\n  }\n\n  return card;\n}\n\nfunction buildCombinedRolePresets(roleStats) {\n  if (!(roleStats instanceof Map) || !roleStats.size) {\n    return [];\n  }\n\n  const entries = Array.from(roleStats.entries())\n    .map(([roleKey, info]) => {\n      const count = info?.count ?? 0;\n      if (!count) {\n        return null;\n      }\n      const totalSynergy = info?.synergy ?? 0;\n      const average = count ? Math.round(totalSynergy / count) : 0;\n      const label = roleKey\n        ? titleCase(String(roleKey).replace(/[_-]+/g, ' '))\n        : 'Ruolo indefinito';\n      const flags = info?.flags instanceof Set ? Array.from(info.flags) : [];\n      const tags = info?.tags instanceof Set ? Array.from(info.tags) : [];\n      return { role: roleKey, label, count, average, flags, tags };\n    })\n    .filter(Boolean)\n    .sort((a, b) => {\n      if (b.average === a.average) {\n        return b.count - a.count;\n      }\n      return b.average - a.average;\n    });\n\n  if (!entries.length) {\n    return [];\n  }\n\n  const presets = [];\n  const seen = new Set();\n\n  const registerPreset = (roleEntries) => {\n    if (!Array.isArray(roleEntries) || !roleEntries.length) return;\n    const key = roleEntries\n      .map((entry) => entry.role)\n      .filter(Boolean)\n      .sort()\n      .join('+');\n    if (!key || seen.has(key)) return;\n    const combinedFlags = new Set();\n    const combinedTags = new Set();\n    let weightedSum = 0;\n    let totalCount = 0;\n    roleEntries.forEach((entry) => {\n      entry.flags.forEach((flag) => combinedFlags.add(flag));\n      entry.tags.forEach((tag) => combinedTags.add(tag));\n      weightedSum += entry.average * entry.count;\n      totalCount += entry.count;\n    });\n    const average = totalCount\n      ? Math.round(weightedSum / totalCount)\n      : Math.round(roleEntries.reduce((sum, entry) => sum + entry.average, 0) / roleEntries.length);\n    const usage = roleEntries.reduce((sum, entry) => sum + entry.count, 0);\n    const filters = {\n      flags: Array.from(combinedFlags),\n      roles: roleEntries.map((entry) => entry.role),\n      tags: Array.from(combinedTags).slice(0, 4),\n    };\n    const label = roleEntries.map((entry) => entry.label).join(' + ');\n    presets.push({\n      id: `composer-${slugify(key) || slugify(label) || randomId('preset')}`,\n      label,\n      filters,\n      synergy: average,\n      usage,\n      highlightTags: filters.tags.slice(0, 3),\n    });\n    seen.add(key);\n  };\n\n  registerPreset([entries[0]]);\n\n  for (let i = 0; i < entries.length && presets.length < 4; i += 1) {\n    for (let j = i + 1; j < entries.length && presets.length < 4; j += 1) {\n      registerPreset([entries[i], entries[j]]);\n    }\n  }\n\n  if (presets.length < 4 && entries.length > 1) {\n    registerPreset(entries.slice(0, Math.min(entries.length, 3)));\n  }\n\n  return presets;\n}\n\nfunction buildComposerSuggestions({ heatmap, combinedPresets, constraints, flagStats }) {\n  const suggestions = [];\n  const minSynergy = Number.isFinite(constraints?.minSynergy) ? constraints.minSynergy : 0;\n  const populatedRows = Array.isArray(heatmap)\n    ? heatmap.filter(\n        (row) => Array.isArray(row?.values) && row.values.some((cell) => cell.count > 0),\n      )\n    : [];\n\n  if (populatedRows.length) {\n    const lowCells = [];\n    populatedRows.forEach((row) => {\n      row.values\n        .filter((cell) => cell.count > 0)\n        .forEach((cell) => {\n          if (cell.average < minSynergy) {\n            lowCells.push({ row, cell });\n          }\n        });\n    });\n    if (lowCells.length) {\n      lowCells.sort((a, b) => a.cell.average - b.cell.average);\n      const critical = lowCells[0];\n      suggestions.push({\n        tone: 'warn',\n        message: `${critical.row.label}: sinergia ${critical.cell.average}% su ${\n          ROLE_FLAG_LABELS[critical.cell.role] ?? critical.cell.role\n        }. Valuta un preset mirato o abbassa la soglia.`,\n      });\n    } else if (minSynergy > 0) {\n      suggestions.push({\n        tone: 'success',\n        message: `Tutte le combinazioni rispettano la soglia minima di ${minSynergy}%.`,\n      });\n    }\n  }\n\n  if (Array.isArray(combinedPresets) && combinedPresets.length) {\n    const topPreset = combinedPresets[0];\n    suggestions.push({\n      tone: 'info',\n      message: `Preset ${topPreset.label}: ${topPreset.synergy}% di sinergia media su ${topPreset.usage} occorrenze recenti.`,\n    });\n  }\n\n  if (flagStats instanceof Map) {\n    const missingRoles = ROLE_FLAGS.filter((flag) => {\n      const stat = flagStats.get(flag);\n      return !stat || !stat.count;\n    });\n    if (missingRoles.length) {\n      suggestions.push({\n        tone: 'info',\n        message: `Nessuna specie con flag ${missingRoles\n          .map((flag) => ROLE_FLAG_LABELS[flag] ?? flag)\n          .join(', ')} nei roll correnti.`,\n      });\n    }\n  }\n\n  if (!suggestions.length) {\n    suggestions.push({\n      tone: 'info',\n      message: 'Genera un ecosistema per sbloccare raccomandazioni dinamiche.',\n    });\n  }\n\n  return suggestions;\n}\n\nfunction renderComposerHeatmap(rows) {\n  const container = elements.composerHeatmap;\n  if (!container) return;\n  container.innerHTML = '';\n  if (!Array.isArray(rows) || !rows.length) {\n    const placeholder = document.createElement('p');\n    placeholder.className = 'generator-composer__empty';\n    placeholder.textContent = 'Genera un ecosistema per popolare la heatmap.';\n    container.appendChild(placeholder);\n    return;\n  }\n\n  const headerRow = document.createElement('div');\n  headerRow.className = 'generator-composer__heatmap-row generator-composer__heatmap-row--header';\n  const labelHeading = document.createElement('span');\n  labelHeading.className = 'generator-composer__heatmap-heading';\n  labelHeading.textContent = 'Bioma';\n  headerRow.appendChild(labelHeading);\n  ROLE_FLAGS.forEach((flag) => {\n    const heading = document.createElement('span');\n    heading.className = 'generator-composer__heatmap-heading';\n    heading.textContent = ROLE_FLAG_LABELS[flag] ?? titleCase(flag);\n    headerRow.appendChild(heading);\n  });\n  container.appendChild(headerRow);\n\n  rows.forEach((row) => {\n    const rowElement = document.createElement('div');\n    rowElement.className = 'generator-composer__heatmap-row';\n    const label = document.createElement('span');\n    label.className = 'generator-composer__heatmap-label';\n    label.textContent = row.label ?? titleCase(row.biomeId ?? 'Bioma');\n    rowElement.appendChild(label);\n    ROLE_FLAGS.forEach((flag) => {\n      const cell = Array.isArray(row.values)\n        ? row.values.find((entry) => entry.role === flag)\n        : null;\n      const cellElement = document.createElement('span');\n      cellElement.className = 'generator-composer__heatmap-cell';\n      const count = cell?.count ?? 0;\n      const average = cell?.average ?? 0;\n      cellElement.dataset.role = flag;\n      cellElement.dataset.count = String(count);\n      cellElement.dataset.synergy = String(average);\n      cellElement.textContent = count ? `${average}%` : '\u2014';\n      cellElement.title = count\n        ? `${count} specie \u00B7 ${ROLE_FLAG_LABELS[flag] ?? flag} \u00B7 sinergia ${average}%`\n        : `Nessuna specie con flag ${ROLE_FLAG_LABELS[flag] ?? flag}`;\n      applyHeatmapColor(cellElement, flag, average);\n      rowElement.appendChild(cellElement);\n    });\n    container.appendChild(rowElement);\n  });\n}\n\nfunction ensureComposerRadarChart() {\n  if (!elements.composerRadarCanvas) return null;\n  if (composerRadarChart) return composerRadarChart;\n  if (typeof Chart === 'undefined') {\n    if (!composerChartUnavailable) {\n      console.warn(\n        'Chart.js non disponibile: il radar sinergie della composizione avanzata rimarr\u00E0 nascosto.',\n      );\n      composerChartUnavailable = true;\n    }\n    return null;\n  }\n  const context = elements.composerRadarCanvas.getContext('2d');\n  if (!context) return null;\n  composerRadarChart = new Chart(context, {\n    type: 'radar',\n    data: {\n      labels: COMPOSER_RADAR_LABELS,\n      datasets: [],\n    },\n    options: {\n      responsive: true,\n      maintainAspectRatio: false,\n      scales: {\n        r: {\n          beginAtZero: true,\n          suggestedMax: 100,\n          ticks: {\n            stepSize: 20,\n            showLabelBackdrop: false,\n            color: 'rgba(148, 196, 255, 0.65)',\n          },\n          angleLines: { color: 'rgba(148, 196, 255, 0.2)' },\n          grid: { color: 'rgba(148, 196, 255, 0.12)' },\n          pointLabels: {\n            color: 'rgba(226, 240, 255, 0.82)',\n            font: { size: 11 },\n          },\n        },\n      },\n      plugins: {\n        legend: { display: false },\n        tooltip: {\n          backgroundColor: 'rgba(15, 23, 42, 0.92)',\n          borderColor: 'rgba(148, 196, 255, 0.35)',\n          borderWidth: 1,\n        },\n      },\n    },\n  });\n  return composerRadarChart;\n}\n\nfunction updateComposerRadarChart(values) {\n  if (!elements.composerRadarCanvas) return;\n  const chart = ensureComposerRadarChart();\n  if (!chart) return;\n  const data = Array.isArray(values) && values.length ? values : ROLE_FLAGS.map(() => 0);\n  const hasData = data.some((value) => Number.isFinite(value) && value > 0);\n  chart.data.labels = COMPOSER_RADAR_LABELS;\n  if (hasData) {\n    chart.data.datasets = [\n      {\n        label: 'Sinergia media',\n        data,\n        backgroundColor: 'rgba(88, 166, 255, 0.25)',\n        borderColor: 'rgba(88, 166, 255, 0.85)',\n        borderWidth: 2,\n        pointBackgroundColor: 'rgba(88, 166, 255, 0.95)',\n        pointBorderColor: 'rgba(4, 7, 14, 0.9)',\n        pointRadius: 3,\n        pointHoverRadius: 4,\n      },\n    ];\n  } else {\n    chart.data.datasets = [];\n  }\n  chart.update();\n}\n\nfunction renderComposerPanel() {\n  const panel = elements.composerPanel;\n  if (!panel) return;\n  const composerState = state.composer ?? {};\n  const constraints = composerState.constraints ?? {};\n  const preferred = ensurePreferredRoleSet();\n  const minValue = Number.isFinite(constraints.minSynergy) ? constraints.minSynergy : 0;\n\n  if (elements.composerSynergySlider) {\n    elements.composerSynergySlider.value = String(minValue);\n  }\n  if (elements.composerSynergyValue) {\n    elements.composerSynergyValue.textContent = `${minValue}%`;\n  }\n\n  const presets = Array.isArray(composerState.combinedPresets) ? composerState.combinedPresets : [];\n  const presetList = elements.composerPresetList;\n  if (presetList) {\n    presetList.innerHTML = '';\n    const hasPresets = presets.length > 0;\n    presetList.hidden = !hasPresets;\n    if (elements.composerPresetEmpty) {\n      elements.composerPresetEmpty.hidden = hasPresets;\n    }\n    if (hasPresets) {\n      presets.forEach((preset) => {\n        const item = document.createElement('li');\n        item.className = 'generator-composer__list-item';\n        item.dataset.presetId = preset.id;\n\n        const heading = document.createElement('div');\n        heading.className = 'generator-composer__list-heading';\n        const title = document.createElement('p');\n        title.className = 'generator-composer__preset-title';\n        title.textContent = preset.label;\n        heading.appendChild(title);\n        const badge = document.createElement('span');\n        badge.className = 'generator-composer__badge';\n        badge.textContent = `${preset.synergy}%`;\n        badge.title = 'Sinergia media stimata';\n        heading.appendChild(badge);\n        item.appendChild(heading);\n\n        const metrics = document.createElement('div');\n        metrics.className = 'generator-composer__metrics';\n        const roleMetric = document.createElement('span');\n        roleMetric.textContent = `Ruoli: ${preset.filters.roles\n          .map((role) => titleCase(String(role).replace(/[_-]+/g, ' ')))\n          .join(', ')}`;\n        metrics.appendChild(roleMetric);\n        const usageMetric = document.createElement('span');\n        usageMetric.textContent = `Utilizzo: ${preset.usage}`;\n        metrics.appendChild(usageMetric);\n        if (preset.highlightTags?.length) {\n          const tagMetric = document.createElement('span');\n          tagMetric.textContent = `Tag: ${preset.highlightTags.join(', ')}`;\n          metrics.appendChild(tagMetric);\n        }\n        item.appendChild(metrics);\n\n        const applyButton = document.createElement('button');\n        applyButton.type = 'button';\n        applyButton.className = 'button button--ghost generator-composer__apply';\n        applyButton.dataset.action = 'composer-apply-preset';\n        applyButton.dataset.presetId = preset.id;\n        applyButton.textContent = 'Applica preset';\n        item.appendChild(applyButton);\n\n        presetList.appendChild(item);\n      });\n    }\n  }\n\n  const toggles = elements.composerRoleToggles;\n  if (toggles) {\n    toggles.innerHTML = '';\n    const roleStats = composerState.roleStats instanceof Map ? composerState.roleStats : new Map();\n    const roleEntries = Array.from(roleStats.entries())\n      .map(([roleKey, info]) => {\n        const count = info?.count ?? 0;\n        if (!count) return null;\n        const totalSynergy = info?.synergy ?? 0;\n        const average = count ? Math.round(totalSynergy / count) : 0;\n        return {\n          role: roleKey,\n          label: titleCase(String(roleKey).replace(/[_-]+/g, ' ')),\n          count,\n          average,\n        };\n      })\n      .filter(Boolean)\n      .sort((a, b) => {\n        if (b.count === a.count) {\n          return b.average - a.average;\n        }\n        return b.count - a.count;\n      });\n\n    if (!roleEntries.length) {\n      const empty = document.createElement('p');\n      empty.className = 'generator-composer__empty';\n      empty.textContent = 'Nessun ruolo analizzato nei roll correnti.';\n      toggles.appendChild(empty);\n    } else {\n      roleEntries.forEach((entry) => {\n        const label = document.createElement('label');\n        label.className = 'generator-composer__role-toggle';\n        const input = document.createElement('input');\n        input.type = 'checkbox';\n        input.dataset.roleKey = entry.role;\n        input.checked = preferred.has(entry.role);\n        label.appendChild(input);\n        const text = document.createElement('span');\n        text.textContent = `${entry.label} (${entry.count})`;\n        label.appendChild(text);\n        toggles.appendChild(label);\n      });\n    }\n  }\n\n  const suggestionList = elements.composerSuggestions;\n  if (suggestionList) {\n    suggestionList.innerHTML = '';\n    const suggestions = Array.isArray(composerState.suggestions) ? composerState.suggestions : [];\n    const hasSuggestions = suggestions.length > 0;\n    suggestionList.hidden = !hasSuggestions;\n    if (elements.composerSuggestionsEmpty) {\n      elements.composerSuggestionsEmpty.hidden = hasSuggestions;\n    }\n    suggestions.forEach((entry) => {\n      const item = document.createElement('li');\n      const tone = entry?.tone ? String(entry.tone).toUpperCase() : null;\n      const message = entry?.message ?? '';\n      item.textContent = tone ? `[${tone}] ${message}` : message;\n      suggestionList.appendChild(item);\n    });\n  }\n\n  const radarValues = composerState.metrics?.radar ?? [];\n  updateComposerRadarChart(radarValues);\n  renderComposerHeatmap(composerState.metrics?.heatmap ?? []);\n}\n\nfunction updateComposerState(filters) {\n  if (!elements.composerPanel) return;\n  const roleStats = new Map();\n  const flagStats = new Map(ROLE_FLAGS.map((flag) => [flag, { count: 0, synergy: 0 }]));\n  const heatmapRows = [];\n\n  const biomes = Array.isArray(state.pick?.biomes) ? state.pick.biomes : [];\n  const speciesBuckets = state.pick?.species ?? {};\n\n  biomes.forEach((biome) => {\n    const bucket = Array.isArray(speciesBuckets[biome.id]) ? speciesBuckets[biome.id] : [];\n    const row = {\n      biomeId: biome.id,\n      label: biome.label ?? titleCase(biome.id ?? 'Bioma'),\n      values: ROLE_FLAGS.map((flag) => ({\n        role: flag,\n        count: 0,\n        synergy: 0,\n        average: 0,\n      })),\n    };\n    const valueMap = new Map(row.values.map((entry) => [entry.role, entry]));\n\n    bucket.forEach((species) => {\n      if (!species) return;\n      const synergy = calculateSynergy(species, biome);\n      const roleKey = species.role_trofico ?? 'ruolo_indefinito';\n      let stats = roleStats.get(roleKey);\n      if (!stats) {\n        stats = {\n          role: roleKey,\n          count: 0,\n          synergy: 0,\n          flags: new Set(),\n          tags: new Set(),\n        };\n        roleStats.set(roleKey, stats);\n      }\n      stats.count += 1;\n      stats.synergy += synergy.percent;\n      (species.functional_tags ?? []).forEach((tag) => {\n        if (tag) stats.tags.add(tag);\n      });\n      ROLE_FLAGS.forEach((flag) => {\n        if (species.flags?.[flag]) {\n          stats.flags.add(flag);\n          const cell = valueMap.get(flag);\n          if (cell) {\n            cell.count += 1;\n            cell.synergy += synergy.percent;\n          }\n          const global = flagStats.get(flag);\n          if (global) {\n            global.count += 1;\n            global.synergy += synergy.percent;\n          }\n        }\n      });\n    });\n\n    row.values.forEach((cell) => {\n      cell.average = cell.count ? Math.round(cell.synergy / cell.count) : 0;\n    });\n    heatmapRows.push(row);\n  });\n\n  const radarValues = ROLE_FLAGS.map((flag) => {\n    const stat = flagStats.get(flag);\n    if (!stat || !stat.count) return 0;\n    return Math.round(stat.synergy / stat.count);\n  });\n\n  const combinedPresets = buildCombinedRolePresets(roleStats);\n  const suggestions = buildComposerSuggestions({\n    heatmap: heatmapRows,\n    combinedPresets,\n    constraints: state.composer?.constraints ?? {},\n    flagStats,\n  });\n\n  state.composer.metrics = { radar: radarValues, heatmap: heatmapRows };\n  state.composer.roleStats = roleStats;\n  state.composer.combinedPresets = combinedPresets;\n  state.composer.suggestions = suggestions;\n  state.metrics.roleUsage = roleStats;\n\n  renderComposerPanelView();\n}\n\nfunction applyComposerPreset(preset) {\n  if (!preset) return;\n  const filters = {\n    flags: Array.isArray(preset.filters?.flags) ? preset.filters.flags : [],\n    roles: Array.isArray(preset.filters?.roles) ? preset.filters.roles : [],\n    tags: Array.isArray(preset.filters?.tags) ? preset.filters.tags : [],\n  };\n  applyFiltersToForm(filters);\n  const preferred = ensurePreferredRoleSet();\n  preferred.clear();\n  filters.roles.forEach((role) => {\n    if (role) preferred.add(role);\n  });\n  renderComposerPanelView();\n  if (state.pick.biomes.length) {\n    const current = currentFilters();\n    rerollSpecies(current);\n    renderBiomesPanel(current);\n    rerollSeeds(current);\n    renderSeedsPanel();\n  }\n  setStatus(`Preset ${preset.label} applicato.`, 'success', {\n    tags: ['composer', 'preset'],\n    action: 'composer-apply-preset',\n    metadata: {\n      presetId: preset.id,\n      synergy: preset.synergy,\n      usage: preset.usage,\n    },\n  });\n}\n\nfunction applyComposerConstraintUpdate({ announce = false } = {}) {\n  renderComposerPanelView();\n  if (!state.pick.biomes.length) return;\n  const filters = currentFilters();\n  rerollSpecies(filters);\n  renderBiomesPanel(filters);\n  rerollSeeds(filters);\n  renderSeedsPanel();\n  if (announce) {\n    const value = Number.isFinite(state.composer?.constraints?.minSynergy)\n      ? state.composer.constraints.minSynergy\n      : 0;\n    setStatus(`Vincoli di sinergia aggiornati (\u2265 ${value}%).`, 'info', {\n      tags: ['composer', 'sinergia'],\n      action: 'composer-constraints-update',\n    });\n  }\n}\n\nfunction attachComposerHandlers() {\n  const panel = elements.composerPanel;\n  if (!panel) return;\n  ensurePreferredRoleSet();\n  const slider = elements.composerSynergySlider;\n  if (slider) {\n    slider.addEventListener('input', (event) => {\n      const value = Number.parseInt(event.target.value, 10) || 0;\n      if (elements.composerSynergyValue) {\n        elements.composerSynergyValue.textContent = `${value}%`;\n      }\n    });\n    slider.addEventListener('change', (event) => {\n      const value = Number.parseInt(event.target.value, 10) || 0;\n      state.composer.constraints.minSynergy = Math.max(0, Math.min(100, value));\n      applyComposerConstraintUpdate({ announce: true });\n    });\n  }\n  const toggles = elements.composerRoleToggles;\n  if (toggles) {\n    toggles.addEventListener('change', (event) => {\n      const target = event.target;\n      if (!(target instanceof HTMLInputElement)) return;\n      if (target.type !== 'checkbox') return;\n      const { roleKey } = target.dataset;\n      if (!roleKey) return;\n      const preferred = ensurePreferredRoleSet();\n      if (target.checked) {\n        preferred.add(roleKey);\n      } else {\n        preferred.delete(roleKey);\n      }\n      applyComposerConstraintUpdate({ announce: Boolean(state.pick.biomes.length) });\n    });\n  }\n\n  panel.addEventListener('click', (event) => {\n    const button =\n      event.target instanceof HTMLElement ? event.target.closest('[data-action]') : null;\n    if (!(button instanceof HTMLElement)) return;\n    const { action } = button.dataset;\n    if (action === 'composer-apply-preset') {\n      const { presetId } = button.dataset;\n      if (!presetId) return;\n      const preset = (state.composer?.combinedPresets ?? []).find((entry) => entry.id === presetId);\n      if (!preset) return;\n      applyComposerPreset(preset);\n    }\n  });\n}\n\nfunction renderBiomes(filters) {\n  updateSummaryCounts();\n  const grid = elements.biomeGrid;\n  if (!grid) return;\n  grid.innerHTML = '';\n\n  const removed = syncComparisonStore();\n  if (removed) {\n    const label = removed === 1 ? 'Una specie' : `${removed} specie`;\n    setStatus(`${label} rimosse dal confronto perch\u00E9 non pi\u00F9 disponibili.`, 'warn', {\n      tags: ['confronto', 'sync'],\n      action: 'compare-sync-remove',\n    });\n  }\n\n  if (!state.pick.biomes.length) {\n    const placeholder = document.createElement('p');\n    placeholder.className = 'placeholder';\n    placeholder.textContent = 'Genera un ecosistema per iniziare.';\n    grid.appendChild(placeholder);\n    renderComparisonPanel();\n    updateComposerState(filters);\n    return;\n  }\n\n  state.pick.biomes.forEach((biome) => {\n    grid.appendChild(buildBiomeCard(biome, filters));\n  });\n  updateComposerState(filters);\n  renderComparisonPanel();\n}\n\nfunction renderPinnedSummary() {\n  const list = elements.pinnedList;\n  const empty = elements.pinnedEmpty;\n  if (!list) return;\n\n  const entries = Array.from(state.cardState.pinned.values());\n  list.innerHTML = '';\n  const hasEntries = entries.length > 0;\n  list.hidden = !hasEntries;\n  if (empty) {\n    empty.hidden = hasEntries;\n  }\n  if (elements.summaryContainer) {\n    elements.summaryContainer.dataset.hasPins = hasEntries ? 'true' : 'false';\n  }\n  if (!hasEntries) {\n    renderFlowMap();\n    return;\n  }\n\n  entries.forEach((entry) => {\n    const item = document.createElement('li');\n    item.className = 'generator-pins__item';\n    item.dataset.pinKey = entry.key;\n\n    const stillPresent = Boolean(findSpeciesInPick(entry.biomeId, entry.speciesId));\n    if (!stillPresent) {\n      item.dataset.state = 'stale';\n    }\n\n    const header = document.createElement('div');\n    header.className = 'generator-pins__header';\n\n    const name = document.createElement('span');\n    name.className = 'generator-pins__name';\n    name.textContent = entry.displayName;\n    header.appendChild(name);\n\n    const controls = document.createElement('div');\n    controls.className = 'generator-pins__controls';\n\n    const rarityBadge = createBadgeElement(entry.rarity, `rarity-${entry.slug}`);\n    rarityBadge.classList.add('generator-pins__badge');\n    controls.appendChild(rarityBadge);\n\n    const unpin = document.createElement('button');\n    unpin.type = 'button';\n    unpin.className = 'generator-pins__unpin';\n    unpin.textContent = 'Rimuovi';\n    unpin.addEventListener('click', (event) => {\n      event.preventDefault();\n      const biome = findBiomeById(entry.biomeId) ?? {\n        id: entry.biomeId,\n        label: entry.biomeLabel,\n        synthetic: entry.synthetic,\n      };\n      const species = findSpeciesInPick(entry.biomeId, entry.speciesId) ?? {\n        id: entry.speciesId,\n        display_name: entry.displayName,\n        balance: { threat_tier: `T${entry.tier}` },\n        synthetic: entry.synthetic,\n      };\n      togglePinned(biome, species);\n    });\n    controls.appendChild(unpin);\n\n    header.appendChild(controls);\n    item.appendChild(header);\n\n    const meta = document.createElement('span');\n    meta.className = 'generator-pins__meta';\n    const metaParts = [entry.biomeLabel, `T${entry.tier}`];\n    if (entry.synthetic) {\n      metaParts.push('Synth');\n    }\n    if (!stillPresent) {\n      metaParts.push('fuori rotazione');\n    }\n    meta.textContent = metaParts.join(' \u00B7 ');\n    item.appendChild(meta);\n\n    list.appendChild(item);\n  });\n\n  renderFlowMap();\n}\nfunction renderSeeds() {\n  updateSummaryCounts();\n  const container = elements.seedGrid;\n  if (!container) return;\n  container.innerHTML = '';\n\n  if (!state.pick.seeds.length) {\n    const placeholder = document.createElement('p');\n    placeholder.className = 'placeholder';\n    placeholder.textContent = 'Genera un ecosistema per ottenere encounter seed.';\n    container.appendChild(placeholder);\n    return;\n  }\n\n  state.pick.seeds.forEach((seed) => {\n    const card = document.createElement('article');\n    card.className = 'card';\n    card.setAttribute('role', 'listitem');\n\n    const header = document.createElement('h3');\n    const headingParts = [seed.biome_id];\n    if (seed.label) {\n      headingParts.push(seed.label);\n    }\n    if (seed.synthetic) {\n      headingParts.push('Synth');\n    }\n    header.innerHTML = `${headingParts.join(' \u00B7 ')} \u00B7 <span class=\"form__hint\">Budget T${seed.threat_budget}</span>`;\n\n    if (seed.description || seed.notes) {\n      const meta = document.createElement('p');\n      meta.className = 'form__hint';\n      const metaParts = [];\n      if (seed.description) metaParts.push(seed.description);\n      if (seed.notes) metaParts.push(seed.notes);\n      meta.textContent = metaParts.join(' \u00B7 ');\n      card.append(header, meta);\n    } else {\n      card.append(header);\n    }\n\n    const list = document.createElement('ul');\n    if (!seed.party.length) {\n      const empty = document.createElement('li');\n      empty.className = 'placeholder';\n      empty.textContent = 'Nessuna specie disponibile per questo seed con i filtri selezionati.';\n      list.appendChild(empty);\n    } else {\n      seed.party.forEach((entry) => {\n        const item = document.createElement('li');\n        const parts = [entry.id, entry.role ?? '\u2014', `T${entry.tier}`];\n        if (entry.count && entry.count > 1) {\n          parts.push(`x${entry.count}`);\n        }\n        if (entry.sources || entry.synthetic) {\n          parts.push('Synth');\n        }\n        item.innerHTML = `${entry.display_name} <span class=\"form__hint\">(${parts.join(' \u00B7 ')})</span>`;\n        list.appendChild(item);\n      });\n    }\n\n    card.append(list);\n    container.appendChild(card);\n  });\n}\n\nfunction exportPayload(filters) {\n  const catalogSource =\n    resolvedCatalogUrl ||\n    packContext?.catalogUrl ||\n    resolvedPackRoot ||\n    packContext?.resolvedBase ||\n    null;\n  return {\n    pick: state.pick,\n    filters,\n    source: {\n      catalog: catalogSource,\n      generated_at: new Date().toISOString(),\n    },\n    composer: buildComposerExportSnapshot(),\n  };\n}\n\nfunction exportActivityLogEntries() {\n  if (!Array.isArray(state.activityLog) || !state.activityLog.length) {\n    return [];\n  }\n  return state.activityLog\n    .map(serialiseActivityLogEntry)\n    .filter(Boolean)\n    .sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());\n}\n\nfunction downloadFile(name, content, type) {\n  const blob =\n    content instanceof Blob\n      ? content\n      : new Blob([content], { type: type ?? 'application/octet-stream' });\n  const url = URL.createObjectURL(blob);\n  const anchor = document.createElement('a');\n  anchor.href = url;\n  anchor.download = name;\n  anchor.click();\n  URL.revokeObjectURL(url);\n}\n\nfunction buildTraitRegistryCandidates(context) {\n  const candidates = new Set();\n  if (context) {\n    candidates.add('env_traits.json');\n    candidates.add('docs/catalog/env_traits.json');\n  }\n  return Array.from(candidates).filter(Boolean);\n}\n\nfunction buildTraitReferenceCandidates(context) {\n  const candidates = new Set([\n    'traits/index.json',\n    'trait_reference.json',\n    'trait-reference.json',\n    'docs/catalog/trait_reference.json',\n    'docs/catalog/trait-reference.json',\n    'data/traits/index.json',\n  ]);\n  return Array.from(candidates).filter(Boolean);\n}\n\nfunction buildTraitGlossaryCandidates(context, hint) {\n  const normalizedHint = typeof hint === 'string' ? hint.trim() : '';\n  const baseCandidates = [\n    normalizedHint,\n    'trait_glossary.json',\n    'trait-glossary.json',\n    'data/core/traits/glossary.json',\n  ].filter(Boolean);\n  const candidates = new Set();\n  baseCandidates.forEach((name) => {\n    candidates.add(name);\n    if (!name.startsWith('docs/')) {\n      candidates.add(`docs/catalog/${name}`);\n    }\n  });\n  return Array.from(candidates).filter(Boolean);\n}\n\nfunction buildHazardRegistryCandidates() {\n  return ['hazards.json', 'docs/catalog/hazards.json'];\n}\n\nasync function loadTraitRegistry(context) {\n  try {\n    const result = await fetchTraitRegistry({\n      context,\n      candidates: buildTraitRegistryCandidates(context),\n    });\n    if (result?.data) {\n      setTraitRegistry(result.data);\n      if (result.fromFallback) {\n        setStatus('Registro tratti caricato dal fallback locale.', 'info', {\n          tags: ['catalogo', 'traits', 'fallback'],\n          action: 'traits-registry-fallback',\n          metadata: { url: result.url ?? undefined },\n        });\n      }\n      return;\n    }\n  } catch (error) {\n    console.warn('Caricamento registry tratti fallito', error);\n    setStatus('Errore durante il caricamento del registro tratti.', 'warn', {\n      tags: ['catalogo', 'traits', 'errore'],\n      action: 'traits-registry-error-fetch',\n      metadata: { reason: error instanceof Error ? error.message : String(error ?? '') },\n    });\n  }\n  console.warn('Nessuna sorgente valida per il registry tratti trovata.');\n  setTraitRegistry({ schema_version: '0', rules: [] });\n  setStatus('Impossibile caricare il registro dei tratti.', 'error', {\n    tags: ['catalogo', 'traits', 'errore'],\n    action: 'traits-registry-error',\n  });\n}\n\nasync function loadTraitReference(context) {\n  try {\n    const result = await fetchTraitReference({\n      context,\n      candidates: buildTraitReferenceCandidates(context),\n    });\n    if (result?.data) {\n      setTraitReference(result.data);\n      if (result.fromFallback) {\n        setStatus('Reference tratti caricato dal fallback locale.', 'info', {\n          tags: ['catalogo', 'traits', 'fallback'],\n          action: 'traits-reference-fallback',\n          metadata: { url: result.url ?? undefined },\n        });\n      }\n      if (result.data?.trait_glossary && !state.traitGlossary) {\n        await loadTraitGlossary(context, result.data.trait_glossary);\n      }\n      return;\n    }\n  } catch (error) {\n    console.warn('Caricamento reference tratti fallito', error);\n    setStatus('Errore durante il caricamento del reference tratti.', 'warn', {\n      tags: ['catalogo', 'traits', 'errore'],\n      action: 'traits-reference-error-fetch',\n      metadata: { reason: error instanceof Error ? error.message : String(error ?? '') },\n    });\n  }\n  console.warn('Nessuna sorgente valida per il reference tratti trovata.');\n  setTraitReference({ schema_version: '0', traits: {} });\n  setStatus('Impossibile caricare il reference dei tratti.', 'error', {\n    tags: ['catalogo', 'traits', 'errore'],\n    action: 'traits-reference-error',\n  });\n}\n\nasync function loadTraitGlossary(context, hint) {\n  try {\n    const result = await fetchTraitGlossary({\n      context,\n      candidates: buildTraitGlossaryCandidates(context, hint),\n    });\n    if (result?.data) {\n      setTraitGlossary(result.data);\n      if (result.fromFallback) {\n        setStatus('Glossario tratti caricato dal fallback locale.', 'info', {\n          tags: ['catalogo', 'traits', 'fallback'],\n          action: 'traits-glossary-fallback',\n          metadata: { url: result.url ?? undefined },\n        });\n      }\n      return;\n    }\n  } catch (error) {\n    console.warn('Caricamento glossario tratti fallito', error);\n    setStatus('Errore durante il caricamento del glossario tratti.', 'warn', {\n      tags: ['catalogo', 'traits', 'errore'],\n      action: 'traits-glossary-error-fetch',\n      metadata: { reason: error instanceof Error ? error.message : String(error ?? '') },\n    });\n  }\n  console.warn('Nessuna sorgente valida per il glossario tratti trovata.');\n  setTraitGlossary(null);\n  setStatus('Impossibile caricare il glossario dei tratti.', 'error', {\n    tags: ['catalogo', 'traits', 'errore'],\n    action: 'traits-glossary-error',\n  });\n}\n\nasync function loadHazardRegistry(context) {\n  try {\n    const result = await fetchHazardRegistry({\n      context,\n      candidates: buildHazardRegistryCandidates(),\n    });\n    if (result?.data) {\n      setHazardRegistry(result.data);\n      if (result.fromFallback) {\n        setStatus('Registro hazard caricato dal fallback locale.', 'info', {\n          tags: ['catalogo', 'hazard', 'fallback'],\n          action: 'hazard-registry-fallback',\n          metadata: { url: result.url ?? undefined },\n        });\n      }\n      return;\n    }\n  } catch (error) {\n    console.warn('Caricamento registry hazard fallito', error);\n    setStatus('Errore durante il caricamento del registro hazard.', 'warn', {\n      tags: ['catalogo', 'hazard', 'errore'],\n      action: 'hazard-registry-error-fetch',\n      metadata: { reason: error instanceof Error ? error.message : String(error ?? '') },\n    });\n  }\n  console.warn('Nessuna sorgente valida per il registry hazard trovata.');\n  setHazardRegistry({ schema_version: '0', hazards: {} });\n  setStatus('Impossibile caricare il registro degli hazard.', 'error', {\n    tags: ['catalogo', 'hazard', 'errore'],\n    action: 'hazard-registry-error',\n  });\n}\n\nasync function loadSpeciesIndex(context) {\n  try {\n    const result = await fetchSpecies({ context, speciesId: null });\n    if (result?.data) {\n      state.data = state.data || {};\n      state.data.speciesIndex = result.data;\n      if (result.fromFallback) {\n        setStatus('Indice specie caricato dal fallback locale.', 'info', {\n          tags: ['catalogo', 'species', 'fallback'],\n          action: 'species-index-fallback',\n          metadata: { url: result.url ?? undefined },\n        });\n      }\n    }\n  } catch (error) {\n    console.warn('Indice specie non disponibile', error);\n  }\n}\n\nfunction attachActions() {\n  if (!elements.form) return;\n  elements.form.addEventListener('click', async (event) => {\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) return;\n    const action = target.dataset.action;\n    if (!action) return;\n    event.preventDefault();\n    if (!state.data) {\n      setStatus('Caricare i dati prima di utilizzare il generatore.', 'error', {\n        tags: ['guardia', 'catalogo'],\n        action: 'guard-catalog',\n      });\n      return;\n    }\n    const filters = currentFilters();\n    switch (action) {\n      case 'roll-ecos': {\n        const requested = Math.max(1, Math.min(parseInt(elements.nBiomi.value, 10) || 2, 6));\n        const lockedBiomes = state.pick.biomes.filter((biome) => isBiomeLocked(biome.id));\n        const targetCount = Math.max(requested, lockedBiomes.length || 0);\n        if (elements.nBiomi && targetCount !== requested) {\n          elements.nBiomi.value = String(targetCount);\n        }\n        const toGenerate = Math.max(0, targetCount - lockedBiomes.length);\n        let generated = [];\n        let meta = null;\n        if (toGenerate > 0) {\n          try {\n            const response = await requestBiomeSynthesis(toGenerate, filters);\n            generated = normaliseBiomeCollection(response.biomes);\n            meta = response.meta ?? null;\n            if (!generated.length) {\n              throw new Error('Nessun bioma sintetico restituito dal worker');\n            }\n          } catch (error) {\n            console.warn('Generazione biomi remota fallita', error);\n            setStatus('Worker biomi non disponibile, uso fallback locale.', 'warn', {\n              tags: ['roll', 'ecosistema', 'fallback'],\n              action: 'roll-ecos-fallback',\n              metadata: { reason: error instanceof Error ? error.message : String(error ?? '') },\n            });\n            generated = fallbackGenerateBiomes(state.data.biomi, toGenerate);\n            meta = null;\n          }\n        }\n        const combined = [...lockedBiomes.slice(0, targetCount), ...generated].slice(\n          0,\n          targetCount,\n        );\n        state.pick.ecosystem = {\n          id: randomId('ecos'),\n          label: `Rete sintetica (${combined.length} biomi)`,\n          synthetic: true,\n          sources: state.data.ecosistema?.biomi?.map((b) => b.id) ?? [],\n          connessioni: synthesiseConnections(combined),\n        };\n        state.pick.biomes = combined;\n        state.lastGenerationMeta = meta;\n        state.pick.exportSlug = null;\n        rerollSpecies(filters);\n        rerollSeeds(filters);\n        renderBiomesPanel(filters);\n        renderSeedsPanel();\n        focusSummaryPanel();\n        const narrativeContext = updateNarrativePrompts(filters);\n        const summaryParts = [];\n        if (meta?.applied?.hazard) {\n          summaryParts.push(`hazard ${formatHazardSeverity(meta.applied.hazard)}`);\n        }\n        if (meta?.applied?.climate) {\n          summaryParts.push(`clima ${titleCase(meta.applied.climate)}`);\n        }\n        const metaSuffix = summaryParts.length ? ` (${summaryParts.join(' \u00B7 ')})` : '';\n        setStatus(\n          `Generati ${state.pick.biomes.length} biomi sintetici e ${state.pick.seeds.length} seed${metaSuffix}.`,\n          'success',\n          {\n            tags: ['roll', 'ecosistema'],\n            action: 'roll-ecos',\n            rare: Boolean(narrativeContext?.isHighThreat),\n            rareTarget: narrativeContext?.rareReason ?? undefined,\n          },\n        );\n        recordHistoryEntry('roll-ecos', filters);\n        break;\n      }\n      case 'reroll-biomi': {\n        if (!state.pick.biomes.length) {\n          setStatus('Genera prima un ecosistema completo.', 'warn', {\n            tags: ['guardia', 'reroll', 'biomi'],\n            action: 'guard-reroll-biomi',\n          });\n          return;\n        }\n        const requested = Math.max(\n          1,\n          Math.min(parseInt(elements.nBiomi.value, 10) || state.pick.biomes.length, 6),\n        );\n        const lockedBiomes = state.pick.biomes.filter((biome) => isBiomeLocked(biome.id));\n        const targetCount = Math.max(requested, lockedBiomes.length || 0);\n        if (elements.nBiomi && targetCount !== requested) {\n          elements.nBiomi.value = String(targetCount);\n        }\n        const toGenerate = Math.max(0, targetCount - lockedBiomes.length);\n        let regenerated = [];\n        let meta = null;\n        if (toGenerate > 0) {\n          try {\n            const response = await requestBiomeSynthesis(toGenerate, filters);\n            regenerated = normaliseBiomeCollection(response.biomes);\n            meta = response.meta ?? null;\n            if (!regenerated.length) {\n              throw new Error('Nessun bioma sintetico restituito dal worker');\n            }\n          } catch (error) {\n            console.warn('Reroll biomi remoto fallito', error);\n            setStatus('Worker biomi non disponibile, uso fallback locale.', 'warn', {\n              tags: ['reroll', 'biomi', 'fallback'],\n              action: 'reroll-biomi-fallback',\n              metadata: { reason: error instanceof Error ? error.message : String(error ?? '') },\n            });\n            regenerated = fallbackGenerateBiomes(state.data.biomi, toGenerate);\n            meta = null;\n          }\n        }\n        const combined = [...lockedBiomes.slice(0, targetCount), ...regenerated].slice(\n          0,\n          targetCount,\n        );\n        state.pick.biomes = combined;\n        state.lastGenerationMeta = meta;\n        state.pick.ecosystem = {\n          id: state.pick.ecosystem?.id || randomId('ecos'),\n          label: `Rete sintetica (${combined.length} biomi)`,\n          synthetic: true,\n          sources: state.data.ecosistema?.biomi?.map((b) => b.id) ?? [],\n          connessioni: synthesiseConnections(combined),\n        };\n        state.pick.exportSlug = null;\n        rerollSpecies(filters);\n        rerollSeeds(filters);\n        renderBiomesPanel(filters);\n        renderSeedsPanel();\n        focusSummaryPanel();\n        const narrativeContext = updateNarrativePrompts(filters);\n        const rerollSummary = [];\n        if (meta?.applied?.hazard) {\n          rerollSummary.push(`hazard ${formatHazardSeverity(meta.applied.hazard)}`);\n        }\n        if (meta?.applied?.climate) {\n          rerollSummary.push(`clima ${titleCase(meta.applied.climate)}`);\n        }\n        const rerollSuffix = rerollSummary.length ? ` (${rerollSummary.join(' \u00B7 ')})` : '';\n        setStatus(`Biomi sintetici ricalcolati con i filtri correnti${rerollSuffix}.`, 'success', {\n          tags: ['reroll', 'biomi'],\n          action: 'reroll-biomi',\n          rare: Boolean(narrativeContext?.isHighThreat),\n          rareTarget: narrativeContext?.rareReason ?? undefined,\n        });\n        recordHistoryEntry('reroll-biomi', filters);\n        break;\n      }\n      case 'reroll-species': {\n        if (!state.pick.biomes.length) {\n          setStatus('Genera prima un ecosistema per estrarre le specie.', 'warn', {\n            tags: ['guardia', 'reroll', 'specie'],\n            action: 'guard-reroll-species',\n          });\n          return;\n        }\n        rerollSpecies(filters);\n        renderBiomesPanel(filters);\n        focusSummaryPanel();\n        const narrativeContext = updateNarrativePrompts(filters);\n        setStatus('Specie ricalcolate.', 'success', {\n          tags: ['reroll', 'specie'],\n          action: 'reroll-species',\n          rare: Boolean(narrativeContext?.isHighThreat),\n          rareTarget: narrativeContext?.rareReason ?? undefined,\n        });\n        recordHistoryEntry('reroll-species', filters);\n        break;\n      }\n      case 'reroll-seeds': {\n        if (!state.pick.biomes.length) {\n          setStatus('Genera prima un ecosistema per creare gli encounter seed.', 'warn', {\n            tags: ['guardia', 'reroll', 'seed'],\n            action: 'guard-reroll-seeds',\n          });\n          return;\n        }\n        rerollSeeds(filters);\n        renderSeedsPanel();\n        focusSummaryPanel();\n        const narrativeContext = updateNarrativePrompts(filters);\n        setStatus('Seed rigenerati.', 'success', {\n          tags: ['reroll', 'seed'],\n          action: 'reroll-seeds',\n          rare: Boolean(narrativeContext?.isHighThreat),\n          rareTarget: narrativeContext?.rareReason ?? undefined,\n        });\n        recordHistoryEntry('reroll-seeds', filters);\n        break;\n      }\n      case 'export-json': {\n        const payload = exportPayload(filters);\n        const slug = ensureExportSlug();\n        downloadFile(`${slug}.json`, JSON.stringify(payload, null, 2), 'application/json');\n        markCurrentPresetByBuilder('ecosystem-json');\n        renderParametersPanel({ refresh: ['export'], filters });\n        setStatus('Esportazione JSON completata.', 'success', {\n          tags: ['export', 'json'],\n          action: 'export-json',\n        });\n        break;\n      }\n      case 'export-yaml': {\n        const payload = exportPayload(filters);\n        const yaml = toYAML(payload);\n        const slug = ensureExportSlug();\n        downloadFile(`${slug}.yaml`, yaml, 'text/yaml');\n        markCurrentPresetByBuilder('ecosystem-yaml');\n        renderParametersPanel({ refresh: ['export'], filters });\n        setStatus('Esportazione YAML completata.', 'success', {\n          tags: ['export', 'yaml'],\n          action: 'export-yaml',\n        });\n        break;\n      }\n      case 'export-log-json': {\n        if (!state.activityLog.length) {\n          setStatus('Il registro attivit\u00E0 \u00E8 vuoto, nulla da esportare.', 'warn', {\n            tags: ['export', 'log', 'vuoto'],\n            action: 'export-log-empty',\n          });\n          break;\n        }\n        const entries = exportActivityLogEntries();\n        const slug = ensureExportSlug();\n        downloadFile(`${slug}-log.json`, JSON.stringify(entries, null, 2), 'application/json');\n        markCurrentPresetByBuilder('activity-json');\n        renderParametersPanel({ refresh: ['export'], filters });\n        setStatus('Registro attivit\u00E0 esportato in JSON.', 'success', {\n          tags: ['export', 'log', 'json'],\n          action: 'export-log-json',\n        });\n        break;\n      }\n      case 'export-log-csv': {\n        if (!state.activityLog.length) {\n          setStatus('Il registro attivit\u00E0 \u00E8 vuoto, nulla da esportare.', 'warn', {\n            tags: ['export', 'log', 'vuoto'],\n            action: 'export-log-empty',\n          });\n          break;\n        }\n        const entries = exportActivityLogEntries();\n        const slug = ensureExportSlug();\n        downloadFile(`${slug}-log.csv`, activityLogToCsv(entries), 'text/csv');\n        markCurrentPresetByBuilder('activity-csv');\n        renderParametersPanel({ refresh: ['export'], filters });\n        setStatus('Registro attivit\u00E0 esportato in CSV.', 'success', {\n          tags: ['export', 'log', 'csv'],\n          action: 'export-log-csv',\n        });\n        break;\n      }\n      case 'download-preset-zip': {\n        const preset = getCurrentPreset();\n        if (!preset) {\n          setStatus('Nessun preset selezionato.', 'warn', {\n            tags: ['export', 'zip'],\n            action: 'export-zip-missing-preset',\n          });\n          break;\n        }\n        try {\n          const { zipName, fileCount } = await downloadPresetZip(preset, filters);\n          renderParametersPanel({ refresh: ['export'], filters });\n          setStatus(`Bundle ZIP \"${zipName}\" generato (${fileCount} file).`, 'success', {\n            tags: ['export', 'zip'],\n            action: 'export-zip',\n          });\n        } catch (error) {\n          console.error('Errore durante la generazione del bundle ZIP', error);\n          setStatus('Impossibile generare il bundle ZIP.', 'error', {\n            tags: ['export', 'zip', 'errore'],\n            action: 'export-zip-error',\n          });\n        }\n        break;\n      }\n      case 'download-dossier-html': {\n        try {\n          const context = buildPresetContext(filters);\n          const html = await generateDossierHtml(context);\n          if (!html) {\n            throw new Error('HTML non disponibile');\n          }\n          const slug = ensureExportSlug();\n          const fileName = `${slug}-dossier.html`;\n          downloadFile(fileName, html, 'text/html');\n          markCurrentPresetByBuilder('dossier-html');\n          renderParametersPanel({ refresh: ['export'], filters });\n          setStatus('Dossier HTML esportato.', 'success', {\n            tags: ['export', 'dossier', 'html'],\n            action: 'export-dossier-html',\n          });\n        } catch (error) {\n          console.error(\"Errore durante l'esportazione del dossier HTML\", error);\n          setStatus('Impossibile esportare il dossier HTML.', 'error', {\n            tags: ['export', 'dossier', 'errore'],\n            action: 'export-dossier-html-error',\n          });\n        }\n        break;\n      }\n      case 'download-dossier-pdf': {\n        try {\n          const context = buildPresetContext(filters);\n          const blob = await generateDossierPdfBlob(context);\n          const slug = ensureExportSlug();\n          downloadFile(`${slug}-dossier.pdf`, blob, 'application/pdf');\n          markCurrentPresetByBuilder('dossier-pdf');\n          renderParametersPanel({ refresh: ['export'], filters });\n          setStatus('Dossier PDF esportato.', 'success', {\n            tags: ['export', 'dossier', 'pdf'],\n            action: 'export-dossier-pdf',\n          });\n        } catch (error) {\n          console.error(\"Errore durante l'esportazione del dossier PDF\", error);\n          setStatus('Impossibile esportare il dossier PDF.', 'error', {\n            tags: ['export', 'dossier', 'errore'],\n            action: 'export-dossier-pdf-error',\n          });\n        }\n        break;\n      }\n      default:\n        break;\n    }\n  });\n}\n\nasync function loadData() {\n  setStatus('Caricamento catalogo in corso\u2026', 'info', {\n    tags: ['catalogo', 'caricamento'],\n    action: 'catalog-load-start',\n  });\n  try {\n    const { data, context } = await loadPackCatalog();\n    applyCatalogContext(data, context);\n    await loadTraitRegistry(context);\n    await loadTraitReference(context);\n    await loadHazardRegistry(context);\n    await loadSpeciesIndex(context);\n    setStatus(\"Catalogo pronto all'uso. Genera un ecosistema!\", 'success', {\n      tags: ['catalogo', 'ready'],\n      action: 'catalog-load-ready',\n    });\n    return;\n  } catch (error) {\n    console.warn('Caricamento catalogo tramite loader condiviso fallito', error);\n  }\n\n  try {\n    const { data, context } = await manualLoadCatalog();\n    applyCatalogContext(data, context);\n    await loadTraitRegistry(context);\n    await loadTraitReference(context);\n    await loadHazardRegistry(context);\n    await loadSpeciesIndex(context);\n    setStatus(\"Catalogo pronto all'uso dal fallback manuale. Genera un ecosistema!\", 'success', {\n      tags: ['catalogo', 'ready', 'fallback'],\n      action: 'catalog-load-ready-fallback',\n    });\n  } catch (error) {\n    console.error('Impossibile caricare il catalogo da alcuna sorgente', error);\n    await loadTraitRegistry(packContext);\n    await loadTraitReference(packContext);\n    await loadTraitGlossary(packContext);\n    await loadHazardRegistry(packContext);\n    await loadSpeciesIndex(packContext);\n    setStatus('Errore durante il caricamento del catalogo. Controlla la console.', 'error', {\n      tags: ['catalogo', 'errore'],\n      action: 'catalog-load-error',\n    });\n  }\n}\n\nrestoreActivityLog();\nrestorePinnedState();\nrestoreLockState();\naudioService.restorePreferences();\nrestoreFilterProfiles();\nrestoreHistoryEntries();\nupdateActivityTagRegistry();\nrecalculateActivityMetrics();\nrenderNebulaPanel();\nattachNebulaHandlers();\nrenderActivityLog();\nsetupActivityControls();\naudioService.setupControls();\nparametersPanel.setup();\ntraitsPanel.setup();\nbiomesPanel.setup();\nseedsPanel.setup();\ncomposerPanel.setup();\ninsightsPanel.setup();\nanchorNavigator.init(anchorUi);\nrenderTraitsPanel();\nrenderParametersPanel();\nrenderHistoryPanel();\nrenderPinnedSummary();\nrenderComparisonPanel();\nupdateNarrativePrompts();\nrenderComposerPanelView();\nattachHistoryHandlers();\nattachActions();\nsetupFlowMapControls();\nloadNebulaSnapshot({ silent: true });\nloadData();\n\nif (typeof window !== 'undefined') {\n  window.EvoPack = window.EvoPack || {};\n  window.EvoPack.packRootCandidates = PACK_ROOT_CANDIDATES;\n  window.EvoPack.generator = {\n    get state() {\n      return state;\n    },\n    get traitReference() {\n      return state.traitReference;\n    },\n    getTraitDetails,\n    getResolvedCatalogUrl() {\n      return resolvedCatalogUrl;\n    },\n    getResolvedPackRoot() {\n      return resolvedPackRoot;\n    },\n    getPackDocsBase() {\n      return packDocsBase;\n    },\n    getContext() {\n      return packContext;\n    },\n    getApiBase() {\n      return state.api?.base ?? null;\n    },\n    setApiBase(base) {\n      state.api.base = base ?? null;\n    },\n    initAnchorNavigation(ui) {\n      return anchorNavigator.init(ui ?? anchorUi);\n    },\n    setActiveSection(sectionId, options) {\n      return anchorNavigator.setActiveSection(sectionId, options);\n    },\n    scrollToPanel(sectionId, options) {\n      return anchorNavigator.scrollToPanel(sectionId, options);\n    },\n    requestBiomeSynthesis,\n    manualLoadCatalog,\n    loadPackCatalog,\n  };\n}\n"],
  "mappings": "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",
  "names": ["resolvePackHref", "ensureTrailingSlash", "resolveRelative", "state", "label", "id", "label", "elements", "state", "elements", "renderProfileSlots", "renderExportManifest", "renderKpiSidebar", "currentFilters", "render", "setup", "state", "elements", "render", "setup", "state", "elements", "renderBiomes", "currentFilters", "render", "setup", "state", "elements", "render", "setup", "state", "elements", "render", "setup", "state", "elements", "renderContextualInsights", "setup", "state", "elements", "render", "query", "render", "state", "elements", "PACK_ROOT_CANDIDATES", "entries", "render", "setup", "loadDossierTemplate", "generateDossierDocument", "generateDossierHtml", "generateDossierPdfBlob", "generatePresetFileContents", "loadDossierTemplate", "collectRoles", "uniquePicks", "context", "generateDossierHtml", "generateDossierPdfBlob", "PACK_ROOT_CANDIDATES"]
}
