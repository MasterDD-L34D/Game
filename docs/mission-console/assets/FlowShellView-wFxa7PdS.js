var dn=Object.defineProperty;var pn=(t,e,s)=>e in t?dn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Te=(t,e,s)=>pn(t,typeof e!="symbol"?e+"":e,s);import{_ as ye,K as _t,c as g,o as f,a,F as W,l as Q,v as Le,b as ae,t as h,L as xa,k as U,d as pe,S as fn,M as Pe,j as y,N as mn,O as pt,P as Xe,Q as Ze,T as dt,U as Ft,V as vt,r as bt,W as yt,X as gn,Y as gt,Z as ys,$ as ks,a0 as ws,a1 as hn,a2 as _n,a3 as Rt,a4 as vn,a5 as bn,f as Ee,h as Ce,a6 as Ie,m as Re,s as ft,w as Se,a7 as yn,g as Ea,a8 as et,a9 as kn,u as Ra,aa as Is,ab as Et,ac as wn,ad as Ss,ae as Sn,af as aa,ag as $n,ah as An,ai as Tn,aj as Ca,ak as xn,al as Qe,e as En,x as Rn,y as Cn,J as In}from"./atlas-CoNIwjfj.js";const On={class:"flow-breadcrumb","aria-label":"Percorso di generazione"},qn={class:"flow-breadcrumb__list"},Nn=["disabled","onClick"],Ln={class:"flow-breadcrumb__index"},zn={class:"flow-breadcrumb__label"},Mn={__name:"FlowBreadcrumb",props:{steps:{type:Array,default:()=>[]},current:{type:Object,default:null}},emits:["navigate"],setup(t){const e=t,{steps:s,current:n}=_t(e);return(i,r)=>(f(),g("nav",On,[a("ol",qn,[(f(!0),g(W,null,Q(ae(s),d=>{var o,u;return f(),g("li",{key:d.id,class:"flow-breadcrumb__item"},[a("button",{type:"button",class:Le(["flow-breadcrumb__link",{"flow-breadcrumb__link--active":d.id===((o=ae(n))==null?void 0:o.id)}]),disabled:d.id===((u=ae(n))==null?void 0:u.id),onClick:l=>i.$emit("navigate",d.id)},[a("span",Ln,h(d.index+1),1),a("span",zn,h(d.title),1)],10,Nn)])}),128))])]))}},Pn=ye(Mn,[["__scopeId","data-v-1140a026"]]),Dn={class:"progress-tracker"},Fn={class:"progress-tracker__header"},Bn={class:"progress-tracker__subtitle"},Un={class:"progress-tracker__chip"},jn={class:"progress-tracker__chip-label"},Vn={class:"progress-tracker__chip-value"},Hn=["aria-valuenow"],Gn={class:"progress-tracker__cards",role:"list"},Wn={class:"progress-card__header"},Qn={class:"progress-card__caption"},Zn={class:"progress-card__title"},Yn=["onClick","aria-label"],Xn={class:"progress-card__index"},Kn={class:"progress-card__description"},Jn={key:0,class:"progress-card__metrics"},ei={__name:"ProgressTracker",props:{steps:{type:Array,default:()=>[]},summary:{type:Object,default:()=>({totalSteps:0,completedSteps:0,percent:0,active:null})}},emits:["navigate"],setup(t){const e=t,{steps:s,summary:n}=_t(e),i={done:{label:"Completo",variant:"success"},current:{label:"In corso",variant:"info"},pending:{label:"In attesa",variant:"neutral"},blocked:{label:"Bloccato",variant:"danger"}},r=u=>(i[u]||i.pending).label,d=u=>(i[u]||i.pending).variant,o=u=>{const l=Number.isFinite(u.total)?u.total:0,p=Number.isFinite(u.completed)?u.completed:0;return l?Math.min(100,Math.round(p/l*100)):0};return(u,l)=>{var p;return f(),g("section",Dn,[a("header",Fn,[a("div",null,[l[0]||(l[0]=a("h1",{class:"progress-tracker__title"},"Orchestrazione generazione",-1)),a("p",Bn," Stato globale Â· "+h(ae(n).completedSteps)+" / "+h(ae(n).totalSteps)+" fasi completate ",1)]),a("div",Un,[a("span",jn,h((p=ae(n).active)==null?void 0:p.title),1),a("span",Vn,h(ae(n).percent)+"%",1)])]),a("div",{class:"progress-tracker__bar",role:"progressbar","aria-valuenow":ae(n).percent,"aria-valuemin":"0","aria-valuemax":"100"},[a("div",{class:"progress-tracker__bar-fill",style:xa({width:`${ae(n).percent}%`})},null,4)],8,Hn),a("div",Gn,[(f(!0),g(W,null,Q(ae(s),m=>{var _;return f(),g("article",{key:m.id,class:Le(["progress-card",[`progress-card--${m.status}`,{"progress-card--active":m.id===((_=ae(n).active)==null?void 0:_.id)}]]),role:"listitem"},[a("header",Wn,[a("div",null,[a("p",Qn,h(m.caption),1),a("h2",Zn,h(m.title),1)]),a("button",{type:"button",class:"progress-card__status",onClick:w=>u.$emit("navigate",m.id),"aria-label":`Vai alla fase ${m.title}`},[pe(fn,{label:r(m.status),variant:d(m.status),compact:""},null,8,["label","variant"]),a("span",Xn,"#"+h(m.index+1),1)],8,Yn)]),a("p",Kn,h(m.description),1),m.metrics.total?(f(),g("dl",Jn,[a("div",null,[a("dt",null,h(m.metrics.label||"Elementi"),1),a("dd",null,h(m.metrics.completed)+" / "+h(m.metrics.total),1)]),a("div",null,[l[1]||(l[1]=a("dt",null,"Completezza",-1)),a("dd",null,h(o(m.metrics))+"%",1)])])):U("",!0)],2)}),128))])])}}},ti=ye(ei,[["__scopeId","data-v-e174894c"]]),Ia=[{id:"overview",title:"Overview",caption:"Panoramica del progetto",description:"Riepilogo degli obiettivi e dei vincoli di generazione."},{id:"species",title:"Specie",caption:"Curazione faunistica",description:"Selezione e revisione delle specie protagoniste."},{id:"biomeSetup",title:"Setup Biomi",caption:"Parametri di sintesi",description:"Definizione dei vincoli ambientali prima della generazione."},{id:"biomes",title:"Biomi",caption:"Scenari ecologici",description:"Biomi candidati e condizioni ambientali principali."},{id:"encounter",title:"Encounter",caption:"Configurazioni di scontro",description:"Seed, varianti e parametri del combattimento."},{id:"qualityRelease",title:"Quality & Release",caption:"Validazione runtime",description:"Controlli QA automatizzati e readiness per la release."},{id:"publishing",title:"Publishing",caption:"Preparazione artefatti",description:"Pacchetti finali e consegna dei deliverable."}];function Wt(t,e){const s=Math.max(0,Math.min(e,t.length-1));return t.forEach((n,i)=>{i<s?n.status=n.status==="blocked"?"blocked":"done":i===s?n.status=n.status==="blocked"?"blocked":"current":n.status=n.status==="blocked"?"blocked":"pending"}),s}function si(t={}){const{initial:e="overview",stepOverrides:s={}}=t,n=Pe(Ia.map((A,S)=>{const T=s[A.id]||{},C={completed:0,total:0,label:"Elementi",...T.metrics};return{...A,...T,index:S,status:"pending",metrics:C,completed:!!(C.total&&C.completed>=C.total),locked:!!T.locked}})),i=n.findIndex(A=>A.id===e),r=Pe({currentIndex:Wt(n,i===-1?0:i)}),d=y(()=>n[r.currentIndex]||n[0]),o=y(()=>n.slice(0,r.currentIndex+1)),u=y(()=>{const A=n.length,S=n.filter(C=>C.status==="done").length,T=A===0?0:Math.round(S/A*100);return{totalSteps:A,completedSteps:S,percent:T,active:d.value}});function l(A){const S=n.findIndex(T=>T.id===A);S!==-1&&(r.currentIndex=Wt(n,S))}function p(){r.currentIndex<n.length-1&&(r.currentIndex=Wt(n,r.currentIndex+1))}function m(){r.currentIndex>0&&(r.currentIndex=Wt(n,r.currentIndex-1))}function _(A,S={}){const T=n.find(N=>N.id===A);if(!T)return;const C={...T.metrics,...S};T.metrics=C;const ee=Number.isFinite(C.total)?C.total:0,R=Number.isFinite(C.completed)?C.completed:0;ee>0&&R>=ee&&(T.completed=!0,n[r.currentIndex].id!==T.id&&(T.status="done"))}function w(A,S){const T=n.find(C=>C.id===A);T&&(T.status=S,S==="done"&&(T.completed=!0))}return{steps:n,currentStep:d,breadcrumb:o,summary:u,goTo:l,next:p,previous:m,updateMetrics:_,mark:w}}Ia.map(t=>({...t}));const na=200;function ai(){const t=new Map;return{on:(i,r)=>{if(!i||typeof r!="function")return()=>{};const d=String(i);t.has(d)||t.set(d,new Set);const o=t.get(d);return o.add(r),()=>{o.delete(r),o.size===0&&t.delete(d)}},off:(i,r)=>{if(!i)return;const d=t.get(String(i));d&&(typeof r=="function"?d.delete(r):d.clear(),d.size===0&&t.delete(String(i)))},emit:(i,r)=>{if(!i)return;const d=t.get(String(i));!d||d.size===0||[...d].forEach(o=>{try{o(r)}catch{}})}}}function ni(t){return{id:t.id,scope:t.scope,level:t.level,message:t.message,timestamp:t.timestamp,event:t.event,request_id:t.request_id,meta:t.meta,validation:t.validation,source:t.source,...t.data!==void 0?{data:t.data}:{},...t.context!==void 0?{context:t.context}:{}}}function ii(){const t=Pe({entries:[]}),e=ai(),s=mn("flow",{sink(p){const m=ni(p);t.entries.unshift(m),t.entries.length>na&&(t.entries.length=na),e.emit(p.event,m)}}),n=(p,m={})=>s.log(p,{source:"flow",...m}),i=(p,m={})=>s.info(p,{source:"flow",...m}),r=(p,m={})=>s.warn(p,{source:"flow",...m}),d=(p,m={})=>s.error(p,{source:"flow",...m}),o=y(()=>t.entries.map(p=>({...p})));return{log:n,info:i,warn:r,error:d,logs:o,on:(p,m)=>e.on(p,m),off:(p,m)=>e.off(p,m)}}function ia(t,e){if(t instanceof Error)return e&&!t.message&&(t.message=e),t;if(typeof t=="string")return new Error(t);const s=new Error(e||"errors.generic");return Object.defineProperty(s,"cause",{value:t,enumerable:!1,configurable:!0}),s}function lt(t,e,s,n={}){!t||typeof t.log!="function"||!(s!=null&&s.event)||t.log(s.event,{scope:e,level:s.level??"info",message:s.message,...n})}function At(t,e){if(t!=null&&t.metaBuilder)try{return t.metaBuilder(e)}catch{return}}async function ri({attemptPrimary:t,attemptFallback:e,preferFallbackFirst:s=!1,logger:n=null,scope:i="flow",events:r={}}){var u;const d=async(l,p)=>{const m=r[`${l}Start`];lt(n,i,m,{});const _=await p(),w=r[`${l}Success`];return lt(n,i,w,{meta:At(w,_)}),_},o=async l=>{var m;if(!e)throw l;const p=()=>e(l);try{lt(n,i,r.fallbackStart,{meta:At(r.fallbackStart,l)});const _=await p();return lt(n,i,r.fallbackSuccess,{meta:At(r.fallbackSuccess,_)}),Object.assign({},_,{source:"fallback",error:l})}catch(_){const w=ia(_,(m=r.fallbackFailure)==null?void 0:m.message);throw l&&!("cause"in w)&&Object.defineProperty(w,"cause",{value:l,configurable:!0}),lt(n,i,r.fallbackFailure,{}),w}};if(s&&e){lt(n,i,r.fallbackPreferred,{});try{const l=await e();return lt(n,i,r.fallbackSuccess,{meta:At(r.fallbackSuccess,l)}),Object.assign({},l,{source:"fallback",error:null})}catch(l){lt(n,i,r.fallbackFirstFailure,{meta:At(r.fallbackFirstFailure,l)})}}try{const l=await d("primary",t);return Object.assign({},l,{source:"remote",error:null})}catch(l){const p=ia(l,(u=r.primaryFailure)==null?void 0:u.message);return lt(n,i,r.primaryFailure,{meta:At(r.primaryFailure,p)}),o(p)}}/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */const{entries:Oa,setPrototypeOf:ra,isFrozen:li,getPrototypeOf:oi,getOwnPropertyDescriptor:ci}=Object;let{freeze:He,seal:Ke,create:$s}=Object,{apply:As,construct:Ts}=typeof Reflect<"u"&&Reflect;He||(He=function(e){return e});Ke||(Ke=function(e){return e});As||(As=function(e,s){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return e.apply(s,i)});Ts||(Ts=function(e){for(var s=arguments.length,n=new Array(s>1?s-1:0),i=1;i<s;i++)n[i-1]=arguments[i];return new e(...n)});const Qt=Ge(Array.prototype.forEach),ui=Ge(Array.prototype.lastIndexOf),la=Ge(Array.prototype.pop),It=Ge(Array.prototype.push),di=Ge(Array.prototype.splice),Xt=Ge(String.prototype.toLowerCase),ds=Ge(String.prototype.toString),ps=Ge(String.prototype.match),Ot=Ge(String.prototype.replace),pi=Ge(String.prototype.indexOf),fi=Ge(String.prototype.trim),Je=Ge(Object.prototype.hasOwnProperty),je=Ge(RegExp.prototype.test),qt=mi(TypeError);function Ge(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var s=arguments.length,n=new Array(s>1?s-1:0),i=1;i<s;i++)n[i-1]=arguments[i];return As(t,e,n)}}function mi(t){return function(){for(var e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return Ts(t,s)}}function ve(t,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Xt;ra&&ra(t,null);let n=e.length;for(;n--;){let i=e[n];if(typeof i=="string"){const r=s(i);r!==i&&(li(e)||(e[n]=r),i=r)}t[i]=!0}return t}function gi(t){for(let e=0;e<t.length;e++)Je(t,e)||(t[e]=null);return t}function ot(t){const e=$s(null);for(const[s,n]of Oa(t))Je(t,s)&&(Array.isArray(n)?e[s]=gi(n):n&&typeof n=="object"&&n.constructor===Object?e[s]=ot(n):e[s]=n);return e}function Nt(t,e){for(;t!==null;){const n=ci(t,e);if(n){if(n.get)return Ge(n.get);if(typeof n.value=="function")return Ge(n.value)}t=oi(t)}function s(){return null}return s}const oa=He(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),fs=He(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ms=He(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),hi=He(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),gs=He(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),_i=He(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),ca=He(["#text"]),ua=He(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),hs=He(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),da=He(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Zt=He(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),vi=Ke(/\{\{[\w\W]*|[\w\W]*\}\}/gm),bi=Ke(/<%[\w\W]*|[\w\W]*%>/gm),yi=Ke(/\$\{[\w\W]*/gm),ki=Ke(/^data-[\-\w.\u00B7-\uFFFF]+$/),wi=Ke(/^aria-[\-\w]+$/),qa=Ke(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Si=Ke(/^(?:\w+script|data):/i),$i=Ke(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Na=Ke(/^html$/i),Ai=Ke(/^[a-z][.\w]*(-[.\w]+)+$/i);var pa=Object.freeze({__proto__:null,ARIA_ATTR:wi,ATTR_WHITESPACE:$i,CUSTOM_ELEMENT:Ai,DATA_ATTR:ki,DOCTYPE_NAME:Na,ERB_EXPR:bi,IS_ALLOWED_URI:qa,IS_SCRIPT_OR_DATA:Si,MUSTACHE_EXPR:vi,TMPLIT_EXPR:yi});const Lt={element:1,text:3,progressingInstruction:7,comment:8,document:9},Ti=function(){return typeof window>"u"?null:window},xi=function(e,s){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let n=null;const i="data-tt-policy-suffix";s&&s.hasAttribute(i)&&(n=s.getAttribute(i));const r="dompurify"+(n?"#"+n:"");try{return e.createPolicy(r,{createHTML(d){return d},createScriptURL(d){return d}})}catch{return console.warn("TrustedTypes policy "+r+" could not be created."),null}},fa=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function La(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ti();const e=le=>La(le);if(e.version="3.3.0",e.removed=[],!t||!t.document||t.document.nodeType!==Lt.document||!t.Element)return e.isSupported=!1,e;let{document:s}=t;const n=s,i=n.currentScript,{DocumentFragment:r,HTMLTemplateElement:d,Node:o,Element:u,NodeFilter:l,NamedNodeMap:p=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:m,DOMParser:_,trustedTypes:w}=t,A=u.prototype,S=Nt(A,"cloneNode"),T=Nt(A,"remove"),C=Nt(A,"nextSibling"),ee=Nt(A,"childNodes"),R=Nt(A,"parentNode");if(typeof d=="function"){const le=s.createElement("template");le.content&&le.content.ownerDocument&&(s=le.content.ownerDocument)}let N,I="";const{implementation:q,createNodeIterator:E,createDocumentFragment:F,getElementsByTagName:te}=s,{importNode:he}=n;let me=fa();e.isSupported=typeof Oa=="function"&&typeof R=="function"&&q&&q.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:re,ERB_EXPR:Ae,TMPLIT_EXPR:Oe,DATA_ATTR:De,ARIA_ATTR:Fe,IS_SCRIPT_OR_DATA:M,ATTR_WHITESPACE:H,CUSTOM_ELEMENT:se}=pa;let{IS_ALLOWED_URI:L}=pa,x=null;const D=ve({},[...oa,...fs,...ms,...gs,...ca]);let ne=null;const ge=ve({},[...ua,...hs,...da,...Zt]);let K=Object.seal($s(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),_e=null,Y=null;const $=Object.seal($s(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let z=!0,X=!0,J=!1,be=!0,$e=!1,k=!0,j=!1,O=!1,ce=!1,G=!1,ue=!1,oe=!1,c=!0,v=!1;const P="user-content-";let Z=!0,de=!1,fe={},B=null;const ze=ve({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let tt=null;const Ut=ve({},["audio","video","img","source","image","track"]);let is=null;const Vs=ve({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),jt="http://www.w3.org/1998/Math/MathML",Vt="http://www.w3.org/2000/svg",nt="http://www.w3.org/1999/xhtml";let wt=nt,rs=!1,ls=null;const an=ve({},[jt,Vt,nt],ds);let Ht=ve({},["mi","mo","mn","ms","mtext"]),Gt=ve({},["annotation-xml"]);const nn=ve({},["title","style","font","a","script"]);let Ct=null;const rn=["application/xhtml+xml","text/html"],ln="text/html";let Me=null,St=null;const on=s.createElement("form"),Hs=function(b){return b instanceof RegExp||b instanceof Function},os=function(){let b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(St&&St===b)){if((!b||typeof b!="object")&&(b={}),b=ot(b),Ct=rn.indexOf(b.PARSER_MEDIA_TYPE)===-1?ln:b.PARSER_MEDIA_TYPE,Me=Ct==="application/xhtml+xml"?ds:Xt,x=Je(b,"ALLOWED_TAGS")?ve({},b.ALLOWED_TAGS,Me):D,ne=Je(b,"ALLOWED_ATTR")?ve({},b.ALLOWED_ATTR,Me):ge,ls=Je(b,"ALLOWED_NAMESPACES")?ve({},b.ALLOWED_NAMESPACES,ds):an,is=Je(b,"ADD_URI_SAFE_ATTR")?ve(ot(Vs),b.ADD_URI_SAFE_ATTR,Me):Vs,tt=Je(b,"ADD_DATA_URI_TAGS")?ve(ot(Ut),b.ADD_DATA_URI_TAGS,Me):Ut,B=Je(b,"FORBID_CONTENTS")?ve({},b.FORBID_CONTENTS,Me):ze,_e=Je(b,"FORBID_TAGS")?ve({},b.FORBID_TAGS,Me):ot({}),Y=Je(b,"FORBID_ATTR")?ve({},b.FORBID_ATTR,Me):ot({}),fe=Je(b,"USE_PROFILES")?b.USE_PROFILES:!1,z=b.ALLOW_ARIA_ATTR!==!1,X=b.ALLOW_DATA_ATTR!==!1,J=b.ALLOW_UNKNOWN_PROTOCOLS||!1,be=b.ALLOW_SELF_CLOSE_IN_ATTR!==!1,$e=b.SAFE_FOR_TEMPLATES||!1,k=b.SAFE_FOR_XML!==!1,j=b.WHOLE_DOCUMENT||!1,G=b.RETURN_DOM||!1,ue=b.RETURN_DOM_FRAGMENT||!1,oe=b.RETURN_TRUSTED_TYPE||!1,ce=b.FORCE_BODY||!1,c=b.SANITIZE_DOM!==!1,v=b.SANITIZE_NAMED_PROPS||!1,Z=b.KEEP_CONTENT!==!1,de=b.IN_PLACE||!1,L=b.ALLOWED_URI_REGEXP||qa,wt=b.NAMESPACE||nt,Ht=b.MATHML_TEXT_INTEGRATION_POINTS||Ht,Gt=b.HTML_INTEGRATION_POINTS||Gt,K=b.CUSTOM_ELEMENT_HANDLING||{},b.CUSTOM_ELEMENT_HANDLING&&Hs(b.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(K.tagNameCheck=b.CUSTOM_ELEMENT_HANDLING.tagNameCheck),b.CUSTOM_ELEMENT_HANDLING&&Hs(b.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(K.attributeNameCheck=b.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),b.CUSTOM_ELEMENT_HANDLING&&typeof b.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(K.allowCustomizedBuiltInElements=b.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),$e&&(X=!1),ue&&(G=!0),fe&&(x=ve({},ca),ne=[],fe.html===!0&&(ve(x,oa),ve(ne,ua)),fe.svg===!0&&(ve(x,fs),ve(ne,hs),ve(ne,Zt)),fe.svgFilters===!0&&(ve(x,ms),ve(ne,hs),ve(ne,Zt)),fe.mathMl===!0&&(ve(x,gs),ve(ne,da),ve(ne,Zt))),b.ADD_TAGS&&(typeof b.ADD_TAGS=="function"?$.tagCheck=b.ADD_TAGS:(x===D&&(x=ot(x)),ve(x,b.ADD_TAGS,Me))),b.ADD_ATTR&&(typeof b.ADD_ATTR=="function"?$.attributeCheck=b.ADD_ATTR:(ne===ge&&(ne=ot(ne)),ve(ne,b.ADD_ATTR,Me))),b.ADD_URI_SAFE_ATTR&&ve(is,b.ADD_URI_SAFE_ATTR,Me),b.FORBID_CONTENTS&&(B===ze&&(B=ot(B)),ve(B,b.FORBID_CONTENTS,Me)),Z&&(x["#text"]=!0),j&&ve(x,["html","head","body"]),x.table&&(ve(x,["tbody"]),delete _e.tbody),b.TRUSTED_TYPES_POLICY){if(typeof b.TRUSTED_TYPES_POLICY.createHTML!="function")throw qt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof b.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw qt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');N=b.TRUSTED_TYPES_POLICY,I=N.createHTML("")}else N===void 0&&(N=xi(w,i)),N!==null&&typeof I=="string"&&(I=N.createHTML(""));He&&He(b),St=b}},Gs=ve({},[...fs,...ms,...hi]),Ws=ve({},[...gs,..._i]),cn=function(b){let V=R(b);(!V||!V.tagName)&&(V={namespaceURI:wt,tagName:"template"});const ie=Xt(b.tagName),xe=Xt(V.tagName);return ls[b.namespaceURI]?b.namespaceURI===Vt?V.namespaceURI===nt?ie==="svg":V.namespaceURI===jt?ie==="svg"&&(xe==="annotation-xml"||Ht[xe]):!!Gs[ie]:b.namespaceURI===jt?V.namespaceURI===nt?ie==="math":V.namespaceURI===Vt?ie==="math"&&Gt[xe]:!!Ws[ie]:b.namespaceURI===nt?V.namespaceURI===Vt&&!Gt[xe]||V.namespaceURI===jt&&!Ht[xe]?!1:!Ws[ie]&&(nn[ie]||!Gs[ie]):!!(Ct==="application/xhtml+xml"&&ls[b.namespaceURI]):!1},st=function(b){It(e.removed,{element:b});try{R(b).removeChild(b)}catch{T(b)}},mt=function(b,V){try{It(e.removed,{attribute:V.getAttributeNode(b),from:V})}catch{It(e.removed,{attribute:null,from:V})}if(V.removeAttribute(b),b==="is")if(G||ue)try{st(V)}catch{}else try{V.setAttribute(b,"")}catch{}},Qs=function(b){let V=null,ie=null;if(ce)b="<remove></remove>"+b;else{const qe=ps(b,/^[\r\n\t ]+/);ie=qe&&qe[0]}Ct==="application/xhtml+xml"&&wt===nt&&(b='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+b+"</body></html>");const xe=N?N.createHTML(b):b;if(wt===nt)try{V=new _().parseFromString(xe,Ct)}catch{}if(!V||!V.documentElement){V=q.createDocument(wt,"template",null);try{V.documentElement.innerHTML=rs?I:xe}catch{}}const Ue=V.body||V.documentElement;return b&&ie&&Ue.insertBefore(s.createTextNode(ie),Ue.childNodes[0]||null),wt===nt?te.call(V,j?"html":"body")[0]:j?V.documentElement:Ue},Zs=function(b){return E.call(b.ownerDocument||b,b,l.SHOW_ELEMENT|l.SHOW_COMMENT|l.SHOW_TEXT|l.SHOW_PROCESSING_INSTRUCTION|l.SHOW_CDATA_SECTION,null)},cs=function(b){return b instanceof m&&(typeof b.nodeName!="string"||typeof b.textContent!="string"||typeof b.removeChild!="function"||!(b.attributes instanceof p)||typeof b.removeAttribute!="function"||typeof b.setAttribute!="function"||typeof b.namespaceURI!="string"||typeof b.insertBefore!="function"||typeof b.hasChildNodes!="function")},Ys=function(b){return typeof o=="function"&&b instanceof o};function it(le,b,V){Qt(le,ie=>{ie.call(e,b,V,St)})}const Xs=function(b){let V=null;if(it(me.beforeSanitizeElements,b,null),cs(b))return st(b),!0;const ie=Me(b.nodeName);if(it(me.uponSanitizeElement,b,{tagName:ie,allowedTags:x}),k&&b.hasChildNodes()&&!Ys(b.firstElementChild)&&je(/<[/\w!]/g,b.innerHTML)&&je(/<[/\w!]/g,b.textContent)||b.nodeType===Lt.progressingInstruction||k&&b.nodeType===Lt.comment&&je(/<[/\w]/g,b.data))return st(b),!0;if(!($.tagCheck instanceof Function&&$.tagCheck(ie))&&(!x[ie]||_e[ie])){if(!_e[ie]&&Js(ie)&&(K.tagNameCheck instanceof RegExp&&je(K.tagNameCheck,ie)||K.tagNameCheck instanceof Function&&K.tagNameCheck(ie)))return!1;if(Z&&!B[ie]){const xe=R(b)||b.parentNode,Ue=ee(b)||b.childNodes;if(Ue&&xe){const qe=Ue.length;for(let We=qe-1;We>=0;--We){const rt=S(Ue[We],!0);rt.__removalCount=(b.__removalCount||0)+1,xe.insertBefore(rt,C(b))}}}return st(b),!0}return b instanceof u&&!cn(b)||(ie==="noscript"||ie==="noembed"||ie==="noframes")&&je(/<\/no(script|embed|frames)/i,b.innerHTML)?(st(b),!0):($e&&b.nodeType===Lt.text&&(V=b.textContent,Qt([re,Ae,Oe],xe=>{V=Ot(V,xe," ")}),b.textContent!==V&&(It(e.removed,{element:b.cloneNode()}),b.textContent=V)),it(me.afterSanitizeElements,b,null),!1)},Ks=function(b,V,ie){if(c&&(V==="id"||V==="name")&&(ie in s||ie in on))return!1;if(!(X&&!Y[V]&&je(De,V))){if(!(z&&je(Fe,V))){if(!($.attributeCheck instanceof Function&&$.attributeCheck(V,b))){if(!ne[V]||Y[V]){if(!(Js(b)&&(K.tagNameCheck instanceof RegExp&&je(K.tagNameCheck,b)||K.tagNameCheck instanceof Function&&K.tagNameCheck(b))&&(K.attributeNameCheck instanceof RegExp&&je(K.attributeNameCheck,V)||K.attributeNameCheck instanceof Function&&K.attributeNameCheck(V,b))||V==="is"&&K.allowCustomizedBuiltInElements&&(K.tagNameCheck instanceof RegExp&&je(K.tagNameCheck,ie)||K.tagNameCheck instanceof Function&&K.tagNameCheck(ie))))return!1}else if(!is[V]){if(!je(L,Ot(ie,H,""))){if(!((V==="src"||V==="xlink:href"||V==="href")&&b!=="script"&&pi(ie,"data:")===0&&tt[b])){if(!(J&&!je(M,Ot(ie,H,"")))){if(ie)return!1}}}}}}}return!0},Js=function(b){return b!=="annotation-xml"&&ps(b,se)},ea=function(b){it(me.beforeSanitizeAttributes,b,null);const{attributes:V}=b;if(!V||cs(b))return;const ie={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ne,forceKeepAttr:void 0};let xe=V.length;for(;xe--;){const Ue=V[xe],{name:qe,namespaceURI:We,value:rt}=Ue,$t=Me(qe),us=rt;let Be=qe==="value"?us:fi(us);if(ie.attrName=$t,ie.attrValue=Be,ie.keepAttr=!0,ie.forceKeepAttr=void 0,it(me.uponSanitizeAttribute,b,ie),Be=ie.attrValue,v&&($t==="id"||$t==="name")&&(mt(qe,b),Be=P+Be),k&&je(/((--!?|])>)|<\/(style|title|textarea)/i,Be)){mt(qe,b);continue}if($t==="attributename"&&ps(Be,"href")){mt(qe,b);continue}if(ie.forceKeepAttr)continue;if(!ie.keepAttr){mt(qe,b);continue}if(!be&&je(/\/>/i,Be)){mt(qe,b);continue}$e&&Qt([re,Ae,Oe],sa=>{Be=Ot(Be,sa," ")});const ta=Me(b.nodeName);if(!Ks(ta,$t,Be)){mt(qe,b);continue}if(N&&typeof w=="object"&&typeof w.getAttributeType=="function"&&!We)switch(w.getAttributeType(ta,$t)){case"TrustedHTML":{Be=N.createHTML(Be);break}case"TrustedScriptURL":{Be=N.createScriptURL(Be);break}}if(Be!==us)try{We?b.setAttributeNS(We,qe,Be):b.setAttribute(qe,Be),cs(b)?st(b):la(e.removed)}catch{mt(qe,b)}}it(me.afterSanitizeAttributes,b,null)},un=function le(b){let V=null;const ie=Zs(b);for(it(me.beforeSanitizeShadowDOM,b,null);V=ie.nextNode();)it(me.uponSanitizeShadowNode,V,null),Xs(V),ea(V),V.content instanceof r&&le(V.content);it(me.afterSanitizeShadowDOM,b,null)};return e.sanitize=function(le){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},V=null,ie=null,xe=null,Ue=null;if(rs=!le,rs&&(le="<!-->"),typeof le!="string"&&!Ys(le))if(typeof le.toString=="function"){if(le=le.toString(),typeof le!="string")throw qt("dirty is not a string, aborting")}else throw qt("toString is not a function");if(!e.isSupported)return le;if(O||os(b),e.removed=[],typeof le=="string"&&(de=!1),de){if(le.nodeName){const rt=Me(le.nodeName);if(!x[rt]||_e[rt])throw qt("root node is forbidden and cannot be sanitized in-place")}}else if(le instanceof o)V=Qs("<!---->"),ie=V.ownerDocument.importNode(le,!0),ie.nodeType===Lt.element&&ie.nodeName==="BODY"||ie.nodeName==="HTML"?V=ie:V.appendChild(ie);else{if(!G&&!$e&&!j&&le.indexOf("<")===-1)return N&&oe?N.createHTML(le):le;if(V=Qs(le),!V)return G?null:oe?I:""}V&&ce&&st(V.firstChild);const qe=Zs(de?le:V);for(;xe=qe.nextNode();)Xs(xe),ea(xe),xe.content instanceof r&&un(xe.content);if(de)return le;if(G){if(ue)for(Ue=F.call(V.ownerDocument);V.firstChild;)Ue.appendChild(V.firstChild);else Ue=V;return(ne.shadowroot||ne.shadowrootmode)&&(Ue=he.call(n,Ue,!0)),Ue}let We=j?V.outerHTML:V.innerHTML;return j&&x["!doctype"]&&V.ownerDocument&&V.ownerDocument.doctype&&V.ownerDocument.doctype.name&&je(Na,V.ownerDocument.doctype.name)&&(We="<!DOCTYPE "+V.ownerDocument.doctype.name+`>
`+We),$e&&Qt([re,Ae,Oe],rt=>{We=Ot(We,rt," ")}),N&&oe?N.createHTML(We):We},e.setConfig=function(){let le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};os(le),O=!0},e.clearConfig=function(){St=null,O=!1},e.isValidAttribute=function(le,b,V){St||os({});const ie=Me(le),xe=Me(b);return Ks(ie,xe,V)},e.addHook=function(le,b){typeof b=="function"&&It(me[le],b)},e.removeHook=function(le,b){if(b!==void 0){const V=ui(me[le],b);return V===-1?void 0:di(me[le],V,1)[0]}return la(me[le])},e.removeHooks=function(le){me[le]=[]},e.removeAllHooks=function(){me=fa()},e}var Ei=La();function Os(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var kt=Os();function za(t){kt=t}var Dt={exec:()=>null};function we(t,e=""){let s=typeof t=="string"?t:t.source;const n={replace:(i,r)=>{let d=typeof r=="string"?r:r.source;return d=d.replace(Ve.caret,"$1"),s=s.replace(i,d),n},getRegex:()=>new RegExp(s,e)};return n}var Ve={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},Ri=/^(?:[ \t]*(?:\n|$))+/,Ci=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Ii=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Bt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Oi=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,qs=/(?:[*+-]|\d{1,9}[.)])/,Ma=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Pa=we(Ma).replace(/bull/g,qs).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),qi=we(Ma).replace(/bull/g,qs).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Ns=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Ni=/^[^\n]+/,Ls=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Li=we(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Ls).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),zi=we(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,qs).getRegex(),ss="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",zs=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Mi=we("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",zs).replace("tag",ss).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Da=we(Ns).replace("hr",Bt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ss).getRegex(),Pi=we(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Da).getRegex(),Ms={blockquote:Pi,code:Ci,def:Li,fences:Ii,heading:Oi,hr:Bt,html:Mi,lheading:Pa,list:zi,newline:Ri,paragraph:Da,table:Dt,text:Ni},ma=we("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Bt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ss).getRegex(),Di={...Ms,lheading:qi,table:ma,paragraph:we(Ns).replace("hr",Bt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",ma).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ss).getRegex()},Fi={...Ms,html:we(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",zs).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Dt,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:we(Ns).replace("hr",Bt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Pa).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Bi=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Ui=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Fa=/^( {2,}|\\)\n(?!\s*$)/,ji=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,as=/[\p{P}\p{S}]/u,Ps=/[\s\p{P}\p{S}]/u,Ba=/[^\s\p{P}\p{S}]/u,Vi=we(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Ps).getRegex(),Ua=/(?!~)[\p{P}\p{S}]/u,Hi=/(?!~)[\s\p{P}\p{S}]/u,Gi=/(?:[^\s\p{P}\p{S}]|~)/u,Wi=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,ja=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Qi=we(ja,"u").replace(/punct/g,as).getRegex(),Zi=we(ja,"u").replace(/punct/g,Ua).getRegex(),Va="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Yi=we(Va,"gu").replace(/notPunctSpace/g,Ba).replace(/punctSpace/g,Ps).replace(/punct/g,as).getRegex(),Xi=we(Va,"gu").replace(/notPunctSpace/g,Gi).replace(/punctSpace/g,Hi).replace(/punct/g,Ua).getRegex(),Ki=we("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Ba).replace(/punctSpace/g,Ps).replace(/punct/g,as).getRegex(),Ji=we(/\\(punct)/,"gu").replace(/punct/g,as).getRegex(),er=we(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),tr=we(zs).replace("(?:-->|$)","-->").getRegex(),sr=we("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",tr).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Jt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,ar=we(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Jt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ha=we(/^!?\[(label)\]\[(ref)\]/).replace("label",Jt).replace("ref",Ls).getRegex(),Ga=we(/^!?\[(ref)\](?:\[\])?/).replace("ref",Ls).getRegex(),nr=we("reflink|nolink(?!\\()","g").replace("reflink",Ha).replace("nolink",Ga).getRegex(),Ds={_backpedal:Dt,anyPunctuation:Ji,autolink:er,blockSkip:Wi,br:Fa,code:Ui,del:Dt,emStrongLDelim:Qi,emStrongRDelimAst:Yi,emStrongRDelimUnd:Ki,escape:Bi,link:ar,nolink:Ga,punctuation:Vi,reflink:Ha,reflinkSearch:nr,tag:sr,text:ji,url:Dt},ir={...Ds,link:we(/^!?\[(label)\]\((.*?)\)/).replace("label",Jt).getRegex(),reflink:we(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Jt).getRegex()},xs={...Ds,emStrongRDelimAst:Xi,emStrongLDelim:Zi,url:we(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},rr={...xs,br:we(Fa).replace("{2,}","*").getRegex(),text:we(xs.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Yt={normal:Ms,gfm:Di,pedantic:Fi},zt={normal:Ds,gfm:xs,breaks:rr,pedantic:ir},lr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ga=t=>lr[t];function at(t,e){if(e){if(Ve.escapeTest.test(t))return t.replace(Ve.escapeReplace,ga)}else if(Ve.escapeTestNoEncode.test(t))return t.replace(Ve.escapeReplaceNoEncode,ga);return t}function ha(t){try{t=encodeURI(t).replace(Ve.percentDecode,"%")}catch{return null}return t}function _a(t,e){var r;const s=t.replace(Ve.findPipe,(d,o,u)=>{let l=!1,p=o;for(;--p>=0&&u[p]==="\\";)l=!l;return l?"|":" |"}),n=s.split(Ve.splitPipe);let i=0;if(n[0].trim()||n.shift(),n.length>0&&!((r=n.at(-1))!=null&&r.trim())&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(Ve.slashPipe,"|");return n}function Mt(t,e,s){const n=t.length;if(n===0)return"";let i=0;for(;i<n&&t.charAt(n-i-1)===e;)i++;return t.slice(0,n-i)}function or(t,e){if(t.indexOf(e[1])===-1)return-1;let s=0;for(let n=0;n<t.length;n++)if(t[n]==="\\")n++;else if(t[n]===e[0])s++;else if(t[n]===e[1]&&(s--,s<0))return n;return s>0?-2:-1}function va(t,e,s,n,i){const r=e.href,d=e.title||null,o=t[1].replace(i.other.outputLinkReplace,"$1");n.state.inLink=!0;const u={type:t[0].charAt(0)==="!"?"image":"link",raw:s,href:r,title:d,text:o,tokens:n.inlineTokens(o)};return n.state.inLink=!1,u}function cr(t,e,s){const n=t.match(s.other.indentCodeCompensation);if(n===null)return e;const i=n[1];return e.split(`
`).map(r=>{const d=r.match(s.other.beginningSpace);if(d===null)return r;const[o]=d;return o.length>=i.length?r.slice(i.length):r}).join(`
`)}var es=class{constructor(t){Te(this,"options");Te(this,"rules");Te(this,"lexer");this.options=t||kt}space(t){const e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){const e=this.rules.block.code.exec(t);if(e){const s=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?s:Mt(s,`
`)}}}fences(t){const e=this.rules.block.fences.exec(t);if(e){const s=e[0],n=cr(s,e[3]||"",this.rules);return{type:"code",raw:s,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:n}}}heading(t){const e=this.rules.block.heading.exec(t);if(e){let s=e[2].trim();if(this.rules.other.endingHash.test(s)){const n=Mt(s,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(s=n.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(t){const e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:Mt(e[0],`
`)}}blockquote(t){const e=this.rules.block.blockquote.exec(t);if(e){let s=Mt(e[0],`
`).split(`
`),n="",i="";const r=[];for(;s.length>0;){let d=!1;const o=[];let u;for(u=0;u<s.length;u++)if(this.rules.other.blockquoteStart.test(s[u]))o.push(s[u]),d=!0;else if(!d)o.push(s[u]);else break;s=s.slice(u);const l=o.join(`
`),p=l.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${l}`:l,i=i?`${i}
${p}`:p;const m=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(p,r,!0),this.lexer.state.top=m,s.length===0)break;const _=r.at(-1);if((_==null?void 0:_.type)==="code")break;if((_==null?void 0:_.type)==="blockquote"){const w=_,A=w.raw+`
`+s.join(`
`),S=this.blockquote(A);r[r.length-1]=S,n=n.substring(0,n.length-w.raw.length)+S.raw,i=i.substring(0,i.length-w.text.length)+S.text;break}else if((_==null?void 0:_.type)==="list"){const w=_,A=w.raw+`
`+s.join(`
`),S=this.list(A);r[r.length-1]=S,n=n.substring(0,n.length-_.raw.length)+S.raw,i=i.substring(0,i.length-w.raw.length)+S.raw,s=A.substring(r.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:r,text:i}}}list(t){let e=this.rules.block.list.exec(t);if(e){let s=e[1].trim();const n=s.length>1,i={type:"list",raw:"",ordered:n,start:n?+s.slice(0,-1):"",loose:!1,items:[]};s=n?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=n?s:"[*+-]");const r=this.rules.other.listItemRegex(s);let d=!1;for(;t;){let u=!1,l="",p="";if(!(e=r.exec(t))||this.rules.block.hr.test(t))break;l=e[0],t=t.substring(l.length);let m=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,C=>" ".repeat(3*C.length)),_=t.split(`
`,1)[0],w=!m.trim(),A=0;if(this.options.pedantic?(A=2,p=m.trimStart()):w?A=e[1].length+1:(A=e[2].search(this.rules.other.nonSpaceChar),A=A>4?1:A,p=m.slice(A),A+=e[1].length),w&&this.rules.other.blankLine.test(_)&&(l+=_+`
`,t=t.substring(_.length+1),u=!0),!u){const C=this.rules.other.nextBulletRegex(A),ee=this.rules.other.hrRegex(A),R=this.rules.other.fencesBeginRegex(A),N=this.rules.other.headingBeginRegex(A),I=this.rules.other.htmlBeginRegex(A);for(;t;){const q=t.split(`
`,1)[0];let E;if(_=q,this.options.pedantic?(_=_.replace(this.rules.other.listReplaceNesting,"  "),E=_):E=_.replace(this.rules.other.tabCharGlobal,"    "),R.test(_)||N.test(_)||I.test(_)||C.test(_)||ee.test(_))break;if(E.search(this.rules.other.nonSpaceChar)>=A||!_.trim())p+=`
`+E.slice(A);else{if(w||m.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||R.test(m)||N.test(m)||ee.test(m))break;p+=`
`+_}!w&&!_.trim()&&(w=!0),l+=q+`
`,t=t.substring(q.length+1),m=E.slice(A)}}i.loose||(d?i.loose=!0:this.rules.other.doubleBlankLine.test(l)&&(d=!0));let S=null,T;this.options.gfm&&(S=this.rules.other.listIsTask.exec(p),S&&(T=S[0]!=="[ ] ",p=p.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:l,task:!!S,checked:T,loose:!1,text:p,tokens:[]}),i.raw+=l}const o=i.items.at(-1);if(o)o.raw=o.raw.trimEnd(),o.text=o.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let u=0;u<i.items.length;u++)if(this.lexer.state.top=!1,i.items[u].tokens=this.lexer.blockTokens(i.items[u].text,[]),!i.loose){const l=i.items[u].tokens.filter(m=>m.type==="space"),p=l.length>0&&l.some(m=>this.rules.other.anyLine.test(m.raw));i.loose=p}if(i.loose)for(let u=0;u<i.items.length;u++)i.items[u].loose=!0;return i}}html(t){const e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){const e=this.rules.block.def.exec(t);if(e){const s=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:s,raw:e[0],href:n,title:i}}}table(t){var d;const e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;const s=_a(e[1]),n=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=(d=e[3])!=null&&d.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],r={type:"table",raw:e[0],header:[],align:[],rows:[]};if(s.length===n.length){for(const o of n)this.rules.other.tableAlignRight.test(o)?r.align.push("right"):this.rules.other.tableAlignCenter.test(o)?r.align.push("center"):this.rules.other.tableAlignLeft.test(o)?r.align.push("left"):r.align.push(null);for(let o=0;o<s.length;o++)r.header.push({text:s[o],tokens:this.lexer.inline(s[o]),header:!0,align:r.align[o]});for(const o of i)r.rows.push(_a(o,r.header.length).map((u,l)=>({text:u,tokens:this.lexer.inline(u),header:!1,align:r.align[l]})));return r}}lheading(t){const e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){const e=this.rules.block.paragraph.exec(t);if(e){const s=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:s,tokens:this.lexer.inline(s)}}}text(t){const e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){const e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){const e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){const e=this.rules.inline.link.exec(t);if(e){const s=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(s)){if(!this.rules.other.endAngleBracket.test(s))return;const r=Mt(s.slice(0,-1),"\\");if((s.length-r.length)%2===0)return}else{const r=or(e[2],"()");if(r===-2)return;if(r>-1){const o=(e[0].indexOf("!")===0?5:4)+e[1].length+r;e[2]=e[2].substring(0,r),e[0]=e[0].substring(0,o).trim(),e[3]=""}}let n=e[2],i="";if(this.options.pedantic){const r=this.rules.other.pedanticHrefTitle.exec(n);r&&(n=r[1],i=r[3])}else i=e[3]?e[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(s)?n=n.slice(1):n=n.slice(1,-1)),va(e,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let s;if((s=this.rules.inline.reflink.exec(t))||(s=this.rules.inline.nolink.exec(t))){const n=(s[2]||s[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[n.toLowerCase()];if(!i){const r=s[0].charAt(0);return{type:"text",raw:r,text:r}}return va(s,i,s[0],this.lexer,this.rules)}}emStrong(t,e,s=""){let n=this.rules.inline.emStrongLDelim.exec(t);if(!n||n[3]&&s.match(this.rules.other.unicodeAlphaNumeric))return;if(!(n[1]||n[2]||"")||!s||this.rules.inline.punctuation.exec(s)){const r=[...n[0]].length-1;let d,o,u=r,l=0;const p=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(p.lastIndex=0,e=e.slice(-1*t.length+r);(n=p.exec(e))!=null;){if(d=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!d)continue;if(o=[...d].length,n[3]||n[4]){u+=o;continue}else if((n[5]||n[6])&&r%3&&!((r+o)%3)){l+=o;continue}if(u-=o,u>0)continue;o=Math.min(o,o+u+l);const m=[...n[0]][0].length,_=t.slice(0,r+n.index+m+o);if(Math.min(r,o)%2){const A=_.slice(1,-1);return{type:"em",raw:_,text:A,tokens:this.lexer.inlineTokens(A)}}const w=_.slice(2,-2);return{type:"strong",raw:_,text:w,tokens:this.lexer.inlineTokens(w)}}}}codespan(t){const e=this.rules.inline.code.exec(t);if(e){let s=e[2].replace(this.rules.other.newLineCharGlobal," ");const n=this.rules.other.nonSpaceChar.test(s),i=this.rules.other.startingSpaceChar.test(s)&&this.rules.other.endingSpaceChar.test(s);return n&&i&&(s=s.substring(1,s.length-1)),{type:"codespan",raw:e[0],text:s}}}br(t){const e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){const e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){const e=this.rules.inline.autolink.exec(t);if(e){let s,n;return e[2]==="@"?(s=e[1],n="mailto:"+s):(s=e[1],n=s),{type:"link",raw:e[0],text:s,href:n,tokens:[{type:"text",raw:s,text:s}]}}}url(t){var s;let e;if(e=this.rules.inline.url.exec(t)){let n,i;if(e[2]==="@")n=e[0],i="mailto:"+n;else{let r;do r=e[0],e[0]=((s=this.rules.inline._backpedal.exec(e[0]))==null?void 0:s[0])??"";while(r!==e[0]);n=e[0],e[1]==="www."?i="http://"+e[0]:i=e[0]}return{type:"link",raw:e[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(t){const e=this.rules.inline.text.exec(t);if(e){const s=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:s}}}},ct=class Es{constructor(e){Te(this,"tokens");Te(this,"options");Te(this,"state");Te(this,"tokenizer");Te(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||kt,this.options.tokenizer=this.options.tokenizer||new es,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const s={other:Ve,block:Yt.normal,inline:zt.normal};this.options.pedantic?(s.block=Yt.pedantic,s.inline=zt.pedantic):this.options.gfm&&(s.block=Yt.gfm,this.options.breaks?s.inline=zt.breaks:s.inline=zt.gfm),this.tokenizer.rules=s}static get rules(){return{block:Yt,inline:zt}}static lex(e,s){return new Es(s).lex(e)}static lexInline(e,s){return new Es(s).inlineTokens(e)}lex(e){e=e.replace(Ve.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let s=0;s<this.inlineQueue.length;s++){const n=this.inlineQueue[s];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,s=[],n=!1){var i,r,d;for(this.options.pedantic&&(e=e.replace(Ve.tabCharGlobal,"    ").replace(Ve.spaceLine,""));e;){let o;if((r=(i=this.options.extensions)==null?void 0:i.block)!=null&&r.some(l=>(o=l.call({lexer:this},e,s))?(e=e.substring(o.raw.length),s.push(o),!0):!1))continue;if(o=this.tokenizer.space(e)){e=e.substring(o.raw.length);const l=s.at(-1);o.raw.length===1&&l!==void 0?l.raw+=`
`:s.push(o);continue}if(o=this.tokenizer.code(e)){e=e.substring(o.raw.length);const l=s.at(-1);(l==null?void 0:l.type)==="paragraph"||(l==null?void 0:l.type)==="text"?(l.raw+=`
`+o.raw,l.text+=`
`+o.text,this.inlineQueue.at(-1).src=l.text):s.push(o);continue}if(o=this.tokenizer.fences(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.heading(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.hr(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.blockquote(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.list(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.html(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.def(e)){e=e.substring(o.raw.length);const l=s.at(-1);(l==null?void 0:l.type)==="paragraph"||(l==null?void 0:l.type)==="text"?(l.raw+=`
`+o.raw,l.text+=`
`+o.raw,this.inlineQueue.at(-1).src=l.text):this.tokens.links[o.tag]||(this.tokens.links[o.tag]={href:o.href,title:o.title});continue}if(o=this.tokenizer.table(e)){e=e.substring(o.raw.length),s.push(o);continue}if(o=this.tokenizer.lheading(e)){e=e.substring(o.raw.length),s.push(o);continue}let u=e;if((d=this.options.extensions)!=null&&d.startBlock){let l=1/0;const p=e.slice(1);let m;this.options.extensions.startBlock.forEach(_=>{m=_.call({lexer:this},p),typeof m=="number"&&m>=0&&(l=Math.min(l,m))}),l<1/0&&l>=0&&(u=e.substring(0,l+1))}if(this.state.top&&(o=this.tokenizer.paragraph(u))){const l=s.at(-1);n&&(l==null?void 0:l.type)==="paragraph"?(l.raw+=`
`+o.raw,l.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=l.text):s.push(o),n=u.length!==e.length,e=e.substring(o.raw.length);continue}if(o=this.tokenizer.text(e)){e=e.substring(o.raw.length);const l=s.at(-1);(l==null?void 0:l.type)==="text"?(l.raw+=`
`+o.raw,l.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=l.text):s.push(o);continue}if(e){const l="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return this.state.top=!0,s}inline(e,s=[]){return this.inlineQueue.push({src:e,tokens:s}),s}inlineTokens(e,s=[]){var o,u,l;let n=e,i=null;if(this.tokens.links){const p=Object.keys(this.tokens.links);if(p.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)p.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,i.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(i=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let r=!1,d="";for(;e;){r||(d=""),r=!1;let p;if((u=(o=this.options.extensions)==null?void 0:o.inline)!=null&&u.some(_=>(p=_.call({lexer:this},e,s))?(e=e.substring(p.raw.length),s.push(p),!0):!1))continue;if(p=this.tokenizer.escape(e)){e=e.substring(p.raw.length),s.push(p);continue}if(p=this.tokenizer.tag(e)){e=e.substring(p.raw.length),s.push(p);continue}if(p=this.tokenizer.link(e)){e=e.substring(p.raw.length),s.push(p);continue}if(p=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(p.raw.length);const _=s.at(-1);p.type==="text"&&(_==null?void 0:_.type)==="text"?(_.raw+=p.raw,_.text+=p.text):s.push(p);continue}if(p=this.tokenizer.emStrong(e,n,d)){e=e.substring(p.raw.length),s.push(p);continue}if(p=this.tokenizer.codespan(e)){e=e.substring(p.raw.length),s.push(p);continue}if(p=this.tokenizer.br(e)){e=e.substring(p.raw.length),s.push(p);continue}if(p=this.tokenizer.del(e)){e=e.substring(p.raw.length),s.push(p);continue}if(p=this.tokenizer.autolink(e)){e=e.substring(p.raw.length),s.push(p);continue}if(!this.state.inLink&&(p=this.tokenizer.url(e))){e=e.substring(p.raw.length),s.push(p);continue}let m=e;if((l=this.options.extensions)!=null&&l.startInline){let _=1/0;const w=e.slice(1);let A;this.options.extensions.startInline.forEach(S=>{A=S.call({lexer:this},w),typeof A=="number"&&A>=0&&(_=Math.min(_,A))}),_<1/0&&_>=0&&(m=e.substring(0,_+1))}if(p=this.tokenizer.inlineText(m)){e=e.substring(p.raw.length),p.raw.slice(-1)!=="_"&&(d=p.raw.slice(-1)),r=!0;const _=s.at(-1);(_==null?void 0:_.type)==="text"?(_.raw+=p.raw,_.text+=p.text):s.push(p);continue}if(e){const _="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(_);break}else throw new Error(_)}}return s}},ts=class{constructor(t){Te(this,"options");Te(this,"parser");this.options=t||kt}space(t){return""}code({text:t,lang:e,escaped:s}){var r;const n=(r=(e||"").match(Ve.notSpaceStart))==null?void 0:r[0],i=t.replace(Ve.endingNewline,"")+`
`;return n?'<pre><code class="language-'+at(n)+'">'+(s?i:at(i,!0))+`</code></pre>
`:"<pre><code>"+(s?i:at(i,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){const e=t.ordered,s=t.start;let n="";for(let d=0;d<t.items.length;d++){const o=t.items[d];n+=this.listitem(o)}const i=e?"ol":"ul",r=e&&s!==1?' start="'+s+'"':"";return"<"+i+r+`>
`+n+"</"+i+`>
`}listitem(t){var s;let e="";if(t.task){const n=this.checkbox({checked:!!t.checked});t.loose?((s=t.tokens[0])==null?void 0:s.type)==="paragraph"?(t.tokens[0].text=n+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&t.tokens[0].tokens[0].type==="text"&&(t.tokens[0].tokens[0].text=n+" "+at(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:n+" ",text:n+" ",escaped:!0}):e+=n+" "}return e+=this.parser.parse(t.tokens,!!t.loose),`<li>${e}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",s="";for(let i=0;i<t.header.length;i++)s+=this.tablecell(t.header[i]);e+=this.tablerow({text:s});let n="";for(let i=0;i<t.rows.length;i++){const r=t.rows[i];s="";for(let d=0;d<r.length;d++)s+=this.tablecell(r[d]);n+=this.tablerow({text:s})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+n+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){const e=this.parser.parseInline(t.tokens),s=t.header?"th":"td";return(t.align?`<${s} align="${t.align}">`:`<${s}>`)+e+`</${s}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${at(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:s}){const n=this.parser.parseInline(s),i=ha(t);if(i===null)return n;t=i;let r='<a href="'+t+'"';return e&&(r+=' title="'+at(e)+'"'),r+=">"+n+"</a>",r}image({href:t,title:e,text:s,tokens:n}){n&&(s=this.parser.parseInline(n,this.parser.textRenderer));const i=ha(t);if(i===null)return at(s);t=i;let r=`<img src="${t}" alt="${s}"`;return e&&(r+=` title="${at(e)}"`),r+=">",r}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:at(t.text)}},Fs=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},ut=class Rs{constructor(e){Te(this,"options");Te(this,"renderer");Te(this,"textRenderer");this.options=e||kt,this.options.renderer=this.options.renderer||new ts,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Fs}static parse(e,s){return new Rs(s).parse(e)}static parseInline(e,s){return new Rs(s).parseInline(e)}parse(e,s=!0){var i,r;let n="";for(let d=0;d<e.length;d++){const o=e[d];if((r=(i=this.options.extensions)==null?void 0:i.renderers)!=null&&r[o.type]){const l=o,p=this.options.extensions.renderers[l.type].call({parser:this},l);if(p!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(l.type)){n+=p||"";continue}}const u=o;switch(u.type){case"space":{n+=this.renderer.space(u);continue}case"hr":{n+=this.renderer.hr(u);continue}case"heading":{n+=this.renderer.heading(u);continue}case"code":{n+=this.renderer.code(u);continue}case"table":{n+=this.renderer.table(u);continue}case"blockquote":{n+=this.renderer.blockquote(u);continue}case"list":{n+=this.renderer.list(u);continue}case"html":{n+=this.renderer.html(u);continue}case"paragraph":{n+=this.renderer.paragraph(u);continue}case"text":{let l=u,p=this.renderer.text(l);for(;d+1<e.length&&e[d+1].type==="text";)l=e[++d],p+=`
`+this.renderer.text(l);s?n+=this.renderer.paragraph({type:"paragraph",raw:p,text:p,tokens:[{type:"text",raw:p,text:p,escaped:!0}]}):n+=p;continue}default:{const l='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return n}parseInline(e,s=this.renderer){var i,r;let n="";for(let d=0;d<e.length;d++){const o=e[d];if((r=(i=this.options.extensions)==null?void 0:i.renderers)!=null&&r[o.type]){const l=this.options.extensions.renderers[o.type].call({parser:this},o);if(l!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=l||"";continue}}const u=o;switch(u.type){case"escape":{n+=s.text(u);break}case"html":{n+=s.html(u);break}case"link":{n+=s.link(u);break}case"image":{n+=s.image(u);break}case"strong":{n+=s.strong(u);break}case"em":{n+=s.em(u);break}case"codespan":{n+=s.codespan(u);break}case"br":{n+=s.br(u);break}case"del":{n+=s.del(u);break}case"text":{n+=s.text(u);break}default:{const l='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return n}},bs,Kt=(bs=class{constructor(t){Te(this,"options");Te(this,"block");this.options=t||kt}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}provideLexer(){return this.block?ct.lex:ct.lexInline}provideParser(){return this.block?ut.parse:ut.parseInline}},Te(bs,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"])),bs),ur=class{constructor(...t){Te(this,"defaults",Os());Te(this,"options",this.setOptions);Te(this,"parse",this.parseMarkdown(!0));Te(this,"parseInline",this.parseMarkdown(!1));Te(this,"Parser",ut);Te(this,"Renderer",ts);Te(this,"TextRenderer",Fs);Te(this,"Lexer",ct);Te(this,"Tokenizer",es);Te(this,"Hooks",Kt);this.use(...t)}walkTokens(t,e){var n,i;let s=[];for(const r of t)switch(s=s.concat(e.call(this,r)),r.type){case"table":{const d=r;for(const o of d.header)s=s.concat(this.walkTokens(o.tokens,e));for(const o of d.rows)for(const u of o)s=s.concat(this.walkTokens(u.tokens,e));break}case"list":{const d=r;s=s.concat(this.walkTokens(d.items,e));break}default:{const d=r;(i=(n=this.defaults.extensions)==null?void 0:n.childTokens)!=null&&i[d.type]?this.defaults.extensions.childTokens[d.type].forEach(o=>{const u=d[o].flat(1/0);s=s.concat(this.walkTokens(u,e))}):d.tokens&&(s=s.concat(this.walkTokens(d.tokens,e)))}}return s}use(...t){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(s=>{const n={...s};if(n.async=this.defaults.async||n.async||!1,s.extensions&&(s.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){const r=e.renderers[i.name];r?e.renderers[i.name]=function(...d){let o=i.renderer.apply(this,d);return o===!1&&(o=r.apply(this,d)),o}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const r=e[i.level];r?r.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),n.extensions=e),s.renderer){const i=this.defaults.renderer||new ts(this.defaults);for(const r in s.renderer){if(!(r in i))throw new Error(`renderer '${r}' does not exist`);if(["options","parser"].includes(r))continue;const d=r,o=s.renderer[d],u=i[d];i[d]=(...l)=>{let p=o.apply(i,l);return p===!1&&(p=u.apply(i,l)),p||""}}n.renderer=i}if(s.tokenizer){const i=this.defaults.tokenizer||new es(this.defaults);for(const r in s.tokenizer){if(!(r in i))throw new Error(`tokenizer '${r}' does not exist`);if(["options","rules","lexer"].includes(r))continue;const d=r,o=s.tokenizer[d],u=i[d];i[d]=(...l)=>{let p=o.apply(i,l);return p===!1&&(p=u.apply(i,l)),p}}n.tokenizer=i}if(s.hooks){const i=this.defaults.hooks||new Kt;for(const r in s.hooks){if(!(r in i))throw new Error(`hook '${r}' does not exist`);if(["options","block"].includes(r))continue;const d=r,o=s.hooks[d],u=i[d];Kt.passThroughHooks.has(r)?i[d]=l=>{if(this.defaults.async)return Promise.resolve(o.call(i,l)).then(m=>u.call(i,m));const p=o.call(i,l);return u.call(i,p)}:i[d]=(...l)=>{let p=o.apply(i,l);return p===!1&&(p=u.apply(i,l)),p}}n.hooks=i}if(s.walkTokens){const i=this.defaults.walkTokens,r=s.walkTokens;n.walkTokens=function(d){let o=[];return o.push(r.call(this,d)),i&&(o=o.concat(i.call(this,d))),o}}this.defaults={...this.defaults,...n}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return ct.lex(t,e??this.defaults)}parser(t,e){return ut.parse(t,e??this.defaults)}parseMarkdown(t){return(s,n)=>{const i={...n},r={...this.defaults,...i},d=this.onError(!!r.silent,!!r.async);if(this.defaults.async===!0&&i.async===!1)return d(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof s>"u"||s===null)return d(new Error("marked(): input parameter is undefined or null"));if(typeof s!="string")return d(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(s)+", string expected"));r.hooks&&(r.hooks.options=r,r.hooks.block=t);const o=r.hooks?r.hooks.provideLexer():t?ct.lex:ct.lexInline,u=r.hooks?r.hooks.provideParser():t?ut.parse:ut.parseInline;if(r.async)return Promise.resolve(r.hooks?r.hooks.preprocess(s):s).then(l=>o(l,r)).then(l=>r.hooks?r.hooks.processAllTokens(l):l).then(l=>r.walkTokens?Promise.all(this.walkTokens(l,r.walkTokens)).then(()=>l):l).then(l=>u(l,r)).then(l=>r.hooks?r.hooks.postprocess(l):l).catch(d);try{r.hooks&&(s=r.hooks.preprocess(s));let l=o(s,r);r.hooks&&(l=r.hooks.processAllTokens(l)),r.walkTokens&&this.walkTokens(l,r.walkTokens);let p=u(l,r);return r.hooks&&(p=r.hooks.postprocess(p)),p}catch(l){return d(l)}}}onError(t,e){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,t){const n="<p>An error occurred:</p><pre>"+at(s.message+"",!0)+"</pre>";return e?Promise.resolve(n):n}if(e)return Promise.reject(s);throw s}}},ht=new ur;function ke(t,e){return ht.parse(t,e)}ke.options=ke.setOptions=function(t){return ht.setOptions(t),ke.defaults=ht.defaults,za(ke.defaults),ke};ke.getDefaults=Os;ke.defaults=kt;ke.use=function(...t){return ht.use(...t),ke.defaults=ht.defaults,za(ke.defaults),ke};ke.walkTokens=function(t,e){return ht.walkTokens(t,e)};ke.parseInline=ht.parseInline;ke.Parser=ut;ke.parser=ut.parse;ke.Renderer=ts;ke.TextRenderer=Fs;ke.Lexer=ct;ke.lexer=ct.lex;ke.Tokenizer=es;ke.Hooks=Kt;ke.parse=ke;ke.options;ke.setOptions;ke.use;ke.walkTokens;ke.parseInline;ut.parse;ct.lex;let Pt=null;function dr(){if(typeof window<"u")return window;if(typeof globalThis<"u"&&globalThis.window)return globalThis.window}function pr(){if(Pt)return Pt;const t=dr();return t?(Pt=Ei(t),Pt.setConfig({USE_PROFILES:{html:!0}}),Pt):null}function ns(t){if(!t)return"";const e=pr();return e?e.sanitize(t,{ALLOWED_URI_REGEXP:/^(?:(?:https?|mailto|tel|data:image\/(?:png|jpeg|gif|webp));|[^a-z]|[a-z+.-]+:)/i}):t.replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi,"")}ke.use({breaks:!0,gfm:!0,mangle:!1,headerIds:!1});function Wa(t){if(!t)return"";const e=ke.parse(t,{async:!1}),s=typeof e=="string"?e:String(e);return ns(s)}function ba(t,e=0){const s=Number(t);return Number.isFinite(s)?s:e}const fr=pt({total:Xe().optional(),passed:Xe().optional()}).partial().transform(t=>({total:ba(t.total,0),passed:ba(t.passed,0)})),mr=pt({checks:Ft(fr).optional(),suggestions:dt(Ft(Xe())).optional(),releaseNotesMarkdown:Ze().optional(),releaseNotesHtml:Ze().optional()}).passthrough().transform(t=>{const e=t.checks??{},n=(Array.isArray(t.suggestions)?t.suggestions:[]).map((d,o)=>({id:typeof d.id=="string"&&d.id.trim()?d.id.trim():`suggestion-${o+1}`,scope:typeof d.scope=="string"&&d.scope.trim()?d.scope.trim():"general",title:typeof d.title=="string"?d.title:"Suggerimento",description:typeof d.description=="string"?d.description:"",applied:!!d.applied,running:!!d.running,error:typeof d.error=="string"&&d.error.trim()?d.error.trim():void 0})),i=typeof t.releaseNotesMarkdown=="string"?t.releaseNotesMarkdown:"",r=typeof t.releaseNotesHtml=="string"?ns(t.releaseNotesHtml):i?Wa(i):"";return{...t,checks:e,suggestions:n,releaseNotesMarkdown:i,releaseNotesHtml:r}}),gr=pt({id:Ze().optional(),channel:Ze().optional(),message:Ze().optional(),lastTriggeredAt:Ze().optional().nullable()}).partial(),hr=pt({notifications:dt(gr).optional()}).passthrough().transform(t=>{const e=(t.notifications??[]).map((s,n)=>({id:s.id&&s.id.trim()?s.id.trim():`notification-${n+1}`,channel:s.channel&&s.channel.trim()?s.channel.trim():"Canale interno",message:ns(s.message||""),lastTriggeredAt:typeof s.lastTriggeredAt=="string"&&s.lastTriggeredAt.trim()?s.lastTriggeredAt:null}));return{...t,notifications:e}}),_r=pt({releaseNotesMarkdown:Ze().optional(),releaseNotesHtml:Ze().optional(),releaseConsole:hr.optional()}).passthrough().transform(t=>{const e=typeof t.releaseNotesMarkdown=="string"?t.releaseNotesMarkdown:"",s=typeof t.releaseNotesHtml=="string"?ns(t.releaseNotesHtml):e?Wa(e):"";return{...t,releaseNotesMarkdown:e,releaseNotesHtml:s,releaseConsole:t.releaseConsole??{notifications:[]}}}),vr=pt({qualityRelease:Xe().optional().transform(t=>mr.parse(t??{})),qualityReleaseContext:Xe().optional().transform(t=>_r.parse(t??{}))}).passthrough();function ya(t){const e=t??{};return vr.parse(e)}function br(t){if(!(typeof t>"u")){if(t===null||typeof t=="string"&&t.trim().toLowerCase()==="null")return null;if(typeof t=="string"){const e=t.trim();return e.length?e:void 0}return t}}function yr(t,{refresh:e=!1}={}){if(!e)return t;const s=t.includes("?")?"&":"?";return`${t}${s}refresh=1`}function Qa(t){if(!t)return null;const e=t.toLowerCase();return e.includes("/data/flow/")||e.includes("data/flow/")||e.includes("/data/nebula/")||e.includes("data/nebula/")||e.includes("assets/demo/")?"demo":"fallback"}function kr(t={}){const e=t.logger||null,s=vt("flowSnapshot",{endpoint:Object.prototype.hasOwnProperty.call(t,"snapshotUrl")?t.snapshotUrl:void 0,fallback:Object.prototype.hasOwnProperty.call(t,"fallbackSnapshotUrl")?br(t.fallbackSnapshotUrl):void 0}),n=s.endpoint||"/api/v1/generation/snapshot",i=bt(n),r=s.fallback??(gt()?"data/flow/snapshots/flow-shell-snapshot.json":null),d=r?yt(r):null,o=gn(t.fetch),u=Pe({snapshot:null,loading:!1,error:null,source:null,fallbackLabel:null,lastUpdatedAt:null,meta:null,refreshing:!1}),l=!!t.preferFallbackFirst||!t.forceRemote&&!t.preferRemote&&!t.disableFallbackPreference&&d&&d!==i&&gt();async function p({force:x=!1,refresh:D=!1}={}){var _e;if(u.snapshot&&!x&&!D)return u.snapshot;const ne=!!u.snapshot,ge=(D||x)&&ne;u.loading=!0,u.refreshing=!!ge,u.error=null;const K=!x&&!D&&l;try{const Y=await ri({attemptPrimary:async()=>{const $=yr(i,{refresh:x||D}),z=await o($,{cache:"no-store"});if(!z.ok){const J=new Error("errors.snapshot.remote_unavailable");throw J.status=z.status,J}const X=await z.json();try{return{data:ya(X),meta:{url:$}}}catch(J){throw J instanceof ys?ks(J,"Snapshot remoto non valido",{code:"snapshot.invalid"}):ws(J,"Snapshot remoto non valido",{code:"snapshot.invalid"})}},attemptFallback:d?async()=>{const $=await o(d,{cache:"no-store"});if(!$.ok){const X=new Error("errors.snapshot.fallback_unavailable");throw X.status=$.status,X}const z=await $.json();try{return{data:ya(z),meta:{url:d}}}catch(X){throw X instanceof ys?ks(X,"Snapshot fallback non valido",{code:"snapshot.invalid"}):ws(X,"Snapshot fallback non valido",{code:"snapshot.invalid"})}}:null,preferFallbackFirst:K,logger:e,scope:"snapshot",events:{primaryStart:{event:"snapshot.load.start",message:"log.snapshot.load.start"},primarySuccess:{event:"snapshot.load.success",level:"info",message:"log.snapshot.load.success",metaBuilder:$=>{var z;return{source:(z=$.meta)==null?void 0:z.url,fallback:!1}}},primaryFailure:{event:"snapshot.load.failed",level:"error",message:"log.snapshot.load.failed"},fallbackPreferred:{event:"snapshot.load.preferred",level:"info",message:"log.snapshot.load.preferred"},fallbackFirstFailure:{event:"snapshot.load.preferred.failed",level:"warning",message:"log.snapshot.load.preferred_failed"},fallbackStart:{event:"snapshot.load.fallback.start",level:"warning",message:"log.snapshot.load.fallback_start"},fallbackSuccess:{event:"snapshot.load.fallback.success",level:"warning",message:"log.snapshot.load.fallback_success",metaBuilder:$=>{var z;return{source:(z=$.meta)==null?void 0:z.url,fallback:!0}}},fallbackFailure:{event:"snapshot.load.fallback.failed",level:"error",message:"log.snapshot.load.fallback_failed"}}});return u.snapshot=(Y==null?void 0:Y.data)??{},u.meta=(Y==null?void 0:Y.meta)||{},u.source=(Y==null?void 0:Y.source)??"remote",u.error=null,u.lastUpdatedAt=Date.now(),u.fallbackLabel=u.source==="fallback"?Qa((_e=Y==null?void 0:Y.meta)==null?void 0:_e.url):null,u.snapshot}catch(Y){throw u.error=Y,u.snapshot=null,u.meta=null,u.source=null,u.fallbackLabel=null,Y}finally{u.loading=!1,u.refreshing=!1}}let m=null;const _=()=>{m&&clearTimeout(m),m=setTimeout(()=>{m=null,!u.loading&&p({refresh:!0}).catch(()=>{})},250)};let w;e&&typeof e.on=="function"&&(w=e.on("snapshot.invalidate",_));const A=()=>{m&&(clearTimeout(m),m=null),w?w():e&&typeof e.off=="function"&&e.off("snapshot.invalidate",_)};hn()&&_n(A);const S=y(()=>u.snapshot||{}),T=y(()=>{var x;return((x=S.value)==null?void 0:x.overview)||{objectives:[],blockers:[],completion:{}}}),C=y(()=>{var x;return((x=S.value)==null?void 0:x.species)||{curated:0,total:0,shortlist:[]}}),ee=y(()=>{var x;return((x=S.value)==null?void 0:x.biomeSetup)||{config:{},graph:{},validators:[]}}),R=y(()=>{var x;return((x=S.value)==null?void 0:x.biomes)||[]}),N=y(()=>{var x;return((x=S.value)==null?void 0:x.biomeSummary)||{validated:0,pending:0}}),I=y(()=>{var x;return((x=S.value)==null?void 0:x.encounter)||{}}),q=y(()=>{var x;return((x=S.value)==null?void 0:x.encounterSummary)||{variants:0,seeds:0}}),E=y(()=>{var x;return((x=S.value)==null?void 0:x.qualityRelease)||{checks:{}}}),F=y(()=>{var x;return((x=S.value)==null?void 0:x.publishing)||{}}),te=y(()=>{var x;return Array.isArray((x=S.value)==null?void 0:x.suggestions)?S.value.suggestions:[]}),he=y(()=>{var x;return Array.isArray((x=S.value)==null?void 0:x.notifications)?S.value.notifications:[]}),me=y(()=>{var x;return((x=S.value)==null?void 0:x.qualityReleaseContext)||{}}),re=y(()=>{var K;const x=((K=T.value)==null?void 0:K.completion)||{},D=Number(x.total)||0,ne=Number(x.completed)||0,ge=D>0?Math.round(ne/D*100):0;return{label:`Sincronizzazione ${ge}%`,percent:ge}}),Ae=y(()=>{var _e,Y,$,z,X,J,be,$e,k,j,O,ce,G,ue,oe,c,v,P,Z;const x=((_e=E.value)==null?void 0:_e.checks)||{},D=Object.values(x).reduce((de,fe)=>de+(Number(fe==null?void 0:fe.total)||0),0),ne=Object.values(x).reduce((de,fe)=>de+(Number(fe==null?void 0:fe.passed)||0),0),ge=(Number((Y=N.value)==null?void 0:Y.validated)||0)+(Number(($=N.value)==null?void 0:$.pending)||0),K=(Number((z=q.value)==null?void 0:z.variants)||0)+(Number((X=q.value)==null?void 0:X.seeds)||0);return{overview:{completed:Number((be=(J=T.value)==null?void 0:J.completion)==null?void 0:be.completed)||0,total:Number((k=($e=T.value)==null?void 0:$e.completion)==null?void 0:k.total)||0,label:"Milestone"},species:{completed:Number((j=C.value)==null?void 0:j.curated)||0,total:Number((O=C.value)==null?void 0:O.total)||0,label:"Specie"},biomeSetup:{completed:Number((G=(ce=S.value)==null?void 0:ce.biomeSetup)==null?void 0:G.prepared)||0,total:Number((oe=(ue=S.value)==null?void 0:ue.biomeSetup)==null?void 0:oe.total)||0,label:"Preset"},biomes:{completed:Number((c=N.value)==null?void 0:c.validated)||0,total:ge,label:"Biomi"},encounter:{completed:Number((v=q.value)==null?void 0:v.variants)||0,total:K,label:"Varianti"},qualityRelease:{completed:ne,total:D,label:"Check QA"},publishing:{completed:Number((P=F.value)==null?void 0:P.artifactsReady)||0,total:Number((Z=F.value)==null?void 0:Z.totalArtifacts)||0,label:"Artefatti"}}}),Oe=y(()=>u.loading),De=y(()=>u.error),Fe=y(()=>u.source),M=y(()=>u.fallbackLabel),H=y(()=>u.lastUpdatedAt),se=y(()=>u.refreshing),L=y(()=>!!u.snapshot);return{state:u,snapshot:S,overview:T,speciesStatus:C,biomeSetup:ee,biomes:R,biomeSummary:N,encounter:I,encounterSummary:q,qualityRelease:E,publishing:F,suggestions:te,notifications:he,qualityContext:me,timeline:re,metrics:Ae,loading:Oe,error:De,source:Fe,fallbackLabel:M,lastUpdatedAt:H,refreshing:se,hasSnapshot:L,fetchSnapshot:p}}function Tt(t){if(t==null)return null;const e=String(t).trim();return e.length?e:null}function ka(t){return t?typeof t=="string"?t.trim()?[t.trim()]:[]:Array.isArray(t)?t.map(e=>typeof e=="string"?e.trim():String(e||"").trim()).filter(e=>!!e.length):[]:[]}function Za(t={}){const e=t&&typeof t.corrected=="object"&&t.corrected!==null?{...t.corrected}:null,s=Array.isArray(t==null?void 0:t.messages)?t.messages.filter(Boolean).map(i=>{if(typeof i=="string")return{level:"info",message:i};const r=i.level||i.severity||"info",d=i.code||null,o=i.subject||i.scope||null,u=i.context&&typeof i.context=="object"?{...i.context}:void 0;return{level:r,code:d||void 0,message:i.message||i.text||"",subject:o||void 0,context:u}}):[],n=Array.isArray(t==null?void 0:t.discarded)?[...t.discarded]:[];return{corrected:e,messages:s,discarded:n}}function wr(t={}){const e={};return t&&typeof t=="object"&&Object.entries(t).forEach(([s,n])=>{n!==void 0&&(e[s]=n)}),e.request_id&&!e.requestId&&(e.requestId=e.request_id),!e.request_id&&e.requestId&&(e.request_id=e.requestId),e}function Sr(t={}){return!t||typeof t!="object"?{}:{...t}}function Ya(t={}){const e=Sr(t.blueprint||t),s=Za(t.validation||{}),n=wr(t.meta||{});return{blueprint:e,validation:s,meta:n}}function $r(t={}){const e=Number.isFinite(t.index)?t.index:0,s=typeof t.error=="string"?t.error:"Errore generazione specie",n=Tt(t.request_id||t.requestId);return{index:e,error:s,request_id:n,requestId:n||void 0}}function Bs(t={}){const e=ka(t.trait_ids||t.traits),s=ka(t.fallback_trait_ids||t.fallbackTraits);return{trait_ids:e,biome_id:Tt(t.biome_id||t.biomeId),seed:t.seed??null,base_name:Tt(t.base_name||t.baseName),request_id:Tt(t.request_id||t.requestId),fallback_trait_ids:s,dataset_id:Tt(t.dataset_id||t.datasetId),profile_id:Tt(t.profile_id||t.profileId)}}function Xa(t,e){return t&&typeof t.endpoint=="string"&&t.endpoint.trim()?t.endpoint:e}function Ka(t,e){if(t&&Object.prototype.hasOwnProperty.call(t,"fallback")){if(t.fallback===null)return null;if(typeof t.fallback=="string"&&t.fallback.trim())return t.fallback.trim()}return e}function Ja(t){return t&&Object.prototype.hasOwnProperty.call(t,"allowFallback")?!!t.allowFallback:gt()}async function Ar(t,e={}){const s=Bs(t||{});if(!s.trait_ids.length)throw new Error("trait_ids richiesti per la generazione specie");const n=vt("generationSpecies",{endpoint:Object.prototype.hasOwnProperty.call(e,"endpoint")?e.endpoint:void 0,fallback:Object.prototype.hasOwnProperty.call(e,"fallback")?e.fallback:void 0}),i=bt(Xa(e,n.endpoint)),r=Ka(e,n.fallback),d=r?yt(r):null,o=await Rt(i,{requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),signal:e.signal},fallbackUrl:d,allowFallback:Ja(e),errorMessage:"Errore generazione specie",fallbackErrorMessage:"Snapshot specie di fallback non disponibile"}),{data:u,error:l}=o,p=o.source,m=Ya(u),_={...m.meta||{}};return _.endpoint_source=p,_.endpoint_url=p==="fallback"&&d?d:i,p==="fallback"&&(_.fallback_used=!0,_.fallback_active=!0,_.fallback_error=l?l.message:"Richiesta remota non disponibile"),m.meta=_,m}function Cs(t){return Array.isArray(t)?t.map(e=>Bs(e)).filter(e=>Array.isArray(e.trait_ids)&&e.trait_ids.length):[]}async function Tr(t,e={}){const s=Array.isArray(t==null?void 0:t.batch)?Cs(t.batch):Cs(t);if(!s.length)return{results:[],errors:[]};const n=vt("generationSpeciesBatch",{endpoint:Object.prototype.hasOwnProperty.call(e,"endpoint")?e.endpoint:void 0,fallback:Object.prototype.hasOwnProperty.call(e,"fallback")?e.fallback:void 0}),i=bt(Xa(e,n.endpoint)),r=Ka(e,n.fallback),d=r?yt(r):null,u=await Rt(i,{requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({batch:s}),signal:e.signal},fallbackUrl:d,allowFallback:Ja(e),errorMessage:"Errore generazione batch specie",fallbackErrorMessage:"Batch di fallback non disponibile"}),{data:l,error:p}=u,m=u.source,_=Array.isArray(l==null?void 0:l.results)?l.results.map(T=>Ya(T)):[],w=Array.isArray(l==null?void 0:l.errors)?l.errors.map(T=>$r(T)):[],A=m==="fallback"&&d?d:i;return{results:_.map(T=>{const C={...T.meta||{}};return C.endpoint_source=m,C.endpoint_url=A,m==="fallback"&&(C.fallback_used=!0,C.fallback_active=!0,C.fallback_error=p?p.message:"Richiesta remota non disponibile"),{...T,meta:C}}),errors:w,endpoint_source:m,endpoint_url:A}}function wa(t={}){const e=Za(t),s=e.messages.length,n=e.messages.filter(r=>r.level==="warning").length,i=e.messages.filter(r=>r.level==="error").length;return{total:s,warnings:n,errors:i,discarded:Array.isArray(e.discarded)?e.discarded.length:0,corrected:e.corrected?1:0}}const xr={normaliseRequest:Bs,normaliseBatchEntries:Cs},{normaliseRequest:Er,normaliseBatchEntries:Rr}=xr,Cr={endpoint:void 0,fallback:void 0,allowFallback:void 0},Ir={endpoint:void 0,fallback:void 0,allowFallback:void 0},_s=new Map,vs=new Map;function Sa(t){if(t instanceof Error)return t;if(typeof t=="string")return new Error(t);const e=new Error("errors.species.unknown");return Object.defineProperty(e,"cause",{value:t,configurable:!0}),e}function Or(t){const e={...t,trait_ids:Array.isArray(t.trait_ids)?[...t.trait_ids].sort():[],fallback_trait_ids:Array.isArray(t.fallback_trait_ids)?[...t.fallback_trait_ids].sort():[]};return JSON.stringify(e)}function qr(t){const e=t.map(s=>({...s,trait_ids:Array.isArray(s.trait_ids)?[...s.trait_ids].sort():[],fallback_trait_ids:Array.isArray(s.fallback_trait_ids)?[...s.fallback_trait_ids].sort():[]})).sort((s,n)=>JSON.stringify(s).localeCompare(JSON.stringify(n)));return JSON.stringify(e)}function Nr(){return{corrected:null,messages:[],discarded:[]}}function Lr(t={}){const e=t.logger||null,s={...Cr,...t.speciesOptions||{}},n={...Ir,...t.batchOptions||{}},i=Pe({loading:!1,error:null,result:null,lastRequest:null,loadingBatch:!1,batchError:null,lastBatchResult:null,source:null,lastUpdatedAt:null}),r=(q,E={})=>{e&&typeof e.log=="function"&&e.log(q,{scope:"species",...E})};async function d(q,{force:E=!1}={}){var he,me,re,Ae,Oe,De,Fe,M,H,se,L,x,D,ne,ge,K,_e,Y,$,z,X,J,be,$e,k,j,O,ce;const F=Er(q||{});if(!Array.isArray(F.trait_ids)||!F.trait_ids.length){const G=new Error("errors.species.trait_ids_required");return i.error=G,Promise.reject(G)}const te=Or(F);if(!E&&_s.has(te)){const G=_s.get(te);i.result=G.result,i.lastRequest=G.request,i.source=((me=(he=G.result)==null?void 0:he.meta)==null?void 0:me.endpoint_source)||"remote",i.lastUpdatedAt=G.timestamp;const ue=wa(((re=G.result)==null?void 0:re.validation)||{}),oe=!!(((Oe=(Ae=G.result)==null?void 0:Ae.meta)==null?void 0:Oe.fallback_used)??((Fe=(De=G.result)==null?void 0:De.meta)==null?void 0:Fe.fallbackUsed)??((H=(M=G.result)==null?void 0:M.meta)==null?void 0:H.fallback_active));return r("species.cache.hit",{level:"info",message:oe?"log.species.cache_fallback":"log.species.cache_hit",request_id:((L=(se=G.result)==null?void 0:se.meta)==null?void 0:L.request_id)||((x=G.request)==null?void 0:x.request_id)||null,meta:((D=G.result)==null?void 0:D.meta)||null,validation:ue}),oe&&r("species.fallback.cached",{level:"warning",message:"log.species.fallback_cached",request_id:((ge=(ne=G.result)==null?void 0:ne.meta)==null?void 0:ge.request_id)||((K=G.request)==null?void 0:K.request_id)||null,meta:((_e=G.result)==null?void 0:_e.meta)||null}),ue.warnings>0&&r("species.validation.cached",{level:"warning",message:"log.species.validation_cached",request_id:(($=(Y=G.result)==null?void 0:Y.meta)==null?void 0:$.request_id)||((z=G.request)==null?void 0:z.request_id)||null,validation:ue}),G.result}i.loading=!0,i.error=null,r("species.requested",{level:"info",message:"log.species.requested",request_id:F.request_id||null,meta:{biome_id:F.biome_id,trait_ids:F.trait_ids,seed:F.seed}});try{const G=await Ar(F,s),ue=wa(G.validation);return _s.set(te,{result:G,request:F,timestamp:Date.now()}),i.result=G,i.lastRequest=F,i.source=((X=G.meta)==null?void 0:X.endpoint_source)||"remote",i.lastUpdatedAt=Date.now(),r("species.success",{level:ue.errors>0?"warning":"success",message:ue.errors>0?"log.species.success_with_errors":"log.species.success",request_id:((J=G.meta)==null?void 0:J.request_id)||F.request_id||null,meta:G.meta||null,validation:ue}),!!(((be=G.meta)==null?void 0:be.fallback_used)??(($e=G.meta)==null?void 0:$e.fallbackUsed)??((k=G.meta)==null?void 0:k.fallback_active))&&r("species.fallback",{level:"warning",message:"log.species.fallback_triggered",request_id:((j=G.meta)==null?void 0:j.request_id)||F.request_id||null,meta:G.meta||null}),ue.warnings>0&&r("species.validation.warning",{level:"warning",message:"log.species.validation_warning",request_id:((O=G.meta)==null?void 0:O.request_id)||F.request_id||null,validation:ue}),e&&typeof e.log=="function"&&e.log("snapshot.invalidate",{scope:"snapshot",level:"info",meta:{source:"species",request_id:((ce=G.meta)==null?void 0:ce.request_id)||F.request_id||null}}),G}catch(G){const ue=Sa(G);throw i.error=ue,r("species.failed",{level:"error",message:"log.species.failed",request_id:F.request_id||null,meta:{biome_id:F.biome_id,trait_ids:F.trait_ids}}),ue}finally{i.loading=!1}}async function o(q,{force:E=!1}={}){var he,me;const F=Rr(Array.isArray(q)?q:[]);if(!F.length)return{results:[],errors:[]};const te=qr(F);if(!E&&vs.has(te)){const re=vs.get(te);return i.lastBatchResult=re.result,r("species.batch.cache",{scope:"flow",level:"info",message:"log.species.batch_cache_hit",meta:{entries:F.length,endpoint_source:((he=re.result)==null?void 0:he.endpoint_source)||null,endpoint_url:((me=re.result)==null?void 0:me.endpoint_url)||null}}),re.result}i.loadingBatch=!0,i.batchError=null,r("species.batch.requested",{scope:"flow",level:"info",message:"log.species.batch_requested",meta:{entries:F.length}});try{const re=await Tr({batch:F},n);return vs.set(te,{result:re,entries:F,timestamp:Date.now()}),i.lastBatchResult=re,r("species.batch.success",{scope:"flow",level:re.errors.length?"warning":"success",message:"log.species.batch_success",meta:{entries:F.length,success:re.results.length,errors:re.errors.length,endpoint_source:re.endpoint_source,endpoint_url:re.endpoint_url}}),re}catch(re){const Ae=Sa(re);throw i.batchError=Ae,r("species.batch.failed",{scope:"flow",level:"error",message:"log.species.batch_failed",meta:{entries:F.length}}),Ae}finally{i.loadingBatch=!1}}function u(){var q;return!!(i.lastRequest&&((q=i.lastRequest.trait_ids)!=null&&q.length))}async function l({force:q=!0}={}){if(!u())throw new Error("errors.species.retry_unavailable");return d(i.lastRequest,{force:q})}const p=y(()=>{var q;return((q=i.result)==null?void 0:q.blueprint)||null}),m=y(()=>{var q;return((q=i.result)==null?void 0:q.meta)||{}}),_=y(()=>{var q;return((q=i.result)==null?void 0:q.validation)||Nr()}),w=y(()=>{var q,E;return((q=m.value)==null?void 0:q.request_id)||((E=m.value)==null?void 0:E.requestId)||null}),A=y(()=>i.loading),S=y(()=>i.error),T=y(()=>i.loadingBatch),C=y(()=>i.batchError),ee=y(()=>i.lastBatchResult),R=y(()=>i.source||"remote"),N=y(()=>i.lastUpdatedAt),I=y(()=>R.value==="fallback");return{state:i,blueprint:p,meta:m,validation:_,requestId:w,loading:A,error:S,source:R,fallbackActive:I,lastUpdatedAt:N,loadingBatch:T,batchError:C,lastBatchResult:ee,runSpecies:d,runSpeciesBatch:o,retry:l,canRetry:u}}function zr(t,e){if(t&&Object.prototype.hasOwnProperty.call(t,"fallback")){if(t.fallback===null)return null;if(typeof t.fallback=="string"&&t.fallback.trim())return t.fallback.trim()}return e}function Mr(t){return t&&Object.prototype.hasOwnProperty.call(t,"allowFallback")?!!t.allowFallback:gt()}async function Pr(t={}){const e=vt("traitDiagnostics",{endpoint:Object.prototype.hasOwnProperty.call(t,"endpoint")?t.endpoint:void 0,fallback:Object.prototype.hasOwnProperty.call(t,"fallback")?t.fallback:void 0}),s=bt(t.endpoint||e.endpoint),n=t.refresh?"?refresh=true":"",i=`${s}${n}`,r=zr(t,e.fallback),d=r?yt(r):null,o=await Rt(i,{requestInit:{method:"GET",headers:{Accept:"application/json"},cache:"no-store"},fallbackUrl:d,allowFallback:Mr(t),errorMessage:"Errore caricamento trait diagnostics",fallbackErrorMessage:"Trait diagnostics locali non disponibili"}),{data:u,error:l}=o,p=o.source,m=u||{},_=(m==null?void 0:m.diagnostics)||m||{},w={...(m==null?void 0:m.meta)||{}};return w.endpoint_source=p,w.endpoint_url=p==="fallback"&&d?d:s,p==="fallback"&&(w.fallback_error=l?l.message:"Richiesta remota non disponibile"),{diagnostics:_,meta:w}}function Dr(t){if(t instanceof Error)return t;if(typeof t=="string")return new Error(t);const e=new Error("errors.traitDiagnostics.unknown");return Object.defineProperty(e,"cause",{value:t,configurable:!0}),e}function Fr(t={}){const e=t.logger||null,s=t.service||Pr,n=t.traitDiagnosticsOptions||{},i=Pe({diagnostics:null,meta:null,loading:!1,error:null,source:null,fallbackLabel:null,lastUpdatedAt:null}),r=(C,ee={})=>{e&&typeof e.log=="function"&&e.log(C,{scope:"quality",...ee})};async function d({force:C=!1,refresh:ee=!1}={}){if(i.diagnostics&&!C&&!ee)return i.diagnostics;i.loading=!0,i.error=null,r("traitDiagnostics.requested",{level:"info",message:ee?"log.traitDiagnostics.refresh":"log.traitDiagnostics.requested",meta:{refresh:ee}});try{const{diagnostics:R,meta:N}=await s({...n,refresh:ee});i.diagnostics=R||{},i.meta=N||{},i.source=(N==null?void 0:N.endpoint_source)||"remote";const I=N==null?void 0:N.endpoint_url;return i.fallbackLabel=i.source==="fallback"?Qa(I||null):null,i.lastUpdatedAt=Date.now(),r("traitDiagnostics.success",{level:i.source==="fallback"?"warning":"info",message:i.source==="fallback"?"log.traitDiagnostics.success_fallback":"log.traitDiagnostics.success",meta:N}),i.source==="fallback"&&r("traitDiagnostics.fallback",{level:"warning",message:"log.traitDiagnostics.fallback",meta:N}),i.diagnostics}catch(R){const N=Dr(R);throw i.error=N,r("traitDiagnostics.failed",{level:"error",message:"log.traitDiagnostics.failed"}),N}finally{i.loading=!1}}async function o(){return d({force:!0,refresh:!0})}const u=y(()=>i.diagnostics||{}),l=y(()=>i.meta||{}),p=y(()=>i.loading),m=y(()=>i.error),_=y(()=>i.source||"remote"),w=y(()=>i.fallbackLabel),A=y(()=>i.lastUpdatedAt),S=y(()=>{var E;const C=Array.isArray((E=u.value)==null?void 0:E.traits)?u.value.traits:[],ee={},R={},N={},I={},q={};for(const F of C){if(!F||typeof F!="object")continue;const te=F.id||void 0;te&&(ee[te]=F.label||te,Array.isArray(F.synergies)&&(R[te]=F.synergies.filter(Boolean)),Array.isArray(F.usage_tags)&&(N[te]=F.usage_tags.filter(Boolean)),F.completion_flags&&typeof F.completion_flags=="object"&&(I[te]=F.completion_flags),Array.isArray(F.species_affinity)&&(q[te]=F.species_affinity))}return{traits:C,labels:ee,synergyMap:R,usageTags:N,completionFlags:I,speciesAffinity:q}}),T=y(()=>{var he,me,re,Ae;const C=((he=u.value)==null?void 0:he.summary)||{},ee=Number(C.total_traits)||0,R=Number(C.glossary_ok)||0,N=Math.max(ee-R,0),I=Number(C.matrix_mismatch)||0,q=Number(C.matrix_only_traits)||0,E=Number(C.with_conflicts)||0,F=[];ee>0&&F.push({id:"glossary",label:N===0?"Glossario OK":"Glossario incompleto",value:`${R}/${ee}`,tone:N===0?"success":"warning"});const te=I+q;return F.push({id:"matrix",label:te===0?"Matrix OK":"Matrix mismatch",value:te===0?"0 mismatch":`${te} mismatch`,tone:te===0?"success":"warning"}),F.push({id:"conflicts",label:E===0?"Conflicts OK":"Conflicts attivi",value:`${E}`,tone:E===0?"neutral":"warning"}),{badges:F,summary:C,generatedAt:((me=u.value)==null?void 0:me.generated_at)||((re=u.value)==null?void 0:re.generatedAt)||null,matrixOnlyTraits:((Ae=u.value)==null?void 0:Ae.matrix_only_traits)||[]}});return{state:i,diagnostics:u,meta:l,loading:p,error:m,source:_,fallbackLabel:w,lastUpdatedAt:A,traitCatalog:S,traitCompliance:T,load:d,reload:o}}const Br={class:"flow-view"},Ur={__name:"OverviewView",props:{overview:{type:Object,required:!0},timeline:{type:Object,required:!0},qualityRelease:{type:Object,default:()=>({})}},setup(t){const e=t,{overview:s,timeline:n,qualityRelease:i}=_t(e),r=vn({overview:s,timeline:n,qualityRelease:i});return(d,o)=>(f(),g("section",Br,[pe(bn,{header:ae(r).header,cards:ae(r).cards,"timeline-entries":ae(r).timelineEntries,"evolution-matrix":ae(r).evolutionMatrix,share:ae(r).share},null,8,["header","cards","timeline-entries","evolution-matrix","share"])]))}},$a=ye(Ur,[["__scopeId","data-v-f85f2813"]]),jr={class:"nebula-shell"},Vr={class:"nebula-shell__frame"},Hr={class:"nebula-shell__header"},Gr={key:0,class:"nebula-shell__status-grid"},Wr=["data-tone"],Qr={class:"nebula-shell__status-label"},Zr={class:"nebula-shell__status-value"},Yr={class:"nebula-shell__actions"},Xr={class:"nebula-shell__cards"},Kr={key:0,class:"nebula-shell__tabs","aria-label":"Navigazione schede",role:"tablist"},Jr=["id","aria-controls","aria-selected","tabindex","onClick","onKeydown"],el={class:"nebula-shell__tab-icon","aria-hidden":"true"},tl=["id","aria-labelledby"],sl={class:"nebula-shell__footer"},al={__name:"NebulaShell",props:{tabs:{type:Array,default:()=>[]},statusIndicators:{type:Array,default:()=>[]},modelValue:{type:String,default:""}},emits:["update:modelValue","tab-change"],setup(t,{emit:e}){let s=0;const n=t,i=e,r=`nebula-shell-${++s}`,d=y(()=>(n.tabs||[]).map((S,T)=>({...S,tabId:S.tabId||`${r}-tab-${T}`,panelId:S.panelId||`${r}-panel-${T}`}))),o=y(()=>{if(n.modelValue)return n.modelValue;const[S]=d.value||[];return(S==null?void 0:S.id)||""}),u=Ee(o.value),l=Ee([]),p=y(()=>d.value.find(S=>S.id===u.value)||null);Ce(d,()=>{l.value=[]},{flush:"post"}),Ce(o,S=>{S&&u.value!==S&&(u.value=S)}),Ce(()=>n.modelValue,S=>{S&&S!==u.value&&(u.value=S)}),Ce(()=>{var S;return(S=n.tabs)==null?void 0:S.length},()=>{var S;(S=n.tabs)!=null&&S.some(T=>T.id===u.value)||(u.value=o.value)});function m(S){u.value!==S&&(u.value=S,i("update:modelValue",S),i("tab-change",S))}function _(S,T){l.value[T]=S||null}function w(S){const T=l.value[S];T!=null&&T.focus&&T.focus()}function A(S,T){const C=S.key;if(!["ArrowRight","ArrowLeft","Home","End"].includes(C))return;S.preventDefault();const ee=d.value.length;if(!ee)return;if(C==="Home"){m(d.value[0].id),w(0);return}if(C==="End"){const I=ee-1;m(d.value[I].id),w(I);return}const N=(T+(C==="ArrowRight"?1:-1)+ee)%ee;m(d.value[N].id),w(N)}return(S,T)=>(f(),g("section",jr,[a("div",Vr,[a("header",Hr,[t.statusIndicators.length?(f(),g("div",Gr,[(f(!0),g(W,null,Q(t.statusIndicators,C=>(f(),g("div",{key:C.id||C.label,class:"nebula-shell__status"},[a("span",{class:"nebula-shell__status-led","data-tone":C.tone||"neutral"},null,8,Wr),a("div",null,[a("p",Qr,h(C.label),1),a("p",Zr,h(C.value),1)])]))),128))])):U("",!0),a("div",Yr,[Ie(S.$slots,"actions",{},void 0,!0)])]),a("div",Xr,[Ie(S.$slots,"cards",{},void 0,!0)]),d.value.length?(f(),g("nav",Kr,[(f(!0),g(W,null,Q(d.value,(C,ee)=>(f(),g("button",{key:C.id,type:"button",class:Le(["nebula-shell__tab",{"nebula-shell__tab--active":C.id===u.value}]),role:"tab",id:C.tabId,"aria-controls":C.panelId,"aria-selected":C.id===u.value,tabindex:C.id===u.value?0:-1,onClick:R=>m(C.id),onKeydown:R=>A(R,ee),ref_for:!0,ref:R=>_(R,ee)},[a("span",el,h(C.icon||"â"),1),a("span",null,h(C.label),1)],42,Jr))),128))])):U("",!0),p.value?(f(),g("div",{key:1,class:"nebula-shell__content",role:"tabpanel",id:p.value.panelId,"aria-labelledby":p.value.tabId,tabindex:"0"},[Ie(S.$slots,"default",{activeTab:u.value},void 0,!0)],8,tl)):U("",!0),a("footer",sl,[Ie(S.$slots,"footer",{},void 0,!0)])])]))}},Us=ye(al,[["__scopeId","data-v-0fab8e00"]]),nl={class:"species-biology"},il={class:"species-biology__section"},rl={class:"species-biology__header"},ll={class:"species-biology__trait-list","data-testid":"core-traits"},ol={key:0,class:"species-biology__section"},cl={class:"species-biology__trait-list species-biology__trait-list--derived","data-testid":"derived-traits"},ul={key:1,class:"species-biology__section"},dl={class:"species-biology__list"},pl={key:2,class:"species-biology__section"},fl={key:0,class:"species-biology__behaviour-tags"},ml={key:1,class:"species-biology__list"},gl={__name:"SpeciesBiology",props:{coreTraits:{type:Array,default:()=>[]},derivedTraits:{type:Array,default:()=>[]},adaptations:{type:Array,default:()=>[]},behaviourTags:{type:Array,default:()=>[]},drives:{type:Array,default:()=>[]}},setup(t){return(e,s)=>(f(),g("section",nl,[a("div",il,[a("header",rl,[s[0]||(s[0]=a("h3",null,"Tratti fondamentali",-1)),Ie(e.$slots,"filters",{},void 0,!0)]),a("ul",ll,[(f(!0),g(W,null,Q(t.coreTraits,n=>(f(),g("li",{key:n},h(n),1))),128))]),Ie(e.$slots,"synergy-suggestions",{},void 0,!0)]),t.derivedTraits.length?(f(),g("div",ol,[s[1]||(s[1]=a("h3",null,"Tratti derivati",-1)),a("ul",cl,[(f(!0),g(W,null,Q(t.derivedTraits,n=>(f(),g("li",{key:n},h(n),1))),128))])])):U("",!0),t.adaptations.length?(f(),g("div",ul,[s[2]||(s[2]=a("h3",null,"Adattamenti",-1)),a("ul",dl,[(f(!0),g(W,null,Q(t.adaptations,n=>(f(),g("li",{key:n},h(n),1))),128))])])):U("",!0),t.behaviourTags.length||t.drives.length?(f(),g("div",pl,[s[3]||(s[3]=a("h3",null,"Comportamento",-1)),t.behaviourTags.length?(f(),g("p",fl,h(t.behaviourTags.join(", ")),1)):U("",!0),t.drives.length?(f(),g("ul",ml,[(f(!0),g(W,null,Q(t.drives,n=>(f(),g("li",{key:n},h(n),1))),128))])):U("",!0)])):U("",!0)]))}},hl=ye(gl,[["__scopeId","data-v-a98bf0c5"]]),_l=["data-variant"],vl={class:"trait-chip__icon","aria-hidden":"true"},bl={class:"trait-chip__label"},yl={__name:"TraitChip",props:{label:{type:String,default:""},variant:{type:String,default:"default"},icon:{type:String,default:""}},setup(t){const e=t,s={core:"â¶",derived:"â²",optional:"â°",synergy:"â",hazard:"â ",climate:"â",role:"â",validator:"â",telemetry:"ð¡",default:"â"},n=y(()=>e.icon?e.icon:s[e.variant]||s.default);return(i,r)=>(f(),g("span",{class:"trait-chip","data-variant":t.variant},[a("span",vl,h(n.value),1),a("span",bl,h(t.label),1)],8,_l))}},Ne=ye(yl,[["__scopeId","data-v-fc27d620"]]),kl={class:"species-card"},wl={class:"species-card__header"},Sl={class:"species-card__kicker"},$l={class:"species-card__title"},Al={class:"species-card__badges"},Tl={key:0,class:"species-card__synopsis"},xl={class:"species-card__traits","aria-label":"Tratti principali"},El={class:"species-card__trait-grid"},Rl={class:"species-card__trait-grid"},Cl={key:0},Il={class:"species-card__trait-grid"},Ol={class:"species-card__footer"},ql={class:"species-card__info-block"},Nl={class:"species-card__info-block"},Ll={key:0,class:"species-card__info-block"},zl={__name:"SpeciesCard",props:{species:{type:Object,default:()=>({})}},setup(t){const e=t,s=y(()=>{var m,_,w;return((m=e.species)==null?void 0:m.display_name)||((_=e.species)==null?void 0:_.name)||((w=e.species)==null?void 0:w.id)||"Specie"}),n=y(()=>{var m,_;return((m=e.species)==null?void 0:m.archetype)||((_=e.species)==null?void 0:_.role)||"Profilo non definito"}),i=y(()=>{var m,_,w;return((m=e.species)==null?void 0:m.rarity)||((w=(_=e.species)==null?void 0:_.statistics)==null?void 0:w.rarity)||""}),r=y(()=>{var _,w,A,S,T;const m=((_=e.species)==null?void 0:_.threatTier)||((A=(w=e.species)==null?void 0:w.statistics)==null?void 0:A.threat_tier)||((T=(S=e.species)==null?void 0:S.balance)==null?void 0:T.threat_tier);return m?String(m).replace(/^T/i,""):""}),d=y(()=>{var m,_;return((m=e.species)==null?void 0:m.synopsis)||((_=e.species)==null?void 0:_.summary)||""}),o=y(()=>{var m,_,w,A,S,T,C,ee,R;return{core:((_=(m=e.species)==null?void 0:m.traits)==null?void 0:_.core)||((w=e.species)==null?void 0:w.core_traits)||[],derived:((S=(A=e.species)==null?void 0:A.traits)==null?void 0:S.derived)||((T=e.species)==null?void 0:T.derived_traits)||[],optional:((ee=(C=e.species)==null?void 0:C.traits)==null?void 0:ee.optional)||((R=e.species)==null?void 0:R.optional_traits)||[]}}),u=y(()=>{var m,_,w,A;return((m=e.species)==null?void 0:m.energyProfile)||((_=e.species)==null?void 0:_.energy_profile)||((A=(w=e.species)==null?void 0:w.statistics)==null?void 0:A.energy_profile)||"â"}),l=y(()=>{var m,_,w,A;return((m=e.species)==null?void 0:m.habitats)||((_=e.species)==null?void 0:_.habitat)||((A=(w=e.species)==null?void 0:w.morphology)==null?void 0:A.environments)||[]}),p=y(()=>{var _,w,A,S;const m=((w=(_=e.species)==null?void 0:_.telemetry)==null?void 0:w.coverage)||((S=(A=e.species)==null?void 0:A.statistics)==null?void 0:S.coverage);return typeof m!="number"?"":`${Math.round(m*100)}%`});return(m,_)=>(f(),g("article",kl,[a("header",wl,[a("div",null,[a("p",Sl,h(n.value),1),a("h3",$l,h(s.value),1)]),a("div",Al,[i.value?(f(),Re(Ne,{key:0,label:i.value,variant:"core",icon:"â¦"},null,8,["label"])):U("",!0),r.value?(f(),Re(Ne,{key:1,label:`T${r.value}`,variant:"hazard",icon:"â¡"},null,8,["label"])):U("",!0)])]),d.value?(f(),g("p",Tl,h(d.value),1)):U("",!0),a("section",xl,[a("div",null,[_[0]||(_[0]=a("h4",null,"Core",-1)),a("div",El,[(f(!0),g(W,null,Q(o.value.core,w=>(f(),Re(Ne,{key:`core-${w}`,label:w,variant:"core"},null,8,["label"]))),128))])]),a("div",null,[_[1]||(_[1]=a("h4",null,"Derivati",-1)),a("div",Rl,[(f(!0),g(W,null,Q(o.value.derived,w=>(f(),Re(Ne,{key:`derived-${w}`,label:w,variant:"derived"},null,8,["label"]))),128))])]),o.value.optional.length?(f(),g("div",Cl,[_[2]||(_[2]=a("h4",null,"Optional",-1)),a("div",Il,[(f(!0),g(W,null,Q(o.value.optional,w=>(f(),Re(Ne,{key:`optional-${w}`,label:w,variant:"optional"},null,8,["label"]))),128))])])):U("",!0)]),a("footer",Ol,[a("div",ql,[_[3]||(_[3]=a("span",{class:"species-card__label"},"Energia",-1)),a("span",null,h(u.value),1)]),a("div",Nl,[_[4]||(_[4]=a("span",{class:"species-card__label"},"Habitat",-1)),a("span",null,h(l.value.join(", ")),1)]),p.value?(f(),g("div",Ll,[_[5]||(_[5]=a("span",{class:"species-card__label"},"Coverage QA",-1)),a("span",null,h(p.value),1)])):U("",!0)])]))}},Ml=ye(zl,[["__scopeId","data-v-058a73f6"]]),Pl={class:"species-overview"},Dl={class:"species-overview__heading"},Fl={class:"species-overview__title"},Bl={key:0,class:"species-overview__summary"},Ul={key:0,class:"species-overview__description"},jl={__name:"SpeciesOverview",props:{name:{type:String,default:""},summary:{type:String,default:""},description:{type:String,default:""}},setup(t){return(e,s)=>(f(),g("header",Pl,[a("div",Dl,[a("h2",Fl,h(t.name),1),t.summary?(f(),g("p",Bl,h(t.summary),1)):U("",!0)]),t.description?(f(),g("p",Ul,h(t.description),1)):U("",!0),Ie(e.$slots,"actions",{},void 0,!0)]))}},Vl=ye(jl,[["__scopeId","data-v-240ccb6b"]]),Hl=["aria-busy"],Gl={class:"species-preview-grid__header"},Wl={key:0,class:"species-preview-grid__error",role:"alert"},Ql={key:1,class:"species-preview-grid__loading",role:"status","aria-live":"polite"},Zl={key:2,class:"species-preview-grid__cards",role:"list"},Yl={class:"species-preview-card__header"},Xl={class:"species-preview-card__badge"},Kl={class:"species-preview-card__summary"},Jl={class:"species-preview-card__stats"},eo={key:0,class:"species-preview-card__traits"},to={key:3,class:"species-preview-grid__empty",role:"status","aria-live":"polite"},so={__name:"SpeciesPreviewGrid",props:{previews:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},error:{type:String,default:""}},setup(t){return(e,s)=>(f(),g("section",{class:"species-preview-grid","aria-busy":t.loading},[a("header",Gl,[s[0]||(s[0]=a("h3",null,"Anteprime sintetiche",-1)),Ie(e.$slots,"filters",{},void 0,!0)]),t.error?(f(),g("p",Wl,h(t.error),1)):t.loading?(f(),g("p",Ql," Generazione in corso... ")):t.previews.length?(f(),g("div",Zl,[(f(!0),g(W,null,Q(t.previews,n=>{var i,r,d,o,u,l,p,m,_,w,A,S,T,C;return f(),g("article",{key:((i=n.blueprint)==null?void 0:i.id)||((r=n.meta)==null?void 0:r.request_id),class:"species-preview-card",role:"listitem"},[a("header",Yl,[a("h4",null,h(((d=n.blueprint)==null?void 0:d.display_name)||((o=n.blueprint)==null?void 0:o.id)),1),a("span",Xl,h(((l=(u=n.blueprint)==null?void 0:u.statistics)==null?void 0:l.threat_tier)||"T?"),1)]),a("p",Kl,h((p=n.blueprint)==null?void 0:p.summary),1),a("dl",Jl,[a("div",null,[s[1]||(s[1]=a("dt",null,"Energia",-1)),a("dd",null,h(((_=(m=n.blueprint)==null?void 0:m.statistics)==null?void 0:_.energy_profile)||"n/d"),1)]),a("div",null,[s[2]||(s[2]=a("dt",null,"RaritÃ ",-1)),a("dd",null,h(((A=(w=n.blueprint)==null?void 0:w.statistics)==null?void 0:A.rarity)||"R?"),1)])]),(C=(T=(S=n.blueprint)==null?void 0:S.traits)==null?void 0:T.core)!=null&&C.length?(f(),g("p",eo,h(n.blueprint.traits.core.join(", ")),1)):U("",!0)])}),128))])):(f(),g("p",to," Nessuna anteprima disponibile. "))],8,Hl))}},ao=ye(so,[["__scopeId","data-v-2627b764"]]),no={class:"species-quick-actions"},io={__name:"SpeciesQuickActions",emits:["export","save"],setup(t){return(e,s)=>(f(),g("div",no,[a("button",{type:"button",class:"species-quick-actions__button",onClick:s[0]||(s[0]=n=>e.$emit("export"))}," Esporta scheda "),a("button",{type:"button",class:"species-quick-actions__button species-quick-actions__button--secondary",onClick:s[1]||(s[1]=n=>e.$emit("save"))}," Salva nel pack ")]))}},ro=ye(io,[["__scopeId","data-v-11baf8f0"]]),lo={key:0,class:"species-timeline"},oo={class:"species-timeline__header"},co={class:"species-timeline__filters"},uo=["onClick"],po={class:"species-timeline__filter-icon"},fo={class:"species-timeline__filter-label"},mo={class:"species-timeline__filter-count"},go={key:0,class:"species-timeline__list"},ho=["data-tone"],_o={class:"species-timeline__entry-header"},vo=["data-tone"],bo={class:"species-timeline__badge-icon"},yo={class:"species-timeline__badge-text"},ko={class:"species-timeline__entry-meta"},wo={class:"species-timeline__code"},So={class:"species-timeline__message"},$o={key:1,class:"species-timeline__empty"},Ao={key:1,class:"species-timeline species-timeline--empty"},To={__name:"SpeciesRevisionTimeline",props:{entries:{type:Array,default:()=>[]}},setup(t){const e=t,s=[{value:"all",label:"Tutte",icon:"â¦"},{value:"info",label:"Info",icon:"â§"},{value:"warning",label:"Avvisi",icon:"â ï¸"},{value:"error",label:"Critici",icon:"â ï¸"},{value:"success",label:"OK",icon:"â¨"}],n={info:{label:"Info",icon:"â§",tone:"info"},warning:{label:"Avviso",icon:"â ï¸",tone:"warning"},error:{label:"Critico",icon:"â ï¸",tone:"error"},success:{label:"Successo",icon:"â¨",tone:"success"}},i=Ee("all"),r=y(()=>(Array.isArray(e.entries)?e.entries:[]).map((p,m)=>{const _=p.level||p.severity||"info",w=n[_]||n.info;return{id:p.id||`revision-${m}`,title:p.title||w.label,message:p.message||"",code:p.code||"n/d",level:_,badgeLabel:w.label,badgeIcon:w.icon,tone:w.tone}})),d=y(()=>{const l={all:r.value.length};for(const p of r.value)l[p.level]=(l[p.level]||0)+1;return l}),o=y(()=>i.value==="all"?r.value:r.value.filter(l=>l.level===i.value)),u=y(()=>r.value.length>0);return(l,p)=>u.value?(f(),g("section",lo,[a("div",oo,[p[0]||(p[0]=a("h3",null,"Revisioni validate",-1)),a("div",co,[(f(),g(W,null,Q(s,m=>a("button",{key:m.value,type:"button",class:Le(["species-timeline__filter",{"species-timeline__filter--active":m.value===i.value}]),onClick:_=>i.value=m.value},[a("span",po,h(m.icon),1),a("span",fo,h(m.label),1),a("span",mo,h(d.value[m.value]||0),1)],10,uo)),64))])]),o.value.length?(f(),g("ol",go,[(f(!0),g(W,null,Q(o.value,m=>(f(),g("li",{key:m.id,class:"species-timeline__entry","data-tone":m.tone},[a("div",_o,[a("span",{class:"species-timeline__badge","data-tone":m.tone},[a("span",bo,h(m.badgeIcon),1),a("span",yo,h(m.badgeLabel),1)],8,vo),a("div",ko,[a("strong",null,h(m.title),1),a("span",wo,h(m.code),1)])]),a("p",So,h(m.message),1)],8,ho))),128))])):(f(),g("p",$o,"Nessun evento per il filtro selezionato."))])):(f(),g("section",Ao,[...p[1]||(p[1]=[a("h3",null,"Revisioni validate",-1),a("p",{class:"species-timeline__empty"},"Nessuna validazione registrata dal runtime.",-1)])]))}},xo=ye(To,[["__scopeId","data-v-551b1f2d"]]),Eo={class:"species-statistics"},Ro={class:"species-statistics__grid"},Co={class:"species-statistics__stat"},Io={class:"species-statistics__stat"},Oo={class:"species-statistics__stat"},qo={class:"species-statistics__stat"},No={__name:"SpeciesStatistics",props:{statistics:{type:Object,default:()=>({})},synergy:{type:String,default:"n/d"}},setup(t){return(e,s)=>(f(),g("section",Eo,[s[4]||(s[4]=a("h3",null,"Statistiche",-1)),a("dl",Ro,[a("div",Co,[s[0]||(s[0]=a("dt",null,"Minaccia",-1)),a("dd",null,h(t.statistics.threat_tier||"T?"),1)]),a("div",Io,[s[1]||(s[1]=a("dt",null,"RaritÃ ",-1)),a("dd",null,h(t.statistics.rarity||"R?"),1)]),a("div",Oo,[s[2]||(s[2]=a("dt",null,"Energia",-1)),a("dd",null,h(t.statistics.energy_profile||"n/d"),1)]),a("div",qo,[s[3]||(s[3]=a("dt",null,"Sinergia",-1)),a("dd",null,h(t.synergy),1)])]),Ie(e.$slots,"default",{},void 0,!0)]))}},Lo=ye(No,[["__scopeId","data-v-32d0ed13"]]),zo={class:"synergy-card__face synergy-card__face--front"},Mo={class:"synergy-card__title"},Po={class:"synergy-card__face synergy-card__face--back"},Do={class:"synergy-card__title"},Fo={class:"synergy-card__detail"},Bo={__name:"SpeciesSynergyCard",props:{title:{type:String,default:""},detail:{type:String,default:""}},setup(t){const e=t,s=Ee(!1),n=y(()=>e.detail?e.detail:"Sinergia tracciata: benchmark QA non annotato. Consultare telemetry per approfondimenti.");function i(){s.value=!s.value}return(r,d)=>(f(),g("button",{type:"button",class:Le(["synergy-card",{"synergy-card--flipped":s.value}]),onClick:i},[a("div",zo,[d[0]||(d[0]=a("span",{class:"synergy-card__icon","aria-hidden":"true"},"â",-1)),a("p",Mo,h(t.title),1),d[1]||(d[1]=a("p",{class:"synergy-card__hint"},"Tocca per dettagli",-1))]),a("div",Po,[a("p",Do,h(t.title),1),a("p",Fo,h(n.value),1)])],2))}},Uo=ye(Bo,[["__scopeId","data-v-3692c854"]]),jo={class:"trait-filter-panel","aria-label":"Filtri tratti"},Vo={class:"trait-filter-panel__group"},Ho={role:"list"},Go=["value","checked","onChange"],Wo={key:0,class:"trait-filter-panel__group"},Qo={role:"list"},Zo=["value","checked","onChange"],Yo={__name:"TraitFilterPanel",props:{coreOptions:{type:Array,default:()=>[]},derivedOptions:{type:Array,default:()=>[]},labels:{type:Object,default:()=>({})},highlight:{type:Array,default:()=>[]},modelValue:{type:Object,default:()=>({core:[],derived:[]})}},emits:["update:modelValue"],setup(t,{emit:e}){const s=t,n=e,i=y(()=>s.labels||{}),r=y(()=>new Set(s.highlight||[])),d=y({get(){return{core:Array.isArray(s.modelValue.core)?s.modelValue.core:[],derived:Array.isArray(s.modelValue.derived)?s.modelValue.derived:[]}},set(l){n("update:modelValue",l)}});function o(l){var m;if(!l)return"";const p=(m=i.value)==null?void 0:m[l];return p&&p!==l?`${l} Â· ${p}`:l}function u(l,p,m){var T;const _=(T=m==null?void 0:m.target)==null?void 0:T.checked,w={core:[...d.value.core],derived:[...d.value.derived]},A=w[l],S=A.indexOf(p);_&&S===-1?A.push(p):!_&&S!==-1&&A.splice(S,1),d.value=w}return(l,p)=>(f(),g("section",jo,[a("fieldset",Vo,[p[0]||(p[0]=a("legend",null,"Filtra tratti core",-1)),a("ul",Ho,[(f(!0),g(W,null,Q(t.coreOptions,m=>(f(),g("li",{key:m},[a("label",{class:Le({"trait-filter-panel__option--highlight":r.value.has(m)})},[a("input",{type:"checkbox",value:m,checked:d.value.core.includes(m),onChange:_=>u("core",m,_)},null,40,Go),ft(" "+h(o(m)),1)],2)]))),128))])]),t.derivedOptions.length?(f(),g("fieldset",Wo,[p[1]||(p[1]=a("legend",null,"Filtra tratti derivati",-1)),a("ul",Qo,[(f(!0),g(W,null,Q(t.derivedOptions,m=>(f(),g("li",{key:m},[a("label",{class:Le({"trait-filter-panel__option--highlight":r.value.has(m)})},[a("input",{type:"checkbox",value:m,checked:d.value.derived.includes(m),onChange:_=>u("derived",m,_)},null,40,Zo),ft(" "+h(o(m)),1)],2)]))),128))])])):U("",!0)]))}},Xo=ye(Yo,[["__scopeId","data-v-f2c702c4"]]);function Ko(t,e){if(t&&Object.prototype.hasOwnProperty.call(t,"fallback")){if(t.fallback===null)return null;if(typeof t.fallback=="string"&&t.fallback.trim())return t.fallback.trim()}return e}function Jo(t){return t&&Object.prototype.hasOwnProperty.call(t,"allowFallback")?!!t.allowFallback:gt()}function ec(t){return Array.isArray(t)?t.filter(e=>e&&Array.isArray(e.trait_ids)&&e.trait_ids.length).map(e=>({trait_ids:e.trait_ids,biome_id:e.biome_id??null,seed:e.seed??null,base_name:e.base_name??null,request_id:e.request_id??null,fallback_trait_ids:e.fallback_trait_ids})):[]}async function tc(t,e={}){const s=ec(t);if(!s.length)return{previews:[],errors:[]};const n=vt("generationSpeciesPreview",{endpoint:Object.prototype.hasOwnProperty.call(e,"endpoint")?e.endpoint:void 0,fallback:Object.prototype.hasOwnProperty.call(e,"fallback")?e.fallback:void 0}),i=bt(e.endpoint||n.endpoint),r=Ko(e,n.fallback),d=r?yt(r):null,o=await Rt(i,{requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({batch:s})},fallbackUrl:d,allowFallback:Jo(e),errorMessage:"Errore richiesta anteprime specie",fallbackErrorMessage:"Anteprime specie locali non disponibili"}),{data:u,error:l}=o,p=o.source,m=Array.isArray(u.results)?u.results:Array.isArray(u.previews)?u.previews:[],_=Array.isArray(u.errors)?u.errors:[];return{previews:m,errors:_,endpoint_source:p,endpoint_url:p==="fallback"&&d?d:i,fallback_error:p==="fallback"&&l?l.message:void 0}}const sc={key:0,class:"species-panel"},ac={key:0,class:"species-panel__section"},nc={key:0,class:"species-panel__meta"},ic={key:1,class:"species-panel__adaptations"},rc={key:1,class:"species-panel__section species-panel__section--grid"},lc={key:0,class:"species-panel__suggestions"},oc={class:"species-panel__suggestions-list"},cc=["onClick","aria-label"],uc={key:2,class:"species-panel__section species-panel__section--columns"},dc={key:0,class:"species-panel__meta-text"},pc={key:0,class:"species-panel__telemetry"},fc={key:1,class:"species-panel__error",role:"alert"},mc={key:3,class:"species-panel__section species-panel__section--synergy"},gc={key:0,class:"species-panel__synergy-grid"},hc={key:1,class:"species-panel__empty"},_c=["disabled"],vc={key:1,class:"species-panel species-panel--empty"},bc={__name:"SpeciesPanel",props:{species:{type:Object,default:null},validation:{type:Object,default:null},meta:{type:Object,default:null},traitCatalog:{type:Object,default:()=>({traits:[],labels:{},synergyMap:{}})},traitCompliance:{type:Object,default:()=>({badges:[]})},previewBatch:{type:Array,default:()=>[]},autoPreview:{type:Boolean,default:!0}},emits:["export","save","preview-error"],setup(t,{emit:e}){const s=t,n=e,i=y(()=>{var $;return(($=s.species)==null?void 0:$.summary)||null}),r=y(()=>{var $,z;return(($=s.species)==null?void 0:$.description)||((z=s.species)==null?void 0:z.summary)||""}),d=y(()=>{var $;return(($=s.species)==null?void 0:$.traits)||{}}),o=y(()=>{var $;return d.value.core||(($=s.species)==null?void 0:$.core_traits)||[]}),u=y(()=>{var $;return d.value.derived||(($=s.species)==null?void 0:$.derived_traits)||[]}),l=y(()=>{var $;return(($=s.species)==null?void 0:$.morphology)||{}}),p=y(()=>l.value.adaptations||[]),m=y(()=>{var $,z;return(($=s.species)==null?void 0:$.behavior)||((z=s.species)==null?void 0:z.behavior_profile)||{}}),_=y(()=>m.value.tags||m.value.behaviourTags||[]),w=y(()=>m.value.drives||[]),A=y(()=>{var $,z,X,J;return(($=s.species)==null?void 0:$.statistics)||{threat_tier:(X=(z=s.species)==null?void 0:z.balance)==null?void 0:X.threat_tier,rarity:(J=s.species)==null?void 0:J.rarity}}),S=y(()=>{var $,z;return(($=s.species)==null?void 0:$.display_name)||((z=s.species)==null?void 0:z.id)||"Specie"}),T=y(()=>{var $,z;return(($=s.species)==null?void 0:$.telemetry)||((z=s.meta)==null?void 0:z.telemetry)||{}}),C=y(()=>{var X,J;const $=(X=s.meta)==null?void 0:X.attempts,z=(J=s.meta)==null?void 0:J.fallback_used;if($||z){const be=[];return $&&be.push(`Tentativi: ${$}`),z!=null&&be.push(`Fallback: ${z?"sÃ¬":"no"}`),be.join(" Â· ")}return""}),ee=y(()=>{var z;const $=(z=A.value)==null?void 0:z.synergy_score;return typeof $=="number"&&Number.isFinite($)?`${Math.round($*100)}%`:"n/d"}),R=y(()=>{var $;return Array.isArray(($=s.traitCatalog)==null?void 0:$.traits)?s.traitCatalog.traits:[]}),N=y(()=>{var $;return(($=s.traitCatalog)==null?void 0:$.labels)||{}}),I=y(()=>{var $;return(($=s.traitCatalog)==null?void 0:$.synergyMap)||{}}),q=y(()=>R.value.map($=>$&&$.id?String($.id):null).filter(Boolean).sort(($,z)=>$.localeCompare(z)));function E($){return Array.from(new Set($.filter(Boolean))).sort((z,X)=>z.localeCompare(X))}const F=y(()=>{const $=new Set(o.value||[]),z=q.value.slice(0,20);!$.size&&z.length&&z.forEach(J=>$.add(J));const X=[...o.value||[],...u.value||[]];for(const J of X)(I.value[J]||[]).forEach($e=>$.add($e));return E([...$])}),te=y(()=>{const $=new Set(u.value||[]),z=q.value.slice(0,20);!$.size&&z.length&&z.forEach(J=>$.add(J));const X=[...o.value||[],...u.value||[]];for(const J of X)(I.value[J]||[]).forEach($e=>$.add($e));return E([...$])}),he=y(()=>({core:F.value,derived:te.value})),me=y(()=>{const $=new Set,z=Array.isArray(re.value.core)?re.value.core:[];for(const X of z){const J=I.value[X]||[];for(const be of J)z.includes(be)||$.add(be)}return E([...$])}),re=Ee({core:[],derived:[]}),Ae=Ee("overview"),Oe=y(()=>[{id:"overview",label:"Scheda",icon:"ð§¬"},{id:"biology",label:"Biologia",icon:"ð¿"},{id:"telemetry",label:"Telemetry",icon:"ð¡"},{id:"synergies",label:"Sinergie",icon:"â"}]);function De($){var X;if(!$)return"";const z=(X=N.value)==null?void 0:X[$];return z&&z!==$?`${$} Â· ${z}`:$}function Fe($){if(!$)return;const z=Array.isArray(re.value.core)?[...re.value.core]:[],X=Array.isArray(re.value.derived)?[...re.value.derived]:[];X.includes($)||X.push($),re.value={core:z,derived:X}}const M=y(()=>{var k,j,O,ce,G,ue,oe;const $=[],z=((k=s.species)==null?void 0:k.rarity)||((j=A.value)==null?void 0:j.rarity);z&&$.push({id:"rarity",label:"RaritÃ ",value:z,tone:"neutral"});const X=((O=A.value)==null?void 0:O.threat_tier)||((ce=s.species)==null?void 0:ce.threatTier);if(X){const c=Number.parseInt(String(X).replace(/[^0-9]/g,""),10);let v="neutral";Number.isFinite(c)&&(c>=3?v="critical":c>=2&&(v="warning")),$.push({id:"threat",label:"Threat tier",value:`T${c||X}`,tone:v})}const J=(G=A.value)==null?void 0:G.synergy_score;if(typeof J=="number"){const c=Math.round(J*100);let v="warning";c>=80?v="success":c<50&&(v="critical"),$.push({id:"synergy",label:"Allineamento",value:`${c}%`,tone:v})}const be=(ue=T.value)==null?void 0:ue.coverage;if(typeof be=="number"){const c=Math.round(be*100);let v="neutral";be>=.8?v="success":be<.55&&(v="warning"),$.push({id:"coverage",label:"Coverage QA",value:`${c}%`,tone:v})}const $e=Array.isArray((oe=s.traitCompliance)==null?void 0:oe.badges)?s.traitCompliance.badges:[];for(const c of $e)c&&$.push({id:`trait-${c.id||c.label}`,label:c.label||"Trait QA",value:c.value||"",tone:c.tone||"neutral"});return $}),H=y(()=>{var z,X,J;const $=[];if((z=T.value)!=null&&z.lastValidation){const be=new Date(T.value.lastValidation);$.push({label:"Ultima validazione",value:Number.isNaN(be.getTime())?T.value.lastValidation:new Intl.DateTimeFormat("it-IT",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(be)})}return(X=T.value)!=null&&X.curatedBy&&$.push({label:"Curatore",value:T.value.curatedBy}),typeof((J=T.value)==null?void 0:J.coverage)=="number"&&$.push({label:"Coverage",value:`${Math.round(T.value.coverage*100)}%`}),$}),se=y(()=>{var X,J,be,$e,k,j;const $=Array.isArray((J=(X=s.species)==null?void 0:X.traits)==null?void 0:J.synergy)?s.species.traits.synergy:[],z=(($e=(be=s.species)==null?void 0:be.statistics)==null?void 0:$e.synergy_breakdown)||((j=(k=s.species)==null?void 0:k.statistics)==null?void 0:j.synergies)||{};return $.map((O,ce)=>{var v,P,Z;const G=typeof O=="string"?O:(O==null?void 0:O.id)||String(ce),ue=typeof O=="string"?O:(O==null?void 0:O.label)||(O==null?void 0:O.name)||`Sinergia ${ce+1}`;let oe="";if(Array.isArray(z)){const de=z[ce];de&&typeof de=="object"?oe=de.note||de.summary||de.detail||"":typeof de=="string"&&(oe=de)}else if(z&&typeof z=="object"){const de=z[G]||z[ue];de&&typeof de=="object"?oe=de.note||de.summary||de.detail||"":typeof de=="string"&&(oe=de)}const c=[];return oe&&c.push(oe),typeof((v=T.value)==null?void 0:v.coverage)=="number"&&c.push(`Coverage ${Math.round(T.value.coverage*100)}%`),(P=A.value)!=null&&P.synergy_score&&c.push(`Allineamento ${ee.value}`),c.length||c.push("Sinergia registrata dal generator senza annotazioni extra."),{id:`${((Z=s.species)==null?void 0:Z.id)||"synergy"}-${ce}`,title:ue,detail:c.join(" Â· ")}})}),L=y(()=>{var z;return(Array.isArray((z=s.validation)==null?void 0:z.messages)?s.validation.messages:[]).map((X,J)=>({id:`${X.code||"msg"}-${J}`,title:X.level==="error"?"Errore":X.level==="warning"?"Avviso":"Info",message:X.message||X.code,code:X.code||"n/d",level:X.level||"info"}))}),x=Ee([]),D=Ee(!1),ne=Ee("");Ce(()=>s.previewBatch,$=>{Array.isArray($)&&(x.value=$)},{immediate:!0}),Ce(()=>{var $;return($=s.species)==null?void 0:$.id},()=>{Ae.value="overview",re.value={core:E([...o.value||[]]),derived:E([...u.value||[]])},x.value=Array.isArray(s.previewBatch)?s.previewBatch:[],ne.value="",s.autoPreview&&K()},{immediate:!0}),Ce(()=>{var $;return[re.value.core.slice().sort().join(","),re.value.derived.slice().sort().join(","),s.autoPreview,($=s.species)==null?void 0:$.id]},async()=>{s.autoPreview&&await K()});function ge(){var O,ce;const $=re.value.core.length?re.value.core:Array.isArray(o.value)&&o.value.length?E([...o.value]):F.value,z=re.value.derived,X=Array.from(new Set([...$,...z]));if(!X.length)return[];const J=((O=s.meta)==null?void 0:O.biome_id)||((ce=l.value.environments)==null?void 0:ce[0])||null,be=F.value,$e=[X];for(const G of z)$e.push(Array.from(new Set([...$,G])));const k=[],j=new Set;for(const G of $e){const ue=G.slice().sort().join("|");!ue||j.has(ue)||(j.add(ue),k.push(G))}return k.slice(0,4).map((G,ue)=>{var oe;return{trait_ids:G,biome_id:J,seed:ue,base_name:`${S.value} Preview ${ue+1}`,request_id:`${((oe=s.species)==null?void 0:oe.id)||"preview"}-${ue}`,fallback_trait_ids:be}})}async function K(){if(!s.species){x.value=[];return}const $=ge();if(!$.length){x.value=[];return}D.value=!0,ne.value="";try{const z=await tc($);x.value=z.previews||[]}catch(z){const X=z instanceof Error?z.message:String(z);ne.value=X,n("preview-error",X)}finally{D.value=!1}}function _e(){n("export",s.species)}function Y(){n("save",s.species)}return($,z)=>t.species?(f(),g("section",sc,[pe(Us,{tabs:Oe.value,modelValue:Ae.value,"onUpdate:modelValue":z[1]||(z[1]=X=>Ae.value=X),"status-indicators":M.value},{actions:Se(()=>[pe(ro,{onExport:_e,onSave:Y})]),cards:Se(()=>[pe(Ml,{species:t.species},null,8,["species"])]),default:Se(({activeTab:X})=>[X==="overview"?(f(),g("div",ac,[pe(Vl,{name:S.value,summary:i.value,description:r.value},null,8,["name","summary","description"]),C.value?(f(),g("div",nc,[pe(Ne,{label:C.value,variant:"telemetry",icon:"â§"},null,8,["label"])])):U("",!0),p.value.length?(f(),g("div",ic,[z[2]||(z[2]=a("h4",null,"Adattamenti",-1)),a("ul",null,[(f(!0),g(W,null,Q(p.value,J=>(f(),g("li",{key:J},h(J),1))),128))])])):U("",!0)])):X==="biology"?(f(),g("div",rc,[pe(hl,{"core-traits":o.value,"derived-traits":u.value,adaptations:p.value,"behaviour-tags":_.value,drives:w.value},{filters:Se(()=>[pe(Xo,{modelValue:re.value,"onUpdate:modelValue":z[0]||(z[0]=J=>re.value=J),"core-options":he.value.core,"derived-options":he.value.derived,labels:N.value,highlight:me.value},null,8,["modelValue","core-options","derived-options","labels","highlight"])]),"synergy-suggestions":Se(()=>[me.value.length?(f(),g("div",lc,[z[3]||(z[3]=a("p",null,"Sinergie dal catalogo",-1)),a("div",oc,[(f(!0),g(W,null,Q(me.value,J=>(f(),g("button",{key:`suggestion-${J}`,type:"button",class:"species-panel__suggestion",onClick:be=>Fe(J),"aria-label":`Applica suggerimento sinergia ${De(J)}`},[pe(Ne,{label:De(J),variant:"synergy"},null,8,["label"])],8,cc))),128))])])):U("",!0)]),_:1},8,["core-traits","derived-traits","adaptations","behaviour-tags","drives"])])):X==="telemetry"?(f(),g("div",uc,[pe(Lo,{statistics:A.value,synergy:ee.value},{default:Se(()=>[C.value?(f(),g("p",dc,h(C.value),1)):U("",!0)]),_:1},8,["statistics","synergy"]),pe(xo,{entries:L.value},null,8,["entries"]),H.value.length?(f(),g("div",pc,[z[4]||(z[4]=a("h4",null,"Telemetry",-1)),a("ul",null,[(f(!0),g(W,null,Q(H.value,J=>(f(),g("li",{key:J.label},[a("strong",null,h(J.label),1),a("span",null,h(J.value),1)]))),128))])])):U("",!0),ne.value?(f(),g("div",fc,h(ne.value),1)):U("",!0)])):X==="synergies"?(f(),g("div",mc,[se.value.length?(f(),g("div",gc,[(f(!0),g(W,null,Q(se.value,J=>(f(),Re(Uo,{key:J.id,title:J.title,detail:J.detail},null,8,["title","detail"]))),128))])):(f(),g("p",hc,"Nessuna sinergia registrata per questa specie.")),pe(ao,{class:"species-panel__previews",previews:x.value,loading:D.value,error:ne.value},{filters:Se(()=>[a("button",{type:"button",class:"species-panel__refresh",onClick:K,disabled:D.value}," Aggiorna batch ",8,_c)]),_:1},8,["previews","loading","error"])])):U("",!0)]),_:1},8,["tabs","modelValue","status-indicators"])])):(f(),g("section",vc,[...z[5]||(z[5]=[a("p",null,"Nessuna specie selezionata.",-1)])]))}},yc=ye(bc,[["__scopeId","data-v-634279c2"]]),kc=["data-tone"],wc={key:0,class:"insight-card__header"},Sc={class:"insight-card__title"},$c={key:0,class:"insight-card__icon","aria-hidden":"true"},Ac={key:0},Tc={key:1,class:"insight-card__subtitle"},xc={class:"insight-card__actions"},Ec={key:1,class:"insight-card__tabs",role:"tablist"},Rc=["aria-selected","onClick"],Cc={key:0,class:"insight-card__tab-icon","aria-hidden":"true"},Ic={class:"insight-card__body"},Oc={__name:"InsightCard",props:{title:{type:String,default:""},subtitle:{type:String,default:""},icon:{type:String,default:""},tone:{type:String,default:"neutral"},tabs:{type:Array,default:()=>[]},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(t,{emit:e}){const s=t,n=e,i=y(()=>Array.isArray(s.tabs)?s.tabs.filter(Boolean):[]),r=y({get(){if(!i.value.length)return"";const p=s.modelValue&&i.value.find(m=>m.id===s.modelValue);return p&&p.id||i.value[0].id},set(p){p!==s.modelValue&&n("update:modelValue",p)}}),d=yn(),o=y(()=>!!(s.title||s.subtitle||s.icon||d.actions)),u=y(()=>i.value);function l(p){u.value.some(m=>m.id===p)&&(r.value=p)}return Ea(()=>{u.value.length&&!s.modelValue&&n("update:modelValue",u.value[0].id)}),Ce(()=>s.tabs,p=>{var _;const m=Array.isArray(p)?p:[];if(!m.some(w=>w.id===r.value)){const w=((_=m[0])==null?void 0:_.id)||"";w&&n("update:modelValue",w)}}),(p,m)=>(f(),g("section",{class:"insight-card","data-tone":t.tone},[o.value?(f(),g("header",wc,[a("div",Sc,[t.icon?(f(),g("span",$c,h(t.icon),1)):U("",!0),a("div",null,[t.title?(f(),g("h3",Ac,h(t.title),1)):U("",!0),t.subtitle?(f(),g("p",Tc,h(t.subtitle),1)):Ie(p.$slots,"subtitle",{key:2},void 0,!0)])]),a("div",xc,[Ie(p.$slots,"actions",{},void 0,!0)])])):U("",!0),u.value.length?(f(),g("div",Ec,[(f(!0),g(W,null,Q(u.value,_=>(f(),g("button",{key:_.id,type:"button",class:Le(["insight-card__tab",{"insight-card__tab--active":_.id===r.value}]),role:"tab","aria-selected":_.id===r.value,onClick:w=>l(_.id)},[_.icon?(f(),g("span",Cc,h(_.icon),1)):U("",!0),a("span",null,h(_.label),1)],10,Rc))),128))])):U("",!0),a("div",Ic,[u.value.length?(f(!0),g(W,{key:0},Q(u.value,_=>et((f(),g("div",{key:`panel-${_.id}`,role:"tabpanel",class:"insight-card__panel"},[Ie(p.$slots,`tab-${_.id}`,{tab:_},void 0,!0)])),[[kn,_.id===r.value]])),128)):Ie(p.$slots,"default",{key:1},void 0,!0)])],8,kc))}},xt=ye(Oc,[["__scopeId","data-v-795354ba"]]),qc=["aria-valuenow"],Nc={class:"telemetry-progress__header"},Lc={class:"telemetry-progress__label"},zc={class:"telemetry-progress__value"},Mc={class:"telemetry-progress__bar"},Pc={key:0,class:"telemetry-progress__description"},Dc={__name:"TelemetryProgressBar",props:{label:{type:String,required:!0},current:{type:Number,default:null},total:{type:Number,default:null},percent:{type:Number,default:null},value:{type:String,default:""},description:{type:String,default:""}},setup(t){const e=t,s=y(()=>typeof e.percent=="number"&&Number.isFinite(e.percent)?e.percent:typeof e.current=="number"&&typeof e.total=="number"&&e.total>0?e.current/e.total*100:0),n=y(()=>e.value?e.value:e.current!=null&&e.total!=null?`${e.current} / ${e.total}`:`${Math.round(s.value)}%`);return(i,r)=>(f(),g("div",{class:"telemetry-progress",role:"progressbar","aria-valuenow":Math.round(s.value),"aria-valuemin":"0","aria-valuemax":"100"},[a("div",Nc,[a("span",Lc,h(t.label),1),a("span",zc,h(n.value),1)]),a("div",Mc,[a("div",{class:"telemetry-progress__fill",style:xa({width:`${Math.min(100,Math.max(s.value,0))}%`})},null,4)]),t.description?(f(),g("p",Pc,h(t.description),1)):U("",!0)],8,qc))}},Fc=ye(Dc,[["__scopeId","data-v-57896592"]]),Bc={class:"species-view"},Uc={class:"species-view__header"},jc={class:"species-view__layout"},Vc={key:0,class:"species-view__progress"},Hc={key:1,class:"species-view__empty"},Gc={key:2,class:"species-view__meta"},Wc={key:0,class:"species-view__request"},Qc={key:1,class:"species-view__shortlist"},Zc={key:3,class:"species-view__error",role:"alert"},Yc={key:0,class:"species-view__synergy"},Xc={key:0},Kc={key:0},Jc={key:1,class:"species-view__empty"},eu={key:2,class:"species-view__compliance"},tu=["data-tone"],su={key:0,class:"species-view__timestamp"},au={class:"species-view__qa"},nu=["data-tone"],iu={key:0,class:"species-view__qa-text"},ru={key:1,class:"species-view__qa-text"},lu={key:2,class:"species-view__qa-messages"},ou=["data-level"],cu={key:3,class:"species-view__qa-counters"},uu={key:0},du={key:1},pu={key:2},fu={key:3},mu={key:4,class:"species-view__qa-text"},gu={key:5,class:"species-view__error",role:"alert"},hu={__name:"SpeciesView",props:{species:{type:Object,default:null},status:{type:Object,required:!0},meta:{type:Object,default:()=>({})},validation:{type:Object,default:()=>({messages:[],discarded:[],corrected:null})},requestId:{type:[String,null],default:null},loading:{type:Boolean,default:!1},error:{type:[String,Object,null],default:null},traitCatalog:{type:Object,default:()=>({traits:[],labels:{},synergyMap:{}})},traitCompliance:{type:Object,default:()=>({badges:[],summary:{},generatedAt:null})},traitDiagnosticsLoading:{type:Boolean,default:!1},traitDiagnosticsError:{type:[String,Object,null],default:null},traitDiagnosticsMeta:{type:Object,default:()=>({})}},setup(t){const e=t,{species:s,status:n,meta:i,validation:r,requestId:d,error:o,traitCatalog:u,traitCompliance:l,traitDiagnosticsLoading:p,traitDiagnosticsError:m,traitDiagnosticsMeta:_}=_t(e),{t:w,locale:A}=Ra(),S=y(()=>n.value.curated||0),T=y(()=>n.value.total||0),C=y(()=>n.value.shortlist||[]),ee=y(()=>T.value?Math.min(100,Math.round(S.value/T.value*100)):0),R=y(()=>{var L;return((L=i.value)==null?void 0:L.telemetry)||{}}),N=y(()=>{var ne,ge,K,_e;const L=[];(T.value||S.value)&&L.push({id:"curation",label:w("views.species.sidebar.telemetry.curated.label"),current:S.value,total:T.value,description:w("views.species.sidebar.telemetry.curated.description")});const x=Number.isFinite((ne=R.value)==null?void 0:ne.coverage)?Number(R.value.coverage):ee.value;return Number.isFinite(x)&&L.push({id:"coverage",label:w("views.species.sidebar.telemetry.coverage.label"),percent:x,value:`${Math.round(x)}%`,description:((ge=R.value)==null?void 0:ge.coverage_label)||w("views.species.sidebar.telemetry.coverage.descriptionFallback")}),(Array.isArray((K=R.value)==null?void 0:K.phases)?R.value.phases:Array.isArray((_e=R.value)==null?void 0:_e.stages)?R.value.stages:[]).forEach((Y,$)=>{const z=Number.isFinite(Y==null?void 0:Y.percent)?Number(Y.percent):Number.isFinite(Y==null?void 0:Y.coverage)?Number(Y.coverage):Number.isFinite(Y==null?void 0:Y.value)?Number(Y.value):0;L.push({id:`phase-${(Y==null?void 0:Y.id)||$}`,label:(Y==null?void 0:Y.label)||(Y==null?void 0:Y.name)||w("views.species.sidebar.telemetry.phaseFallback",{index:$+1}),percent:z,value:`${Math.round(Math.max(0,z))}%`,description:(Y==null?void 0:Y.summary)||(Y==null?void 0:Y.description)||""})}),L}),I=y(()=>{const L=i.value||{},x=d.value||L.request_id||L.requestId,D=L.biome_id||L.biomeId||"â",ne=w("views.species.sidebar.request.fallbackStates.unknown"),ge=L.fallback_used===void 0?ne:L.fallback_used?w("views.species.sidebar.request.fallbackStates.enabled"):w("views.species.sidebar.request.fallbackStates.disabled");return!x&&D==="â"&&ge===ne?null:{id:x||"â",biome:D,fallback:ge}}),q=y(()=>{var x;return(Array.isArray((x=r.value)==null?void 0:x.messages)?r.value.messages:[]).filter(Boolean)}),E=y(()=>{var K,_e;const L=q.value,x=L.filter(Y=>(Y.level||Y.severity)==="warning").length,D=L.filter(Y=>(Y.level||Y.severity)==="error").length,ne=Array.isArray((K=r.value)==null?void 0:K.discarded)?r.value.discarded.length:0,ge=(_e=r.value)!=null&&_e.corrected?1:0;return{total:L.length,warnings:x,errors:D,discarded:ne,corrected:ge}}),F=y(()=>q.value.slice(0,3)),te=y(()=>E.value.errors?"critical":E.value.warnings?"warning":E.value.total?"success":"neutral"),he=y(()=>o.value?typeof o.value=="string"?o.value:o.value&&typeof o.value.message=="string"?o.value.message:String(o.value):""),me=y(()=>{var x;return(Array.isArray((x=l.value)==null?void 0:x.badges)?l.value.badges:[]).filter(Boolean)}),re=y(()=>{var ne,ge;const L=((ne=l.value)==null?void 0:ne.generatedAt)||((ge=_.value)==null?void 0:ge.fetched_at);if(!L)return"";const x=new Date(L);if(Number.isNaN(x.getTime()))return L;const D=A.value==="it"?"it-IT":"en-US";return new Intl.DateTimeFormat(D,{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(x)}),Ae=y(()=>m.value?typeof m.value=="string"?m.value:typeof m.value.message=="string"?m.value.message:String(m.value):""),Oe=y(()=>{var L;return((L=u.value)==null?void 0:L.labels)||{}}),De=y(()=>{var L;return((L=u.value)==null?void 0:L.synergyMap)||{}}),Fe=y(()=>{const L=[];return Object.entries(De.value||{}).forEach(([x,D])=>{const ne=Array.isArray(D)?D:Array.isArray(D==null?void 0:D.traits)?D.traits:Array.isArray(D==null?void 0:D.related)?D.related:[];L.push({id:x,label:Oe.value[x]||x,summary:Array.isArray(D==null?void 0:D.summary)?D.summary.join(", "):(D==null?void 0:D.summary)||"",items:ne})}),L.slice(0,6)});function M(L){return Oe.value[L]||L}const H=y(()=>[{id:"overview",label:w("views.species.sidebar.tabs.overview"),icon:"ð"},{id:"synergy",label:w("views.species.sidebar.tabs.synergy"),icon:"ð§¬"},{id:"qa",label:w("views.species.sidebar.tabs.qa"),icon:"ð§ª"}]),se=Ee("overview");return(L,x)=>(f(),g("section",Bc,[a("header",Uc,[a("h2",null,h(ae(w)("views.species.header.title")),1),a("p",null,h(ae(w)("views.species.header.body")),1)]),a("div",jc,[pe(yc,{species:ae(s),meta:ae(i),validation:ae(r),"trait-catalog":ae(u),"trait-compliance":ae(l)},null,8,["species","meta","validation","trait-catalog","trait-compliance"]),pe(xt,{modelValue:se.value,"onUpdate:modelValue":x[0]||(x[0]=D=>se.value=D),class:"species-view__card",icon:"ð°",title:ae(w)("views.species.sidebar.title"),tabs:H.value},{"tab-overview":Se(()=>[N.value.length?(f(),g("div",Vc,[(f(!0),g(W,null,Q(N.value,D=>(f(),Re(Fc,{key:D.id,label:D.label,current:D.current,total:D.total,percent:D.percent,value:D.value,description:D.description},null,8,["label","current","total","percent","value","description"]))),128))])):(f(),g("p",Hc,h(ae(w)("views.species.sidebar.emptyTelemetry")),1)),I.value||C.value.length?(f(),g("div",Gc,[I.value?(f(),g("dl",Wc,[a("div",null,[a("dt",null,h(ae(w)("views.species.sidebar.request.id")),1),a("dd",null,h(I.value.id),1)]),a("div",null,[a("dt",null,h(ae(w)("views.species.sidebar.request.biome")),1),a("dd",null,h(I.value.biome),1)]),a("div",null,[a("dt",null,h(ae(w)("views.species.sidebar.request.fallback")),1),a("dd",null,h(I.value.fallback),1)])])):U("",!0),C.value.length?(f(),g("div",Qc,[a("h4",null,h(ae(w)("views.species.sidebar.shortlist")),1),a("ul",null,[(f(!0),g(W,null,Q(C.value,D=>(f(),g("li",{key:D},h(D),1))),128))])])):U("",!0)])):U("",!0),he.value?(f(),g("p",Zc,h(he.value),1)):U("",!0)]),"tab-synergy":Se(()=>[Fe.value.length?(f(),g("div",Yc,[(f(!0),g(W,null,Q(Fe.value,D=>(f(),g("div",{key:D.id,class:"species-view__synergy-card"},[a("header",null,[pe(Ne,{label:D.label,variant:"synergy"},null,8,["label"]),D.summary?(f(),g("span",Xc,h(D.summary),1)):U("",!0)]),D.items.length?(f(),g("ul",Kc,[(f(!0),g(W,null,Q(D.items,ne=>(f(),g("li",{key:ne},[pe(Ne,{label:M(ne),variant:"trait"},null,8,["label"])]))),128))])):U("",!0)]))),128))])):(f(),g("p",Jc,h(ae(w)("views.species.sidebar.emptySynergy")),1)),me.value.length?(f(),g("div",eu,[a("h4",null,h(ae(w)("views.species.sidebar.compliance.title")),1),a("ul",null,[(f(!0),g(W,null,Q(me.value,D=>(f(),g("li",{key:D.id},[a("span",{"data-tone":D.tone||"neutral"},h(D.label),9,tu),a("strong",null,h(D.value),1)]))),128))]),re.value?(f(),g("p",su,h(ae(w)("views.species.sidebar.compliance.updated",{timestamp:re.value})),1)):U("",!0)])):U("",!0)]),"tab-qa":Se(()=>[a("div",au,[a("header",null,[a("h4",null,h(ae(w)("views.species.sidebar.qa.title")),1),a("span",{"data-tone":te.value},h(ae(w)("views.species.sidebar.qa.messages",{count:E.value.total})),9,nu)]),E.value.total?(f(),g("p",iu,h(ae(w)("views.species.sidebar.qa.intro")),1)):(f(),g("p",ru,h(ae(w)("views.species.sidebar.qa.empty")),1)),E.value.total?(f(),g("ul",lu,[(f(!0),g(W,null,Q(F.value,D=>(f(),g("li",{key:D.code||D.message},[a("span",{"data-level":D.level||D.severity||"info"},h(D.level||D.severity||"info"),9,ou),a("span",null,h(D.message),1)]))),128))])):U("",!0),E.value.total?(f(),g("ul",cu,[E.value.errors?(f(),g("li",uu,[a("strong",null,h(ae(w)("views.species.sidebar.qa.counters.errors")),1),a("span",null,h(E.value.errors),1)])):U("",!0),E.value.warnings?(f(),g("li",du,[a("strong",null,h(ae(w)("views.species.sidebar.qa.counters.warnings")),1),a("span",null,h(E.value.warnings),1)])):U("",!0),E.value.corrected?(f(),g("li",pu,[a("strong",null,h(ae(w)("views.species.sidebar.qa.counters.corrected")),1),a("span",null,h(E.value.corrected),1)])):U("",!0),E.value.discarded?(f(),g("li",fu,[a("strong",null,h(ae(w)("views.species.sidebar.qa.counters.discarded")),1),a("span",null,h(E.value.discarded),1)])):U("",!0)])):U("",!0),ae(p)?(f(),g("p",mu,h(ae(w)("views.species.sidebar.qa.syncing")),1)):Ae.value?(f(),g("p",gu,h(Ae.value),1)):U("",!0)])]),_:1},8,["modelValue","title","tabs"])])]))}},_u=ye(hu,[["__scopeId","data-v-29fd6bda"]]),vu={class:"synthesis-map"},bu={class:"synthesis-map__header"},yu={class:"synthesis-map__canvas-wrapper"},ku={class:"synthesis-map__canvas",viewBox:"0 0 360 240",role:"img"},wu={class:"synthesis-map__connections"},Su=["x1","y1","x2","y2","stroke-width"],$u={class:"synthesis-map__nodes"},Au=["transform"],Tu={class:"synthesis-map__node-label",y:"32"},xu={class:"synthesis-map__node-metric",y:"-26"},Eu={class:"synthesis-map__legend"},Ru=["onClick"],Cu=["onClick"],Iu={__name:"BiomeSynthesisMap",props:{nodes:{type:Array,default:()=>[]},connections:{type:Array,default:()=>[]}},setup(t){const e=t,s=y(()=>{const o=new Map;return e.nodes.forEach(u=>{o.set(u.id,u)}),o}),n=o=>`${Math.round(o*100)}%`,i=o=>{const u=s.value.get(o);return u?u.position||{x:0,y:0}:{x:0,y:0}},r=o=>({staging:"Smistamento squadre",ambush:"Punto di agguato",lure:"Innesco diversivo",safe:"Nodo di recupero"})[o]||"Nodo operativo",d=o=>{var p,m;const u=((p=s.value.get(o.from))==null?void 0:p.label)||o.from,l=((m=s.value.get(o.to))==null?void 0:m.label)||o.to;return`${u} â ${l}`};return(o,u)=>(f(),g("section",vu,[a("header",bu,[u[1]||(u[1]=a("div",null,[a("h3",null,"Schema modulare"),a("p",null,"Visualizza i nodi generati e le connessioni tattiche previste.")],-1)),a("button",{type:"button",class:"synthesis-map__action",onClick:u[0]||(u[0]=l=>o.$emit("regenerate:layout"))}," Rigenera layout ")]),a("div",yu,[(f(),g("svg",ku,[u[2]||(u[2]=a("defs",null,[a("pattern",{id:"tile-grid",width:"24",height:"24",patternUnits:"userSpaceOnUse"},[a("path",{d:"M24 0 H0 V24",fill:"none",stroke:"rgba(255,255,255,0.05)","stroke-width":"1"})])],-1)),u[3]||(u[3]=a("rect",{x:"0",y:"0",width:"360",height:"240",fill:"url(#tile-grid)"},null,-1)),a("g",wu,[(f(!0),g(W,null,Q(t.connections,l=>(f(),g("line",{key:l.id,x1:i(l.from).x,y1:i(l.from).y,x2:i(l.to).x,y2:i(l.to).y,"stroke-width":1.5+l.weight*.6,class:Le(["synthesis-map__connection",`synthesis-map__connection--w${l.weight}`])},null,10,Su))),128))]),a("g",$u,[(f(!0),g(W,null,Q(t.nodes,l=>(f(),g("g",{key:l.id,class:"synthesis-map__node",transform:`translate(${i(l.id).x} ${i(l.id).y})`},[a("circle",{r:18,class:Le(["synthesis-map__node-circle",`synthesis-map__node-circle--${l.type}`])},null,2),a("text",Tu,h(l.label),1),a("text",xu,h(n(l.intensity)),1)],8,Au))),128))])]))]),a("div",Eu,[a("section",null,[u[4]||(u[4]=a("h4",null,"Nodi",-1)),a("ul",null,[(f(!0),g(W,null,Q(t.nodes,l=>(f(),g("li",{key:l.id},[a("div",null,[a("strong",null,h(l.label),1),a("span",null,h(r(l.type)),1)]),a("button",{type:"button",onClick:p=>o.$emit("regenerate:node",l.id)},"Rigenera",8,Ru)]))),128))])]),a("section",null,[u[5]||(u[5]=a("h4",null,"Connessioni",-1)),a("ul",null,[(f(!0),g(W,null,Q(t.connections,l=>(f(),g("li",{key:l.id},[a("div",null,[a("strong",null,h(d(l)),1),a("span",null,"IntensitÃ  "+h(l.weight),1)]),a("button",{type:"button",onClick:p=>o.$emit("regenerate:connection",l.id)},"Rigenera",8,Cu)]))),128))])])])]))}},Ou=ye(Iu,[["__scopeId","data-v-e788bbd6"]]),qu={class:"glossary-tooltip"},Nu={key:0,class:"glossary-tooltip__bubble"},Lu={__name:"GlossaryTooltip",props:{description:{type:String,default:""}},setup(t){const e=t;return(s,n)=>(f(),g("span",qu,[Ie(s.$slots,"default",{},void 0,!0),e.description?(f(),g("span",Nu,h(e.description),1)):U("",!0)]))}},en=ye(Lu,[["__scopeId","data-v-53fc6d81"]]),zu={class:"biome-setup"},Mu={class:"biome-setup__chips"},Pu={class:"biome-setup__filters"},Du=["data-active","aria-pressed","onClick"],Fu={key:0,class:"biome-setup__panel"},Bu=["value"],Uu=["value"],ju={class:"biome-setup__roles"},Vu=["value"],Hu={class:"biome-setup__seed"},Gu={class:"biome-setup__actions"},Wu=["disabled"],Qu={key:1,class:"biome-setup__graph"},Zu={key:2,class:"biome-setup__validators"},Yu={class:"biome-setup__validator-title"},Xu={__name:"BiomeSetupView",props:{config:{type:Object,default:()=>({})},graph:{type:Object,default:()=>({nodes:[],connections:[]})},validators:{type:Array,default:()=>[]}},emits:["synthesize"],setup(t,{emit:e}){const s=t,n=e,i=Pe({hazard:"",climate:"",requiredRoles:[],graphicSeed:""}),r=Pe({nodes:[],connections:[]}),d=Ee("setup"),o=[{id:"setup",label:"Setup",icon:"ð "},{id:"graph",label:"Synth map",icon:"ð°"},{id:"validators",label:"Validatori",icon:"ð¡"}],u=y(()=>{var M;return((M=s.config)==null?void 0:M.hazardOptions)||[]}),l=y(()=>{var M;return((M=s.config)==null?void 0:M.climateOptions)||[]}),p=y(()=>{var M;return((M=s.config)==null?void 0:M.roleCatalog)||[]}),m=y(()=>{var L,x,D,ne;const M=new Map;return[(L=s.config)==null?void 0:L.traitGlossary,(x=s.config)==null?void 0:x.glossary].forEach(ge=>{!ge||typeof ge!="object"||Object.entries(ge).forEach(([K,_e])=>{if(!K)return;const Y=_e||{};M.set(K,{id:K,label:Y.label||Y.name||K,description:Y.description||Y.summary||"",roles:Array.isArray(Y.roles)?Y.roles:Array.isArray(Y.requiredRoles)?Y.requiredRoles:[]})})}),[(D=s.config)==null?void 0:D.affinities,(ne=s.config)==null?void 0:ne.affinityCatalog].forEach(ge=>{Array.isArray(ge)&&ge.forEach(K=>{const _e=typeof K=="string"?K:K.id||K.key||K.slug||K.name;_e&&(M.has(_e)||M.set(_e,{id:_e,label:typeof K=="string"?K:K.label||K.name||_e,description:typeof K=="string"?"":K.description||K.summary||"",roles:Array.isArray(K.roles)?K.roles:Array.isArray(K.requiredRoles)?K.requiredRoles:[]}))})}),Array.from(M.values())}),_=Ee([]),w=y(()=>{var se,L;const M=new Map;m.value.forEach(x=>{Array.isArray(x.roles)&&x.roles.length&&M.set(x.id,x.roles)});const H=((se=s.config)==null?void 0:se.traitRoleMap)||((L=s.config)==null?void 0:L.traitRoles)||{};return H&&typeof H=="object"&&Object.entries(H).forEach(([x,D])=>{if(!x)return;const ne=Array.isArray(D)?D:[];if(!M.has(x))M.set(x,ne);else{const ge=new Set(M.get(x));ne.forEach(K=>ge.add(K)),M.set(x,Array.from(ge))}}),M}),A=y(()=>{const M=Array.isArray(p.value)?p.value:[];if(!_.value.length)return M;const H=w.value,se=new Set;if(_.value.forEach(D=>{(H.get(D)||[]).forEach(ne=>se.add(ne))}),!se.size)return M;const L=M.filter(D=>se.has(D)),x=i.requiredRoles.filter(D=>!L.includes(D));return[...L,...x]}),S=y(()=>i.hazard&&i.climate&&i.requiredRoles.length>0&&i.graphicSeed),T=y(()=>{const M=[];return i.hazard&&M.push({id:"hazard",label:"Hazard",value:i.hazard,tone:"warning"}),i.climate&&M.push({id:"climate",label:"Clima",value:i.climate,tone:"neutral"}),M.push({id:"roles",label:"Ruoli",value:i.requiredRoles.length||0,tone:"success"}),_.value.length&&M.push({id:"filters",label:"Filtri tratti",value:_.value.length,tone:"neutral"}),r.nodes.length&&M.push({id:"nodes",label:"Nodi mappa",value:r.nodes.length,tone:"neutral"}),M}),C=y(()=>s.validators.flatMap(M=>(M.validators||[]).map(H=>({id:`${M.id}-${H.id}`,biome:M.name,status:H.status,label:H.label,message:H.message})))),ee=()=>{var M,H,se,L;i.hazard=((M=s.config)==null?void 0:M.hazard)||"",i.climate=((H=s.config)==null?void 0:H.climate)||"",i.graphicSeed=((se=s.config)==null?void 0:se.graphicSeed)||"",i.requiredRoles=[...((L=s.config)==null?void 0:L.requiredRoles)||[]]},R=()=>({x:60+Math.random()*240,y:60+Math.random()*140}),N=M=>({...M,position:M.position||R()}),I=M=>({...M}),q=()=>{var M,H;r.nodes=(((M=s.graph)==null?void 0:M.nodes)||[]).map(se=>N(se)),r.connections=(((H=s.graph)==null?void 0:H.connections)||[]).map(se=>I(se))},E=M=>{const H=Number.isFinite(M.intensity)?M.intensity:.55,se=Math.max(.35,Math.min(.95,H+(Math.random()*.4-.2)));M.intensity=Number(se.toFixed(2))},F=M=>{if(!M)return;const H=_.value.indexOf(M);if(H===-1)_.value=[..._.value,M];else{const se=[..._.value];se.splice(H,1),_.value=se}},te=M=>_.value.includes(M),he=()=>{_.value=[]},me=M=>{const H=r.nodes.find(se=>se.id===M);H&&(H.position=R(),E(H))},re=M=>{const H=r.connections.find(L=>L.id===M);if(!H)return;const se=Math.round(Math.random()*2-1);H.weight=Math.max(1,H.weight+se)},Ae=()=>{r.nodes.forEach(M=>{M.position=R(),E(M)})},Oe=()=>{var H;const M=Math.random().toString(16).slice(2,8).toUpperCase();i.graphicSeed=`${((H=i.hazard)==null?void 0:H.split(" ")[0])||"BIOME"}-${M}`},De=()=>{S.value&&n("synthesize",{hazard:i.hazard,climate:i.climate,requiredRoles:[...i.requiredRoles],graphicSeed:i.graphicSeed,graph:{nodes:r.nodes.map(M=>({id:M.id,position:M.position,intensity:M.intensity})),connections:r.connections.map(M=>({id:M.id,weight:M.weight}))}})};Ce(()=>{var M,H,se;return[(M=s.config)==null?void 0:M.hazard,(H=s.config)==null?void 0:H.climate,(se=s.config)==null?void 0:se.graphicSeed]},ee,{immediate:!0}),Ce(()=>{var M;return((M=s.config)==null?void 0:M.requiredRoles)&&[...s.config.requiredRoles]},()=>{var M;i.requiredRoles=[...((M=s.config)==null?void 0:M.requiredRoles)||[]]},{immediate:!0}),Ce(()=>{var M,H,se,L;return[(H=(M=s.graph)==null?void 0:M.nodes)==null?void 0:H.length,(L=(se=s.graph)==null?void 0:se.connections)==null?void 0:L.length]},q,{immediate:!0});function Fe(M){return M?M==="passed"?"â":M==="warning"?"â ":M==="failed"?"â":"â":"â"}return(M,H)=>(f(),g("section",zu,[pe(Us,{tabs:o,modelValue:d.value,"onUpdate:modelValue":H[4]||(H[4]=se=>d.value=se),"status-indicators":T.value},{cards:Se(()=>[pe(xt,{icon:"ðª",title:"Profilo ambientale"},{default:Se(()=>[a("div",Mu,[i.hazard?(f(),Re(Ne,{key:0,label:i.hazard,variant:"hazard"},null,8,["label"])):U("",!0),i.climate?(f(),Re(Ne,{key:1,label:i.climate,variant:"climate"},null,8,["label"])):U("",!0),(f(!0),g(W,null,Q(i.requiredRoles,se=>(f(),Re(Ne,{key:se,label:se,variant:"role",icon:"â"},null,8,["label"]))),128))])]),_:1}),m.value.length?(f(),Re(xt,{key:0,icon:"ð§¬",title:"Filtri tratti"},{default:Se(()=>[a("div",Pu,[(f(!0),g(W,null,Q(m.value,se=>(f(),g("button",{key:se.id,type:"button",class:"biome-setup__filter","data-active":te(se.id),"aria-pressed":te(se.id),onClick:L=>F(se.id)},[pe(en,{description:se.description},{default:Se(()=>[pe(Ne,{label:se.label,variant:"trait"},null,8,["label"])]),_:2},1032,["description"])],8,Du))),128))]),_.value.length?(f(),g("button",{key:0,type:"button",class:"biome-setup__reset",onClick:he}," Reset filtri ")):U("",!0)]),_:1})):U("",!0)]),default:Se(({activeTab:se})=>[se==="setup"?(f(),g("div",Fu,[a("form",{class:"biome-setup__form",onSubmit:Is(De,["prevent"])},[a("fieldset",null,[H[7]||(H[7]=a("legend",null,"Perimetro ambientale",-1)),a("label",null,[H[5]||(H[5]=a("span",null,"Hazard dominante",-1)),et(a("select",{"onUpdate:modelValue":H[0]||(H[0]=L=>i.hazard=L)},[(f(!0),g(W,null,Q(u.value,L=>(f(),g("option",{key:L,value:L},h(L),9,Bu))),128))],512),[[Et,i.hazard]])]),a("label",null,[H[6]||(H[6]=a("span",null,"Clima operativo",-1)),et(a("select",{"onUpdate:modelValue":H[1]||(H[1]=L=>i.climate=L)},[(f(!0),g(W,null,Q(l.value,L=>(f(),g("option",{key:L,value:L},h(L),9,Uu))),128))],512),[[Et,i.climate]])])]),a("fieldset",null,[H[8]||(H[8]=a("legend",null,"Ruoli richiesti",-1)),a("div",ju,[(f(!0),g(W,null,Q(A.value,L=>(f(),g("label",{key:L},[et(a("input",{type:"checkbox",value:L,"onUpdate:modelValue":H[2]||(H[2]=x=>i.requiredRoles=x)},null,8,Vu),[[wn,i.requiredRoles]]),pe(Ne,{label:L,variant:"role"},null,8,["label"])]))),128))])]),a("fieldset",null,[H[9]||(H[9]=a("legend",null,"Seed grafico",-1)),a("div",Hu,[et(a("input",{"onUpdate:modelValue":H[3]||(H[3]=L=>i.graphicSeed=L),type:"text",placeholder:"Inserisci seed procedurale"},null,512),[[Ss,i.graphicSeed]]),a("button",{type:"button",onClick:Oe},"Random")])]),a("footer",Gu,[a("button",{type:"submit",disabled:!S.value},"Invoca biomeSynthesizer",8,Wu),H[10]||(H[10]=a("p",null,"Il seed e i ruoli selezionati verranno passati come contesto obbligatorio per i nodi rigenerati.",-1))])],32)])):se==="graph"?(f(),g("div",Qu,[pe(Ou,{nodes:r.nodes,connections:r.connections,"onRegenerate:layout":Ae,"onRegenerate:node":me,"onRegenerate:connection":re},null,8,["nodes","connections"])])):(f(),g("div",Zu,[H[11]||(H[11]=a("header",null,[a("h3",null,"Feedback dai validator runtime"),a("p",null,"Monitoraggio in tempo reale delle anomalie per bioma.")],-1)),a("ul",null,[(f(!0),g(W,null,Q(C.value,L=>(f(),g("li",{key:L.id,class:Le(`status-${L.status}`)},[a("div",Yu,[pe(Ne,{label:L.biome,variant:"validator",icon:Fe(L.status)},null,8,["label","icon"]),a("span",null,h(L.label),1)]),a("p",null,h(L.message),1)],2))),128))])]))]),_:1},8,["modelValue","status-indicators"])]))}},Ku=ye(Xu,[["__scopeId","data-v-d3a076c9"]]),Ju=["data-tone"],Ye={__name:"EvoGeneDeckTelemetryBadge",props:{label:{type:String,required:!0},value:{type:[String,Number],default:"â"},tone:{type:String,default:"neutral"}},setup(t){const s=`evogene-deck-telemetry-${Sn()}`,n=`${s}-label`,i=`${s}-value`;return(r,d)=>(f(),g("span",{class:"evogene-deck-telemetry","data-tone":t.tone,role:"group","aria-labelledby":n,"aria-describedby":i},[a("span",{id:n,class:"evogene-deck-telemetry__label"},h(t.label),1),a("span",{id:i,class:"evogene-deck-telemetry__value"},[Ie(r.$slots,"default",{},()=>[ft(h(t.value),1)])])],8,Ju))}},ed=["data-tone"],td={class:"evogene-deck-biome-card__header"},sd={class:"evogene-deck-biome-card__title"},ad={key:0,class:"evogene-deck-biome-card__subtitle"},nd={class:"evogene-deck-biome-card__telemetry"},id={key:0,class:"evogene-deck-biome-card__section"},rd={class:"evogene-deck-biome-card__chips"},ld={key:1,class:"evogene-deck-biome-card__section"},od={class:"evogene-deck-biome-card__list"},cd={key:2,class:"evogene-deck-biome-card__section"},ud={class:"evogene-deck-biome-card__footer"},dd={key:0},pd={__name:"EvoGeneDeckBiomeCard",props:{biome:{type:Object,required:!0}},setup(t){const e=t,s=y(()=>{var r,d;return((r=e.biome)==null?void 0:r.lanes)||((d=e.biome)==null?void 0:d.paths)||[]}),n=y(()=>{var r,d;return((r=e.biome)==null?void 0:r.operations)||((d=e.biome)==null?void 0:d.opportunities)||[]}),i=y(()=>{var u,l;const r=Number((u=e.biome)==null?void 0:u.total)||0,d=Number((l=e.biome)==null?void 0:l.readiness)||0;if(!r)return"warning";const o=Math.round(d/r*100);return o>=80?"success":o<50?"critical":"warning"});return(r,d)=>(f(),g("article",{class:"evogene-deck-biome-card","data-tone":i.value},[a("header",td,[a("div",null,[d[0]||(d[0]=a("p",{class:"evogene-deck-biome-card__kicker"},"Bioma operativo",-1)),a("h3",sd,h(t.biome.name),1),t.biome.hazard?(f(),g("p",ad,h(t.biome.hazard),1)):U("",!0)]),a("div",nd,[pe(Ye,{label:"Readiness",value:`${t.biome.readiness||0}/${t.biome.total||0}`,tone:i.value},null,8,["value","tone"]),t.biome.risk?(f(),Re(Ye,{key:0,label:"Rischio",value:t.biome.risk,tone:"warning"},null,8,["value"])):U("",!0)])]),s.value.length?(f(),g("section",id,[d[1]||(d[1]=a("h4",null,"Corridoi",-1)),a("ul",rd,[(f(!0),g(W,null,Q(s.value,o=>(f(),g("li",{key:o},h(o),1))),128))])])):U("",!0),n.value.length?(f(),g("section",ld,[d[2]||(d[2]=a("h4",null,"Operazioni",-1)),a("ul",od,[(f(!0),g(W,null,Q(n.value,o=>(f(),g("li",{key:o},h(o),1))),128))])])):U("",!0),t.biome.infiltration?(f(),g("section",cd,[d[3]||(d[3]=a("h4",null,"Infiltrazione",-1)),a("p",null,h(t.biome.infiltration),1)])):U("",!0),a("footer",ud,[t.biome.storyHook?(f(),g("p",dd,h(t.biome.storyHook),1)):U("",!0),Ie(r.$slots,"footer",{},void 0,!0)])],8,ed))}},fd=ye(pd,[["__scopeId","data-v-82f5146d"]]),md={class:"biomes-view"},gd={class:"biomes-view__telemetry"},hd={class:"biomes-view__filters"},_d=["data-active","aria-pressed","onClick"],vd={class:"biomes-view__hazards"},bd={key:0,class:"biomes-view__grid"},yd={class:"biomes-view__metrics"},kd={key:0,class:"biomes-view__validators"},wd={key:1,class:"biomes-view__validator-feed"},Sd={__name:"BiomesView",props:{biomes:{type:Array,default:()=>[]}},setup(t){const e=t,{biomes:s}=_t(e),n=Ee("grid"),{t:i}=Ra(),r=y(()=>[{id:"grid",label:i("views.biomes.tabs.grid"),icon:"ð"},{id:"validators",label:i("views.biomes.tabs.validators"),icon:"ð¡"}]),d=y(()=>{const I=new Map;return(Array.isArray(s.value)?s.value:[]).forEach(E=>{[...Array.isArray(E.traits)?E.traits:[],...Array.isArray(E.affinities)?E.affinities:[]].forEach(te=>{const he=typeof te=="string"?te:te.id||te.key||te.slug||te.name;he&&(I.has(he)||I.set(he,{id:he,label:typeof te=="string"?te:te.label||te.name||he,description:typeof te=="string"?"":te.description||te.summary||te.detail||""}))})}),Array.from(I.values())}),o=Ee([]),u=I=>{const q=[...Array.isArray(I.traits)?I.traits:[],...Array.isArray(I.affinities)?I.affinities:[]];return new Set(q.map(E=>typeof E=="string"?E:E.id||E.key||E.slug||E.name).filter(Boolean))},l=y(()=>{const I=new Set(o.value);return I.size?(s.value||[]).filter(q=>{const E=u(q);return Array.from(I).every(F=>E.has(F))}):Array.isArray(s.value)?s.value:[]}),p=y(()=>{const I=Array.isArray(l.value)?l.value:[],q=I.reduce((te,he)=>te+(Number(he.readiness)||0),0),E=I.reduce((te,he)=>te+(Number(he.total)||0),0),F=I.reduce((te,he)=>te+(Number(he.risk)||0),0);return{count:I.length,readiness:q,capacity:E,riskAverage:I.length?Math.round(F/I.length*10)/10:0}}),m=y(()=>{const I=[];if((p.value.count||o.value.length)&&I.push({id:"count",label:i("views.biomes.metrics.activeBiomes"),value:p.value.count,tone:"neutral"}),p.value.capacity){const q=Math.min(100,Math.round(p.value.readiness/p.value.capacity*100));let E="warning";q>=80?E="success":q<50&&(E="critical"),I.push({id:"readiness",label:i("views.biomes.metrics.readinessCoverage"),value:`${q}%`,tone:E})}return I.push({id:"risk",label:i("views.biomes.metrics.riskAverage"),value:p.value.riskAverage||"0",tone:"warning"}),o.value.length&&I.push({id:"filters",label:i("views.biomes.metrics.activeFilters"),value:o.value.length,tone:"neutral"}),I}),_=y(()=>{const I=new Set,q=[];return(l.value||[]).forEach(E=>{const F=E.hazard||i("views.biomes.fallbacks.hazard");I.has(F)||(I.add(F),q.push({key:`${E.id}-hazard`,label:F,variant:"hazard",icon:"â "}),E.climate&&q.push({key:`${E.id}-climate`,label:E.climate,variant:"climate",icon:"â"}))}),q.slice(0,4)}),w=y(()=>(l.value||[]).flatMap(I=>(I.validators||[]).map(q=>({id:`${I.id}-${q.id}`,biome:I.name,status:q.status||"info",label:q.label,message:q.message}))));function A(I){if(!I)return;const q=o.value.indexOf(I);if(q===-1)o.value=[...o.value,I];else{const E=[...o.value];E.splice(q,1),o.value=E}}function S(I){return o.value.includes(I)}function T(){o.value=[]}function C(I){const q=Number.isFinite(I.total)?I.total:0,E=Number.isFinite(I.readiness)?I.readiness:0;return q?Math.min(100,Math.round(E/q*100)):0}function ee(I){const q=C(I);return`${I.readiness||0} / ${I.total||0} Â· ${q}%`}function R(I){const q=C(I);return q>=80?"success":q<50?"critical":"warning"}function N(I){return I?I==="passed"?"â":I==="warning"?"â ":I==="failed"?"â":"â":"â"}return(I,q)=>(f(),g("section",md,[pe(Us,{tabs:r.value,modelValue:n.value,"onUpdate:modelValue":q[0]||(q[0]=E=>n.value=E),"status-indicators":m.value},{cards:Se(()=>[pe(xt,{icon:"ð°",title:ae(i)("views.biomes.cards.orchestrator")},{default:Se(()=>[a("div",gd,[(f(!0),g(W,null,Q(m.value,E=>(f(),Re(Ye,{key:E.id,label:E.label,value:E.value,tone:E.tone||"neutral"},null,8,["label","value","tone"]))),128))])]),_:1},8,["title"]),d.value.length?(f(),Re(xt,{key:0,icon:"ð§¬",title:ae(i)("views.biomes.cards.traits")},{default:Se(()=>[a("div",hd,[(f(!0),g(W,null,Q(d.value,E=>(f(),g("button",{key:E.id,type:"button",class:"biomes-view__filter","data-active":S(E.id),"aria-pressed":S(E.id),onClick:F=>A(E.id)},[pe(en,{description:E.description},{default:Se(()=>[pe(Ne,{label:E.label,variant:"trait"},null,8,["label"])]),_:2},1032,["description"])],8,_d))),128))]),o.value.length?(f(),g("button",{key:0,type:"button",class:"biomes-view__reset",onClick:T},h(ae(i)("views.biomes.actions.resetFilters")),1)):U("",!0)]),_:1},8,["title"])):U("",!0),_.value.length?(f(),Re(xt,{key:1,icon:"â ",title:ae(i)("views.biomes.cards.hazards")},{default:Se(()=>[a("div",vd,[(f(!0),g(W,null,Q(_.value,E=>(f(),Re(Ne,{key:E.key,label:E.label,variant:E.variant,icon:E.icon},null,8,["label","variant","icon"]))),128))])]),_:1},8,["title"])):U("",!0)]),default:Se(({activeTab:E})=>[E==="grid"?(f(),g("div",bd,[(f(!0),g(W,null,Q(l.value,F=>(f(),Re(fd,{key:F.id,biome:F},{footer:Se(()=>[a("div",yd,[pe(Ye,{label:ae(i)("views.biomes.metrics.readiness"),value:ee(F),tone:R(F)},null,8,["label","value","tone"]),pe(Ne,{label:ae(i)("views.biomes.metrics.riskLabel",{value:F.risk}),variant:"hazard",icon:"â "},null,8,["label"])]),(F.validators||[]).length?(f(),g("ul",kd,[(f(!0),g(W,null,Q(F.validators,te=>(f(),g("li",{key:te.id,class:Le(`validator validator--${te.status}`)},[pe(Ne,{label:te.label,variant:"validator",icon:N(te.status)},null,8,["label","icon"]),a("span",null,h(te.message),1)],2))),128))])):U("",!0)]),_:2},1032,["biome"]))),128))])):(f(),g("div",wd,[a("header",null,[a("h3",null,h(ae(i)("views.biomes.validator.feedTitle")),1),a("p",null,h(ae(i)("views.biomes.validator.feedDescription")),1)]),a("ul",null,[(f(!0),g(W,null,Q(w.value,F=>(f(),g("li",{key:F.id,class:Le(`validator validator--${F.status}`)},[a("div",null,[a("strong",null,h(F.biome),1),a("span",null,h(F.label),1)]),a("p",null,h(F.message),1)],2))),128))])]))]),_:1},8,["tabs","modelValue","status-indicators"])]))}},$d=ye(Sd,[["__scopeId","data-v-a3e7f99a"]]),Ad={key:0,class:"encounter-panel"},Td={class:"encounter-panel__header"},xd={class:"encounter-panel__title-block"},Ed={class:"encounter-panel__title"},Rd={class:"encounter-panel__summary"},Cd={class:"encounter-panel__meta"},Id={class:"encounter-panel__badge"},Od={class:"encounter-panel__biome"},qd={key:0,class:"encounter-panel__variant-selector"},Nd=["value"],Ld={class:"encounter-panel__description"},zd={class:"encounter-panel__slots"},Md={class:"encounter-panel__slot-list"},Pd={class:"encounter-panel__slot-qty"},Dd={class:"encounter-panel__specimen-list"},Fd={class:"encounter-panel__specimen-name"},Bd={class:"encounter-panel__specimen-role"},Ud={key:1,class:"encounter-panel__parameters"},jd={key:2,class:"encounter-panel__warnings"},Vd={key:1,class:"encounter-panel encounter-panel--empty"},Hd={__name:"EncounterPanel",props:{encounter:{type:Object,default:null},initialVariant:{type:Number,default:0}},setup(t){const e=t,s=Ee(e.initialVariant);Ce(()=>e.encounter,()=>{s.value=e.initialVariant}),Ce(()=>e.initialVariant,l=>{s.value=l});const n=y(()=>{var l,p;return(((p=(l=e.encounter)==null?void 0:l.variants)==null?void 0:p.length)||0)>1}),i=y(()=>e.encounter?(e.encounter.variants||[e.encounter.seed||e.encounter]).map(p=>({...p,metrics:p.metrics||{threat:{tier:"T?"}},parametersList:Object.entries(p.parameters||{}).map(([m,_])=>{var w;return{id:m,label:((w=e.encounter.parameterLabels)==null?void 0:w[m])||m,value:_}}),warnings:p.warnings||[]})):[]),r=y(()=>{const l=Math.min(Math.max(s.value,0),i.value.length-1);return i.value[l]||{summary:"",description:"",slots:[],metrics:{threat:{tier:"T?"}},parametersList:[],warnings:[]}}),d=y(()=>{var l,p;return e.encounter?{templateName:e.encounter.templateName||e.encounter.template_id||"Encounter",biomeName:e.encounter.biomeName||((l=e.encounter.biome)==null?void 0:l.name)||((p=e.encounter.biome)==null?void 0:p.id)||"Biome sconosciuto",variants:i.value}:null});function o(l,p){const m=l.parametersList.map(_=>`${_.label}: ${_.value.label}`).join(" Â· ");return m?`${p+1}. ${m}`:`${p+1}. Configurazione`}function u(l){return l.slot?`${l.code} (${l.slot})`:l.code}return(l,p)=>d.value?(f(),g("section",Ad,[a("header",Td,[a("div",xd,[a("h2",Ed,h(d.value.templateName),1),a("p",Rd,h(r.value.summary),1)]),a("div",Cd,[a("span",Id,h(r.value.metrics.threat.tier),1),a("span",Od,h(d.value.biomeName),1)])]),n.value?(f(),g("div",qd,[p[1]||(p[1]=a("label",{class:"encounter-panel__variant-label",for:"encounter-variant"},"Scenario",-1)),et(a("select",{id:"encounter-variant",class:"encounter-panel__variant-select","onUpdate:modelValue":p[0]||(p[0]=m=>s.value=m),"data-testid":"variant-select"},[(f(!0),g(W,null,Q(d.value.variants,(m,_)=>(f(),g("option",{key:m.id,value:_},h(o(m,_)),9,Nd))),128))],512),[[Et,s.value]])])):U("",!0),a("article",Ld,[a("p",null,h(r.value.description),1)]),a("section",zd,[p[2]||(p[2]=a("h3",null,"Composizione",-1)),a("ul",Md,[(f(!0),g(W,null,Q(r.value.slots,m=>(f(),g("li",{key:m.id,class:"encounter-panel__slot"},[a("header",null,[a("h4",null,[ft(h(m.title)+" ",1),a("span",Pd,"Ã "+h(m.quantity),1)])]),a("ul",Dd,[(f(!0),g(W,null,Q(m.species,_=>(f(),g("li",{key:_.id},[a("span",Fd,h(_.display_name),1),a("small",Bd,h(_.role_trofico),1)]))),128))])]))),128))])]),r.value.parametersList.length?(f(),g("section",Ud,[p[3]||(p[3]=a("h3",null,"Parametri",-1)),a("dl",null,[(f(!0),g(W,null,Q(r.value.parametersList,m=>(f(),g("div",{key:m.id},[a("dt",null,h(m.label),1),a("dd",null,h(m.value.label),1)]))),128))])])):U("",!0),r.value.warnings.length?(f(),g("section",jd,[p[4]||(p[4]=a("h3",null,"Avvisi",-1)),a("ul",null,[(f(!0),g(W,null,Q(r.value.warnings,m=>(f(),g("li",{key:m.code+m.slot},h(u(m)),1))),128))])])):U("",!0)])):(f(),g("section",Vd,[...p[5]||(p[5]=[a("p",null,"Nessun encounter generato.",-1)])]))}},Gd=ye(Hd,[["__scopeId","data-v-ed33f428"]]),Wd={class:"encounter-editor"},Qd={class:"encounter-editor__header"},Zd={class:"encounter-editor__steps","aria-label":"Editor encounter"},Yd=["onClick"],Xd={class:"encounter-editor__step-index"},Kd={class:"encounter-editor__step-label"},Jd={class:"encounter-editor__content"},ep={key:0,class:"encounter-editor__panel"},tp={class:"variant-list"},sp=["onClick"],ap={class:"variant-card__badge"},np={class:"variant-card__footer"},ip=["onClick"],rp={key:1,class:"encounter-editor__panel"},lp={key:0,class:"parameter-grid"},op=["for"],cp=["id","onUpdate:modelValue","onChange"],up=["value"],dp={key:1},pp={key:2,class:"encounter-editor__panel"},fp={key:0,class:"slot-table"},mp={class:"slot-table__info"},gp={class:"slot-table__controls"},hp=["for"],_p=["id","value","onInput"],vp={key:1},bp={class:"encounter-editor__footer"},yp=["disabled"],kp=["disabled"],wp={__name:"EncounterEditor",props:{encounter:{type:Object,required:!0},variants:{type:Array,default:()=>[]},selectedVariantId:{type:String,default:null},metricsByVariant:{type:Object,default:()=>({})},comparisonSelection:{type:Array,default:()=>[]}},emits:["select-variant","update-parameter","update-slot","toggle-comparison"],setup(t,{emit:e}){const s=e,n=t,i=[{id:"variant",label:"Variante"},{id:"parameters",label:"Parametri"},{id:"slots",label:"Slot"}],r=Ee(0);Ce(()=>n.selectedVariantId,()=>{!n.selectedVariantId&&n.variants.length&&s("select-variant",n.variants[0].id)},{immediate:!0});const d=y(()=>n.variants.find(S=>S.id===n.selectedVariantId)||n.variants[0]||null),o=Pe({});Ce(d,S=>{if(S){for(const T of Object.keys(o))delete o[T];for(const[T,C]of Object.entries(S.parameters||{}))o[T]=C.value}},{immediate:!0});const u=y(()=>{const S=new Map;for(const C of n.variants)for(const[ee,R]of Object.entries(C.parameters||{}))S.has(ee)||S.set(ee,new Map),S.get(ee).set(R.value,{value:R.value,label:R.label,summary:R.summary||""});const T={};for(const[C,ee]of S.entries())T[C]=Array.from(ee.values());return T});function l(S){var T;return((T=n.encounter.parameterLabels)==null?void 0:T[S])||S}function p(S){s("select-variant",S)}function m(S){var C;if(!d.value)return;const T=(C=u.value[S])==null?void 0:C.find(ee=>ee.value===o[S]);T&&s("update-parameter",{variantId:d.value.id,parameterId:S,value:T})}function _(S,T){if(!d.value)return;const C=Number.parseInt(T,10);Number.isNaN(C)||C<0||s("update-slot",{variantId:d.value.id,slotId:S,quantity:C})}function w(){r.value=Math.max(0,r.value-1)}function A(){r.value=Math.min(i.length-1,r.value+1)}return(S,T)=>{var C,ee;return f(),g("section",Wd,[a("header",Qd,[T[0]||(T[0]=a("h3",null,"Editor step-by-step",-1)),a("nav",Zd,[(f(),g(W,null,Q(i,(R,N)=>a("button",{key:R.id,type:"button",class:Le(["encounter-editor__step",{"encounter-editor__step--active":N===r.value}]),onClick:I=>r.value=N},[a("span",Xd,h(N+1),1),a("span",Kd,h(R.label),1)],10,Yd)),64))])]),a("div",Jd,[((C=i[r.value])==null?void 0:C.id)==="variant"?(f(),g("section",ep,[T[1]||(T[1]=a("h4",null,"Seleziona una variante",-1)),T[2]||(T[2]=a("p",null,"Scegli la variante da configurare o aggiungila al confronto laterale.",-1)),a("ul",tp,[(f(!0),g(W,null,Q(t.variants,R=>{var N,I;return f(),g("li",{key:R.id},[a("article",{class:Le(["variant-card",{"variant-card--active":R.id===t.selectedVariantId}]),onClick:q=>p(R.id)},[a("header",null,[a("h5",null,h(R.summary),1),a("span",ap,h(((I=(N=t.metricsByVariant[R.id])==null?void 0:N.threat)==null?void 0:I.tier)||"T?"),1)]),a("p",null,h(R.description),1),a("footer",np,[a("span",null,h(R.slots.length)+" slot",1),a("button",{type:"button",class:"variant-card__action",onClick:Is(q=>S.emit("toggle-comparison",R.id),["stop"])},h(t.comparisonSelection.includes(R.id)?"Rimuovi dal confronto":"Confronta"),9,ip)])],10,sp)])}),128))])])):((ee=i[r.value])==null?void 0:ee.id)==="parameters"?(f(),g("section",rp,[T[3]||(T[3]=a("h4",null,"Configura parametri",-1)),T[4]||(T[4]=a("p",null,"Modifica densitÃ , cadenza e altri parametri per vedere l'impatto immediato.",-1)),d.value?(f(),g("div",lp,[(f(!0),g(W,null,Q(u.value,(R,N)=>{var I;return f(),g("div",{key:N,class:"parameter-grid__item"},[a("label",{for:`parameter-${N}`},h(l(N)),9,op),et(a("select",{id:`parameter-${N}`,"onUpdate:modelValue":q=>o[N]=q,onChange:q=>m(N)},[(f(!0),g(W,null,Q(R,q=>(f(),g("option",{key:q.value,value:q.value},h(q.label),9,up))),128))],40,cp),[[Et,o[N]]]),a("small",null,h((I=R.find(q=>q.value===o[N]))==null?void 0:I.summary),1)])}),128))])):(f(),g("p",dp,"Nessuna variante selezionata."))])):(f(),g("section",pp,[T[5]||(T[5]=a("h4",null,"Gestisci slot e quantitÃ ",-1)),T[6]||(T[6]=a("p",null,"Regola la composizione tattica prima di passare alla visualizzazione finale.",-1)),d.value?(f(),g("div",fp,[(f(!0),g(W,null,Q(d.value.slots,R=>(f(),g("div",{key:R.id,class:"slot-table__row"},[a("div",mp,[a("h5",null,h(R.title),1),a("span",null,h(R.species.length)+" specie selezionate",1)]),a("div",gp,[a("label",{for:`slot-${R.id}`},"QuantitÃ ",8,hp),a("input",{id:`slot-${R.id}`,type:"number",min:"0",value:R.quantity,onInput:N=>_(R.id,N.target.value)},null,40,_p)])]))),128))])):(f(),g("p",vp,"Nessuna variante selezionata."))]))]),a("footer",bp,[a("button",{type:"button",disabled:r.value===0,onClick:w},"Indietro",8,yp),a("button",{type:"button",disabled:r.value>=i.length-1,onClick:A},"Avanti",8,kp)])])}}},Sp=ye(wp,[["__scopeId","data-v-49627cc6"]]),$p={key:0,class:"metrics-panel"},Ap={class:"metrics-panel__header"},Tp={class:"metrics-panel__badge"},xp={class:"metrics-panel__list"},Ep={class:"metrics-panel__rarity"},Rp={key:0,class:"metrics-panel__suggestions"},Cp={__name:"EncounterMetricsPanel",props:{metrics:{type:Object,required:!0},suggestions:{type:Array,default:()=>[]}},setup(t){return(e,s)=>t.metrics?(f(),g("section",$p,[a("header",Ap,[s[0]||(s[0]=a("h3",null,"Metriche live",-1)),a("span",Tp,h(t.metrics.threat.tier),1)]),a("dl",xp,[a("div",null,[s[1]||(s[1]=a("dt",null,"Punteggio minaccia",-1)),a("dd",null,h(t.metrics.threat.score.toFixed(2)),1)]),a("div",null,[s[2]||(s[2]=a("dt",null,"Riepilogo raritÃ ",-1)),a("dd",null,[a("ul",Ep,[(f(!0),g(W,null,Q(t.metrics.rarityMix.counts,(n,i)=>(f(),g("li",{key:i},[a("strong",null,h(i)+":",1),a("span",null,h(n),1),a("small",null,"("+h(t.metrics.rarityMix.distribution[i])+"%)",1)]))),128))])])]),a("div",null,[s[3]||(s[3]=a("dt",null,"UnitÃ  totali",-1)),a("dd",null,h(t.metrics.rarityMix.total),1)])]),t.suggestions.length?(f(),g("section",Rp,[s[4]||(s[4]=a("h4",null,"Suggerimenti",-1)),a("ul",null,[(f(!0),g(W,null,Q(t.suggestions,n=>(f(),g("li",{key:n},h(n),1))),128))])])):U("",!0)])):U("",!0)}},Ip=ye(Cp,[["__scopeId","data-v-9cbbd50e"]]),Op={class:"variant-comparison"},qp={class:"variant-comparison__selector"},Np=["value","checked","onChange"],Lp={key:0,class:"variant-comparison__grid"},zp={class:"comparison-card__badge"},Mp={class:"comparison-card__description"},Pp={class:"comparison-card__metrics"},Dp={class:"comparison-card__parameters"},Fp={class:"comparison-card__actions"},Bp=["onClick"],Up=["onClick"],jp={key:1,class:"variant-comparison__empty"},Vp={__name:"VariantComparison",props:{variants:{type:Array,default:()=>[]},metricsByVariant:{type:Object,default:()=>({})},selectedIds:{type:Array,default:()=>[]},parameterLabels:{type:Object,default:()=>({})}},emits:["toggle","export"],setup(t,{emit:e}){const s=e,n=t,i=y(()=>n.variants.filter(l=>n.selectedIds.includes(l.id)));function r(l){s("toggle",l)}function d(l,p){s("export",{variantId:l,target:p})}function o(l){var _;if(!((_=l==null?void 0:l.rarityMix)!=null&&_.dominant))return"â";const p=l.rarityMix.dominant,m=l.rarityMix.distribution[p];return m?`${p} (${m}%)`:p}function u(l){var p;return((p=n.parameterLabels)==null?void 0:p[l])||l}return(l,p)=>(f(),g("section",Op,[p[4]||(p[4]=a("header",null,[a("h3",null,"Confronto varianti"),a("p",null,"Seleziona fino a tre varianti per confrontarle fianco a fianco ed esportarle.")],-1)),a("ul",qp,[(f(!0),g(W,null,Q(t.variants,m=>{var _,w;return f(),g("li",{key:m.id},[a("label",null,[a("input",{type:"checkbox",value:m.id,checked:t.selectedIds.includes(m.id),onChange:A=>r(m.id)},null,40,Np),a("span",null,h(m.summary),1),a("small",null,h(((w=(_=t.metricsByVariant[m.id])==null?void 0:_.threat)==null?void 0:w.tier)||"T?"),1)])])}),128))]),i.value.length?(f(),g("div",Lp,[(f(!0),g(W,null,Q(i.value,m=>{var _,w,A,S;return f(),g("article",{key:m.id,class:"comparison-card"},[a("header",null,[a("h4",null,h(m.summary),1),a("span",zp,h(((w=(_=t.metricsByVariant[m.id])==null?void 0:_.threat)==null?void 0:w.tier)||"T?"),1)]),a("p",Mp,h(m.description),1),a("section",Pp,[p[2]||(p[2]=a("h5",null,"Metriche",-1)),a("ul",null,[a("li",null,[p[0]||(p[0]=a("strong",null,"Minaccia:",-1)),a("span",null,h((S=(A=t.metricsByVariant[m.id])==null?void 0:A.threat)==null?void 0:S.score.toFixed(2)),1)]),a("li",null,[p[1]||(p[1]=a("strong",null,"RaritÃ  dominante:",-1)),a("span",null,h(o(t.metricsByVariant[m.id])),1)])])]),a("section",Dp,[p[3]||(p[3]=a("h5",null,"Parametri",-1)),a("ul",null,[(f(!0),g(W,null,Q(m.parameters,(T,C)=>(f(),g("li",{key:C},[ft(h(u(C))+": ",1),a("strong",null,h(T.label),1)]))),128))])]),a("footer",Fp,[a("button",{type:"button",onClick:T=>d(m.id,"pack")},"Esporta nel pack",8,Bp),a("button",{type:"button",onClick:T=>d(m.id,"builder")},"Invia a Encounter Builder",8,Up)])])}),128))])):(f(),g("p",jp,"Seleziona almeno una variante da confrontare."))]))}},Hp=ye(Vp,[["__scopeId","data-v-046d9858"]]),Aa=Object.freeze([{id:"dune-patrol",name:"Pattuglia Termomagnetica",category:"skirmish",tags:["patrol","mobile"],biomes:["badlands","deserto_caldo"],summary:"Pattuglia {{parameters.intensity.label}} tra le dune di {{biome.name}}",description:'Il comandante {{slots.leader.primary.display_name}} coordina {{slots.outrider.names || "nessun esploratore"}} con supporto {{slots.support.names || "limitato"}}.',parameters:[{id:"intensity",type:"enum",default:"standard",label:"IntensitÃ  tattica",values:[{value:"low",label:"cauta",summary:"Riduce pattugliamenti di contatto."},{value:"standard",label:"standard",summary:"Comportamento di pattuglia regolare."},{value:"high",label:"aggressiva",summary:"Ricerca attiva di bersagli ad alto rischio."}]}],slots:[{id:"leader",title:"Predatore alfa",quantity:1,filters:{roles:["predatore_apice_badlands","predatore_apice_deserto_caldo"],tags:["predatore"]}},{id:"outrider",title:"Esploratori sinaptici",quantity:{min:1,max:2},filters:{roles:["predatore_specialista_badlands","predatore_specialista_deserto_caldo"],tags:["ricognizione","trappola"]},variants:{intensity:{low:{quantity:{min:1,max:1}},high:{quantity:{min:2,max:3}}}}},{id:"support",title:"Supporto bio-ingegneristico",quantity:{min:0,max:2},optional:!0,filters:{roles:["ingegnere_ecologico_badlands","ingegnere_ecologico_deserto_caldo"],tags:["supporto","catalizzatore"]},variants:{intensity:{high:{quantity:{min:1,max:2}}}}}],dynamics:{threat:{base:2.5,slotWeight:{default:.9,leader:1.4},parameterMultipliers:{intensity:{low:.85,standard:1,high:1.25}}},pacing:{base:"dinamica"}}},{id:"glacier-ambush",name:"Agguato dei Ponti di Ghiaccio",category:"skirmish",tags:["imboscata","furtiva"],biomes:["cryosteppe"],summary:"Emboscata {{parameters.trigger.label}} nella {{biome.name}}",description:'Le unitÃ  di presa {{slots.vanguard.names}} chiudono i flussi mentre {{slots.sapper.names || "nessun sabotatore"}} preparano il terreno.',parameters:[{id:"trigger",type:"enum",default:"standard",label:"Trigger",values:[{value:"standard",label:"a contatto"},{value:"delayed",label:"a ritardo"}]}],slots:[{id:"vanguard",title:"Linea di chiusura",quantity:{min:2,max:3},filters:{roles:["predatore_assalitore_cryosteppe","guardiano_cryosteppe"],tags:["controllo"]}},{id:"sapper",title:"Sabotatori ambientali",quantity:{min:0,max:2},optional:!0,filters:{roles:["ingegnere_ecologico_cryosteppe","supporto_cryosteppe"],tags:["area_effect"]},variants:{trigger:{delayed:{quantity:{min:1,max:2}}}}},{id:"overwatch",title:"Contenimento a distanza",quantity:{min:1,max:1},filters:{roles:["predatore_ranged_cryosteppe"],tags:["precisione"]}}],dynamics:{threat:{base:2,slotWeight:{default:.8,overwatch:1.3},parameterMultipliers:{trigger:{delayed:1.1,standard:1}}},pacing:{base:"tesa"}}},{id:"temperate-bloom",name:"Sinfonia Micotica",category:"story",tags:["evento","ambientale"],biomes:["foresta_temperata"],summary:"Evento {{parameters.expression.label}} nella {{biome.name}}",description:'Le colonie {{slots.conductor.names}} orchestrano un bloom che attira {{slots.sentinel.names}} e puÃ² mutare in {{slots.emergent.names || "esiti imprevedibili"}}.',parameters:[{id:"expression",type:"enum",default:"placida",label:"Espressione del bloom",values:[{value:"placida",label:"placida",description:"Integrazione simbiotica con il bosco."},{value:"sinergica",label:"sinergica",description:"Richiede manutenzione biotica costante."}]}],slots:[{id:"conductor",title:"Colonie direttrici",quantity:{min:1,max:2},filters:{roles:["ingegnere_ecologico_foresta_temperata"],tags:["micelio","rete"]}},{id:"sentinel",title:"Sentinelle",quantity:{min:1,max:2},filters:{roles:["guardiano_foresta_temperata","predatore_specialista_foresta_temperata"],tags:["difesa"]}},{id:"emergent",title:"Forme emergenti",quantity:{min:0,max:1},optional:!0,filters:{roles:["anomalia_ecologica_foresta_temperata"]},variants:{expression:{sinergica:{quantity:{min:1,max:2}}}}}],dynamics:{threat:{base:1.2,slotWeight:{default:.6,sentinel:.9},parameterMultipliers:{expression:{placida:.9,sinergica:1.1}}},pacing:{base:"rituale"}}}]);function tn(t){if(typeof t=="number")return t;if(typeof t=="string"){const e=t.match(/(\d+(?:\.\d+)?)/);if(e)return parseFloat(e[1])}return 1}function Gp(t,e,s){var o;const n=((o=t.dynamics)==null?void 0:o.threat)||{},i=n.slotWeight||{};let r=n.base??0;for(const u of s){const l=i[u.slot.id]??i.default??1,p=u.species.reduce((m,_)=>{var A,S;const w=tn(((A=_.statistics)==null?void 0:A.threat_tier)||((S=_.balance)==null?void 0:S.threat_tier));return m+w},0);r+=p*l}if(n.parameterMultipliers)for(const[u,l]of Object.entries(n.parameterMultipliers)){const p=e[u];p&&typeof l[p.value]=="number"&&(r*=l[p.value])}const d=Math.max(1,Math.round(r));return{score:Number(r.toFixed(2)),tier:`T${d}`}}function Wp(t,e){var i,r;if(t)return t;const s=(r=(i=e==null?void 0:e.metrics)==null?void 0:i.threat)==null?void 0:r.tier,n=s?tn(s):0;return{id:(e==null?void 0:e.id)||"custom",name:(e==null?void 0:e.summary)||"Variante",dynamics:{threat:{base:n,slotWeight:{}}}}}function Qp(t){return t?(t.slots||[]).map(e=>{var s;return{slot:{id:e.id,title:e.title},quantity:e.quantity??((s=e.species)==null?void 0:s.length)??0,species:(e.species||[]).map(n=>{var i,r,d;return{...n,statistics:{...n.statistics||{},threat_tier:((i=n.statistics)==null?void 0:i.threat_tier)||n.threat_tier||((r=n.balance)==null?void 0:r.threat_tier)||null,rarity:((d=n.statistics)==null?void 0:d.rarity)||n.rarity||null},balance:n.balance||null}})}}):[]}function Zp(t){const e={},s=Object.entries((t==null?void 0:t.parameters)||{});for(const[n,i]of s)i&&typeof i=="object"&&(e[n]=i);return e}function Yp(t){var d;const e={};let s=0;for(const o of t)for(const u of o.species){const l=((d=u.statistics)==null?void 0:d.rarity)||"Sconosciuta";e[l]=(e[l]||0)+1,s+=1}const n={};let i=null,r=0;for(const[o,u]of Object.entries(e)){const l=s===0?0:Number((u/s*100).toFixed(1));n[o]=l,u>r&&(r=u,i=o)}return{total:s,counts:e,distribution:n,dominant:i||null}}function Xp(t,e){if(!e)return{threat:{tier:"T?",score:0},rarityMix:{total:0,counts:{},distribution:{},dominant:null}};const s=Wp(t,e),n=Qp(e),i=Zp(e),r=Gp(s,i,n),d=Yp(n);return{threat:r,rarityMix:d}}function Kp(t){var d,o,u,l;if(!t)return[];const e=[],s=((d=t.threat)==null?void 0:d.score)??0,n=((o=t.threat)==null?void 0:o.tier)??"T?",i=((u=t.rarityMix)==null?void 0:u.total)??0,r=(l=t.rarityMix)==null?void 0:l.dominant;return s>=9?e.push("Riduci la presenza di unitÃ  d'Ã©lite o abbassa la cadenza per riportare la minaccia sotto controllo."):s<=4&&i>0&&e.push("Aggiungi un rinforzo pesante o aumenta l'intensitÃ  dei parametri per evitare un incontro troppo facile."),r&&r.toLowerCase().includes("comune")&&e.push("Inserisci una creatura rara per aumentare la varietÃ  tattica e la ricompensa percepita."),!e.length&&n!=="T?"&&e.push("La configurazione Ã¨ bilanciata: valuta solo piccoli ritocchi narrativi o di pacing."),e}const Jp={class:"encounter-workspace"},ef={class:"encounter-workspace__header"},tf={class:"encounter-workspace__summary"},sf={class:"encounter-workspace__grid"},af={key:1,class:"encounter-workspace__preview"},nf={__name:"EncounterView",props:{encounter:{type:Object,required:!0},summary:{type:Object,required:!0}},setup(t){const e=t,s=Ee(null),n=Ee([]),i=Ee(null),r=y(()=>e.encounter?e.encounter.templateId?Aa.find(R=>R.id===e.encounter.templateId)||null:Aa.find(R=>R.name===e.encounter.templateName)||null:null),d=Ee(null);Ce(()=>e.encounter,R=>{var I,q;if(!R){d.value=null,s.value=null,n.value=[];return}const N=((I=R.variants)==null?void 0:I.map(E=>({id:E.id,summary:E.summary,description:E.description,parameters:Pe({...E.parameters}),slots:E.slots.map(F=>Pe({id:F.id,title:F.title,quantity:F.quantity,species:F.species.map(te=>({...te}))})),warnings:[...E.warnings||[]],metrics:{...E.metrics||{}}})))||[];d.value=Pe({templateName:R.templateName,biomeName:R.biomeName,parameterLabels:R.parameterLabels||{},variants:N}),s.value=((q=N[0])==null?void 0:q.id)||null,n.value=N.slice(0,2).map(E=>E.id)},{immediate:!0});const o=y(()=>{const R={};if(!d.value)return R;for(const N of d.value.variants)R[N.id]=Xp(r.value,N);return R}),u=y(()=>d.value?{templateName:d.value.templateName,biomeName:d.value.biomeName,parameterLabels:d.value.parameterLabels,variants:d.value.variants.map(R=>{var N,I;return{...R,metrics:{...R.metrics,threat:((N=o.value[R.id])==null?void 0:N.threat)||((I=R.metrics)==null?void 0:I.threat)||{tier:"T?"}}}})}:null),l=y(()=>d.value?d.value.variants.findIndex(R=>R.id===s.value):0),p=y(()=>d.value&&d.value.variants.find(R=>R.id===s.value)||null),m=y(()=>p.value?o.value[p.value.id]:{threat:{tier:"T?",score:0},rarityMix:{total:0,counts:{},distribution:{},dominant:null}}),_=y(()=>Kp(m.value)),w=y(()=>i.value?`Esportato ${i.value.variant} â ${i.value.target}`:"");function A(R){s.value=R}function S({variantId:R,parameterId:N,value:I}){if(!d.value)return;const q=d.value.variants.find(E=>E.id===R);q&&(q.parameters[N]={...q.parameters[N],...I})}function T({variantId:R,slotId:N,quantity:I}){if(!d.value)return;const q=d.value.variants.find(F=>F.id===R);if(!q)return;const E=q.slots.find(F=>F.id===N);E&&(E.quantity=I)}function C(R){const N=new Set(n.value);N.has(R)?N.delete(R):N.add(R),n.value=Array.from(N).slice(0,3)}function ee({variantId:R,target:N}){if(!d.value)return;const I=d.value.variants.find(q=>q.id===R);I&&(i.value={variant:I.summary,target:N==="pack"?"Pack":"Encounter Builder",timestamp:new Date})}return(R,N)=>(f(),g("section",Jp,[a("header",ef,[N[0]||(N[0]=a("div",null,[a("h2",null,"Editor encounter"),a("p",null,"Configura template, parametri e slot prima della visualizzazione finale.")],-1)),a("div",tf,[pe(Ye,{label:"Seed",value:t.summary.seeds},null,8,["value"]),pe(Ye,{label:"Varianti",value:t.summary.variants},null,8,["value"]),pe(Ye,{label:"Warning",value:t.summary.warnings,tone:t.summary.warnings?"warning":"success"},null,8,["value","tone"]),w.value?(f(),Re(Ye,{key:0,label:"Ultimo export",tone:"success"},{default:Se(()=>[ft(h(w.value),1)]),_:1})):U("",!0)])]),a("div",sf,[d.value?(f(),Re(Sp,{key:0,encounter:d.value,variants:d.value.variants,"selected-variant-id":s.value,"metrics-by-variant":o.value,"comparison-selection":n.value,onSelectVariant:A,onUpdateParameter:S,onUpdateSlot:T,onToggleComparison:C},null,8,["encounter","variants","selected-variant-id","metrics-by-variant","comparison-selection"])):U("",!0),u.value?(f(),g("div",af,[pe(Gd,{encounter:u.value,"initial-variant":l.value},null,8,["encounter","initial-variant"]),pe(Ip,{metrics:m.value,suggestions:_.value},null,8,["metrics","suggestions"])])):U("",!0)]),d.value?(f(),Re(Hp,{key:0,variants:d.value.variants,"metrics-by-variant":o.value,"selected-ids":n.value,"parameter-labels":d.value.parameterLabels,onToggle:C,onExport:ee},null,8,["variants","metrics-by-variant","selected-ids","parameter-labels"])):U("",!0)]))}},rf=ye(nf,[["__scopeId","data-v-a8301ce3"]]),lf={class:"flow-view"},of={class:"flow-view__grid"},cf={class:"flow-card"},uf={class:"flow-card__body"},df={class:"flow-card"},pf={class:"publishing-workflow"},ff={class:"publishing-workflow__steps"},mf={class:"publishing-step__status"},gf={class:"publishing-step__meta"},hf={class:"publishing-step__meta"},_f={class:"publishing-updates"},vf={class:"publishing-timeline"},bf={class:"publishing-notifications"},yf={key:0},kf={__name:"PublishingView",props:{publishing:{type:Object,required:!0}},setup(t){const e=t,{publishing:s}=_t(e),n=y(()=>{var u,l,p,m,_,w,A,S,T,C,ee,R;const o=s.value.workflow||{};return[{id:"preview",title:"Anteprima",status:((u=o.preview)==null?void 0:u.status)||"pending",owner:((l=o.preview)==null?void 0:l.owner)||"â",eta:((p=o.preview)==null?void 0:p.eta)||"â",notes:((m=o.preview)==null?void 0:m.notes)||"â"},{id:"approval",title:"Approvazione",status:((_=o.approval)==null?void 0:_.status)||"pending",owner:((w=o.approval)==null?void 0:w.owner)||"â",eta:((A=o.approval)==null?void 0:A.eta)||"â",notes:((S=o.approval)==null?void 0:S.notes)||"â"},{id:"deploy",title:"Deploy sul sito",status:((T=o.deploy)==null?void 0:T.status)||"pending",owner:((C=o.deploy)==null?void 0:C.owner)||"â",eta:((ee=o.deploy)==null?void 0:ee.eta)||"â",notes:((R=o.deploy)==null?void 0:R.notes)||"â"}]}),i=y(()=>Array.isArray(s.value.history)?s.value.history:[]),r=y(()=>Array.isArray(s.value.notifications)?s.value.notifications:[]);function d(o){return o==="ready"?"Pronto":o==="scheduled"?"Programmato":o==="in-progress"?"In corso":o==="done"?"Completato":"In attesa"}return(o,u)=>(f(),g("section",lf,[u[6]||(u[6]=a("header",{class:"flow-view__header"},[a("h2",null,"Publishing & Deliverable"),a("p",null,"Stato di confezionamento dei materiali e canali di uscita.")],-1)),a("div",of,[a("article",cf,[u[0]||(u[0]=a("h3",{class:"flow-card__title"},"Artefatti",-1)),a("p",uf,h(ae(s).artifactsReady)+" asset pronti su "+h(ae(s).totalArtifacts)+" previsti. ",1)]),a("article",df,[u[1]||(u[1]=a("h3",{class:"flow-card__title"},"Canali",-1)),a("ul",null,[(f(!0),g(W,null,Q(ae(s).channels,l=>(f(),g("li",{key:l},h(l),1))),128))])]),u[2]||(u[2]=a("article",{class:"flow-card flow-card--action"},[a("h3",{class:"flow-card__title"},"Prossime azioni"),a("p",{class:"flow-card__body"},"Coordinare il QA narrativo e validare la sincronizzazione media.")],-1))]),a("section",pf,[u[3]||(u[3]=a("header",null,[a("h3",null,"Workflow di pubblicazione"),a("p",null,"Anteprima, approvazione e deploy con stato aggiornato e referenti di riferimento.")],-1)),a("div",ff,[(f(!0),g(W,null,Q(n.value,l=>(f(),g("article",{key:l.id,class:Le(["publishing-step",`publishing-step--${l.status}`])},[a("header",null,[a("h4",null,h(l.title),1),a("span",mf,h(d(l.status)),1)]),a("p",null,h(l.notes),1),a("footer",null,[a("span",gf,"Owner Â· "+h(l.owner),1),a("span",hf,"ETA Â· "+h(l.eta),1)])],2))),128))])]),a("div",_f,[a("section",vf,[u[4]||(u[4]=a("header",null,[a("h3",null,"Cronologia release"),a("p",null,"Eventi recenti e milestone approvate per il pacchetto corrente.")],-1)),a("ul",null,[(f(!0),g(W,null,Q(i.value,l=>(f(),g("li",{key:l.id},[a("div",null,[a("strong",null,h(l.label),1),a("p",null,h(l.details),1)]),a("footer",null,[a("span",null,h(l.author),1),a("time",null,h(l.timestamp),1)])]))),128))])]),a("section",bf,[u[5]||(u[5]=a("header",null,[a("h3",null,"Notifiche team"),a("p",null,"Avvisi inviati a stakeholder e canali di comunicazione.")],-1)),a("ul",null,[(f(!0),g(W,null,Q(r.value,l=>{var p;return f(),g("li",{key:l.id},[a("div",null,[a("strong",null,h(l.channel),1),a("p",null,h(l.message),1)]),a("footer",null,[(p=l.recipients)!=null&&p.length?(f(),g("span",yf,h(l.recipients.join(", ")),1)):U("",!0),a("time",null,h(l.time),1)])])}),128))])])])]))}},wf=ye(kf,[["__scopeId","data-v-215c8693"]]),sn=pt({id:Ze().optional(),message:Ze().optional().transform(t=>typeof t=="string"&&t.trim()?t.trim():"").default(""),level:aa(["info","success","warning","error"]).optional(),severity:aa(["info","warning","error"]).optional(),scope:Ze().optional(),hint:Ze().optional(),path:dt($n([Ze(),An()])).optional(),data:Ft(Xe()).optional()}).passthrough(),Sf=pt({ok:Tn().optional(),status:Ze().optional(),messages:dt(sn).default([]),corrected:dt(Xe()).default([]),discarded:dt(Xe()).default([]),meta:Ft(Xe()).optional()}).passthrough(),$f=pt({result:Sf.optional(),messages:dt(sn).optional(),corrected:dt(Xe()).optional(),discarded:dt(Xe()).optional(),meta:Ft(Xe()).optional()}).passthrough().transform(t=>{const e=t.result??{},s=e.messages??t.messages??[],n=e.corrected??t.corrected??[],i=e.discarded??t.discarded??[],r={...e.meta??{},...t.meta??{}};return{...e,messages:s,corrected:n,discarded:i,meta:r}});function Af(t){return $f.parse(t)}const Ta={species:"runtimeValidatorSpecies",biome:"runtimeValidatorBiome",foodweb:"runtimeValidatorFoodweb"};function Tf(t,e,s){if(e){if(Object.prototype.hasOwnProperty.call(e,"fallback")){const n=e.fallback;if(n===null)return null;if(typeof n=="string"&&n.trim())return n.trim()}if(e.fallbacks&&Object.prototype.hasOwnProperty.call(e.fallbacks,t)){const n=e.fallbacks[t];if(n===null)return null;if(typeof n=="string"&&n.trim())return n.trim()}}return s??null}function xf(t){return t&&Object.prototype.hasOwnProperty.call(t,"allowFallback")?!!t.allowFallback:gt()}async function js(t,e,s={}){const n=Ta[t]??Ta.species,i=vt(n,{endpoint:Object.prototype.hasOwnProperty.call(s,"endpoint")?s.endpoint:void 0,fallback:void 0}),r=bt(s.endpoint??i.endpoint),d=Tf(t,s,i.fallback),o=d?yt(d):null,u=await Rt(r,{requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({kind:t,payload:e})},fallbackUrl:o,allowFallback:xf(s),errorMessage:"Errore validazione runtime",fallbackErrorMessage:"Validator runtime locale non disponibile"}),l=(()=>{try{return Af(u.data)}catch(m){throw m instanceof ys?ks(m,"Risposta runtime non valida",{code:"runtime.validation.invalid"}):ws(m,"Risposta runtime non valida",{code:"runtime.validation.invalid"})}})(),p={...l.meta??{},endpoint_source:u.source,endpoint_url:u.source==="fallback"&&o?o:r};return u.source==="fallback"&&(p.fallback_error=u.error?u.error.message:"Richiesta remota non disponibile"),{...l,meta:p}}async function Ef(t,e={},s={}){const n={entries:Array.isArray(t)?t:[],biomeId:e.biomeId??null};return js("species",n,s)}async function Rf(t,e={},s={}){const n={biome:t??null,defaultHazard:e.defaultHazard??null};return js("biome",n,s)}async function Cf(t,e={}){return js("foodweb",{foodweb:t??null},e)}function If(t,e){if(t&&Object.prototype.hasOwnProperty.call(t,"fallback")){if(t.fallback===null)return null;if(typeof t.fallback=="string"&&t.fallback.trim())return t.fallback.trim()}return e}function Of(t){return t&&Object.prototype.hasOwnProperty.call(t,"allowFallback")?!!t.allowFallback:gt()}async function qf(t,e={}){if(!t||typeof t!="object")throw new Error("Suggerimento non valido per l'applicazione");const s=vt("qualitySuggestionsApply",{endpoint:Object.prototype.hasOwnProperty.call(e,"endpoint")?e.endpoint:void 0,fallback:Object.prototype.hasOwnProperty.call(e,"fallback")?e.fallback:void 0}),n=bt(e.endpoint||s.endpoint),i=If(e,s.fallback),r=i?yt(i):null,d=await Rt(n,{requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({suggestion:t})},fallbackUrl:r,allowFallback:Of(e),errorMessage:"Errore applicazione suggerimento",fallbackErrorMessage:"Suggerimenti locali non disponibili"}),{data:o,error:u}=d,l=d.source,p=o&&typeof o=="object"?{...o}:o;if(p&&typeof p=="object"){const m={...p.meta||{}};m.endpoint_source=l,m.endpoint_url=l==="fallback"&&r?r:n,l==="fallback"&&(m.fallback_error=u?u.message:"Richiesta remota non disponibile"),p.meta=m}return p}const Nf={class:"flow-view quality-release"},Lf={class:"quality-release__status"},zf={class:"quality-release__card"},Mf={class:"quality-release__primary"},Pf={class:"quality-release__meta"},Df={class:"quality-release__meta"},Ff={class:"quality-release__card"},Bf={class:"quality-release__primary"},Uf={class:"quality-release__meta"},jf={class:"quality-release__notifications"},Vf={class:"quality-release__console"},Hf={class:"release-console"},Gf={class:"release-console__panel release-console__panel--form"},Wf={class:"release-console__field"},Qf=["value","disabled"],Zf={class:"release-console__field"},Yf={class:"release-console__field"},Xf={class:"release-console__field"},Kf={key:0,class:"release-console__error"},Jf={class:"release-console__panel release-console__panel--schedule"},em={class:"release-console__list"},tm=["data-status"],sm=["disabled","onClick"],am=["disabled","onClick"],nm={key:0,class:"release-console__empty"},im={class:"release-console__panel release-console__panel--streams"},rm={class:"release-console__list"},lm=["data-status"],om={class:"release-console__stream-meta"},cm=["disabled","onClick"],um=["onClick"],dm=["disabled","onClick"],pm={key:0,class:"release-console__empty"},fm={class:"release-console__panel release-console__panel--notifications"},mm={class:"release-console__list"},gm={class:"release-console__message"},hm={class:"release-console__stream-meta"},_m=["onClick"],vm={key:0,class:"release-console__empty"},bm={key:0,class:"release-console__watchers"},ym={key:0,class:"quality-release__notes"},km={class:"quality-release__validators"},wm={class:"quality-release__checks"},Sm={class:"quality-check"},$m={class:"quality-check__badge"},Am={class:"quality-check__summary"},Tm={key:0,class:"quality-check__error"},xm=["disabled"],Em={class:"quality-check"},Rm={class:"quality-check__badge"},Cm={class:"quality-check__summary"},Im={key:0,class:"quality-check__error"},Om=["disabled"],qm={class:"quality-check"},Nm={class:"quality-check__badge"},Lm={class:"quality-check__summary"},zm={key:0,class:"quality-check__error"},Mm=["disabled"],Pm={key:1,class:"quality-release__suggestions"},Dm={class:"quality-suggestions"},Fm={class:"quality-suggestion__actions"},Bm=["disabled","onClick"],Um={key:0,class:"quality-suggestion__error"},jm={class:"quality-release__logs"},Vm={class:"quality-logs__toolbar"},Hm={class:"quality-logs__filters"},Gm=["onClick"],Wm={class:"quality-logs__actions"},Qm=["disabled"],Zm=["disabled"],Ym={class:"quality-logs"},Xm={class:"quality-log__meta"},Km={class:"quality-log__scope"},Jm={class:"quality-log__time"},eg={class:"quality-log__message"},tg={key:0,class:"quality-log quality-log--empty"},sg={__name:"QualityReleaseView",props:{snapshot:{type:Object,required:!0},context:{type:Object,required:!0},orchestratorLogs:{type:Array,default:()=>[]}},setup(t){const e=t,{snapshot:s,context:n,orchestratorLogs:i}=_t(e),r=Pe({running:!1,result:null,error:null,lastRun:null}),d=Pe({running:!1,result:null,error:null,lastRun:null}),o=Pe({running:!1,result:null,error:null,lastRun:null}),u=Ee([]),l=Ee([]),p=Pe({});let m=0;const _=Ca(),w=Pe({packages:[],schedule:[],streams:[],watchers:[],notifications:[]}),A=Pe({packageId:"",environment:"staging",window:"",notes:"",error:null});function S(c,v){c.splice(0,c.length,...v)}function T(c){return c==="production"?"Produzione":c==="staging"?"Staging":c||"â"}function C(c){const v=(c==null?void 0:c.id)||(c==null?void 0:c.packageId)||`pkg-${Math.random().toString(36).slice(2,8)}`,P=(c==null?void 0:c.environment)||"staging";return{id:v,name:(c==null?void 0:c.name)||(c==null?void 0:c.label)||v,environment:P,environmentLabel:T(P),status:(c==null?void 0:c.status)||"ready",approvals:Array.isArray(c==null?void 0:c.approvals)?[...c.approvals]:[],lastValidation:(c==null?void 0:c.lastValidation)||null}}function ee(c){const v=(c==null?void 0:c.packageId)||(c==null?void 0:c.id)||`pkg-${Math.random().toString(36).slice(2,8)}`,P=(c==null?void 0:c.environment)||"staging",Z=Array.isArray(c==null?void 0:c.approvals)?[...c.approvals]:[];return{id:(c==null?void 0:c.id)||`schedule-${v}-${Math.random().toString(36).slice(2,8)}`,packageId:v,packageName:(c==null?void 0:c.packageName)||(c==null?void 0:c.packageLabel)||v,environment:P,window:(c==null?void 0:c.window)||"â",approvals:Z,status:(c==null?void 0:c.status)||"scheduled",notes:(c==null?void 0:c.notes)||"",lastUpdated:(c==null?void 0:c.lastUpdated)||(c==null?void 0:c.createdAt)||null}}function R(c){return{id:(c==null?void 0:c.id)||`stream-${Math.random().toString(36).slice(2,8)}`,label:(c==null?void 0:c.label)||"Stream QA",scope:(c==null?void 0:c.scope)||"publishing",status:(c==null?void 0:c.status)||"idle",pending:typeof(c==null?void 0:c.pending)=="number"?c.pending:0,lastEvent:(c==null?void 0:c.lastEvent)||null}}function N(c){return{id:(c==null?void 0:c.id)||`notif-${Math.random().toString(36).slice(2,8)}`,channel:(c==null?void 0:c.channel)||"Canale interno",message:(c==null?void 0:c.message)||"Aggiornamento pacchetto disponibile.",lastTriggeredAt:(c==null?void 0:c.lastTriggeredAt)||null}}function I(){var B,ze;const c=((B=n.value)==null?void 0:B.releaseConsole)||{},v=Array.isArray(c.packages)?c.packages.map(C):[],P=Array.isArray(c.schedule)?c.schedule.map(ee):[],Z=Array.isArray(c.streams)?c.streams.map(R):[],de=Array.isArray(c.watchers)?c.watchers.map(tt=>({...tt})):[],fe=Array.isArray(c.notifications)?c.notifications.map(N):[];S(w.packages,v),S(w.schedule,P),S(w.streams,Z),S(w.watchers,de),S(w.notifications,fe),v.some(tt=>tt.id===A.packageId)||(A.packageId=((ze=v[0])==null?void 0:ze.id)||"")}I(),Ce(()=>{var c;return(c=n.value)==null?void 0:c.releaseConsole},()=>{I()},{deep:!0});const q=y(()=>{var P,Z;const c=(P=n.value)==null?void 0:P.releaseNotesHtml;if(typeof c=="string"&&c.trim())return c;const v=(Z=s.value)==null?void 0:Z.releaseNotesHtml;return typeof v=="string"&&v.trim()?v:""}),E=y(()=>w.packages),F=y(()=>{const c=[...w.schedule];return c.sort((v,P)=>{const Z=Date.parse(v.window||"")||0,de=Date.parse(P.window||"")||0;return Z&&de?Z-de:Z?-1:de?1:v.window.localeCompare(P.window)}),c}),te=y(()=>w.streams),he=y(()=>w.notifications),me=y(()=>w.watchers),re=y(()=>{const c=n.value.orchestrator||{};return{stage:c.stage||"â",releaseWindow:c.releaseWindow||"â",coordinator:c.coordinator||"â",focusAreas:Array.isArray(c.focusAreas)?c.focusAreas:[]}}),Ae=y(()=>{const c=s.value&&s.value.owners;return Array.isArray(c)?c:[]}),Oe=y(()=>(Array.isArray(n.value.suggestions)?n.value.suggestions:[]).map(v=>{const P=p[v.id]||{};return{...v,applied:l.value.includes(v.id),running:!!P.running,error:P.error||null}})),De=y(()=>{const c=Array.isArray(n.value.logs)?n.value.logs:[],v=Array.isArray(i.value)?i.value:[];return[...c,...v].map(Z=>({id:Z.id,scope:Z.scope||"general",level:Z.level||"info",message:Z.message||"",timestamp:Z.timestamp||new Date().toISOString()}))}),Fe=y(()=>[...De.value,...u.value]),M=y(()=>[{value:"all",label:"Tutti"},{value:"species",label:"Specie"},{value:"biome",label:"Biomi"},{value:"foodweb",label:"Foodweb"},{value:"publishing",label:"Publishing"}]),H=Ee("all"),se=y(()=>{const c=Fe.value;return H.value==="all"?c:c.filter(v=>v.scope===H.value)});function L(c,v=[]){if(!v.length)return;const P=Date.now(),Z=v.map(fe=>{const B=typeof fe=="string"?fe:fe.message||fe.text||"",ze=fe.level||fe.severity||(fe.type==="error"?"error":"info"),tt=fe.timestamp||new Date().toISOString(),Ut=fe.scope||c;return{id:`${c}-${P}-${m++}`,scope:Ut,level:ze,message:B,timestamp:tt}});u.value=[...u.value,...Z];const de=c==="publishing"?`quality.${c}`:`validator.${c}`;Z.forEach((fe,B)=>{const ze=v[B],tt=typeof ze=="string"?{message:fe.message,level:fe.level}:ze;Qe(de,{id:fe.id,scope:fe.scope,level:fe.level,message:fe.message,timestamp:fe.timestamp,data:tt,source:"quality-console"})})}function x(c,v){const P=[];if(Array.isArray(v==null?void 0:v.messages))for(const Z of v.messages)Z&&P.push(Z);return Array.isArray(v==null?void 0:v.discarded)&&v.discarded.length&&P.push({level:"warning",message:`Elementi scartati: ${v.discarded.length}`}),Array.isArray(v==null?void 0:v.corrected)&&v.corrected.length&&P.push({level:"success",message:`Correzioni applicate: ${v.corrected.length}`}),P.map(Z=>({...Z,scope:c}))}function D(c,v){const P=(v==null?void 0:v.passed)??0,Z=(v==null?void 0:v.total)??0;if(!c)return`${P} di ${Z} check giÃ  superati.`;const de=Array.isArray(c.corrected)?c.corrected.length:0,fe=Array.isArray(c.discarded)?c.discarded.length:0;return`Correzioni ${de} Â· Scartati ${fe}`}function ne(c){var P,Z;const v=(Z=(P=s.value)==null?void 0:P.checks)==null?void 0:Z[c];return v?`${v.passed||0} / ${v.total||0}`:"0 / 0"}function ge(c){return c.applied?"Completato":c.action==="regenerate"?"Rigenera mirato":"Applica fix"}function K(c){return c==="species"?"Specie":c==="biome"||c==="biomes"?"Biomi":c==="foodweb"?"Foodweb":c==="publishing"?"Publishing":"Generale"}function _e(c){if(!c)return"â";const v=new Date(c);return Number.isNaN(v.getTime())?c:new Intl.DateTimeFormat("it-IT",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}).format(v)}function Y(c){return c==="scheduled"?"Programmato":c==="awaiting-approval"?"In approvazione":c==="approved"?"Approvato":c==="deployed"?"Promosso":"â"}function $(c){return c==="monitoring"?"Monitoraggio attivo":c==="cleared"?"Pulito":c==="idle"?"In attesa":c||"â"}function z(){if(A.error=null,!A.packageId){A.error="Seleziona un pacchetto Nebula da pubblicare.";return}if(!A.window||!A.window.trim()){A.error="Indica una finestra di rilascio.";return}const c=w.packages.find(P=>P.id===A.packageId);if(!c){A.error="Pacchetto selezionato non valido.";return}const v={id:`schedule-${Date.now()}`,packageId:c.id,packageName:c.name,environment:A.environment,window:A.window.trim(),approvals:[...c.approvals],status:c.status==="ready"?"awaiting-approval":"scheduled",notes:A.notes.trim(),lastUpdated:new Date().toISOString()};w.schedule.unshift(v),A.window="",A.notes="",L("publishing",[{level:"info",message:`Programmata finestra ${T(v.environment)} per ${v.packageName} (${v.window}).`}])}function X(c){const v=w.schedule.find(P=>P.id===c.id);!v||v.status==="approved"||v.status==="deployed"||(v.status="approved",v.lastUpdated=new Date().toISOString(),L("publishing",[{level:"success",message:`Pacchetto ${v.packageName} approvato per ${T(v.environment)}.`}]))}function J(c){const v=w.schedule.find(P=>P.id===c.id);!v||v.status!=="approved"||(v.status="deployed",v.lastUpdated=new Date().toISOString(),L("publishing",[{level:"success",message:`Promosso ${v.packageName} su ${T(v.environment)}.`}]))}function be(c){const v=w.streams.find(P=>P.id===c.id);!v||v.status==="monitoring"||(v.status="monitoring",v.lastEvent=new Date().toISOString(),L("publishing",[{level:"info",message:`Monitoraggio attivo per ${v.label}.`}]))}function $e(c){const v=w.streams.find(Z=>Z.id===c.id);if(!v)return;const P=Math.max(0,(v.pending||0)-1);v.pending=P,v.lastEvent=new Date().toISOString(),L("publishing",[{level:P===0?"success":"info",message:P===0?`${v.label} senza elementi pendenti.`:`${v.label} aggiornato, elementi rimanenti ${P}.`}])}function k(c){const v=w.streams.find(P=>P.id===c.id);v&&(v.status="cleared",v.pending=0,v.lastEvent=new Date().toISOString(),L("publishing",[{level:"success",message:`${v.label} contrassegnato come risolto.`}]))}function j(c){const v=w.notifications.find(Z=>Z.id===c.id),P=new Date().toISOString();v&&(v.lastTriggeredAt=P),L("publishing",[{level:"success",message:`Notifica inviata su ${c.channel}: ${c.message}`}])}async function O(){r.running=!0,r.error=null,Qe("validator.species.requested",{scope:"species",level:"info",message:"Validazione specie avviata",source:"quality-console"});try{const c=await Ef(n.value.speciesBatch.entries,{biomeId:n.value.speciesBatch.biomeId});r.result=c,r.lastRun=new Date().toISOString(),L("species",x("species",c));const v=Array.isArray(c==null?void 0:c.messages)?c.messages.filter(Z=>(Z.level||Z.severity)==="warning").length:0,P=Array.isArray(c==null?void 0:c.messages)?c.messages.filter(Z=>(Z.level||Z.severity)==="error").length:0;Qe("validator.species.success",{scope:"species",level:P>0?"error":v>0?"warning":"success",message:P>0?`Validazione completata con ${P} errori e ${v} warning`:v>0?`Validazione completata con ${v} warning`:"Validazione specie completata",data:{warnings:v,errors:P,corrected:Array.isArray(c==null?void 0:c.corrected)?c.corrected.length:0,discarded:Array.isArray(c==null?void 0:c.discarded)?c.discarded.length:0},source:"quality-console"})}catch(c){r.error=(c==null?void 0:c.message)||"Errore validazione specie",L("species",[{level:"error",message:r.error}]),Qe("validator.species.failed",{scope:"species",level:"error",message:r.error,data:{error:(c==null?void 0:c.message)||r.error},source:"quality-console"})}finally{r.running=!1}}async function ce(){d.running=!0,d.error=null,Qe("validator.biome.requested",{scope:"biome",level:"info",message:"Sanitizzazione bioma avviata",source:"quality-console"});try{const c=await Rf(n.value.biomeCheck.biome,{defaultHazard:n.value.biomeCheck.defaultHazard});d.result=c,d.lastRun=new Date().toISOString(),L("biome",x("biome",c));const v=Array.isArray(c==null?void 0:c.messages)?c.messages.filter(Z=>(Z.level||Z.severity)==="warning").length:0,P=Array.isArray(c==null?void 0:c.messages)?c.messages.filter(Z=>(Z.level||Z.severity)==="error").length:0;Qe("validator.biome.success",{scope:"biome",level:P>0?"error":v>0?"warning":"success",message:P>0?`Sanitizzazione completata con ${P} errori`:v>0?`Sanitizzazione completata con ${v} warning`:"Sanitizzazione bioma completata",data:{warnings:v,errors:P,corrected:Array.isArray(c==null?void 0:c.corrected)?c.corrected.length:0,discarded:Array.isArray(c==null?void 0:c.discarded)?c.discarded.length:0},source:"quality-console"})}catch(c){d.error=(c==null?void 0:c.message)||"Errore sanitizzazione bioma",L("biome",[{level:"error",message:d.error}]),Qe("validator.biome.failed",{scope:"biome",level:"error",message:d.error,data:{error:(c==null?void 0:c.message)||d.error},source:"quality-console"})}finally{d.running=!1}}async function G(){o.running=!0,o.error=null,Qe("validator.foodweb.requested",{scope:"foodweb",level:"info",message:"Validazione foodweb avviata",source:"quality-console"});try{const c=await Cf(n.value.foodwebCheck.foodweb);o.result=c,o.lastRun=new Date().toISOString(),L("foodweb",x("foodweb",c));const v=Array.isArray(c==null?void 0:c.messages)?c.messages.filter(Z=>(Z.level||Z.severity)==="warning").length:0,P=Array.isArray(c==null?void 0:c.messages)?c.messages.filter(Z=>(Z.level||Z.severity)==="error").length:0;Qe("validator.foodweb.success",{scope:"foodweb",level:P>0?"error":v>0?"warning":"success",message:P>0?`Validazione foodweb con ${P} errori`:v>0?`Validazione foodweb con ${v} warning`:"Validazione foodweb completata",data:{warnings:v,errors:P,corrected:Array.isArray(c==null?void 0:c.corrected)?c.corrected.length:0,discarded:Array.isArray(c==null?void 0:c.discarded)?c.discarded.length:0},source:"quality-console"})}catch(c){o.error=(c==null?void 0:c.message)||"Errore validazione foodweb",L("foodweb",[{level:"error",message:o.error}]),Qe("validator.foodweb.failed",{scope:"foodweb",level:"error",message:o.error,data:{error:(c==null?void 0:c.message)||o.error},source:"quality-console"})}finally{o.running=!1}}async function ue(c){if(!c||c.running||c.applied)return;const v=c.id;p[v]={running:!0,error:null},Qe("quality.suggestion.requested",{scope:c.scope||"publishing",level:"info",message:`Suggerimento in esecuzione: ${c.title}`,data:{id:c.id,action:c.action},source:"quality-console"});try{const P=await qf({id:c.id,scope:c.scope,action:c.action,payload:c.payload}),Z=Array.isArray(P==null?void 0:P.logs)?P.logs:[];L(c.scope,Z),L(c.scope,[{level:c.action==="regenerate"?"info":"success",message:`Suggerimento applicato: ${c.title}`}]),l.value.includes(v)||(l.value=[...l.value,v]),p[v]={running:!1,error:null},Qe("quality.suggestion.success",{scope:c.scope||"publishing",level:"success",message:`Suggerimento completato: ${c.title}`,data:{id:c.id,action:c.action},source:"quality-console"})}catch(P){const Z=(P==null?void 0:P.message)||"Errore applicazione suggerimento";p[v]={running:!1,error:Z},L(c.scope,[{level:"error",message:Z}]),Qe("quality.suggestion.failed",{scope:c.scope||"publishing",level:"error",message:Z,data:{id:c.id,action:c.action},source:"quality-console"})}}function oe(c="json"){if(!se.value.length)return;const v=H.value,P=v==="all"?"all-scopes":v,Z=c==="csv"?"csv":"json",de=_.exportLogs({filename:`qa-flow-logs-${P}.${Z}`,filter:v==="all"?void 0:B=>B.scope===v,format:c}),fe=v==="all"?"Esportazione log QA per tutti gli scope":`Esportazione log QA per scope ${v}`;Qe("quality.logs.exported",{scope:v,level:"info",message:`${fe} (${de.format.toUpperCase()})`,data:{format:de.format,filename:de.filename,count:de.entries.length},source:"quality-console"})}return(c,v)=>{var Z,de,fe;const P=xn("SafeContent");return f(),g("section",Nf,[v[31]||(v[31]=a("header",{class:"flow-view__header"},[a("h2",null,"Quality & Release"),a("p",null," Coordinamento tra orchestrator e runtime validator per assicurare che i branch siano pronti alla pubblicazione. ")],-1)),a("div",Lf,[a("article",zf,[v[6]||(v[6]=a("h3",null,"Finestra di release",-1)),a("p",Mf,h(re.value.releaseWindow),1),a("p",Pf,"Stato orchestrator: "+h(re.value.stage),1),a("p",Df,"Coordinatore: "+h(re.value.coordinator),1),a("ul",null,[(f(!0),g(W,null,Q(re.value.focusAreas,B=>(f(),g("li",{key:B},h(B),1))),128))])]),a("article",Ff,[v[7]||(v[7]=a("h3",null,"Referenti QA",-1)),a("p",Bf,h(Ae.value.join(", ")),1),a("p",Uf,"Ultimo batch: "+h(_e(ae(s).lastRun)),1),a("ul",jf,[(f(!0),g(W,null,Q(ae(n).notifications,B=>(f(),g("li",{key:B.id},[a("strong",null,h(B.channel),1),a("span",null,h(B.message),1),a("small",null,h(B.time),1)]))),128))])])]),a("section",Vf,[v[22]||(v[22]=a("header",{class:"quality-release__section-header"},[a("h3",null,"Console editoriale"),a("p",null," Programma rilasci per il dataset Nebula, monitora gli stream di validazione e coordina le notifiche al team prima della promozione. ")],-1)),a("div",Hf,[a("section",Gf,[v[14]||(v[14]=a("h4",null,"Programmazione rilascio",-1)),a("form",{class:"release-console__form",onSubmit:Is(z,["prevent"])},[a("div",Wf,[v[8]||(v[8]=a("label",{for:"release-package"},"Pacchetto",-1)),et(a("select",{id:"release-package","onUpdate:modelValue":v[0]||(v[0]=B=>A.packageId=B)},[(f(!0),g(W,null,Q(E.value,B=>(f(),g("option",{key:B.id,value:B.id,disabled:B.status==="blocked"},h(B.name)+" Â· "+h(B.environmentLabel),9,Qf))),128))],512),[[Et,A.packageId]])]),a("div",Zf,[v[10]||(v[10]=a("label",{for:"release-environment"},"Ambiente",-1)),et(a("select",{id:"release-environment","onUpdate:modelValue":v[1]||(v[1]=B=>A.environment=B)},[...v[9]||(v[9]=[a("option",{value:"staging"},"Staging",-1),a("option",{value:"production"},"Produzione",-1)])],512),[[Et,A.environment]])]),a("div",Yf,[v[11]||(v[11]=a("label",{for:"release-window"},"Finestra",-1)),et(a("input",{id:"release-window","onUpdate:modelValue":v[2]||(v[2]=B=>A.window=B),type:"text",placeholder:"19/05 Â· 10:00"},null,512),[[Ss,A.window]])]),a("div",Xf,[v[12]||(v[12]=a("label",{for:"release-notes"},"Note operative",-1)),et(a("textarea",{id:"release-notes","onUpdate:modelValue":v[3]||(v[3]=B=>A.notes=B),rows:"2",placeholder:"Snapshot 42A con fix aurorali"},null,512),[[Ss,A.notes]])]),A.error?(f(),g("p",Kf,h(A.error),1)):U("",!0),v[13]||(v[13]=a("button",{type:"submit",class:"release-console__submit"},"Programma rilascio",-1))],32)]),a("section",Jf,[v[18]||(v[18]=a("h4",null,"Rilasci programmati",-1)),a("ul",em,[(f(!0),g(W,null,Q(F.value,B=>(f(),g("li",{key:B.id},[a("header",null,[a("strong",null,h(B.packageName),1),a("span",{class:"release-console__status","data-status":B.status},h(Y(B.status)),9,tm)]),a("dl",null,[a("div",null,[v[15]||(v[15]=a("dt",null,"Finestra",-1)),a("dd",null,h(B.window),1)]),a("div",null,[v[16]||(v[16]=a("dt",null,"Ambiente",-1)),a("dd",null,h(T(B.environment)),1)]),a("div",null,[v[17]||(v[17]=a("dt",null,"Gate",-1)),a("dd",null,h(B.approvals.join(", ")||"â"),1)])]),a("footer",null,[a("button",{type:"button",class:"release-console__action",disabled:B.status!=="scheduled"&&B.status!=="awaiting-approval",onClick:ze=>X(B)}," Conferma approvazione ",8,sm),a("button",{type:"button",class:"release-console__action",disabled:B.status!=="approved",onClick:ze=>J(B)}," Promuovi in produzione ",8,am)])]))),128)),F.value.length?U("",!0):(f(),g("li",nm,"Nessun rilascio pianificato."))])]),a("section",im,[v[19]||(v[19]=a("h4",null,"Stream di validazione",-1)),a("ul",rm,[(f(!0),g(W,null,Q(te.value,B=>(f(),g("li",{key:B.id},[a("header",null,[a("strong",null,h(B.label),1),a("span",{class:"release-console__status","data-status":B.status},h($(B.status)),9,lm)]),a("p",om," Ultimo evento Â· "+h(_e(B.lastEvent))+" Â· Pending "+h(B.pending),1),a("footer",null,[a("button",{type:"button",class:"release-console__action",disabled:B.status==="monitoring",onClick:ze=>be(B)}," Avvia monitoraggio ",8,cm),a("button",{type:"button",class:"release-console__action",onClick:ze=>$e(B)}," Aggiorna stato ",8,um),a("button",{type:"button",class:"release-console__action",disabled:B.status==="cleared",onClick:ze=>k(B)}," Segna risolto ",8,dm)])]))),128)),te.value.length?U("",!0):(f(),g("li",pm," Nessuno stream di validazione attivo. "))])]),a("section",fm,[v[21]||(v[21]=a("h4",null,"Notifiche team",-1)),a("ul",mm,[(f(!0),g(W,null,Q(he.value,B=>(f(),g("li",{key:B.id},[a("header",null,[a("strong",null,h(B.channel),1)]),a("p",gm,h(B.message),1),a("p",hm," Ultimo invio Â· "+h(_e(B.lastTriggeredAt)),1),a("footer",null,[a("button",{type:"button",class:"release-console__action",onClick:ze=>j(B)}," Invia aggiornamento ",8,_m)])]))),128)),he.value.length?U("",!0):(f(),g("li",vm," Nessuna notifica configurata. "))]),me.value.length?(f(),g("div",bm,[v[20]||(v[20]=a("h5",null,"Referenti",-1)),a("ul",null,[(f(!0),g(W,null,Q(me.value,B=>(f(),g("li",{key:B.id},h(B.name)+" Â· "+h(B.channel),1))),128))])])):U("",!0)])]),v[23]||(v[23]=a("aside",{class:"release-console__guide"},[a("h4",null,"Guida rapida alla release Nebula"),a("ol",null,[a("li",null,"Verifica che il pacchetto abbia superato la validazione automatica dal workflow publishing."),a("li",null,"Usa la sezione âProgrammazione rilascioâ per schedulare staging e raccogliere le approvazioni obbligatorie."),a("li",null,"Attiva il monitoraggio degli stream QA e invia la notifica al team quando il gate di approvazione Ã¨ verde.")]),a("p",null,[ft(" Tutte le azioni sono sincronizzate con lo stato persistente in "),a("code",null,"services/publishing/workflowState.json"),ft(" e vengono riportate nei log sottostanti. ")])],-1))]),q.value?(f(),g("section",ym,[v[24]||(v[24]=a("header",{class:"quality-release__section-header"},[a("h3",null,"Release notes Nebula"),a("p",null,"Note di accompagnamento sincronizzate dal runtime snapshot.")],-1)),pe(P,{class:"quality-release__notes-body",source:q.value,kind:"html"},null,8,["source"])])):U("",!0),a("section",km,[v[28]||(v[28]=a("header",{class:"quality-release__section-header"},[a("h3",null,"Runtime checks"),a("p",null,"Avvia validazioni mirate utilizzando il runtime validator collegato all'orchestrator.")],-1)),a("div",wm,[a("article",Sm,[a("header",null,[v[25]||(v[25]=a("h4",null,"Specie",-1)),a("span",$m,h(ne("species")),1)]),a("p",Am,h(D(r.result,(Z=ae(s).checks)==null?void 0:Z.species)),1),r.error?(f(),g("p",Tm,h(r.error),1)):U("",!0),a("footer",null,[a("button",{type:"button",class:"quality-check__action",disabled:r.running,onClick:O},h(r.running?"In corsoâ¦":"Esegui batch specie"),9,xm)])]),a("article",Em,[a("header",null,[v[26]||(v[26]=a("h4",null,"Biomi",-1)),a("span",Rm,h(ne("biomes")),1)]),a("p",Cm,h(D(d.result,(de=ae(s).checks)==null?void 0:de.biomes)),1),d.error?(f(),g("p",Im,h(d.error),1)):U("",!0),a("footer",null,[a("button",{type:"button",class:"quality-check__action",disabled:d.running,onClick:ce},h(d.running?"In corsoâ¦":"Sanitizza bioma"),9,Om)])]),a("article",qm,[a("header",null,[v[27]||(v[27]=a("h4",null,"Foodweb",-1)),a("span",Nm,h(ne("foodweb")),1)]),a("p",Lm,h(D(o.result,(fe=ae(s).checks)==null?void 0:fe.foodweb)),1),o.error?(f(),g("p",zm,h(o.error),1)):U("",!0),a("footer",null,[a("button",{type:"button",class:"quality-check__action",disabled:o.running,onClick:G},h(o.running?"In corsoâ¦":"Valida foodweb"),9,Mm)])])])]),Oe.value.length?(f(),g("section",Pm,[v[29]||(v[29]=a("header",{class:"quality-release__section-header"},[a("h3",null,"Suggerimenti di correzione"),a("p",null,"Applica fix automatici o rigenera selezioni specifiche sulla base dei risultati runtime.")],-1)),a("ul",Dm,[(f(!0),g(W,null,Q(Oe.value,B=>(f(),g("li",{key:B.id,class:Le(["quality-suggestion",`quality-suggestion--${B.scope}`])},[a("div",null,[a("h4",null,h(B.title),1),a("p",null,h(B.description),1)]),a("div",Fm,[a("button",{type:"button",class:"quality-suggestion__action",disabled:B.applied||B.running,onClick:ze=>ue(B)},h(B.running?"In corsoâ¦":ge(B)),9,Bm),B.error?(f(),g("p",Um,h(B.error),1)):U("",!0)])],2))),128))])])):U("",!0),a("section",jm,[v[30]||(v[30]=a("header",{class:"quality-release__section-header"},[a("h3",null,"Log runtime"),a("p",null,"Traccia degli eventi emessi dal runtime validator e dalle azioni correttive.")],-1)),a("div",Vm,[a("div",Hm,[(f(!0),g(W,null,Q(M.value,B=>(f(),g("button",{key:B.value,type:"button",class:Le(["quality-logs__filter",{"quality-logs__filter--active":B.value===H.value}]),onClick:ze=>H.value=B.value},h(B.label),11,Gm))),128))]),a("div",Wm,[a("button",{type:"button",class:"quality-logs__export",disabled:!se.value.length,onClick:v[4]||(v[4]=B=>oe("json"))}," Esporta JSON QA ",8,Qm),a("button",{type:"button",class:"quality-logs__export",disabled:!se.value.length,onClick:v[5]||(v[5]=B=>oe("csv"))}," Esporta CSV QA ",8,Zm)])]),a("ul",Ym,[(f(!0),g(W,null,Q(se.value,B=>(f(),g("li",{key:B.id,class:Le(["quality-log",`quality-log--${B.level}`])},[a("div",Xm,[a("span",Km,h(K(B.scope)),1),a("time",Jm,h(_e(B.timestamp)),1)]),a("p",eg,h(B.message),1)],2))),128)),se.value.length?U("",!0):(f(),g("li",tg," Nessun log per il filtro selezionato. "))])])])}}},ag=ye(sg,[["__scopeId","data-v-d9ff3109"]]),ng={class:"evogene-deck-shell"},ig={class:"evogene-deck-shell__frame"},rg={class:"evogene-deck-shell__inner"},lg={class:"evogene-deck-shell__lights",role:"group","aria-label":"Indicatori di stato EvoGene Deck"},og=["data-state","data-label","aria-label"],cg={class:"evogene-deck-shell__content"},ug={class:"evogene-deck-shell__header"},dg={key:0,class:"evogene-deck-shell__status"},pg={class:"evogene-deck-shell__main"},fg={key:1,class:"evogene-deck-shell__footer"},mg={class:"evogene-deck-shell__logs","aria-live":"polite","aria-label":"Registro missione"},gg={class:"evogene-deck-logs"},hg={class:"evogene-deck-logs__header"},_g={class:"evogene-deck-logs__count"},vg={class:"evogene-deck-logs__feed"},bg=["data-level"],yg={class:"evogene-deck-logs__timestamp"},kg={class:"evogene-deck-logs__message"},wg={key:0,class:"evogene-deck-logs__entry evogene-deck-logs__entry--empty"},Sg={__name:"EvoGeneDeckShell",props:{lights:{type:Array,default:()=>[]},logs:{type:Array,default:()=>[]},logLimit:{type:Number,default:10}},setup(t){const e=t,s={ready:"operativo",success:"operativo",loading:"in caricamento",pending:"in attesa",idle:"in attesa",warning:"attenzione",caution:"attenzione",error:"errore",critical:"errore critico",blocked:"bloccato",offline:"offline"},n=y(()=>e.lights.map((d,o)=>{const u=String(d.state??"idle").toLowerCase(),l=d.label??String(d.id??o+1),p=s[u]??u;return{id:d.id??o,label:l,state:u,ariaLabel:`${l}: ${p}`}})),i=y(()=>e.logs.slice(0,e.logLimit).map((d,o)=>({id:d.id??`${d.level||"info"}-${o}`,level:d.level||"info",scope:d.scope||"Flow",message:d.message||d.event||"Evento registrato",time:r(d.timestamp)})));function r(d){if(!d)return"â";try{const o=new Date(d);if(Number.isNaN(o.getTime()))throw new Error("Invalid timestamp");return o.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return String(d).slice(0,8)}}return(d,o)=>(f(),g("div",ng,[a("div",ig,[a("div",rg,[a("div",lg,[(f(!0),g(W,null,Q(n.value,u=>(f(),g("span",{key:u.id,class:"evogene-deck-light","data-state":u.state,"data-label":u.label,role:"status","aria-label":u.ariaLabel},null,8,og))),128))]),a("div",cg,[a("header",ug,[Ie(d.$slots,"header",{},void 0,!0)]),d.$slots.status?(f(),g("section",dg,[Ie(d.$slots,"status",{},void 0,!0)])):U("",!0),a("main",pg,[Ie(d.$slots,"default",{},void 0,!0)]),d.$slots.footer?(f(),g("footer",fg,[Ie(d.$slots,"footer",{},void 0,!0)])):U("",!0)]),a("aside",mg,[Ie(d.$slots,"sidebar",{},()=>[a("div",gg,[a("header",hg,[o[0]||(o[0]=a("span",{class:"evogene-deck-logs__title"},"Mission Log",-1)),a("span",_g,h(i.value.length),1)]),a("ol",vg,[(f(!0),g(W,null,Q(i.value,u=>(f(),g("li",{key:u.id,class:"evogene-deck-logs__entry","data-level":u.level},[a("span",yg,h(u.time),1),a("p",kg,[a("strong",null,h(u.scope),1),a("span",null,h(u.message),1)])],8,bg))),128)),i.value.length?U("",!0):(f(),g("li",wg,[...o[1]||(o[1]=[a("span",{class:"evogene-deck-logs__timestamp"},"â",-1),a("p",{class:"evogene-deck-logs__message"},[a("strong",null,"Nessun log"),a("span",null,"In attesa dei segnali dell'orchestratoreâ¦")],-1)])]))])])],!0)])])])]))}},$g=ye(Sg,[["__scopeId","data-v-3e8b82a8"]]),Ag={class:"flow-telemetry","aria-live":"polite"},Tg={class:"flow-telemetry__header"},xg=["data-status"],Eg={key:0,class:"flow-telemetry__status-hint"},Rg={key:1,class:"flow-telemetry__status-hint"},Cg={class:"flow-telemetry__badges"},Ig={class:"flow-telemetry__request"},Og={class:"flow-telemetry__toolbar"},qg=["disabled"],Ng=["disabled"],Lg=["disabled"],zg={class:"flow-telemetry__logs"},Mg=["data-level"],Pg={class:"flow-telemetry__time"},Dg={class:"flow-telemetry__message"},Fg={key:0,class:"flow-telemetry__log flow-telemetry__log--empty"},Bg=En({__name:"FlowShellTelemetryPanel",props:{logs:{},metrics:{},stream:{}},emits:["export-json","export-csv","refresh-stream"],setup(t,{emit:e}){const s=t,n=y(()=>{const m=(s.stream.status||"").toLowerCase();return m==="open"?"success":m==="connecting"?"warning":m==="errored"?"critical":m==="unsupported"||m==="closed"?"muted":"neutral"}),i=y(()=>{const m=(s.stream.status||"").toLowerCase();return m==="open"?"Stream live":m==="connecting"?"Connessioneâ¦":m==="errored"?"Stream interrotto":m==="unsupported"?"Stream non supportato":m==="closed"?"Stream chiuso":"In attesa stream"}),r=y(()=>Number(s.metrics.validatorWarnings)>0?"warning":"success"),d=y(()=>Number(s.metrics.fallbackCount)>0?"warning":"neutral"),o=y(()=>s.logs.length>0),u=y(()=>{const m=s.stream.error;return m?m instanceof Error?m.message:String(m):""}),l=y(()=>{if(!s.stream.lastEventAt||s.stream.lastEventAt<=0)return"";try{return`Ultimo evento ${new Date(s.stream.lastEventAt).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}`}catch{return""}}),p=y(()=>{const m=(s.stream.status||"").toLowerCase();return m==="errored"||m==="closed"});return(m,_)=>(f(),g("section",Ag,[a("header",Tg,[_[3]||(_[3]=a("div",null,[a("h2",{class:"flow-telemetry__title"},"QA Telemetry"),a("p",{class:"flow-telemetry__subtitle"},"Stream orchestratore & metriche snapshot")],-1)),a("span",{class:"flow-telemetry__status","data-status":n.value},[a("strong",null,h(i.value),1),l.value?(f(),g("small",Eg,h(l.value),1)):u.value?(f(),g("small",Rg,h(u.value),1)):U("",!0)],8,xg)]),a("div",Cg,[pe(Ye,{label:"Validator warnings",value:t.metrics.validatorWarnings??0,tone:r.value},null,8,["value","tone"]),pe(Ye,{label:"Fallback attivi",value:t.metrics.fallbackCount??0,tone:d.value},null,8,["value","tone"]),pe(Ye,{label:"Request ID",tone:t.metrics.requestId?"neutral":"muted"},{default:Se(()=>[a("code",Ig,h(t.metrics.requestId||"â"),1)]),_:1},8,["tone"])]),a("div",Og,[a("button",{type:"button",class:"flow-telemetry__export",disabled:!o.value,onClick:_[0]||(_[0]=w=>m.$emit("export-json"))}," Esporta JSON QA ",8,qg),a("button",{type:"button",class:"flow-telemetry__export",disabled:!o.value,onClick:_[1]||(_[1]=w=>m.$emit("export-csv"))}," Esporta CSV QA ",8,Ng),a("button",{type:"button",class:"flow-telemetry__refresh",disabled:!p.value,onClick:_[2]||(_[2]=w=>m.$emit("refresh-stream"))}," Riconnetti stream ",8,Lg)]),a("ol",zg,[(f(!0),g(W,null,Q(t.logs,w=>(f(),g("li",{key:w.id,class:"flow-telemetry__log","data-level":w.level||"info"},[a("span",Pg,h(w.time),1),a("div",Dg,[a("strong",null,h(w.scope),1),a("span",null,h(w.message),1)])],8,Mg))),128)),t.logs.length?U("",!0):(f(),g("li",Fg,[..._[4]||(_[4]=[a("span",{class:"flow-telemetry__time"},"â",-1),a("div",{class:"flow-telemetry__message"},[a("strong",null,"Nessun log QA"),a("span",null,"In attesa di aggiornamenti dal runtime validator.")],-1)])]))])]))}}),Ug=ye(Bg,[["__scopeId","data-v-295826ee"]]),jg={class:"flow-shell__header-grid"},Vg={class:"evogene-deck-status-grid"},Hg=["data-state"],Gg={class:"evogene-deck-status-card__header"},Wg={class:"evogene-deck-status-card__label"},Qg={key:0,class:"evogene-deck-status-card__spinner","aria-hidden":"true"},Zg={class:"evogene-deck-status-card__message"},Yg={key:0},Xg={key:1},Kg={key:2},Jg={key:0,class:"evogene-deck-status-card__actions"},eh=["disabled","onClick"],th={key:0,class:"flow-shell__placeholder"},sh={key:1,class:"flow-shell__placeholder flow-shell__placeholder--error"},ah=["disabled"],nh={class:"evogene-deck-step-indicator"},ih=["disabled"],rh={__name:"FlowShellView",setup(t){const e=si(),s=e.steps,n=e.breadcrumb,i=e.currentStep,r=e.summary,d=ii(),o=Ca(),u=kr({logger:d}),l=Lr({logger:d}),p=Fr({logger:d});async function m({force:k=!1}={}){var O;const j=((O=u.snapshot.value)==null?void 0:O.initialSpeciesRequest)||{};if(Array.isArray(j==null?void 0:j.trait_ids)&&j.trait_ids.length)try{await l.runSpecies(j,{force:k})}catch{}}Ea(async()=>{try{await u.fetchSnapshot(),await m()}catch{}try{await p.load()}catch{}});let _="";Ce(()=>{var k;return(k=u.snapshot.value)==null?void 0:k.initialSpeciesRequest},k=>{if(!k||!Array.isArray(k.trait_ids)||!k.trait_ids.length){_="";return}const j=JSON.stringify({trait_ids:[...k.trait_ids].sort(),fallback_trait_ids:Array.isArray(k.fallback_trait_ids)?[...k.fallback_trait_ids].sort():[],biome_id:k.biome_id||null,seed:k.seed??null});j!==_&&(_=j,m())},{deep:!0}),Ce(()=>u.metrics.value,k=>{k&&Object.entries(k).forEach(([j,O])=>{O&&typeof O=="object"&&e.updateMetrics(j,O)})},{immediate:!0,deep:!0});const w={overview:$a,species:_u,biomeSetup:Ku,biomes:$d,encounter:rf,qualityRelease:ag,publishing:wf},A=y(()=>w[i.value.id]||$a),S=y(()=>{var j,O,ce;const k=i.value.id;return k==="overview"?{overview:u.overview.value,timeline:u.timeline.value,qualityRelease:u.qualityRelease.value}:k==="species"?{species:l.blueprint.value,status:u.speciesStatus.value,meta:l.meta.value,validation:l.validation.value,requestId:l.requestId.value,loading:l.loading.value,error:l.error.value,traitCatalog:p.traitCatalog.value,traitCompliance:p.traitCompliance.value,traitDiagnosticsLoading:p.loading.value,traitDiagnosticsError:p.error.value,traitDiagnosticsMeta:p.meta.value}:k==="biomeSetup"?{config:((j=u.biomeSetup.value)==null?void 0:j.config)||{},graph:((O=u.biomeSetup.value)==null?void 0:O.graph)||{},validators:((ce=u.biomeSetup.value)==null?void 0:ce.validators)||u.biomes.value}:k==="biomes"?{biomes:u.biomes.value}:k==="encounter"?{encounter:u.encounter.value,summary:u.encounterSummary.value}:k==="qualityRelease"?{snapshot:u.qualityRelease.value,context:u.qualityContext.value,orchestratorLogs:M.value}:k==="publishing"?{publishing:u.publishing.value}:{}}),T=y(()=>i.value.index>0),C=y(()=>i.value.index<s.length-1),ee=y(()=>u.loading.value&&!u.hasSnapshot.value),R=y(()=>u.refreshing.value);function N(k){return k?typeof k=="string"?k:typeof k.message=="string"&&k.message.trim()?k.message:"errors.generic":""}function I(k){return k?typeof k=="string"?k==="errors.network.offline":(k==null?void 0:k.message)==="errors.network.offline"||typeof(k==null?void 0:k.status)=="number"&&k.status===0||typeof(k==null?void 0:k.code)=="string"&&k.code.toUpperCase()==="ERR_NETWORK":!1}function q(k){if(!k)return"â";try{return new Date(k).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit"})}catch{return"â"}}const E=y(()=>N(u.error.value)),F=async()=>{try{await u.fetchSnapshot({force:!0,refresh:!0}),await m({force:!0})}catch{}},te=async()=>{try{l.canRetry()?await l.retry({force:!0}):await m({force:!0})}catch{}},he=async()=>{try{await p.reload()}catch{}},me=y(()=>{var P;const k=u.source.value==="fallback",j=I(u.error.value),O={id:"snapshot",label:"Snapshot",loading:u.loading.value,loadingMessage:R.value?"Aggiornamentoâ¦":"Caricamentoâ¦",error:u.error.value,errorMessage:N(u.error.value),message:j?"Connessione assente":k?"Snapshot fallback attivo":`Aggiornato ${q(u.lastUpdatedAt.value)}`,fallbackLabel:k?u.fallbackLabel.value||"fallback":j?"offline":null,canRetry:!!(u.error.value||k||j),onRetry:F,state:u.error.value?"error":u.loading.value?"loading":"ready"},ce=l.fallbackActive.value,G=I(l.error.value),ue={id:"species",label:"Specie",loading:l.loading.value,loadingMessage:"Generazioneâ¦",error:l.error.value,errorMessage:N(l.error.value),message:G?"Connessione assente":((P=l.blueprint.value)==null?void 0:P.name)||(l.requestId.value?`Richiesta ${l.requestId.value}`:"In attesa richiesta"),fallbackLabel:ce?"fallback":G?"offline":null,canRetry:!!(l.error.value||ce||G||l.canRetry()),onRetry:te,state:l.error.value?"error":l.loading.value?"loading":l.blueprint.value?"ready":"idle"},oe=p.source.value==="fallback",c=I(p.error.value),v={id:"traitDiagnostics",label:"Trait diagnostics",loading:p.loading.value,loadingMessage:"Aggiornamentoâ¦",error:p.error.value,errorMessage:N(p.error.value),message:c?"Connessione assente":oe?"Trait diagnostics fallback attivo":`Aggiornati ${q(p.lastUpdatedAt.value)}`,fallbackLabel:oe?p.fallbackLabel.value||"fallback":c?"offline":null,canRetry:!!(p.error.value||oe||c),onRetry:he,state:p.error.value?"error":p.loading.value?"loading":"ready"};return[O,ue,v]}),re=k=>e.goTo(k),Ae=()=>e.next(),Oe=()=>e.previous(),De=y(()=>me.value.map(k=>({id:k.id,label:k.label,state:k.state})));function Fe(k){if(!k)return"â";try{const j=new Date(k);if(Number.isNaN(j.getTime()))throw new Error("Invalid timestamp");return j.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return String(k).slice(0,8)}}const M=y(()=>o.list()),H=y(()=>M.value.map((k,j)=>{const O=k.meta&&typeof k.meta=="object"&&k.meta!==null?k.meta.timestamp:void 0,ce=typeof O=="string"&&O.length?O:null,G=k.timestamp||ce||new Date().toISOString();return{id:k.id??`${k.event||"log"}-${j}`,level:k.level||"info",scope:k.scope||k.event||"quality",message:k.message||k.event||"Evento registrato",timestamp:G,time:Fe(G)}})),se=H,L=y(()=>({status:o.streamStatus.value,error:o.streamError.value,lastEventAt:o.streamLastEventAt.value,attempts:o.streamAttempts.value}));function x(k){var O,ce,G,ue;return[(O=k==null?void 0:k.qualityRelease)==null?void 0:O.logs,(ce=k==null?void 0:k.qualityReleaseContext)==null?void 0:ce.logs,(G=k==null?void 0:k.qualityRelease)==null?void 0:G.events,(ue=k==null?void 0:k.qualityReleaseContext)==null?void 0:ue.events].filter(oe=>Array.isArray(oe)).flat().filter(oe=>oe&&typeof oe=="object")}const D=new Set;function ne(k,j){if(k!=null&&k.id)return`snapshot:${k.id}`;const O=typeof(k==null?void 0:k.message)=="string"&&k.message.trim()?k.message.trim():"",ce=typeof(k==null?void 0:k.timestamp)=="string"&&k.timestamp.trim()?k.timestamp.trim():"";return O||ce?`snapshot:${ce}:${O}`:`snapshot:index:${j}`}Ce(()=>u.snapshot.value,k=>{x(k).forEach((O,ce)=>{const G=ne(O,ce);D.has(G)||(D.add(G),o.logEvent((O==null?void 0:O.event)||"quality.snapshot.log",{id:(O==null?void 0:O.id)||G,scope:typeof(O==null?void 0:O.scope)=="string"&&O.scope.trim()?O.scope:"quality",level:typeof(O==null?void 0:O.level)=="string"&&O.level.trim()?O.level:"info",message:typeof(O==null?void 0:O.message)=="string"&&O.message.trim()?O.message.trim():(O==null?void 0:O.title)||"Log snapshot",timestamp:typeof(O==null?void 0:O.timestamp)=="string"?O.timestamp:void 0,data:O,source:"snapshot"}))})},{deep:!0,immediate:!0});function ge(k){return x(k).filter(j=>String((j==null?void 0:j.level)||"").toLowerCase()==="warning").length}function K(k){var oe,c,v;let j=0;const O=(oe=k==null?void 0:k.initialSpeciesRequest)==null?void 0:oe.fallback_trait_ids;Array.isArray(O)&&O.length&&(j+=1);const ce=(v=(c=k==null?void 0:k.qualityReleaseContext)==null?void 0:c.speciesBatch)==null?void 0:v.entries;Array.isArray(ce)&&ce.forEach(P=>{Array.isArray(P==null?void 0:P.fallback_trait_ids)&&P.fallback_trait_ids.length&&(j+=1)});const G=[];Array.isArray(k==null?void 0:k.suggestions)&&k.suggestions.forEach(P=>{var de;const Z=(de=P==null?void 0:P.payload)==null?void 0:de.entries;Array.isArray(Z)&&Z.forEach(fe=>G.push(fe))}),G.forEach(P=>{if(P&&typeof P=="object"){const Z=P.fallback_trait_ids;Array.isArray(Z)&&Z.length&&(j+=1)}});const ue=x(k).filter(P=>String((P==null?void 0:P.message)||"").toLowerCase().includes("fallback")).length;return j+ue}function _e(k){var O,ce,G,ue;if((O=k==null?void 0:k.initialSpeciesRequest)!=null&&O.request_id)return k.initialSpeciesRequest.request_id;const j=(G=(ce=k==null?void 0:k.qualityReleaseContext)==null?void 0:ce.speciesBatch)==null?void 0:G.entries;if(Array.isArray(j)){const oe=j.find(c=>c==null?void 0:c.request_id);if(oe!=null&&oe.request_id)return oe.request_id}if(Array.isArray(k==null?void 0:k.suggestions))for(const oe of k.suggestions){const c=(ue=oe==null?void 0:oe.payload)==null?void 0:ue.entries;if(Array.isArray(c)){const v=c.find(P=>P==null?void 0:P.request_id);if(v!=null&&v.request_id)return v.request_id}}return null}const Y=y(()=>{var c;const k=u.snapshot.value,j=((c=k==null?void 0:k.qualityRelease)==null?void 0:c.metrics)||{},O=Number(j.validatorWarnings??j.validator_warnings??j.warnings??Number.NaN),ce=Number(j.fallbackCount??j.fallback_count??j.fallbacks??Number.NaN),G=Number.isFinite(O)?O:ge(k),ue=Number.isFinite(ce)?ce:K(k),oe=j.lastRequestId??j.requestId??_e(k)??l.requestId.value??null;return{validatorWarnings:G,fallbackCount:ue,requestId:oe}}),$=y(()=>[{id:"validator-warnings",label:"Validator warnings",value:Y.value.validatorWarnings},{id:"fallback-count",label:"Fallback attivi",value:Y.value.fallbackCount},{id:"request-id",label:"Request ID",value:Y.value.requestId||"â"}]);let z="";Ce($,k=>{const j=JSON.stringify(k);j!==z&&(z=j,o.logQaBadgeSummary(k,{scope:"quality"}))},{deep:!0,immediate:!0});const X=y(()=>{var j;const k=((j=u.snapshot.value)==null?void 0:j.qualityRelease)||{};if(typeof k.logStreamUrl=="string"&&k.logStreamUrl.trim())return k.logStreamUrl.trim();if(k.logStream&&typeof k.logStream.url=="string"){const O=k.logStream.url.trim();if(O)return O}return o.defaultStreamUrl});Ce(()=>X.value,k=>{if(typeof window>"u")return;if(!k){o.disconnectStream();return}o.streamUrl.value===k&&o.streamStatus.value==="open"||o.connectStream({url:k,scope:"quality"})},{immediate:!0});function J(k){k==="csv"?o.exportLogsAsCsv():o.exportLogsAsJson()}function be(){o.reconnectStream()}function $e(k){if(!k)return"neutral";const j=String(k).toLowerCase();return j.includes("fallback")?"warning":j.includes("offline")?"critical":j.includes("demo")?"success":"neutral"}return(k,j)=>(f(),Re($g,{lights:De.value,logs:ae(se)},{header:Se(()=>[a("div",jg,[pe(Pn,{steps:ae(n),current:ae(i),onNavigate:re},null,8,["steps","current"]),pe(ti,{steps:ae(s),summary:ae(r),onNavigate:re},null,8,["steps","summary"])])]),status:Se(()=>[a("div",Vg,[(f(!0),g(W,null,Q(me.value,O=>(f(),g("article",{key:O.id,class:"evogene-deck-status-card","data-state":O.state},[a("header",Gg,[a("span",Wg,h(O.label),1),O.loading?(f(),g("span",Qg)):U("",!0),O.fallbackLabel?(f(),Re(Ye,{key:1,label:"ModalitÃ ",value:O.fallbackLabel,tone:$e(O.fallbackLabel)},null,8,["value","tone"])):U("",!0)]),a("p",Zg,[O.loading?(f(),g("span",Yg,h(O.loadingMessage||"Caricamentoâ¦"),1)):O.error?(f(),g("span",Xg,h(O.errorMessage),1)):(f(),g("span",Kg,h(O.message),1))]),O.canRetry?(f(),g("footer",Jg,[a("button",{type:"button",class:"evogene-deck-status-card__retry",disabled:O.loading,onClick:O.onRetry}," Riprova ",8,eh)])):U("",!0)],8,Hg))),128))])]),default:Se(()=>[ee.value?(f(),g("div",th,"Caricamento orchestratoreâ¦")):E.value?(f(),g("div",sh,h(E.value),1)):(f(),Re(Rn(A.value),Cn(In({key:2},S.value)),null,16))]),footer:Se(()=>[a("button",{type:"button",class:"evogene-deck-button",disabled:!T.value,onClick:Oe}," â Indietro ",8,ah),a("span",nh,h(ae(i).index+1)+" / "+h(ae(s).length),1),a("button",{type:"button",class:"evogene-deck-button",disabled:!C.value,onClick:Ae}," Avanti â ",8,ih)]),sidebar:Se(()=>[pe(Ug,{logs:H.value,metrics:Y.value,stream:L.value,onExportJson:j[0]||(j[0]=O=>J("json")),onExportCsv:j[1]||(j[1]=O=>J("csv")),onRefreshStream:be},null,8,["logs","metrics","stream"])]),_:1},8,["lights","logs"]))}},ch=ye(rh,[["__scopeId","data-v-31d1ac10"]]);export{ch as default};
