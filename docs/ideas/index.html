<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Evo-Tactics · Idea Engine</title>
    <meta
      name="description"
      content="Pannello Idea Intake per raccogliere nuove proposte e sincronizzarle con il repository Evo-Tactics."
    />
    <link rel="stylesheet" href="../site.css" />
    <link rel="stylesheet" href="idea-intake.css" />
  </head>
  <body class="idea-intake">
    <header class="idea-intake__header" id="top">
      <div class="idea-intake__intro">
        <p class="idea-intake__eyebrow">Mission Control Toolkit</p>
        <h1>Idea Engine Evo-Tactics</h1>
        <p class="idea-intake__lead">
          Centralizza la raccolta delle idee di design. Compila il form per inviarle al backend Idea Intake oppure
          esporta il Markdown pronto da archiviare nella cartella <code>ideas/</code> del repository.
        </p>
        <div class="idea-intake__actions">
          <a class="button" href="../index.html">← Torna al Support Hub</a>
          <a
            class="button button--secondary"
            href="https://github.com/MasterDD-L34D/Game/blob/main/README_IDEAS.md"
            target="_blank"
            rel="noreferrer"
            >Guida setup</a
          >
        </div>
        <nav class="idea-intake__nav" aria-label="Navigazione Support Hub">
          <a href="../index.html#mission-control">Mission Control</a>
          <a href="../test-interface/index.html">Interfaccia Test</a>
          <a href="../evo-tactics-pack/generator.html">Generatore</a>
          <a href="../evo-tactics-pack/index.html">Ecosystem Pack</a>
        </nav>
      </div>
      <ul class="idea-intake__steps">
        <li>
          <span class="idea-intake__step-label">1.</span>
          Prepara i tag e scegli la categoria coerente con il repository (Biomi, Ecosistemi, Specie, Tratti, Funzioni…).
        </li>
        <li>
          <span class="idea-intake__step-label">2.</span>
          Mappa biomi, ecosistemi, specie, tratti e funzioni di gioco: il reminder resterà allineato con i dataset del repo.
        </li>
        <li>
          <span class="idea-intake__step-label">3.</span>
          Invia verso il backend configurato oppure scarica il file <code>.md</code> pronto per la cartella <code>ideas/</code>.
        </li>
      </ul>
    </header>

    <main class="idea-intake__main">
      <section class="idea-intake__panel card card--highlight">
        <div class="idea-intake__panel-header">
          <h2>Invia o esporta una nuova idea</h2>
          <p>
            I campi seguono il formato richiesto dal workflow automatico. Gli errori vengono mostrati in tempo reale, la preview
            genera il Reminder Block pronto da copiare e il backend salva l'idea nel database generando un brief Codex GPT
            incrementale.
          </p>
        </div>
        <div id="idea-widget" class="idea-intake__widget" aria-live="polite">
          <p class="idea-intake__fallback">Caricamento widget Idea Intake…</p>
        </div>
      </section>

      <aside class="idea-intake__aside">
        <article class="surface-panel surface-panel--overlay idea-intake__reminder">
          <h3>Promemoria campi</h3>
          <dl>
            <div>
              <dt>Categoria</dt>
              <dd id="idea-categories-list">Caricamento tassonomia…</dd>
            </div>
            <div>
              <dt>Tags</dt>
              <dd>Usa <code>#</code> davanti alle keyword. Esempio: <code>#mission</code> <code>#telemetria</code></dd>
            </div>
            <div>
              <dt>Biomi</dt>
              <dd>Elenca gli ID ufficiali da <code>data/core/biomes.yaml</code>. Usa virgole o nuove righe.</dd>
            </div>
            <div>
              <dt>Ecosistemi</dt>
              <dd>Meta-nodi o pack: <em>ecosistema_alpha</em>, <em>fangwood_cluster</em>, ecc.</dd>
            </div>
            <div>
              <dt>Specie &amp; Tratti</dt>
              <dd>Specie da <code>data/core/species.yaml</code> e tratti/mutazioni da <code>data/core/traits/</code>.</dd>
            </div>
            <div>
              <dt>Funzioni di gioco</dt>
              <dd>Telemetria, mating, progressione, HUD… usa slug coerenti con <code>docs/</code> e <code>packs/</code>.</dd>
            </div>
            <div>
              <dt>Priorità</dt>
              <dd>P0 (urgente) → P3 (bassa). Default: P2.</dd>
            </div>
            <div>
              <dt>Azioni Next</dt>
              <dd>Mantieni la sintassi checklist <code>- [ ]</code> per facilitare il parsing.</dd>
            </div>
          </dl>
        </article>

        <article class="surface-panel idea-intake__tips">
          <h3>Config backend opzionale</h3>
          <p>
            Senza backend il bottone <strong>Anteprima / Export .md</strong> scarica il file già formattato. Con il servizio Node
            attivo (<code>npm run start:api</code>) il tasto <strong>Invia al backend</strong> registra nel database e mostra un
            report "Codex GPT Integration Brief" pronto da condividere.
          </p>
          <ul>
            <li>Inserisci <code>?apiBase=https://server</code> e <code>?apiToken=XXX</code> nell'URL per override rapido.</li>
            <li>Prefiltra i campi con <code>?biomes=foresta_temperata</code>, <code>?ecosystems=ecosistema_alpha</code>, <code>?species=cervo_bianco</code> o <code>?traits=muta_respiratoria</code>; la priorità resta configurabile con <code>?priority=P1</code>.</li>
            <li>Salva il file Markdown esportato in <code>ideas/</code>: il workflow aggiorna <code>IDEAS_INDEX.md</code>.</li>
          </ul>
        </article>
      </aside>
    </main>

    <footer class="idea-intake__footer">
      Idea Intake widget — v2.0 · Allineato ai dataset biomi/ecosistemi/specie e compatibile con export offline o backend Node/Express.
    </footer>

    <script>
      window.IDEA_WIDGET_CONFIG = {
        apiBase: "",
        apiToken: "",
        defaultModule: "",
        defaultBiomes: "",
        defaultEcosystems: "",
        defaultSpecies: "",
        defaultTraits: "",
        defaultFunctions: "",
        defaultPriority: "P2",
        categoriesUrl: "../config/idea_engine_taxonomy.json",
      };

      if (!window.IDEA_WIDGET_CONFIG.apiBase && window.location.hostname === "localhost") {
        window.IDEA_WIDGET_CONFIG.apiBase = "http://localhost:3333";
      }

      (function applyOverrides() {
        try {
          const params = new URLSearchParams(window.location.search);
          if (params.has("apiBase")) window.IDEA_WIDGET_CONFIG.apiBase = params.get("apiBase") || "";
          if (params.has("apiToken")) window.IDEA_WIDGET_CONFIG.apiToken = params.get("apiToken") || "";
          if (params.has("module")) {
            const value = params.get("module") || "";
            window.IDEA_WIDGET_CONFIG.defaultModule = value;
            window.IDEA_WIDGET_CONFIG.defaultEcosystems = value;
          }
          if (params.has("biomes")) window.IDEA_WIDGET_CONFIG.defaultBiomes = params.get("biomes") || "";
          if (params.has("ecosystems")) window.IDEA_WIDGET_CONFIG.defaultEcosystems = params.get("ecosystems") || "";
          if (params.has("species")) window.IDEA_WIDGET_CONFIG.defaultSpecies = params.get("species") || "";
          if (params.has("traits")) window.IDEA_WIDGET_CONFIG.defaultTraits = params.get("traits") || "";
          if (params.has("functions")) window.IDEA_WIDGET_CONFIG.defaultFunctions = params.get("functions") || "";
          if (params.has("priority")) window.IDEA_WIDGET_CONFIG.defaultPriority = params.get("priority") || "P2";
          if (params.has("categoriesUrl")) window.IDEA_WIDGET_CONFIG.categoriesUrl = params.get("categoriesUrl") || "";
        } catch (error) {
          console.warn("Impossibile applicare gli override del widget", error);
        }
      })();
    </script>
    <script src="../public/embed.js"></script>
    <script>
      (function mountIdeaWidget() {
        const container = document.querySelector("#idea-widget");
        if (!container) return;
        if (window.IdeaWidget && typeof window.IdeaWidget.mount === "function") {
          window.IdeaWidget
            .mount("#idea-widget", window.IDEA_WIDGET_CONFIG)
            .then((categories) => {
              const list = document.getElementById("idea-categories-list");
              if (list && Array.isArray(categories) && categories.length) {
                list.textContent = categories.join(" · ");
              }
            })
            .catch(() => {
              const list = document.getElementById("idea-categories-list");
              if (list) {
                list.textContent = window.IdeaWidget.DEFAULT_CATEGORIES.join(" · ");
              }
            });
        } else {
          container.innerHTML =
            "<p class='err'>Impossibile caricare il widget (controlla <code>docs/public/embed.js</code>).</p>";
        }
      })();
    </script>
  </body>
</html>
