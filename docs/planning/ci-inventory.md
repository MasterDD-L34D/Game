# Inventario workflow CI e script locali

Questa pagina riepiloga i workflow GitHub Actions e gli script locali citati dalla CI, con trigger, input/output principali e note su eventuale modalità _report-only_.

## Workflow GitHub Actions

- **CI (`.github/workflows/ci.yml`)** – `push`/`pull_request`. Usa filtri paths per attivare suite TypeScript, CLI Python, dataset e deploy. Esegue lint/test Node (`npm run lint:stack`, unit test dashboard/trait editor), CLI smoke (`scripts/cli_smoke.sh`, `tools/py/game_cli.py`), validazioni dati/trait (`scripts/trait_audit.py`, `tools/py/report_trait_coverage.py`), deploy checks (`scripts/run_deploy_checks.sh`) e genera report coverage/style guide. Output principali: artefatti Chrome bundle, metriche dashboard, baseline/coverage trait in `data/derived/analysis` e `reports/trait_style`. Non è report-only.
- **E2E Tests (Playwright) (`.github/workflows/e2e.yml`)** – schedulato e `workflow_dispatch`. Installa `tests/playwright`, risolve `BASE_URL` e lancia `npx playwright test`; carica report `tests/playwright/playwright-report`. Non report-only (fallisce su test KO).
- **Daily PR Summary (`.github/workflows/daily-pr-summary.yml`)** – schedulato + manuale. Script `tools/py/daily_pr_report.py` aggiorna changelog/roadmap e committa su main. Output: file docs aggiornati. Non report-only.
- **Daily tracker refresh (`.github/workflows/daily-tracker-refresh.yml`)** – schedulato + manuale. Esegue `scripts/daily_tracker_refresh.py` con export `reports/daily_tracker_summary.json` e auto-commit. Non report-only.
- **Data audit and validation (`.github/workflows/data-quality.yml`)** – PR su dati/pack. Installa deps, esegue `tools/py/validate_datasets.py`, `scripts/trait_audit.py --check`, `scripts/build_trait_index.js`, `tools/py/report_trait_coverage.py --strict`, `tools/py/trait_completion_dashboard.py`. Carica artefatti `reports/**` e `data/derived/analysis/*.json/csv`. Non report-only.
- **Deploy site (`.github/workflows/deploy-test-interface.yml`)** – su `push` main/PR/manuale. Build tools/ts, HUD tests, CLI smoke, trait audit/baseline/coverage e `scripts/run_deploy_checks.sh`; prepara `dist` e pubblica GitHub Pages. Artefatti: Chromium bundle, test outputs, dist. Non report-only.
- **Idea Intake Index (`.github/workflows/idea-intake-index.yml`)** – su modifiche `docs/ideas/submissions/**`. Script shell genera `IDEAS_INDEX.md`, promemoria changelog e auto-commit. Non report-only.
- **Incoming CLI smoke (`.github/workflows/incoming-smoke.yml`)** – manuale con input percorsi dati/pack. Risolve path incoming e lancia `scripts/cli_smoke.sh --profile staging_incoming`, carica log `logs/incoming_smoke`. Non report-only.
- **Validate JSON Schemas (`.github/workflows/schema-validate.yml`)** – push/PR su `schemas/**` e `config/schemas/**`. Valida i JSON Schema (Draft2020-12) e controlla la sintassi YAML (`schemas/*.yaml`) tramite `tools/py/validate_json_schemas.py`. Nessun artefatto; non report-only.
- **Validate registry naming (`.github/workflows/validate-naming.yml`)** – push/PR su registri/glossario. Esegue `tools/py/validate_registry_naming.py`. Non report-only.
- **Validate Trait Catalog (`.github/workflows/validate_traits.yml`)** – push/PR su dati trait. Esegue `tools/py/trait_template_validator.py`, `scripts/build_trait_index.js`, `tools/py/report_trait_coverage.py --strict`, `scripts/trait_style_check.js`; carica `reports/**` e coverage. Non report-only.
- **QA KPI & Visual Monitor (`.github/workflows/qa-kpi-monitor.yml`)** – mensile + manuale. Corre `tests/validate_dashboard.py` (metriche), `tools/py/report_kpi_alerts.py` e `tools/py/visual_regression.py compare`; carica `logs/visual_runs` e `metrics.json`. Non report-only.
- **QA export manual (`.github/workflows/qa-export.yml`)** – manuale con input PR. Genera QA report via `scripts/export-qa-report.js`, carica artefatti QA e opzionale commento PR. Non report-only.
- **QA reports (`.github/workflows/qa-reports.yml`)** – PR/manuale. Stesse pipeline di export QA e controllo che `reports/qa_badges.json` e `reports/trait_baseline.json` siano aggiornati. Non report-only.
- **Telemetry export (`.github/workflows/telemetry-export.yml`)** – PR su file export. Esegue `tools/py/validate_export.py`, test UI `tools/ts/tests/export-modal.test.tsx`, e invia notifica Slack. Output: validazione schema, nessun artefatto; non report-only.
- **Build Search Index (`.github/workflows/search-index.yml`)** – push su contenuti e manuale. Usa `ops/site-audit/generate_search_index.py` e auto-commit `public/search_index.json`/`ops/site-audit/_out/search_index.json`. Non report-only.
- **HUD Canary (`.github/workflows/hud.yml`)** – push/manuale su HUD. Se flag in `config/cli/hud.yaml` abilitato, installa `tools/ts` e build HUD overlay; altrimenti salta. Non report-only (fallisce su build).
- **Lighthouse CI (`.github/workflows/lighthouse.yml`)** – schedulato/manuale. Esegue `npm run lint:lighthouse` contro `SITE_BASE_URL` e carica `.lighthouseci` come artefatto. Non report-only.
- **Update Evo tracker (check) (`.github/workflows/update-evo-tracker.yml`)** – richiamabile da altri workflow; esegue `make update-tracker TRACKER_CHECK=1` con eventuale input `batch`. Non report-only.
- **Sync Evo traits glossary (`.github/workflows/traits-sync.yml`)** – schedulato/manuale. Esegue `tools/traits/sync_missing_index.py` e `tools/traits/evaluate_internal.py`, carica export interno/esterno e (se segreti) pubblica su S3. Non report-only.
- **Run Evo Batch (`.github/workflows/evo-batch.yml`)** – manuale con input `batch`, `execute`, `ignore_errors`. Usa `tools/automation/evo_batch_runner.py` per pianificare/eseguire batch; dry-run di default. Non report-only (può eseguire comandi reali se `execute=true`).
- **Evo documentation archive sync (`.github/workflows/evo-doc-backfill.yml`)** – schedulato/manuale. Script `scripts/evo_tactics_metadata_diff.py` produce diff/anchors/backfill, `ops/notifier.py` segnala gap e crea issue/alert. Artefatti: diff JSON/MD. Non report-only.
- **Evo rollout status sync (`.github/workflows/evo-rollout-status.yml`)** – settimanale/manuale. `tools/roadmap/update_status.py` genera snapshot roadmap e carica `reports/evo/rollout/status_export.json` + md; mostra diff. Non report-only.
- **Log Harvester (`.github/workflows/log-harvester.yml`)** – schedulato (giornaliero) + `workflow_dispatch`. Usa un token con permessi `actions:read` e `contents:write` per scaricare gli ultimi log/artefatti dei workflow e salvarli in `logs/ci_runs/`, `logs/visual_runs/` e `logs/incoming_smoke/`; mantiene l’inventario aggiornato. Pubblica inoltre un artifact web-ready `logs-harvest-<YYYYMMDD>.zip` (retention 14 giorni) contenente l’intera cartella `logs/` dell’estrazione corrente. Non report-only.

### Stato run, owner e blocchi

_Nota_: quando il **Log Harvester** è attivo, l’aggiornamento degli esiti e dei log avviene automaticamente dai pacchetti scaricati. Per i workflow senza `workflow_dispatch` (es. `ci.yml`) l’harvester attende il prossimo push/PR; per i workflow manuali con input richiede un job esterno che lanci il dispatch con i parametri prima di scaricare i log.

> **Stato autenticazione locale** – La CLI GitHub è installata, ma l’ambiente non esporta il PAT `CI_LOG_PAT` come `GH_TOKEN` e l’agente non può applicare token forniti in chat. Un operatore deve eseguire `export GH_TOKEN=$CI_LOG_PAT` (o login equivalente) prima di qualunque dispatch/download; finché la sessione non è attiva, i semafori restano bloccati e le richieste di artifact ricevono 403.

| Workflow                                      | Owner                                                                                                                                                                    | Ultimo run (data/esito/log)                                                                                                                             | Modalità  | Blocchi noti / note (log)                                                                                                                                                                                                                                                                                                         |
| --------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `.github/workflows/ci.yml`                    | dev-tooling                                                                                                                                                              | **PASS – 2025-12-06 (run4960)** – [log](../../logs/ci_runs/ci_run4960.html)                                                                             | enforcing | Log HTML salvato (download zip API bloccato 403 senza permessi admin). Non espone `workflow_dispatch`: usa push/PR; lo script di raccolta log deve prendere l’ultimo run disponibile.                                                                                                                                             |
| `.github/workflows/e2e.yml`                   | QA                                                                                                                                                                       | **PASS – 2025-12-06 (run38)** – [log](../../logs/ci_runs/e2e_run38.html)                                                                                | enforcing | Log HTML salvato (download zip API bloccato 403 senza permessi admin). Lo script può scaricare l’ultimo run schedulato; resta opzionale il dispatch QA se serve copertura immediata.                                                                                                                                              |
| `.github/workflows/daily-pr-summary.yml`      | archivist                                                                                                                                                                | Prossimo auto-commit da scaricare in `logs/ci_runs/`                                                                                                    | enforcing | Aspetta cron/trigger manuale; raccogli il log via script.                                                                                                                                                                                                                                                                         |
| `.github/workflows/daily-tracker-refresh.yml` | analytics                                                                                                                                                                | Prossimo export `reports/daily_tracker_summary.json` da salvare                                                                                         | enforcing | Usare raccolta automatica dopo il cron; verificare scheduler e output JSON.                                                                                                                                                                                                                                                       |
| `.github/workflows/data-quality.yml`          | data                                                                                                                                                                     | **FAIL – 2025-12-08 (run20012320492, rerun PR `codex/analyze-logs-and-apply-fixes`)** – [log](../../logs/ci_runs/data-quality_run20012320492_rerun.log) | enforcing | Rerun lanciato con GH CLI autenticata (`GH_TOKEN=CI_LOG_PAT`). Step `report_trait_coverage.py --strict` fallisce perché il catalogo specie è vuoto (rules_missing_species_total=284); artefatto `trait-data-reports` ancora 403 via SAS. Servono fix dati/catalogo e rerun da `main` con artefatto scaricato.                     |
| `.github/workflows/deploy-test-interface.yml` | devops                                                                                                                                                                   | **FAIL – 2025-12-08 (run20032811732)** – log/artefatti mancanti; serve rerun con dist/CLI salvati in `logs/ci_runs/` prima del go-live                  | enforcing | Tentativo 2025-12-09: `gh` non presente nel PATH (`bash: command not found: gh` in `logs/ci_runs/deploy_test_interface_dispatch.log`); il dispatch manuale `-b main` non è partito. Azioni: reinstallare GH CLI, esportare `GH_TOKEN=$CI_LOG_PAT`, verificare `gh auth status` e rilanciare salvando dist/CLI in `logs/ci_runs/`. |
| `.github/workflows/idea-intake-index.yml`     | archivist                                                                                                                                                                | Prossimo auto-commit da salvare                                                                                                                         | enforcing | In attesa del cron/manuale; raccogliere log in automatico.                                                                                                                                                                                                                                                                        |
| `.github/workflows/schema-validate.yml`       | data                                                                                                                                                                     | **FAIL – 2025-12-08 (run20037257496, dispatch `main`)** – [log](../../logs/ci_runs/schema-validate_run20037257496.log)                                  | enforcing | Dispatch manuale riuscito con `GH_TOKEN=CI_LOG_PAT`, ma lo step inline Python termina con `IndentationError` durante `validate_json_schemas.py`. Correggere l’invocazione/indentazione e rieseguire da `main` per ottenere log HTML/zip aggiornati.                                                                               |
| `.github/workflows/validate-naming.yml`       | data                                                                                                                                                                     | **PASS – 2025-12-05 (run110)** – [log](../../logs/ci_runs/validate-naming_run110.html)                                                                  | enforcing | Ultimo log OK (HTML salvato; zip non scaricabile senza permessi admin). Nessun warning aperto.                                                                                                                                                                                                                                    |
| `.github/workflows/validate_traits.yml`       | data                                                                                                                                                                     | **FAIL – 2025-12-08 (run20012325923, rerun `main`)** – [log](../../logs/ci_runs/validate_traits_run20012325923_rerun.log)                               | enforcing | Rerun eseguito con GH CLI autenticata: `report_trait_coverage.py --strict` fallisce perché il catalogo specie è vuoto (rules_missing_species_total=284). Artefatto `trait-data-reports` resta in 403; servono fix dati/catalogo e nuovo run da `main`.                                                                            |
| `.github/workflows/qa-kpi-monitor.yml`        | QA                                                                                                                                                                       | Retry **NON ESEGUITO – 2025-12-08** (GH_TOKEN assente; GH CLI reinstallata) – [log](../../logs/visual_runs/qa-kpi-monitor_2025-12-07T2357Z.log)         |
| enforcing                                     | Nessun upload `logs/visual_runs`: visual regression da rilanciare da `main` dopo aver esportato `GH_TOKEN=$CI_LOG_PAT`.                                                  |
|                                               |
| `.github/workflows/qa-export.yml`             | QA                                                                                                                                                                       | Retry **NON ESEGUITO – 2025-12-08** (GH_TOKEN assente; GH CLI reinstallata) – [log](../../logs/ci_runs/qa-export_2025-12-07T2357Z.log)                  |
| enforcing                                     | Dispatch manuale non eseguito per assenza `GH_TOKEN`: riprovare da `main` dopo aver esportato `GH_TOKEN=$CI_LOG_PAT` e archiviare artefatti/badge QA in `logs/ci_runs/`. |
|                                               |
| `.github/workflows/qa-reports.yml`            | QA                                                                                                                                                                       | Retry **NON ESEGUITO – 2025-12-08** (GH_TOKEN assente; GH CLI reinstallata) – [log](../../logs/ci_runs/qa-reports_2025-12-07T2357Z.log)                 |
| enforcing                                     | Dispatch QA report bloccato dall’assenza di `GH_TOKEN`: riprovare dopo autenticazione e salvare log in `logs/ci_runs/`.                                                  |
|                                               |
|                                               |
| `.github/workflows/evo-rollout-status.yml`    | roadmap                                                                                                                                                                  | Prossimo snapshot `reports/evo/rollout/status_export.json` da salvare                                                                                   | enforcing | Scaricare l’artefatto con la raccolta automatica.                                                                                                                                                                                                                                                                                 |

### Semaforo go-live per workflow critici

_Nota_: con il **Log Harvester** abilitato, gli stati del semaforo si aggiornano dai log scaricati automaticamente; i workflow privi di `workflow_dispatch` restano in attesa di push/PR, mentre quelli manuali con input necessitano di un job esterno che effettui il dispatch prima del download.

- **CI (`ci.yml`)** – Giallo: ultimo run `20015313386` (08/12/2025) **cancelled** con HTML/log zip archiviati (`logs/ci_runs/ci_run20015313386*`); artifact `site-audit` non scaricabile (`403 Forbidden`). Serve rerun verde.
- **Data Quality (`data-quality.yml`)** – Rosso: run `20012320492` (08/12/2025) **failure** rerun con GH_TOKEN; log testuale salvato (`logs/ci_runs/data-quality_run20012320492_rerun.log`), errore coverage per catalogo specie vuoto (rules_missing_species_total=284) e artefatto `trait-data-reports` ancora 403. Serve rerun verde da `main` dopo il fix.
- **E2E (`e2e.yml`)** – Verde: run `20017801531` (08/12/2025) **success** con HTML/log zip archiviati; nessun artefatto disponibile.
- **Schema/Validate Traits** – Rosso: run `20037257496` (schema-validate dispatch `main`) **failure** per `IndentationError` nello step inline Python; run `20012325923` (validate_traits rerun `main`) **failure** per catalogo specie vuoto (rules_missing_species_total=284). Log in `logs/ci_runs/schema-validate_run20037257496.log` e `logs/ci_runs/validate_traits_run20012325923_rerun.log`; artefatti trait 403. Rerun dopo i fix.
- **QA suite (`qa-kpi-monitor.yml`, `qa-reports.yml`, `qa-export.yml`)** – Rosso: run `19989066630` (monitor) in **failure** con HTML/log zip per CI+visual, artifact visual `403`; run `19975106001` (export) e `20012320512` (reports) **cancelled** con log salvati. Rerun sequenziale da lanciare con `GH_TOKEN=CI_LOG_PAT` già disponibile, archiviando i nuovi log/artefatti.
- **HUD (`hud.yml`)** – Giallo: run `19975105999` (08/12/2025) **success** con HTML/log zip in `logs/ci_runs` e `logs/visual_runs`; nessun artifact scaricabile. Verificare se flag HUD resta attivo e pianificare rerun se servono overlay aggiornati.
- **Deploy site (`deploy-test-interface.yml`)** – Rosso: run `20032811732` (08/12/2025) **failure** senza artifact disponibili. Rerun richiesto prima del go-live con dist/CLI scaricati. Tentativo 2025-12-09 fallito: `gh` non è installato nel runner (vedi `logs/ci_runs/deploy_test_interface_dispatch.log`); reinstallare GH CLI e autenticare con `GH_TOKEN=$CI_LOG_PAT` prima del nuovo dispatch.

### Azioni aperte (aggiornato)

- **Raccolta automatica log** – Configurare/abilitare lo script `gh run list --workflow <file> --limit 1 --json databaseId,status` → `gh run download <id> --dir <dest>` usando un PAT con scope `workflow/read:org` **e** permessi repo/admin (esposto come `CI_LOG_PAT`/`LOG_HARVEST_PAT` → `GH_TOKEN`) per sbloccare il download zip dei log oltre alle pagine HTML. Applicare a tutti i workflow con trigger push/PR/cron; i workflow manual-only vengono comunque scaricati (dispatch opzionale con `DISPATCH_MANUAL=1`). Configurare lo stesso PAT come secret del job `log-harvester.yml`, esportarlo come `GH_TOKEN` e autenticare `gh` sul runner (`echo "$GH_TOKEN" | gh auth login --with-token` + `gh auth status`), seguendo lo snippet e la checklist runner in `docs/planning/ci-log-automation.md`. Per questo PR i pacchetti `_logs.zip` sono stati rimossi (binari non ammessi): usa `scripts/ci_log_harvest.sh --config ops/ci-log-config.txt --force-zip` con `GH_TOKEN=$CI_LOG_PAT` per rigenerarli localmente (vedi `logs/ci_runs/LOG_ARCHIVE_NOTE.md`).
- **QA suite manuale** – GH CLI installata e autenticata (`GH_TOKEN=CI_LOG_PAT`); i retry non sono ancora partiti. Azione: lanciare la sequenza `qa-kpi-monitor` (visual on) → `qa-export` → `qa-reports` da `main`, archiviare log in `logs/visual_runs/` e `logs/ci_runs/` e aggiornare baseline KPI/asset visual se prodotti.
- **Autenticazione GH locale (2025-12-08)** – GitHub CLI installata via apt (`gh 2.45.0`) e autenticata esportando `GH_TOKEN=$CI_LOG_PAT` (scope `workflow`/repo). Rerun manuali eseguiti: `data-quality.yml` (run20012320492 rerun, KO per catalogo specie vuoto), `schema-validate.yml` (run20037257496 dispatch `main`, KO per `IndentationError` inline), `validate_traits.yml` (run20012325923 rerun `main`, KO per catalogo specie vuoto). Artefatti trait ancora 403 via SAS. Usare direttamente `GH_TOKEN=$CI_LOG_PAT gh <comando>` evitando `gh auth login` se la variabile è già esportata.
- **Sweep manuale 2025-12-08 (PAT `CI_LOG_PAT` valido, rerun post-fix)** – Eseguito `scripts/ci_log_harvest.sh --config ops/ci-log-config.txt` con `GH_TOKEN` attivo e `GH_REPO=MasterDD-L34D/Game`: tutte le pagine HTML e i log zip sono stati riscaricati senza errori di autenticazione GH; gli artifact restano bloccati da 403 SAS (site-audit, trait-data-reports, visual-report, evo-anchors-map, traits-internal-evaluation, incoming-smoke-logs) e `update-evo-tracker.yml` non ha run recenti. Il dispatch locale `gh workflow run log-harvester.yml --ref work` falliva perché il ref non era presente su origin; lo script ora effettua fallback automatico al branch di default remoto (es. `main`) e il workflow con piping del token (`printf '%s' "$GH_TOKEN" | gh auth login --with-token`) va rieseguito da un ref remoto valido per chiudere il fail storico `gh run watch 20030901346`.
- **Sweep GH CLI 2025-12-08 (PAT admin repo/workflow)** – GitHub CLI installata via apt e autenticata con `GH_REPO=MasterDD-L34D/Game`: raccolti gli ID più recenti (`ci.yml` 20032812398 success, `e2e.yml` 20017801531 success, `data-quality.yml` 20012320492 failure per catalogo specie vuoto, `schema-validate.yml` 20037257496 failure per `IndentationError`, `validate_traits.yml` 20012325923 failure per catalogo specie vuoto, `qa-kpi-monitor.yml` 19989066630 failure, `qa-export.yml` 19975106001 cancelled, `qa-reports.yml` 20012320512 cancelled, `deploy-test-interface.yml` 20032811732 failure, `hud.yml` 19975105999 success, `incoming-smoke.yml` 20012779896 failure). Download artifact ancora in 403 (`trait-data-reports`, `visual-report`, `incoming-smoke-logs`); dispatch `log-harvester.yml` `run 20033909404` fallito allo step “Auth gh” se si usa `gh auth login --with-token` con `GH_TOKEN` già presente (warning “The value of the GH_TOKEN environment variable is being used for authentication”).
- **Tentativo 2025-12-08 (env privo di `CI_LOG_PAT`)** – Ripristinata l’installazione di GitHub CLI via apt (`gh 2.45.0`), ma l’ambiente locale non espone `CI_LOG_PAT`/`GH_TOKEN`: `gh auth status` segnala nessuna sessione attiva, `scripts/ci_log_harvest.sh --config ops/ci-log-config.txt` rifiuta l’esecuzione per PAT mancante e l’opzione `--force-zip` non è riconosciuta. I dispatch manuali `gh workflow run log-harvester.yml -r main` e `gh workflow run deploy-test-interface.yml -r main` non partono senza token. Sblocco richiesto: esportare `GH_TOKEN=$CI_LOG_PAT` (scope workflow/read:org/admin) e usare direttamente i comandi `GH_TOKEN=$CI_LOG_PAT gh …` (senza `gh auth login`) oppure eseguire `gh auth status` dopo l’export per verificare la sessione. L’agente non può consumare PAT forniti nella chat; un operatore deve configurare l’ambiente prima di rieseguire log-harvester/QA/deploy.
- **Tentativo 2025-12-09 (GH CLI installata, HUD flag on)** – `gh 2.45.0` installata via apt (`logs/ci_runs/hud_gh_version.log`), ma l’ambiente resta senza `GH_TOKEN`: `gh auth status` segnala nessuna sessione (`logs/ci_runs/hud_auth_status.log`) e il dispatch manuale `gh workflow run hud.yml -r main` rifiuta l’avvio (`logs/ci_runs/hud_dispatch.log`). Azioni: esportare `GH_TOKEN=$CI_LOG_PAT` o login con PAT equivalente, quindi rerun `hud.yml` da `main` e archiviare overlay/log in `logs/visual_runs` e `logs/ci_runs`.
- **Tentativo 2025-12-09 (incoming-smoke con input di default)** – GH CLI installata (`logs/incoming_smoke/incoming_smoke_gh_version.log`) ma non autenticata (`logs/incoming_smoke/incoming_smoke_auth_status.log`); i dispatch manuali `gh workflow run incoming-smoke.yml -r main -f data-root=incoming/decompressed/latest/data -f pack-root=incoming/decompressed/latest/packs/evo_tactics_pack` sono stati rifiutati senza `GH_TOKEN`, vedi `logs/incoming_smoke/incoming_smoke_dispatch*.log`. Azioni: esportare `GH_TOKEN=$CI_LOG_PAT`, rilanciare con input di default o specifici e salvare i log in `logs/incoming_smoke/`.

- **Copertura workflow/destinazioni** – Mantieni allineata la lista nel job `Resolve latest workflow runs` di `log-harvester.yml` con la tabella dei workflow coperti; il job “Prepare target directories” crea e valida `logs/ci_runs`, `logs/visual_runs`, `logs/incoming_smoke` e fallisce se non sono scrivibili.
- **Stato sweep locale** – `gh` installata via apt, `GH_REPO=MasterDD-L34D/Game` e PAT `CI_LOG_PAT` in uso; raccolti HTML + log zip per i workflow in `ops/ci-log-config.txt` ma gli artifact restano inaccessibili (403 su SAS Azure). In attesa di permessi blob o di rigenerazione dei SAS per completare i pacchetti artefatto.
- **ci.yml** – Owner: dev-tooling. Ultimo run4960 (06/12) in PASS con log HTML salvato; mantenere monitoraggio e abilitare PAT con permessi adeguati per scaricare i pacchetti log zip in automatico.
- **e2e.yml** – Owner: QA. Ultimo run38 (06/12) in PASS con log HTML salvato; mantenere la raccolta automatica e abilitare PAT con permessi repo per il download zip completo.
- **data-quality.yml** – Owner: data. Rerun manuale 08/12 (run20012320492) in **failure** su PR `codex/analyze-logs-and-apply-fixes`; log testuale in `logs/ci_runs/data-quality_run20012320492_rerun.log`, errore coverage per catalogo specie vuoto e artefatto `trait-data-reports` 403. Servono fix e nuovo run da `main`.
- **schema-validate.yml** / **validate_traits.yml** – Owner: data. Dispatch manuale `schema-validate.yml` su `main` (run20037257496) in **failure** per `IndentationError` inline; rerun `validate_traits.yml` su `main` (run20012325923) in **failure** per catalogo specie vuoto. Log in `logs/ci_runs/schema-validate_run20037257496.log` e `logs/ci_runs/validate_traits_run20012325923_rerun.log`; servono fix e nuovo dispatch su `main`.
- **QA suite** – Owner: QA. GH CLI installata e autenticata con `GH_TOKEN=CI_LOG_PAT`; i retry sono ancora da lanciare. Log precedenti in `logs/visual_runs/qa-kpi-monitor_2025-12-07T2357Z.log`, `logs/ci_runs/qa-export_2025-12-07T2357Z.log`, `logs/ci_runs/qa-reports_2025-12-07T2357Z.log`. Sequenza: `qa-kpi-monitor.yml` (visual on) → `qa-export.yml` → `qa-reports.yml` con log nelle cartelle dedicate.
- **deploy-test-interface.yml** – Owner: devops. Ultimo run 20032811732 (08/12/2025) in failure senza log/artefatti: obbligatorio un rerun prima del go-live con dist/CLI archiviati in `logs/ci_runs/`.
- **hud.yml** – Owner: HUD. Flag HUD attivo per smart alerts (`config/cli/hud.yaml` → `flags.hud.smart_alerts.default: true`). Tentativo 2025-12-09 bloccato senza token (`logs/ci_runs/hud_dispatch.log`, `logs/ci_runs/hud_auth_status.log`); azioni: esportare `GH_TOKEN=$CI_LOG_PAT`, rerun manuale da `main`, archiviare overlay in `logs/visual_runs` e log HTML/testuali in `logs/ci_runs` gestendo il caso skip se il flag venisse disattivato.
- **incoming-smoke.yml** – Owner: dev-tooling. Ultimo run `20012779896` in failure con artifact `incoming-smoke-logs` bloccato (403 SAS) nonostante PAT `workflow/repo`; serve rerun con input `data-root`/`pack-root` e log in `logs/incoming_smoke/` o un job esterno che fornisca i parametri. Tentativo 2025-12-09 bloccato senza `GH_TOKEN` (`logs/incoming_smoke/incoming_smoke_dispatch*.log`).
- **evo-batch.yml** – Owner: ops/dev-tooling. Dry-run `batch=traits` pianificato il 2026-07-06 (nessun log, vedi [log](../../logs/agent_activity.md)): eseguire con `execute=false` via script/dispatch e archiviare in `logs/ci_runs` prima di valutare `execute=true`.
- **Log harvester** – Garantire manutenzione del workflow `log-harvester.yml` (frequenza giornaliera, dispatch manuale di backup) e revisione periodica dei permessi del token (almeno `actions:read` + `contents:write`).

### Procedura rapida di autenticazione GH CLI e rerun manuali

1. **Esporta il PAT**: `export GH_TOKEN=$CI_LOG_PAT` e verifica con `GH_TOKEN=$CI_LOG_PAT gh auth status` che la sessione sia attiva (evita `gh auth login --with-token` che genera warning se `GH_TOKEN` è già impostato).
2. **Imposta il repo**: se necessario, `export GH_REPO=MasterDD-L34D/Game` per forzare il contesto.
3. **Dispatch workflow**: usa sempre il prefisso `GH_TOKEN=$CI_LOG_PAT gh workflow run <file>.yml -b main [input]` per data-quality/schema/traits/QA/deploy/HUD/incoming-smoke/log-harvester e recupera l’ID con `gh run list --workflow <file>.yml --limit 1`.
4. **Scarica log/artefatti**: `GH_TOKEN=$CI_LOG_PAT gh run download <id> --dir logs/ci_runs` (o `logs/visual_runs` / `logs/incoming_smoke` in base al workflow).
5. **Aggiorna il semaforo**: registra esito e percorsi log nella tabella sopra; se il download artefatti fallisce con 403, segnala agli owner per nuovi SAS/perms.

- **Rerun data-quality.yml** – Comando/branch: `gh workflow run data-quality.yml -r main` (owner: data). Stato: rerun 08/12/2025 in failure (run20012320492) con log `logs/ci_runs/data-quality_run20012320492_rerun.log`, errore catalogo specie vuoto e artefatto 403. Richiede fix e nuovo run da `main` appena pronti i cambi.
- **Rerun schema-validate.yml** – Comando/branch: `gh workflow run schema-validate.yml -r main` (owner: data). Stato: dispatch 08/12/2025 (run20037257496) in failure per `IndentationError` inline (`logs/ci_runs/schema-validate_run20037257496.log`); serve fix e nuovo run da `main` per rigenerare il log HTML/zip.
- **Rerun validate_traits.yml** – Comando/branch: `gh workflow run validate_traits.yml -r main` (owner: data). Stato: rerun 08/12/2025 su `main` (run20012325923) in failure per catalogo specie vuoto con log `logs/ci_runs/validate_traits_run20012325923_rerun.log`. Necessari fix e nuovo dispatch su `main`.
- **QA suite (qa-kpi-monitor + qa-export + qa-reports)** – Comando/branch: sequenza `gh workflow run qa-kpi-monitor.yml -r main` (visual on), poi `qa-export.yml` e `qa-reports.yml` da `main` (owner: QA). Prerequisiti: baseline KPI aggiornata, dati/pack stabili e accesso asset visual; PAT per artefatti. Log: `logs/visual_runs/` (monitor) e `logs/ci_runs/` (export/reports). Scadenza: entro 7 giorni; uscita: tutti i run verdi con upload log <7 giorni.

### Aggiornamenti ticket 03A/03B

- **03A** – Validator 02A schema-only rerun in **PASS** con manifest confermati (vedi `logs/ci_runs/freezer_validator_2026-07-24.log`). Gate chiuso con firma Master DD e freeze 03AB terminato; rollback pronto grazie ai manifest archiviati (`reports/backups/2025-11-25_freeze/manifest.txt`, `reports/backups/2025-11-29T0525Z_freeze_03A-03B/manifest.txt`, checkpoint Master DD). 【F:logs/ci_runs/freezer_validator_2026-07-24.log†L1-L10】【F:logs/agent_activity.md†L6-L10】
- **03B** – Smoke redirect staging in **PASS** su `http://localhost:8000` (report `reports/redirects/redirect-smoke-2026-07-24.json`). Gate chiuso con firma Master DD, freeze 03AB dichiarato chiuso e rollback pronto con manifest referenziati (`reports/backups/2025-11-25_freeze/manifest.txt`, `reports/backups/2025-11-29T0525Z_freeze_03A-03B/manifest.txt`, checkpoint Master DD). 【F:reports/redirects/redirect-smoke-2026-07-24.json†L1-L11】【F:logs/agent_activity.md†L6-L10】

### Come mantenere aggiornato l'inventario (versione automatica)

- Ogni lunedì o dopo i cron, esegui lo script di raccolta automatica: `gh run list --workflow <file.yml> --limit 1 --json databaseId,status,conclusion` per ottenere l’ID più recente, quindi `gh run download <id> --dir logs/ci_runs` (o `logs/visual_runs` / `logs/incoming_smoke`) usando un PAT con scope `workflow`/`read:org` autorizzato SSO.
- Per i workflow che non espongono `workflow_dispatch` (`ci.yml`) attendi push/PR; per i manuali con input (`incoming-smoke.yml`, `evo-batch.yml`, QA suite) valuta un job esterno che lanci `gh workflow run …` con i parametri richiesti prima di scaricare i log.
- Mantieni il semaforo go-live coerente con l’ultimo esito (verde se run completo <7 giorni e verde, giallo se log assente/vecchio, rosso se KO o step critici mancanti) usando i log scaricati automaticamente.
- Aggiorna le note con blocchi e retry pianificati, includendo eventuali esecuzioni programmate dallo scheduler o da job esterni, e archivia gli artefatti aggiuntivi nelle cartelle dedicate.
- Confronta settimanalmente con gli owner se servono dispatch mirati oltre ai cron, soprattutto per HUD (flag on), QA visual e incoming smoke.

## Script locali citati

- `scripts/cli_smoke.sh` – profili smoke CLI; input opzionali (profilo, root dati/pack) e log in `logs/*`.
- `scripts/trait_audit.py` – controlli coerenza catalogo trait; opzione `--check` per modalità verifica. Output baseline/coverage quando usato nei deploy.
- `scripts/run_deploy_checks.sh` – orchestrazione check deploy (usa bundle Playwright, vari env `DEPLOY_*`).
- `scripts/daily_tracker_refresh.py` – aggiorna tracker e JSON riepilogo.
- `scripts/export-qa-report.js` – genera QA badges/baseline/changelog in `reports/`.
- `scripts/build_trait_index.js` – costruisce indice trait.
- `scripts/trait_style_check.js` – verifica style guide trait e genera report JSON/MD.
- `scripts/evo_tactics_metadata_diff.py` – calcola diff/backfill archivio documentazione Evo.
- `scripts/prepare_static_site.py` – compila asset statici per Pages.
- `tools/py` utilities: `game_cli.py` (validate datasets/packs), `validate_datasets.py`, `report_trait_coverage.py`, `trait_completion_dashboard.py`, `trait_template_validator.py`, `styleguide_compliance_report.py`, `validate_registry_naming.py`, `validate_export.py`, `report_kpi_alerts.py`, `visual_regression.py`, `daily_pr_report.py`.
- `tools/automation/evo_batch_runner.py` – pianifica/esegue batch CI/ops.
- `tools/roadmap/update_status.py` – produce stato rollout settimanale.
- `tools/traits/sync_missing_index.py` / `evaluate_internal.py` – sync glossario/valutazioni.
- `ops/site-audit/generate_search_index.py` – costruisce indice ricerca e scrive in `public/search_index.json`.
- `tests/validate_dashboard.py` – validazione dashboard con metriche.

Nessuno script è marcato come "report-only" di default: quelli con flag `--check` o `--strict` falliscono in caso di errori.
